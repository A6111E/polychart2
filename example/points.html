<!DOCTYPE html>
<html>
  <head>
    <script>
      // for testing IE, remove array.indexOf
      // delete Array.prototype.indexOf;
    </script>
    <script type="text/javascript" src="../lib/raphael.js"></script>
    <script type="text/javascript" src="../lib/underscore.js"></script>
    <script type="text/javascript" src="../polychart2.js"></script>
  </head>
  <body>
    <div id="hello"></div>
    <div id="hello2"></div>
    <script type="text/javascript">
    function one() { return Math.random() * 10 }
    function pair() { return {x: one(), y: one()} }
    function construct() {
      var i, data = [];
      for (i = 0; i < 10; i++) {
        data.push(pair())
      }
      return {
        xmin: _.min(_.pluck(data, 'x'))-1,
        ymin: _.min(_.pluck(data, 'y'))-1,
        xmax: _.max(_.pluck(data, 'x'))+1,
        ymax: _.max(_.pluck(data, 'y'))+1,
        data: data
      }
    }
    spec = function() {
      var dt = construct()
      var jsondata = dt.data
      var data = new poly.Data({ json: jsondata });
      var sampleLayer = { data: data, type: 'point', x: 'x', y: 'y' };
      return {
        data : jsondata,
        spec : {
          layers: [sampleLayer],
          strict: true,
          guides: {
            x: { type: 'num', min: dt.xmin, max: dt.xmax },
            y: { type: 'num', min: dt.ymin, max: dt.ymax }
          }
        }
      };
    }

    initspec = spec().spec
    c = poly.chart(window.initspec)
    c.render('hello')

    function redraw() {
      var newspec = spec()
      initspec.layers[0].data.update(newspec.data)
      c.make(newspec.spec)
      c.render()
      setTimeout(redraw, 1000);
    }

    setTimeout(redraw, 1000)

    /*
    p2 = Raphael("hello2", 30,30)
    eve("*", function() {
      console.log(2)
      p2.circle(15,15,5)
    }) */
    </script>

  </body>
</html>


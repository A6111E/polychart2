(function(){var j;j=this.poly||{};j.groupBy=function(b,l){return _.groupBy(b,function(b){return _.reduce(l,function(f,a){return""+f+a+":"+b[a]+";"},"")})};j.linear=function(b,l,e,f){return function(a){return(f-l)/(e-b)*(a-b)+l}};j.median=function(b,l){var e;null==l&&(l=!1);l||(b=_.sortBy(b,function(b){return b}));e=b.length/2;return 0!==e%1?b[Math.floor(e)]:(b[e-1]+b[e])/2};this.poly=j;j.counter=function(){var b;b=0;return function(){return b++}};j.compare=function(b,l){return{deleted:_.difference(b,
l),kept:_.intersection(l,b),added:_.difference(l,b)}};j.flatten=function(b){var l,e,f,a;l=[];if(null!=b)if(_.isObject(b))if("scalefn"===b.t)"novalue"!==b.f&&l.push(b.v);else for(e in b)f=b[e],l=l.concat(j.flatten(f));else if(_.isArray(b)){e=0;for(a=b.length;e<a;e++)f=b[e],l=l.concat(j.flatten(f))}else l.push(b);return l};j.getLabel=function(b,l){return _.chain(b).map(function(b){return b.mapping[l]}).without(null,void 0).uniq().value().join(" | ")};j.strSize=function(b){return 7*(b+"").length};j.sortArrays=
function(b,l){return _.zip.apply(_,_.sortBy(_.zip.apply(_,l),function(e){return b(e[0])}))};j.varType=function(b){var l,e,f,a,c;a=e=l=0;for(c=b.length;a<c;a++)f=b[a],null!=f&&((!isNaN(f)||!isNaN(f.replace(/\$|\,/g,"")))&&e++,moment(f).isValid()&&l++);return e>0.95*b.length?"num":l>0.95*b.length?"date":"cat"};j.coerce=function(b,l){if("cat"===l.type)return b;if("num"===l.type)return isNaN(b)?+(""+b).replace(/\$|\,/g,""):+b;if("date"===l.type)return l.format?"unix"===l.format?moment.unix(b).unix():
moment(b,l.format).unix():moment(b).unix()};this.poly=j}).call(this);
(function(){var j;j=this.poly||{};j["const"]={aes:"x y color size opacity shape id text".split(" "),noLegend:["x","y","id","text","tooltip"],trans:{bin:["key","binwidth"],lag:["key","lag"]},stat:{count:["key"],sum:["key"],mean:["key"],box:["key"],median:["key"]},timerange:"second minute hour day week month year".split(" "),metas:{sort:null,stat:null,limit:null,asc:!0},scaleFns:{novalue:function(){return{v:null,f:"novalue",t:"scalefn"}},max:function(b){return{v:b,f:"max",t:"scalefn"}},min:function(b){return{v:b,
f:"min",t:"scalefn"}},upper:function(b){return{v:b,f:"upper",t:"scalefn"}},lower:function(b){return{v:b,f:"lower",t:"scalefn"}},middle:function(b){return{v:b,f:"middle",t:"scalefn"}},jitter:function(b){return{v:b,f:"jitter",t:"scalefn"}},identity:function(b){return{v:b,f:"identity",t:"scalefn"}}},epsilon:Math.pow(10,-7),defaults:{x:{v:null,f:"novalue",t:"scalefn"},y:{v:null,f:"novalue",t:"scalefn"},color:"steelblue",size:2,opacity:0.7}};this.poly=j}).call(this);
(function(){var j,b=Object.prototype.hasOwnProperty,l=function(a,c){function m(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);m.prototype=c.prototype;a.prototype=new m;a.__super__=c.prototype;return a};j=this.poly||{};var e=function(a){this.message=a;this.name="DefinitionError"};l(e,Error);var f=function(a){this.message=a;this.name="DependencyError"};l(f,Error);var a=function(a){this.message=a;this.name="ModeError"};l(a,Error);var c=function(a){this.message=a;this.name="DataError"};
l(c,Error);var d=function(a){this.message=a;this.name="UnknownInput"};l(d,Error);var m=function(a){this.message=a;this.name="ModeError"};l(m,Error);j.error=function(a){return Error(a)};j.error.data=function(a){return new c(a)};j.error.depn=function(a){return new f(a)};j.error.defn=function(a){return new e(a)};j.error.mode=function(c){return new a(c)};j.error.impl=function(a){return new m(a)};j.error.input=function(a){return new d(a)};this.poly=j}).call(this);
(function(){var j,b,l,e,f=Array.prototype.indexOf||function(a){for(var c=0,d=this.length;c<d;c++)if(c in this&&this[c]===a)return c;return-1};l=this.poly||{};l.format=function(a,c){switch(a){case "cat":return l.format.identity;case "num":return l.format.number(c);case "date":return l.format.date(c)}};l.format.identity=function(a){return a};j={"0":"",3:"k",6:"m",9:"b",12:"t"};e=function(a,c){return _.isUndefined(j[c])?a+"e"+(0<c?"+":"-")+Math.abs(c):a+j[c]};b=function(a){var c,d,m;if(!isFinite(a))return a;
d=""+a;c=Math.abs(a);1E3<=c&&(m=(""+c).split(/\./),c=m[0].length%3||3,m[0]=d.slice(0,c+(0>a))+m[0].slice(c).replace(/(\d{3})/g,",$1"),d=m.join("."));return d};l.format.number=function(a){return function(c){var d,m;m=0;d=null!=a?a:Math.floor(Math.log(Math.abs(0===c?1:c))/Math.LN10);null!=a&&(2===d||5===d||8===d||11===d)?(d+=1,m=1):-1===d?(d=0,m=null!=a?1:2):-2===d?(d=0,m=null!=a?2:3):1===d||2===d?d=0:3<d&&6>d?d=3:6<d&&9>d?d=6:9<d&&12>d?d=9:12<d&&15>d?d=12:m=null!=a?0:1;c=Math.round(c/Math.pow(10,d-
m));c/=Math.pow(10,m);c=c.toFixed(m);return e(b(c),d)}};l.format.date=function(a){0<=f.call(l["const"].timerange,a)||(a="day");if("second"===a)return function(a){return moment.unix(a).format("h:mm:ss a")};if("minute"===a)return function(a){return moment.unix(a).format("h:mm a")};if("hour"===a)return function(a){return moment.unix(a).format("MMM D h a")};if("day"===a||"week"===a)return function(a){return moment.unix(a).format("MMM D")};if("month"===a)return function(a){return moment.unix(a).format("YY/MM")};
if("year"===a)return function(a){return moment.unix(a).format("YYYY")}}}).call(this);
(function(){poly.xhr=function(j,b,l){var e;e=new XMLHttpRequest;3>arguments.length?(l=b,b=null):b&&e.overrideMimeType&&e.overrideMimeType(b);e.open("GET",j,!0);b&&e.setRequestHeader("Accept",b);e.onreadystatechange=function(){var b;if(4===e.readyState)return b=e.status,b=!b&&e.response||200<=b&&300>b||304===b?e:null,l(b)};return e.send(null)};poly.text=function(j,b,l){3>arguments.length&&(l=b,b=null);return poly.xhr(j,b,function(b){return l(b&&b.responseText)})};poly.json=function(j,b){return poly.text(j,
"application/json",function(l){return b(l?JSON.parse(l):null)})};poly.dsv=function(j,b){var l,e,f,a,c,d,m;m=RegExp("\r\n|["+j+"\r\n]","g");d=RegExp('["'+j+"\n]");l=j.charCodeAt(0);f=function(c){return c.map(a).join(j)};a=function(a){var c;return null!=(c=d.test(a))?c:'"'+a.replace(/\"/g,'""')+{'"':a}};c=null;e=function(a,c){return poly.text(a,b,function(a){return c(a&&e.parse(a))})};e.parse=function(a){return e.parseRows(a,function(a,m){var b,d,r;if(m){r={};b=-1;for(d=c.length;++b<d;)r[c[b]]=a[b];
return r}c=a;return null})};e.parseRows=function(a,c){var b,d,f,r,p,e,h,g;d={};b={};e=[];p=0;r=h=null;m.lastIndex=0;for(g=function(){var g,h,c;if(m.lastIndex>=a.length)return b;if(r)return r=!1,d;c=m.lastIndex;if(34===a.charCodeAt(c)){for(h=c;h++<a.length;)if(34===a.charCodeAt(h)){if(34!==a.charCodeAt(h+1))break;h++}m.lastIndex=h+2;g=a.charCodeAt(h+1);13===g?(r=!0,10===a.charCodeAt(h+2)&&m.lastIndex++):10===g&&(r=!0);return a.substring(c+1,h).replace(/""/g,'"')}if(g=m.exec(a))return r=g[0].charCodeAt(0)!==
l,a.substring(c,g.index);m.lastIndex=a.length;return a.substring(c)};(h=g())!==b;){for(f=[];h!==d&&h!==b;)f.push(h),h=g();(!c||(f=c(f,p++)))&&e.push(f)}return e};e.format=function(a){return a.map(f).join("\n")};return e};poly.csv=poly.dsv(",","text/csv")}).call(this);
(function(){var j,b,l,e,f,a,c,d,m,z,n,s,u,v,r,p,x,h,g,q,w,y,B,D,t,k,A,F,G,R=Array.prototype.slice,S=Object.prototype.hasOwnProperty,H=function(a,g){function h(){this.constructor=a}for(var k in g)S.call(g,k)&&(a[k]=g[k]);h.prototype=g.prototype;a.prototype=new h;a.__super__=g.prototype;return a};y=this.poly||{};F=function(a,g){var h,k,c,q;h=a.length;q=['"',"'"];k=0;for(c=q.length;k<c;k++)if(g=q[k],a[0]===g&&a[h-1]===g)return a.slice(1,h-2+1||9E9);return a};G=function(a,g){var h,k,c,q;q=[];h=0;for(c=
a.length;h<c;h++)k=a[h],q.push([k,g[h]]);return q};a=function(a){var g,h,k,c,q;h={};c=0;for(q=a.length;c<q;c++)k=a[c],g=k[0],k=k[1],h[g]=k;return h};m=function(a,g,h){null==h&&(h=null);return g in a&&a[g]||h};z=function(a,g){var h,k,c;k={};for(c in g)h=g[c],h=m(a,c,h),null!==h&&(k[c]=h);return k};v=function(a){var h,g,k,c,q;g={};c=0;for(q=a.length;c<q;c++)for(k in h=a[c],h)g[k]=h[k].concat(m(g,k,[]));return g};c=function(a,h){var g,k,c,q,t;null==h&&(h=function(a){return a});g={};q=0;for(t=a.length;q<
t;q++)k=a[q],g[h(k)]=k;q=[];for(c in g)k=g[c],q.push(k);return q};d=function(a){return function(h){return c(h,function(h){return h[a]})}};B=function(a,h){return""+a+"("+h+")"};D=function(a){return"["+a+"]"};var I=function(a){var h,g,k,c;c=[];g=0;for(k=a.length;g<k;g++)h=a[g],c.push(h);this.buffer=c.reverse()};I.prototype.empty=function(){return 0===this.buffer.length};I.prototype.peek=function(){return this.empty()?null:this.buffer[this.buffer.length-1]};I.prototype.get=function(){return this.empty()?
null:this.buffer.pop()};I.prototype.toString=function(){return B("Stream",D(R.call(this.buffer).reverse()))};var C=function(a){this.tag=a};C.Tag={symbol:"symbol",literal:"literal",lparen:"(",rparen:")",comma:","};C.prototype.toString=function(){return"<"+this.contents().toString()+">"};C.prototype.contents=function(){return[this.tag]};var J=function(a){this.name=a;this.name=F(this.name);J.__super__.constructor.call(this,C.Tag.symbol)};H(J,C);J.prototype.contents=function(){return J.__super__.contents.call(this).concat([this.name])};
f=J;var K=function(a){this.val=a;this.val=F(this.val);K.__super__.constructor.call(this,C.Tag.literal)};H(K,C);K.prototype.contents=function(){return K.__super__.contents.call(this).concat([this.val])};l=K;var E,Q,P,L;P=[C.Tag.lparen,C.Tag.rparen,C.Tag.comma];L=[];E=0;for(Q=P.length;E<Q;E++)t=P[E],L.push(new C(t));b=L[0];e=L[1];j=L[2];A=[[/^\(/,function(){return b}],[/^\)/,function(){return e}],[/^,/,function(){return j}],[/^[+-]?(0x[0-9a-fA-F]+|0?\.\d+|[1-9]\d*(\.\d+)?|0)([eE][+-]?\d+)?/,function(a){return new l(a)}],
[/^(\w|[^\u0000-\u0080])+|'((\\.)|[^\\'])+'|"((\\.)|[^\\"])+"/,function(a){return new f(a)}]];u=function(a){var h,g,k,c;k=0;for(c=A.length;k<c;k++)if(g=A[k],h=g[0],g=g[1],h=h.exec(a))return k=h[0],[a.slice(k.length),g(k)];throw y.error.defn("There is an error in your specification at "+a);};k=function(a){var h,g;for(g=[];;){a=a.replace(/^\s+/,"");if(!a)break;h=u(a);a=h[0];h=h[1];g.push(h)}return g};E=function(){};E.prototype.toString=function(){return B(this.constructor.name,this.contents())};var M=
function(a){this.name=a};H(M,E);M.prototype.contents=function(){return[this.name]};M.prototype.pretty=function(){return this.name};M.prototype.visit=function(a){return a.ident(this,this.name)};var N=function(a){this.val=a};H(N,E);N.prototype.contents=function(){return[this.val]};N.prototype.pretty=function(){return this.val};N.prototype.visit=function(a){return a["const"](this,this.val)};var O=function(a,h){this.fname=a;this.args=h};H(O,E);O.prototype.contents=function(){return[this.fname,D(this.args)]};
O.prototype.pretty=function(){var a,h=this.fname,g,k,c,q;c=this.args;q=[];g=0;for(k=c.length;g<k;g++)a=c[g],q.push(a.pretty());return B(h,q)};O.prototype.visit=function(a){var h;return a.call(this,this.fname,function(){var g,k,c,q;c=this.args;q=[];g=0;for(k=c.length;g<k;g++)h=c[g],q.push(h.visit(a));return q}.call(this))};n=function(a,h,g){var k,c,q,b;c=a.peek();if(null!==c){q=0;for(b=g.length;q<b;q++)if(k=g[q],t=k[0],k=k[1],c.tag===t)return k(a)}return h(a)};q=function(a){throw y.error.defn("There is an error in your specification at "+
a.toString());};r=function(a){var h;h=new I(k(a));a=g(h);if(null!==h.peek())throw y.error.defn("There is an error in your specification at "+h.toString());return a};g=function(a){return n(a,q,[[C.Tag.literal,h],[C.Tag.symbol,w]])};h=function(a){return new N(a.get().val)};w=function(a){var h;h=a.get().name;return n(a,function(){return new M(h)},[[C.Tag.lparen,p(h)]])};p=function(a){return function(h){h.get();h=n(h,x([]),[[C.Tag.rparen,function(a){a.get();return[]}]]);return new O(a,h)}};x=function(a){return function(h){var k,
c;k=g(h);c=a.concat([k]);return n(h,q,[[C.Tag.rparen,function(a){a.get();return c}],[C.Tag.comma,function(a){a.get();return x(c)(a)}]])}};s=function(h){var g;g={trans:[],stat:[]};h.visit({ident:function(a,h){return h},"const":function(a,h){return h},call:function(h,k,c){var q,t;t=k in y["const"].trans?"trans":k in y["const"].stat?"stat":"none";if("none"!==t)return q=y["const"][t][k],c=a(G(q,c)),c.name=h.pretty(),c[t]=k,g[t].push(c),c.name;throw y.error.defn("The operation "+k+" is not recognized. Please check your specifications.");
}});return g};y.parser={tokenize:k,parse:r,layerToData:function(h){var g,k,q,t,b,m,w,A,p;b={};w=null!=(m=h.filter)?m:{};for(k in w)m=w[k],b[r(k).pretty()]=m;q=y["const"].aes;p=[];m=0;for(g=q.length;m<g;m++)w=q[m],p.push([w,null]);g=z(h,a(p));for(k in g)"var"in g[k]||delete g[k];p=[];w=[];m=[];h={};for(k in g)q=g[k],t=r(q["var"]),q["var"]=t.pretty(),t=s(t),p.push(t),w.push(q["var"]),0===t.stat.length&&m.push(q["var"]),"sort"in q&&(t=z(q,y["const"].metas),A=r(t.sort),t.sort=A.pretty(),A=s(A),0!==A.stat.length&&
(t.stat=A.stat),h[q["var"]]=t);g=v(p);k=d("name");m={stats:k(g.stat),groups:c(m)};return{trans:k(g.trans),stats:m,meta:h,select:c(w),filter:b}}};this.poly=y}).call(this);
(function(){var j,b,l,e=Object.prototype.hasOwnProperty,f=function(a,c){function b(){this.constructor=a}for(var d in c)e.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a};l=this.poly||{};var a=function(a){var c;null==a&&(a={});this.flip=null!=(c=a.flip)?c:!1;this.scales=null;a=this.flip?["y","x"]:["x","y"];this.x=a[0];this.y=a[1]};a.prototype.make=function(a){return this.dims=a};a.prototype.setScales=function(a){return this.scales={x:a.x.f,y:a.y.f}};
a.prototype.clipping=function(){return[this.dims.paddingLeft+this.dims.guideLeft,this.dims.paddingTop+this.dims.guideTop,this.dims.chartWidth,this.dims.chartHeight]};a.prototype.ranges=function(){};var c=function(){c.__super__.constructor.apply(this,arguments)};f(c,a);c.prototype.type="cartesian";c.prototype.ranges=function(){var a;a={};a[this.x]={min:this.dims.paddingLeft+this.dims.guideLeft,max:this.dims.paddingLeft+this.dims.guideLeft+this.dims.chartWidth};a[this.y]={min:this.dims.paddingTop+this.dims.guideTop+
this.dims.chartHeight,max:this.dims.paddingTop+this.dims.guideTop};return a};c.prototype.axisType=function(a){return this[a]};c.prototype.getXY=function(a,c){var b,d;if(a)return b={x:_.isArray(c.x)?_.map(c.x,this.scales.x):this.scales.x(c.x),y:_.isArray(c.y)?_.map(c.y,this.scales.y):this.scales.y(c.y)},{x:b[this.x],y:b[this.y]};b=this.scales[this.x];d=this.scales[this.y];return{x:_.isArray(c.x)?_.map(c.x,b):b(c.x),y:_.isArray(c.y)?_.map(c.y,d):d(c.y)}};c.prototype.getAes=function(a,c,b){return{x:b.x(a[this.x],
c[this.x]),y:b.y(a[this.y],c[this.y])}};j=c;var d=function(){var a=this.getXY,c=this;this.getXY=function(){return a.apply(c,arguments)};d.__super__.constructor.apply(this,arguments)};f(d,a);d.prototype.type="polar";d.prototype.make=function(a){this.dims=a;this.cx=this.dims.paddingLeft+this.dims.guideLeft+this.dims.chartWidth/2;return this.cy=this.dims.paddingTop+this.dims.guideTop+this.dims.chartHeight/2};d.prototype.ranges=function(){var a,c,b;c=[this.x,this.y];a=c[0];b=c[1];c={};c[b]={min:0,max:2*
Math.PI};c[a]={min:0,max:Math.min(this.dims.chartWidth,this.dims.chartHeight)/2-10};return c};d.prototype.axisType=function(a){return"x"===this[a]?"r":"t"};d.prototype.getXY=function(a,c){var b,d,f,e,r,p,x,h,g,q,w,y,B,D,t=this;w=function(a,h){return t.cx+a*Math.cos(h-Math.PI/2)};y=function(a,h){return t.cy+a*Math.sin(h-Math.PI/2)};d=[this.x,this.y];r=d[0];x=d[1];if(a){if(_.isArray(c[r])){e={x:[],y:[],r:[],t:[]};B=c[r];d=0;for(b=B.length;d<b;d++)p=B[d],p=this.scales[r](p),h=this.scales[x](c[x][d]),
e.x.push(w(p,h)),e.y.push(y(p,h)),e.r.push(p),e.t.push(h);return e}p=this.scales[r](c[r]);h=this.scales[x](c[x]);return{x:w(p,h),y:y(p,h),r:p,t:h}}f=function(a){return _.isObject(a)&&"scalefn"===a.t&&"identity"===a.f};b=function(a,g){var c,q;c=f(a);q=f(g);if(c&&!q)return{x:a.v,y:y(t.scales[r](g),0)};if(c&&q)return{x:a.v,y:g.v};if(!c&&q)return{y:g.v,x:y(t.scales[x](a),0)};p=t.scales[r](g);h=t.scales[x](a);return{x:w(p,h),y:y(p,h)}};if(_.isArray(c.x)){e={x:[],y:[]};D=c.x;d=0;for(B=D.length;d<B;d++)g=
D[d],q=c.y[d],q=b(g,q),g=q.x,q=q.y,e.x.push(g),e.y.push(q);return e}return b(c.x,c.y)};b=d;l.coord={cartesian:function(a){return new j(a)},polar:function(a){return new b(a)}}}).call(this);
(function(){var j,b,l,e,f,a,c,d,m,z,n;n=this.poly||{};e=n["const"].aes;n.domain={};n.domain.make=function(a,c,b){var r,p,f,h;r=[];f=0;for(h=a.length;f<h;f++)p=a[f],r.push(d(p,c,b));return m(r)};n.domain.sortfn=function(a){switch(a.type){case "num":return function(a){return a};case "date":return function(a){return a};case "cat":return function(c){if(-1===_.indexOf(a.levels,c))return Infinity}}};l=function(a){this.type=a.type;this.min=a.min;this.max=a.max;this.bw=a.bw};b=function(a){this.type=a.type;
this.min=a.min;this.max=a.max;this.bw=a.bw};j=function(a){this.type=a.type;this.levels=a.levels;this.sorted=a.sorted};c=function(a){switch(a.type){case "num":return new l(a);case "date":return new b(a);case "cat":return new j(a)}};d=function(b,d,m){var r,p,f,h,g,q,w,e,B,D,t,k,A;f={};for(r in b.mapping)if(m)f[r]=c(d[r]);else switch(q=a(b.geoms,r),p=null!=(w=b.getMeta(r))?w:{},h=function(a){return null!=d[r]?d[r][a]:null},p.type){case "num":p=null!=(e=h("bw"))?e:p.bw;g=null!=(B=h("min"))?B:_.min(q);
h=null!=(D=h("max"))?D:_.max(q)+(null!=p?p:0);f[r]=c({type:"num",min:g,max:h,bw:p});break;case "date":p=null!=(t=h("bw"))?t:p.bw;g=null!=(k=h("min"))?k:_.min(q);h=h("max");null==h&&(h=_.max(q),p&&(h=moment.unix(h).add(p+"s",1).unix()));f[r]=c({type:"date",min:g,max:h,bw:p});break;case "cat":f[r]=c({type:"cat",levels:null!=(A=h("levels"))?A:_.uniq(q),sorted:null!=h("levels")})}return f};a=function(a,c){var b,d,p,f,h;f=[];for(d in a)for(p in b=a[d],h=b.marks,h)b=h[p],f=f.concat(n.flatten(b[c]));return f};
m=function(a){var c,b,d,p,f;d={};p=0;for(f=e.length;p<f;p++)c=e[p],b=_.without(_.pluck(a,c),void 0),0<b.length&&(d[c]=z(b));return d};f={num:function(a){var b,d;b=_.compact(_.uniq(_.map(a,function(a){return a.bw})));if(1<b.length)throw n.error.data("Not all layers have the same binwidth.");b=null!=(d=b[0])?d:void 0;d=_.min(_.map(a,function(a){return a.min}));a=_.max(_.map(a,function(a){return a.max}));return c({type:"num",min:d,max:a,bw:b})},date:function(a){var b,d;b=_.compact(_.uniq(_.map(a,function(a){return a.bw})));
if(1<b.length)throw n.error.data("Not all layers have the same binwidth.");b=null!=(d=b[0])?d:void 0;d=_.min(_.map(a,function(a){return a.min}));a=_.max(_.map(a,function(a){return a.max}));return c({type:"date",min:d,max:a,bw:b})},cat:function(a){var b;b=_.chain(a).filter(function(a){return a.sorted}).map(function(a){return a.levels}).value();a=_.chain(a).filter(function(a){return!a.sorted}).map(function(a){return a.levels}).value();if(0<b.length&&_.intersection.apply(this,b))throw n.error.data("You are trying to combine incompatiabl sorted domains in the same axis.");
b=[_.flatten(b,!0)];a=_.union.apply(this,b.concat(a));0===b[0].length&&(a=a.sort());return c({type:"cat",levels:a,sorted:!0})}};z=function(a){var c;c=_.uniq(_.map(a,function(a){return a.type}));if(1<c.length)throw n.error.data("You are trying to merge data of different types in the same axis or legend.");return f[c[0]](a)};this.poly=n}).call(this);
(function(){var j,b,l,e,f;l=this.poly||{};l.tick={};l.tick.make=function(a,c,b){var m,j,n,s;m=null;null!=c.ticks?a=c.ticks:(m=null!=(j=c.numticks)?j:5,m=f[b](a,m),a=m.ticks,m=m.step);m=c.labels?function(a){var b;return null!=(b=c.labels[a])?b:a}:c.formatter?c.formatter:l.format(b,m);b={};j=e(m);n=0;for(s=a.length;n<s;n++)m=a[n],b[m]=j(m);return b};j=function(a){this.location=a.location;this.value=a.value;this.index=a.index};e=function(a){var c;c=0;return function(b){return new j({location:b,value:a(b),
index:c++})}};b=function(a,c){var b,f;f=Math.pow(10,Math.floor(Math.log(a/c)/Math.LN10));b=c/a*f;0.15>b?f*=10:0.35>=b?f*=5:0.75>=b&&(f*=2);return f};f={cat:function(a,c){var b,f,e,n,l,j;e=Math.max(1,Math.round(a.levels.length/c));n=[];j=a.levels;b=0;for(l=j.length;b<l;b++)f=j[b],0===b%e&&n.push(f);return{ticks:n}},num:function(a,c){var d,f,e,n;f=a.min;d=a.max;e=b(d-f,c);n=Math.ceil(f/e)*e;for(f=[];n<d;)f.push(n),n+=e;return{ticks:f,step:Math.floor(Math.log(e)/Math.LN10)}},"num-log":function(a,c){var d,
f,e,n,j,u,v,r;u=a.min;j=a.max;f=function(a){return Math.log(a)/Math.LN10};d=function(a){return Math.exp(a*Math.LN10)};n=Math.max(f(u),0);e=f(j);r=b(e-n,c);for(n=Math.ceil(n/r)*r;n<e+l["const"].epsilon;)if(0!==n%1&&0.1>=n%1)n+=r;else{if(n%1>l["const"].epsilon&&(v=Math.floor(n)+f(10*(n%1)),0===v%1)){n+=r;continue}v=d(v);v<u||v>j?n+=r:ticks.push(v)}return{ticks:ticks}},date:function(a,c){var b,f,e,n;b=a.min;f=a.max;e=(f-b)/c;e=1.4>e?"second":84>e?"minute":5040>e?"hour":120960>e?"day":846720>e?"week":
3628800>e?"month":"year";n=[];for(b=moment.unix(b).startOf(e);b.unix()<f;)n.push(b.unix()),b.add(e+"s",1);return{ticks:n,step:e}}};this.poly=l}).call(this);
(function(){var j,b,l,e,f,a,c=function(a,g){return function(){return a.apply(g,arguments)}},d=Object.prototype.hasOwnProperty,m=function(a,g){function c(){this.constructor=a}for(var b in g)d.call(g,b)&&(a[b]=g[b]);c.prototype=g.prototype;a.prototype=new c;a.__super__=g.prototype;return a},z=Array.prototype.indexOf||function(a){for(var g=0,c=this.length;g<c;g++)if(g in this&&this[g]===a)return g;return-1};f=this.poly||{};a=f["const"].scaleFns;var n=function(){};n.prototype.getDimension=function(){throw f.error.impl();
};var s=function(){this._modify=c(this._modify,this);this._add=c(this._add,this);this.render=c(this.render,this);this.make=c(this.make,this);this.title=this.line=null;this.position="none";this.titletext=null;this.ticks={};this.pts={}};m(s,n);s.prototype.make=function(a){var g,c,b,d;g=a.domain;b=a.type;c=a.guideSpec;a=a.key;this.titletext=null!=(d=c.title)?d:a;this.ticks=f.tick.make(g,c,b);return this.maxwidth=_.max(_.map(this.ticks,function(a){return f.strSize(a.value)}))};s.prototype.render=function(a,
g){var c,b,d,e,p,t,k,A;b={top:a.paddingTop+a.guideTop,left:a.paddingLeft+a.guideLeft,right:a.paddingLeft+a.guideLeft+a.chartWidth,bottom:a.paddingTop+a.guideTop+a.chartHeight,width:a.chartWidth,height:a.chartHeight};null!=this.line&&g.remove(this.line);this.line=this._renderline(g,b);this.title=null!=this.title?g.animate(this.title,this._makeTitle(b,this.titletext)):g.add(this._makeTitle(b,this.titletext));p=f.compare(_.keys(this.pts),_.keys(this.ticks));d=p.deleted;e=p.kept;c=p.added;p={};k=0;for(A=
e.length;k<A;k++)t=e[k],p[t]=this._modify(g,this.pts[t],this.ticks[t],b);e=0;for(k=c.length;e<k;e++)t=c[e],p[t]=this._add(g,this.ticks[t],b);b=0;for(c=d.length;b<c;b++)t=d[b],this._delete(g,this.pts[t]);this.pts=p;return this.rendered=!0};s.prototype._add=function(a,c,b){var d;d={};d.tick=a.add(this._makeTick(b,c));d.text=a.add(this._makeLabel(b,c));return d};s.prototype._delete=function(a,c){a.remove(c.tick);return a.remove(c.text)};s.prototype._modify=function(a,c,b,d){var f;f={};f.tick=a.animate(c.tick,
this._makeTick(d,b));f.text=a.animate(c.text,this._makeLabel(d,b));return f};s.prototype._renderline=function(){throw f.error.impl();};s.prototype._makeTitle=function(){throw f.error.impl();};s.prototype._makeTick=function(){throw f.error.impl();};s.prototype._makeLabel=function(){throw f.error.impl();};var u=function(){this.make=c(this.make,this);u.__super__.constructor.apply(this,arguments)};m(u,s);u.prototype.make=function(a){var c,b;this.position=null!=(c=a.guideSpec.position)?c:"bottom";if("top"!==
(b=this.position)&&"bottom"!==b&&"none"!==b)throw f.error.defn("X-axis position can't be "+this.position+".");return u.__super__.make.call(this,a)};u.prototype._renderline=function(c,g){var b,d,f;f="top"===this.position?a.identity(g.top):a.identity(g.bottom);b=a.identity(g.left);d=a.identity(g.left+g.width);return c.add({type:"path",y:[f,f],x:[b,d],stroke:a.identity("black")})};u.prototype._makeTitle=function(c,g){var b;b="top"===this.position?a.identity(c.top-27):a.identity(c.bottom+27);return{type:"text",
x:a.identity(c.left+c.width/2),y:b,text:g,"text-anchor":"middle"}};u.prototype._makeTick=function(c,g){var b,d;"top"===this.position?(b=a.identity(c.top),d=a.identity(c.top-5)):(b=a.identity(c.bottom),d=a.identity(c.bottom+5));return{type:"path",x:[g.location,g.location],y:[b,d],stroke:a.identity("black")}};u.prototype._makeLabel=function(c,g){var b;b="top"===this.position?a.identity(c.top-15):a.identity(c.bottom+15);return{type:"text",x:g.location,y:b,text:g.value,"text-anchor":"middle"}};u.prototype.getDimension=
function(){var a;return{position:null!=(a=this.position)?a:"bottom",height:30,width:"all"}};l=u;var v=function(){this.make=c(this.make,this);v.__super__.constructor.apply(this,arguments)};m(v,s);v.prototype.make=function(a){var c,b;this.position=null!=(c=a.guideSpec.position)?c:"left";if("left"!==(b=this.position)&&"right"!==b&&"none"!==b)throw f.error.defn("X-axis position can't be "+this.position+".");return v.__super__.make.call(this,a)};v.prototype._renderline=function(c,g){var b,d,f;b="left"===
this.position?a.identity(g.left):a.identity(g.right);d=a.identity(g.top);f=a.identity(g.top+g.height);return c.add({type:"path",x:[b,b],y:[d,f],stroke:a.identity("black")})};v.prototype._makeTitle=function(c,b){return{type:"text",x:"left"===this.position?a.identity(c.left-this.maxwidth-15):a.identity(c.right+this.maxwidth+15),y:a.identity(c.top+c.height/2),text:b,transform:"r270","text-anchor":"middle"}};v.prototype._makeTick=function(c,b){var d,f;"left"===this.position?(d=a.identity(c.left),f=a.identity(c.left-
5)):(d=a.identity(c.right),f=a.identity(c.right+5));return{type:"path",x:[d,f],y:[b.location,b.location],stroke:a.identity("black")}};v.prototype._makeLabel=function(c,b){return{type:"text",x:"left"===this.position?a.identity(c.left-7):a.identity(c.right+7),y:b.location,text:b.value,"text-anchor":"left"===this.position?"end":"start"}};v.prototype.getDimension=function(){var a;return{position:null!=(a=this.position)?a:"right",height:"all",width:20+this.maxwidth}};e=v;var r=function(){r.__super__.constructor.apply(this,
arguments)};m(r,s);r.prototype._renderline=function(c,b){var d,f,e;d=a.identity(b.left);f=a.identity(b.top);e=a.identity(b.top+b.height/2);return c.add({type:"path",x:[d,d],y:[f,e],stroke:a.identity("black")})};r.prototype._makeTitle=function(c,b){return{type:"text",x:a.identity(c.left-this.maxwidth-15),y:a.identity(c.top+c.height/4),text:b,transform:"r270","text-anchor":"middle"}};r.prototype._makeTick=function(c,b){return{type:"path",x:[a.identity(c.left),a.identity(c.left-5)],y:[b.location,b.location],
stroke:a.identity("black")}};r.prototype._makeLabel=function(c,b){return{type:"text",x:a.identity(c.left-7),y:b.location,text:b.value,"text-anchor":"end"}};r.prototype.getDimension=function(){return{position:"left",height:"all",width:20+this.maxwidth}};j=r;var p=function(){p.__super__.constructor.apply(this,arguments)};m(p,s);p.prototype._renderline=function(c,b){var d;d=Math.min(b.width,b.height)/2-10;return c.add({type:"circle",x:a.identity(b.left+b.width/2),y:a.identity(b.top+b.height/2),size:a.identity(d),
color:a.identity("none"),stroke:a.identity("black"),"stroke-width":1})};p.prototype._makeTitle=function(c,b){return{type:"text",x:a.identity(c.left+c.width/2),y:a.identity(c.bottom+27),text:b,"text-anchor":"middle"}};p.prototype._makeTick=function(c,b){Math.min(c.width,c.height);return{type:"path",x:[b.location,b.location],y:[a.max(0),a.max(3)],stroke:a.identity("black")}};p.prototype._makeLabel=function(c,b){Math.min(c.width,c.height);return{type:"text",x:b.location,y:a.max(12),text:b.value,"text-anchor":"middle"}};
p.prototype.getDimension=function(){return{}};b=p;var x=function(a){this.aes=a;this._makeTick=c(this._makeTick,this);this.make=c(this.make,this);this.rendered=!1;this.title=null;this.ticks={};this.pts={}};m(x,n);x.prototype.TITLEHEIGHT=15;x.prototype.TICKHEIGHT=12;x.prototype.SPACING=10;x.prototype.make=function(a){var c,b,d,e;c=a.domain;d=a.type;b=a.guideSpec;this.mapping=a.mapping;a=a.keys;this.titletext=null!=(e=b.title)?e:a;this.ticks=f.tick.make(c,b,d);this.height=this.TITLEHEIGHT+this.SPACING+
this.TICKHEIGHT*_.size(this.ticks);b=f.strSize(this.titletext);c=_.max(_.map(this.ticks,function(a){return f.strSize(a.value)}));return this.maxwidth=Math.max(b,c)};x.prototype.render=function(a,c,b){var d,e,p,r,t,k;a={top:a.paddingTop+a.guideTop+b.y,right:a.paddingLeft+a.guideLeft+a.chartWidth+b.x,width:a.guideRight,height:a.chartHeight};this.title=null!=this.title?c.animate(this.title,this._makeTitle(a,this.titletext)):c.add(this._makeTitle(a,this.titletext));b=f.compare(_.keys(this.pts),_.keys(this.ticks));
d=b.deleted;e=b.kept;b=b.added;p={};t=0;for(k=d.length;t<k;t++)r=d[t],this._delete(c,this.pts[r]);d=0;for(t=e.length;d<t;d++)r=e[d],p[r]=this._modify(c,this.pts[r],this.ticks[r],a);e=0;for(d=b.length;e<d;e++)r=b[e],p[r]=this._add(c,this.ticks[r],a);return this.pts=p};x.prototype.remove=function(a){var c,b,d;d=this.pts;for(c in d)b=d[c],this._delete(a,b);a.remove(this.title);this.title=null;return this.pts={}};x.prototype._add=function(a,c,b){var d;d={};d.tick=a.add(this._makeTick(b,c));d.text=a.add(this._makeLabel(b,
c));return d};x.prototype._delete=function(a,c){a.remove(c.tick);return a.remove(c.text)};x.prototype._modify=function(a,c,b,d){var f;f=[];f.tick=a.animate(c.tick,this._makeTick(d,b));f.text=a.animate(c.text,this._makeLabel(d,b));return f};x.prototype._makeLabel=function(c,b){return{type:"text",x:a.identity(c.right+15),y:a.identity(c.top+(15+12*b.index)+1),text:b.value,"text-anchor":"start"}};x.prototype._makeTick=function(c,b){var d,e,p,r;e={type:"circle",x:a.identity(c.right+7),y:a.identity(c.top+
(15+12*b.index)),color:a.identity("steelblue")};r=this.mapping;for(d in r)p=r[d],0<=z.call(f["const"].noLegend,d)||(p=p[0],e[d]=0<=z.call(this.aes,d)?b.location:null!=p.type&&"const"===p.type?a.identity(p.value):_.isObject(p)?a.identity(f["const"].defaults[d]):a.identity(p));0<=z.call(this.aes,"size")||(e.size=a.identity(5));return e};x.prototype._makeTitle=function(c,b){return{type:"text",x:a.identity(c.right+5),y:a.identity(c.top),text:b,"text-anchor":"start"}};x.prototype.getDimension=function(){return{position:"right",
height:this.height,width:15+this.maxwidth}};f.guide={};f.guide.axis=function(a){if("x"===a)return new l;if("y"===a)return new e;if("r"===a)return new j;if("t"===a)return new b};f.guide.legend=function(a){return new x(a)};this.poly=f}).call(this);
(function(){var j,b,l,e,f,a,c,d,m=function(a,c){return function(){return a.apply(c,arguments)}},z=Object.prototype.hasOwnProperty,n=function(a,c){function b(){this.constructor=a}for(var k in c)z.call(c,k)&&(a[k]=c[k]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a};d=this.poly||{};d.scale={linear:function(a){return new f(a)},log:function(c){return new a(c)},area:function(a){return new j(a)},color:function(a){return new b(a)},gradient:function(a){return new l(a)},identity:function(a){return new e(a)},
opacity:function(a){return new c(a)}};var s=function(){this.f=null};s.prototype.make=function(a){this.domain=a;this.sortfn=d.domain.sortfn(a);switch(a.type){case "num":return this._makeNum();case "date":return this._makeDate();case "cat":return this._makeCat()}};s.prototype._makeNum=function(){throw d.error.impl("You are using a scale that does not support numbers");};s.prototype._makeDate=function(){throw d.error.impl("You are using a scale that does not support dates");};s.prototype._makeCat=function(){throw d.error.impl("You are using a scale that does not support categoies");
};s.prototype.tickType=function(){switch(this.domain.type){case "num":return this._tickNum(this.domain);case "date":return this._tickDate(this.domain);case "cat":return this._tickCat(this.domain)}};s.prototype._tickNum=function(){return"num"};s.prototype._tickDate=function(){return"date"};s.prototype._tickCat=function(){return"cat"};s.prototype._identityWrapper=function(a){return function(c){return _.isObject(c)&&"scalefn"===c.t&&"identity"===c.f?c.v:a(c)}};var u=function(){this._catWrapper=m(this._catWrapper,
this);this._dateWrapper=m(this._dateWrapper,this);this._numWrapper=m(this._numWrapper,this);this.finv=this.f=null};n(u,s);u.prototype.make=function(a,c){this.range=c;return u.__super__.make.call(this,a)};u.prototype._numWrapper=function(a,c){var b=this;return function(k){var g;g=0.001*(b.range.max>b.range.min?1:-1);if(_.isObject(k)){if("scalefn"===k.t){if("identity"===k.f)return k.v;if("upper"===k.f)return c(k.v+a.bw)-g;if("lower"===k.f)return c(k.v)+g;if("middle"===k.f)return c(k.v+a.bw/2);if("max"===
k.f)return b.range.max+k.v;if("min"===k.f)return b.range.min+k.v}throw d.error.input("Unknown object "+k+" is passed to a scale");}return c(k)}};u.prototype._dateWrapper=function(a,c){var b=this;return function(k){var g;g=0.001*(b.range.max>b.range.min?1:-1);if(_.isObject(k)){if("scalefn"===k.t){if("identity"===k.f)return k.v;if("upper"===k.f)return k=moment.unix(k.v).endOf(a.bw).unix(),c(k)-g;if("lower"===k.f)return k=moment.unix(k.v).startOf(a.bw).unix(),c(k)+g;if("middle"===k.f)return g=moment.unix(k.v).endOf(a.bw).unix(),
k=moment.unix(k.v).startOf(a.bw).unix(),c(g/2+k/2);if("max"===k.f)return b.range.max+k.v;if("min"===k.f)return b.range.min+k.v}throw d.error.input("Unknown object "+k+" is passed to a scale");}return c(k)}};u.prototype._catWrapper=function(a,c){var b=this;return function(k){var g;g=0.001*(b.range.max>b.range.min?1:-1);if(_.isObject(k)){if("scalefn"===k.t){if("identity"===k.f)return k.v;if("upper"===k.f)return c(k.v)+a-g;if("lower"===k.f)return c(k.v)+g;if("middle"===k.f)return c(k.v)+a/2;if("max"===
k.f)return b.range.max+k.v;if("min"===k.f)return b.range.min+k.v}throw d.error.input("Unknown object "+k+" is passed to a scale");}return c(k)+a/2}};var v=function(){v.__super__.constructor.apply(this,arguments)};n(v,u);v.prototype._makeNum=function(){var a,c;c=d.linear(this.domain.min,this.range.min,this.domain.max,this.range.max);a=d.linear(this.range.min,this.domain.min,this.range.max,this.domain.max);this.f=this._numWrapper(this.domain,c);return this.finv=function(c,b){var g;g=[a(c),a(b)];return{ge:_.min(g),
le:_.max(g)}}};v.prototype._makeDate=function(){var a,c;c=d.linear(this.domain.min,this.range.min,this.domain.max,this.range.max);a=d.linear(this.range.min,this.domain.min,this.range.max,this.domain.max);this.f=this._dateWrapper(this.domain,c);return this.finv=function(c,b){var g;g=[a(c),a(b)];return{ge:_.min(g),le:_.max(g)}}};v.prototype._makeCat=function(){var a,c=this;a=(this.range.max-this.range.min)/this.domain.levels.length;this.f=this._catWrapper(a,function(b){b=_.indexOf(c.domain.levels,b);
return-1===b?null:c.range.min+b*a});return this.finv=function(b,g){var d,f;g<b&&(d=g,g=b,b=d);d=Math.floor(b/a);f=Math.ceil(g/a);return{"in":c.domain.levels.slice(d,f+1||9E9)}}};f=v;var r=function(){r.__super__.constructor.apply(this,arguments)};n(r,u);r.prototype._makeNum=function(){var a,c,b,g;a=Math.log;b=d.linear(a(this.domain.min),this.range.min,a(this.domain.max),this.range.max);this.f=this._numWrapper(function(c){return b(a(c))});g=d.linear(this.range.min,a(this.domain.min),this.range.max,
a(this.domain.max));c=function(a){return Math.exp(g(a))};return this.finv=function(a,b){var g;g=[c(a),c(b)];return{ge:_.min(g),le:_.max(g)}}};r.prototype._tickNum=function(){return"num-log"};a=r;var p=function(){this._makeNum=m(this._makeNum,this);p.__super__.constructor.apply(this,arguments)};n(p,s);p.prototype._makeNum=function(){var a,c,b;a=0===this.domain.min?0:1;c=Math.sqrt;b=d.linear(c(this.domain.min),a,c(this.domain.max),10);return this.f=this._identityWrapper(function(a){return b(c(a))})};
j=p;var x=function(){this._makeNum=m(this._makeNum,this);x.__super__.constructor.apply(this,arguments)};n(x,s);x.prototype._makeNum=function(){return this.f=this._identityWrapper(d.linear(this.domain.min,0===this.domain.min?0:0.1,this.domain.max,1))};c=x;var h=function(){this._makeNum=m(this._makeNum,this);this._makeCat=m(this._makeCat,this);h.__super__.constructor.apply(this,arguments)};n(h,s);h.prototype._makeCat=function(){var a,c,b=this;c=this.domain.levels.length;a=function(a){return _.indexOf(b.domain.levels,
a)/c+1/(2*c)};return this.f=function(c){return Raphael.hsl(a(c),0.5,0.5)}};h.prototype._makeNum=function(){var a;a=d.linear(this.domain.min,0,this.domain.max,1);return this.f=function(c){return Raphael.hsl(0.5,a(c),0.5)}};b=h;var g=function(){g.__super__.constructor.apply(this,arguments)};n(g,s);g.prototype._makeCat=function(){};var q=function(a){this._makeNum=m(this._makeNum,this);this.lower=a.lower;this.upper=a.upper};n(q,s);q.prototype._makeNum=function(){var a,c,b,g,f;b=Raphael.color(this.lower);
f=Raphael.color(this.upper);g=d.linear(this.domain.min,b.r,this.domain.max,f.r);c=d.linear(this.domain.min,b.g,this.domain.max,f.g);a=d.linear(this.domain.min,b.b,this.domain.max,f.b);return this.f=this._identityWrapper(function(b){return Raphael.rgb(g(b),c(b),a(b))})};l=q;q=function(){this._makeCat=m(this._makeCat,this)};n(q,s);q.prototype._makeCat=function(){};var w=function(){w.__super__.constructor.apply(this,arguments)};n(w,s);w.prototype._makeCat=function(){};var y=function(){y.__super__.constructor.apply(this,
arguments)};n(y,s);y.prototype.make=function(){this.sortfn=function(a){return a};return this.f=this._identityWrapper(function(a){return a})};e=y;this.poly=d}).call(this);
(function(){var j,b,l=Array.prototype.indexOf||function(b){for(var a=0,c=this.length;a<c;a++)if(a in this&&this[a]===b)return a;return-1};b=this.poly||{};b.scaleset=function(b,a,c){return new j(b,a,c)};var e=function(f,a){this.axes={x:b.guide.axis(a.axisType("x")),y:b.guide.axis(a.axisType("y"))};this.coord=a;this.ranges=f;this.legends=[];this.deletedLegends=[]};e.prototype.make=function(b,a,c){this.guideSpec=b;this.layers=c;this.domains=a;this.domainx=this.domains.x;this.domainy=this.domains.y;this.scales=
this._makeScales(b,a,this.ranges);this.reverse={x:this.scales.x.finv,y:this.scales.y.finv};return this.layerMapping=this._mapLayers(c)};e.prototype.setRanges=function(b){this.ranges=b;this._makeXScale();return this._makeYScale()};e.prototype.setXDomain=function(b){this.domainx=b;return this._makeXScale()};e.prototype.setYDomain=function(b){this.domainy=b;return this._makeYScale()};e.prototype.resetDomains=function(){this.domainx=this.domains.x;this.domainy=this.domains.y;this._makeXScale();return this._makeYScale()};
e.prototype._makeXScale=function(){return this.scales.x.make(this.domainx,this.ranges.x)};e.prototype._makeYScale=function(){return this.scales.y.make(this.domainy,this.ranges.y)};e.prototype._makeScales=function(f,a,c){var d,e,l,n,j,u;e=function(a){return f&&null!=f[a]&&null!=f[a].scale?f[a].scale:null};d={};d.x=null!=(l=e("x"))?l:b.scale.linear();d.x.make(a.x,c.x);d.y=null!=(n=e("y"))?n:b.scale.linear();d.y.make(a.y,c.y);null!=a.color&&(d.color="cat"===a.color.type?null!=(j=e("color"))?j:b.scale.color():
null!=(u=e("color"))?u:b.scale.gradient({upper:"steelblue",lower:"red"}),d.color.make(a.color));null!=a.size&&(d.size=e("size")||b.scale.area(),d.size.make(a.size));null!=a.opacity&&(d.opacity=e("opacity")||b.scale.opacity(),d.opacity.make(a.opacity));d.text=b.scale.identity();d.text.make();return d};e.prototype.fromPixels=function(b,a){var c,d,e,l,n,j,u;c=this.coord.getAes(b,a,this.reverse);e=c.x;l=c.y;d={};u=this.layerMapping.x;n=0;for(j=u.length;n<j;n++)c=u[n],null!=c.type&&"map"===c.type&&(d[c.value]=
e);j=this.layerMapping.y;e=0;for(n=j.length;e<n;e++)c=j[e],null!=c.type&&"map"===c.type&&(d[c.value]=l);return d};e.prototype.getSpec=function(b){return null!=this.guideSpec&&null!=this.guideSpec[b]?this.guideSpec[b]:{}};e.prototype.makeAxes=function(){this.axes.x.make({domain:this.domainx,type:this.scales.x.tickType(),guideSpec:this.getSpec("x"),key:b.getLabel(this.layers,"x")});this.axes.y.make({domain:this.domainy,type:this.scales.y.tickType(),guideSpec:this.getSpec("y"),key:b.getLabel(this.layers,
"y")});return this.axes};e.prototype.renderAxes=function(b,a){this.axes.x.render(b,a);return this.axes.y.render(b,a)};e.prototype._mapLayers=function(b){var a,c;c={};for(a in this.domains)c[a]=_.map(b,function(c){return null!=c.mapping[a]?{type:"map",value:c.mapping[a]}:null!=c.consts[a]?{type:"const",value:c["const"][a]}:c.defaults[a]});return c};e.prototype._mergeAes=function(e){var a,c,d,m,j,n,s;j=[];for(a in this.domains)if(!(0<=l.call(b["const"].noLegend,a))&&(d=_.map(e,function(c){return c.mapping[a]}),
!_.all(d,_.isUndefined))){m=!1;n=0;for(s=j.length;n<s;n++)if(c=j[n],_.isEqual(c.mapped,d)){c.aes.push(a);m=!0;break}m||j.push({aes:[a],mapped:d})}return _.pluck(j,"aes")};e.prototype.makeLegends=function(){var e,a,c,d,m,l;a=this._mergeAes(this.layers);for(d=0;d<this.legends.length;){m=this.legends[d];l=!0;for(c=0;c<a.length;){e=a[c];if(_.isEqual(e,m.aes)){a.splice(c,1);l=!1;break}c++}l?(this.deletedLegends.push(m),this.legends.splice(d,1)):d++}m=0;for(c=a.length;m<c;m++)e=a[m],this.legends.push(b.guide.legend(e));
d=this.legends;a=0;for(c=d.length;a<c;a++)m=d[a],e=m.aes[0],m.make({domain:this.domains[e],guideSpec:this.getSpec(e),type:this.scales[e].tickType(),mapping:this.layerMapping,keys:b.getLabel(this.layers,e)});return this.legends};e.prototype.renderLegends=function(b,a){var c,d,e,l,n,j,u,v,r;e=this.deletedLegends;n=0;for(d=e.length;n<d;n++)c=e[n],c.remove(a);this.deletedLegends=[];n={x:0,y:0};c=this.axes.y.getDimension();"right"===c.position&&(n.x+=c.width);e=0;d=b.height-b.guideTop-b.paddingTop;v=this.legends;
r=[];j=0;for(u=v.length;j<u;j++)c=v[j],l=c.getDimension(),l.height+n.y>d&&(n.x+=e+5,e=n.y=0),l.width>e&&(e=l.width),c.render(b,a,n),r.push(n.y+=l.height);return r};j=e}).call(this);
(function(){var j,b,l,e,f,a,c,d,m,z,n,s=Array.prototype.indexOf||function(a){for(var c=0,b=this.length;c<b;c++)if(c in this&&this[c]===a)return c;return-1};c=this.poly||{};var u=function(a){this.url=a.url;this.json=a.json;this.csv=a.csv;this.meta=a.meta;this.dataBackend=null!=a.url;this.computeBackend=!1;this.raw=null;null==this.meta&&(this.meta={});this.subscribed=[]};u.prototype.impute=function(a){var b,d,e,g,f,w,l;e=_.keys(a[0]);b=a.slice(0,100);f=0;for(w=e.length;f<w;f++){d=e[f];if(null==(g=this.meta)[d])g[d]=
{};this.meta[d].type||(this.meta[d].type=c.varType(_.pluck(b,d)))}g=0;for(w=a.length;g<w;g++){b=a[g];f=0;for(l=e.length;f<l;f++)d=e[f],b[d]=c.coerce(b[d],this.meta[d])}return this.raw=a};u.prototype.getRaw=function(a){var b=this;this.json&&(this.raw=this.impute(this.json));this.csv&&(this.raw=this.impute(c.csv.parse(this.csv)));if(this.raw)return a(this.raw,this.meta);if(this.url)return c.csv(this.url,function(c){b.raw=b.impute(c);return a(b.raw,b.meta)})};u.prototype.update=function(a){var c=this;
this.json=a.json;this.csv=a.csv;return this.getRaw(function(){var a,b,g,d,e;d=c.subscribed;e=[];b=0;for(g=d.length;b<g;b++)a=d[b],e.push(a());return e})};u.prototype.subscribe=function(a){if(-1===_.indexOf(this.subscribed,a))return this.subscribed.push(a)};u.prototype.unsubscribe=function(a){return this.subscribed.splice(_.indexOf(this.subscribed,a),1)};c.Data=u;var v=function(a,b){var d=this._wrap,e=this;this._wrap=function(){return d.apply(e,arguments)};this.dataObj=a.data;this.initialSpec=c.parser.layerToData(a);
this.prevSpec=null;this.strictmode=b;this.statData=null;this.metaData={}};v.prototype.reset=function(a){return this.make(this.initialSpec,a)};v.prototype.make=function(b,d){var e,f;e=c.parser.layerToData(b);f=this._wrap(d);this.strictmode&&f(this.dataObj.json,{});return this.dataObj.computeBackend?j(e,this.dataObj,f):this.dataObj.getRaw(function(c,b){return a(e,c,b,f)})};v.prototype._wrap=function(a){var c=this;return function(b,d){c.statData=b;c.metaData=d;return a(c.statData,c.metaData)}};c.DataProcess=
v;c.data={};c.data.process=function(a,c,b,d){a=new v(c,b);a.process(d);return a};n={bin:function(a,b,d){var e,g;g=b.name;e=b.binwidth;if("num"===d.type){if(isNaN(e))throw c.error.defn("The binwidth "+e+" is invalid for a numeric varliable");e=+e;b=function(c){return c[g]=e*Math.floor(c[a]/e)};return{trans:b,meta:{bw:e,binned:!0,type:"num"}}}if("date"===d.type){if(!(0<=s.call(c["const"].timerange,e)))throw c.error.defn("The binwidth "+e+" is invalid for a datetime varliable");b=function(c){return c[g]=
moment.unix(c[a]).startOf(e).unix()};return{trans:b,meta:{bw:e,binned:!0,type:"date"}}}},lag:function(a,c,b){var d,g;g=c.name;d=c.lag;var e;e=[];for(c=1;1<=d?c<=d:c>=d;1<=d?c++:c--)e.push(void 0);return{trans:function(c){e.push(c[a]);return c[g]=e.shift()},meta:{type:b.type}}}};z=function(a,c,b){return n[c.trans](a,c,b)};f={lt:function(a,c){return a<c},le:function(a,c){return a<=c},gt:function(a,c){return a>c},ge:function(a,c){return a>=c},"in":function(a,c){return 0<=s.call(c,a)}};e=function(a){var c;
c=[];_.each(a,function(a,b){return _.each(a,function(a,d){return c.push(function(c){return f[d](c[b],a)})})});return function(a){var b,d,e;d=0;for(e=c.length;d<e;d++)if(b=c[d],!b(a))return!1;return!0}};d={sum:function(){return function(a){return _.reduce(_.without(a,void 0,null),function(a,c){return a+c},0)}},count:function(){return function(a){return _.without(a,void 0,null).length}},uniq:function(){return function(a){return _.uniq(_.without(a,void 0,null)).length}},min:function(){return function(a){return _.min(a)}},
max:function(){return function(a){return _.max(a)}},median:function(){return function(a){return c.median(a)}},box:function(){return function(a){var b,d,e,g,f,l;d=a.length;return 5<d?(g=d/2,a=_.sortBy(a,function(a){return a}),b=Math.ceil(g)/2,0!==b%1?(b=Math.floor(b),g=a[b],d=a[d-1-b]):(g=(a[b]+a[b-1])/2,d=(a[d-b]+a[d-b-1])/2),b=d-g,e=g-1.5*b,f=d+1.5*b,b=_.groupBy(a,function(a){return a>=e&&a<=f}),{q1:_.min(b["true"]),q2:g,q3:c.median(a,!0),q4:d,q5:_.max(b["true"]),outliers:null!=(l=b["false"])?l:
[]}):{outliers:a}}}};m=function(a){return d[a.stat](a)};l=function(a,b){var d,e;e={};_.each(b.stats,function(a){var c,b,d;c=a.key;b=a.name;d=m(a);return e[b]=function(a){return d(_.pluck(a,c))}});d=c.groupBy(a,b.groups);return _.map(d,function(a){var c;c={};_.each(b.groups,function(b){return c[b]=a[0][b]});_.each(e,function(b,d){return c[d]=b(a)});return c})};b=function(a,c,b){var d,g,e,f;e=c.sort;f=c.stat;d=c.limit;c=c.asc;f&&(f={stats:[f],groups:[a]},b=l(b,f));g=c?1:-1;b.sort(function(a,c){return a[e]===
c[e]?0:a[e]>=c[e]?1*g:-1*g});d&&(b=b.slice(0,d-1+1||9E9));a=_.uniq(_.pluck(b,a));return{meta:{levels:a,sorted:!0},filter:{"in":a}}};a=function(a,c,d,f){var g,q,n,j,m,s,t,k,A,F,G;n=_.clone(c);null==d&&(d={});c=function(a,c){var b;return d[a]=_.extend(null!=(b=d[a])?b:{},c)};if(a.trans){G=a.trans;j=0;for(A=G.length;j<A;j++){t=G[j];m=t.key;s=z(m,t,d[m]);g=s.trans;s=s.meta;k=0;for(F=n.length;k<F;k++)q=n[k],g(q);c(t.name,s)}}a.filter&&(n=_.filter(n,e(a.filter)));if(a.meta){g={};t=a.meta;for(m in t)s=t[m],
j=b(m,s,n),s=j.meta,j=j.filter,g[m]=j,c(m,s);n=_.filter(n,e(g))}if(a.stats&&a.stats.stats&&0<a.stats.stats.length){n=l(n,a.stats);s=a.stats.stats;a=0;for(m=s.length;a<m;a++)g=s[a],g=g.name,c(g,{type:"num"})}return f(n,d)};j=function(){return console.log("backendProcess")};c.data.frontendProcess=a;this.poly=c}).call(this);
(function(){var j,b,l,e,f,a,c,d,m,z,n,s,u=function(a,c){return function(){return a.apply(c,arguments)}},v=Object.prototype.hasOwnProperty,r=function(a,c){function b(){this.constructor=a}for(var d in c)v.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a};n=this.poly||{};m=n["const"].aes;s=n["const"].scaleFns;z={x:s.novalue(),y:s.novalue(),color:"steelblue",size:2,opacity:0.9,shape:1};n.layer={};n.layer.toStrictMode=function(a){var c,b,d;b=0;for(d=m.length;b<
d;b++)c=m[b],a[c]&&_.isString(a[c])&&(a[c]={"var":a[c]});return a};n.layer.make=function(g,k){switch(g.type){case "point":return new a(g,k);case "text":return new c(g,k);case "line":return new e(g,k);case "path":return new f(g,k);case "area":return new j(g,k);case "bar":return new b(g,k);case "tile":return new d(g,k);case "box":return new l(g,k)}};var p=function(a,c){this._makeMappings=u(this._makeMappings,this);this.render=u(this.render,this);this.reset=u(this.reset,this);this.initialSpec=n.layer.toStrictMode(a);
this.prevSpec=null;this.dataprocess=new n.DataProcess(this.initialSpec,c);this.pts={}};p.prototype.defaults=_.extend(z,{size:7});p.prototype.reset=function(){return this.make(this.initialSpec)};p.prototype.make=function(a,c){var b,d=this;b=n.layer.toStrictMode(a);this._makeMappings(b);this.dataprocess.make(b,function(a,b){d.statData=a;d.meta=b;if(null==d.statData)throw n.error.data("No data is passed into the layer");d._calcGeoms();return c()});return this.prevSpec=b};p.prototype._calcGeoms=function(){return this.geoms=
{}};p.prototype.getMeta=function(a){return this.mapping[a]?this.meta[this.mapping[a]]:{}};p.prototype.render=function(a){var c,b,d,g,e,f,h;e={};d=n.compare(_.keys(this.pts),_.keys(this.geoms));b=d.deleted;g=d.kept;c=d.added;f=0;for(h=b.length;f<h;f++)d=b[f],this._delete(a,this.pts[d]);b=0;for(f=c.length;b<f;b++)d=c[b],e[d]=this._add(a,this.geoms[d]);c=0;for(b=g.length;c<b;c++)d=g[c],e[d]=this._modify(a,this.pts[d],this.geoms[d]);return this.pts=e};p.prototype._delete=function(a,c){var b,d,g;g=[];
for(b in c)d=c[b],g.push(a.remove(d));return g};p.prototype._modify=function(a,c,b){var d,g,e,f;e={};f=b.marks;for(d in f)g=f[d],e[d]=a.animate(c[d],g,b.evtData);return e};p.prototype._add=function(a,c){var b,d,g,e;g={};e=c.marks;for(b in e)d=e[b],g[b]=a.add(d,c.evtData);return g};p.prototype._makeMappings=function(a){var c,b,d,g;this.mapping={};this.consts={};g=[];b=0;for(d=m.length;b<d;b++)c=m[b],a[c]?(a[c]["var"]&&(this.mapping[c]=a[c]["var"]),a[c]["const"]?g.push(this.consts[c]=a[c]["const"]):
g.push(void 0)):g.push(void 0);return g};p.prototype._getValue=function(a,c){return this.mapping[c]?a[this.mapping[c]]:this.consts[c]?s.identity(this.consts[c]):s.identity(this.defaults[c])};p.prototype._getIdFunc=function(){var a=this;return null!=this.mapping.id?function(c){return a._getValue(c,"id")}:n.counter()};p.prototype._fillZeros=function(a,c){var b,d,g,e;e=[];d=0;for(g=a.length;d<g;d++)b=a[d],e.push(this._getValue(b,"x"));b=_.difference(c,e);e=e.concat(b);d=[];g=0;for(b=b.length;g<b;g++)d.push(0);
var f,h;h=[];g=0;for(f=a.length;g<f;g++)b=a[g],h.push(this._getValue(b,"y"));return{x:e,y:h.concat(d)}};p.prototype._stack=function(a){var c,b,d,g,e,f,h=this;a=n.groupBy(this.statData,a);f=[];for(d in a)c=a[d],g=0,e=null!=this.mapping.y?function(a){return a[h.mapping.y]}:function(){return 0},f.push(function(){var a,d,f;f=[];a=0;for(d=c.length;a<d;a++)b=c[a],b.$lower=g,g+=e(b),f.push(b.$upper=g);return f}());return f};var x=function(){x.__super__.constructor.apply(this,arguments)};r(x,p);x.prototype._calcGeoms=
function(){var a,c,b,d,g,e,f,h,q;c=this._getIdFunc();this.geoms={};h=this.statData;q=[];e=0;for(f=h.length;e<f;e++){b=h[e];a={};for(d in b)g=b[d],a[d]={"in":[g]};q.push(this.geoms[c(b)]={marks:{"0":{type:"circle",x:this._getValue(b,"x"),y:this._getValue(b,"y"),color:this._getValue(b,"color"),size:this._getValue(b,"size"),opacity:this._getValue(b,"opacity")}},evtData:a})}return q};a=x;var h=function(){h.__super__.constructor.apply(this,arguments)};r(h,p);h.prototype._calcGeoms=function(){var a,c,b,
d,g,e,f,h,q,l,j,m;d=_.without(_.keys(this.mapping),"x","y");m=[];c=0;for(b=d.length;c<b;c++)e=d[c],m.push(this.mapping[e]);c=n.groupBy(this.statData,m);d=this._getIdFunc();this.geoms={};j=[];for(e in c){a=c[e];h=a[0];b={};q=0;for(l=m.length;q<l;q++)f=m[q],b[f]={"in":[h[f]]};j.push(this.geoms[d(h)]={marks:{"0":{type:"path",x:function(){var c,b,d;d=[];c=0;for(b=a.length;c<b;c++)g=a[c],d.push(this._getValue(g,"x"));return d}.call(this),y:function(){var c,b,d;d=[];c=0;for(b=a.length;c<b;c++)g=a[c],d.push(this._getValue(g,
"y"));return d}.call(this),color:this._getValue(h,"color"),opacity:this._getValue(h,"opacity")}},evtData:b})}return j};f=h;var g=function(){g.__super__.constructor.apply(this,arguments)};r(g,p);g.prototype._calcGeoms=function(){var a,c,b,d,g,e,f,h,q,l,m,j;a=_.uniq(function(){var a,c,b,d;b=this.statData;d=[];a=0;for(c=b.length;a<c;a++)e=b[a],d.push(this._getValue(e,"x"));return d}.call(this));var p;g=_.without(_.keys(this.mapping),"x","y");p=[];b=0;for(d=g.length;b<d;b++)f=g[b],p.push(this.mapping[f]);
b=n.groupBy(this.statData,p);g=this._getIdFunc();this.geoms={};j=[];for(f in b){c=b[f];q=c[0];d={};l=0;for(m=p.length;l<m;l++)h=p[l],d[h]={"in":[q[h]]};h=this._fillZeros(c,a);c=h.x;h=h.y;j.push(this.geoms[g(q)]={marks:{"0":{type:"line",x:c,y:h,color:this._getValue(q,"color"),opacity:this._getValue(q,"opacity")}},evtData:d})}return j};e=g;var q=function(){q.__super__.constructor.apply(this,arguments)};r(q,p);q.prototype._calcGeoms=function(){var a,c,b,d,g,e,f,h,q;this._stack(null!=this.mapping.x?[this.mapping.x]:
[]);c=this._getIdFunc();this.geoms={};h=this.statData;q=[];e=0;for(f=h.length;e<f;e++){b=h[e];a={};for(d in b)g=b[d],"y"!==d&&(a[this.mapping[d]]={"in":[g]});q.push(this.geoms[c(b)]={marks:{"0":{type:"rect",x:[s.lower(this._getValue(b,"x")),s.upper(this._getValue(b,"x"))],y:[b.$lower,b.$upper],color:this._getValue(b,"color"),opacity:this._getValue(b,"opacity")}},evtData:a})}return q};b=q;var w=function(){w.__super__.constructor.apply(this,arguments)};r(w,p);w.prototype._calcGeoms=function(){var a,
c,b,d,g,e,f,h,q,l,m,j,p,w,r,y;a=_.uniq(function(){var a,c,b,d;b=this.statData;d=[];a=0;for(c=b.length;a<c;a++)f=b[a],d.push(this._getValue(f,"x"));return d}.call(this));c={};p=0;for(d=a.length;p<d;p++)q=a[p],c[q]=0;e=_.without(_.keys(this.mapping),"x","y");p=[];d=0;for(g=e.length;d<g;d++)h=e[d],p.push(this.mapping[h]);d=n.groupBy(this.statData,p);e=this._getIdFunc();this.geoms={};y=[];for(h in d){b=d[h];l=b[0];g={};j=0;for(m=p.length;j<m;j++)q=p[j],g[q]={"in":[l[q]]};w=m=j=void 0;w=[];j=0;for(m=a.length;j<
m;j++)q=a[j],w.push(c[q]);j=w;w=0;for(r=b.length;w<r;w++)f=b[w],q=this._getValue(f,"x"),m=this._getValue(f,"y"),c[q]+=m;w=m=b=void 0;w=[];b=0;for(m=a.length;b<m;b++)q=a[b],w.push(c[q]);b=w;y.push(this.geoms[e(l)]={marks:{"0":{type:"area",x:a,y:{bottom:j,top:b},color:this._getValue(l,"color"),opacity:this._getValue(l,"opacity")}},evtData:g})}return y};j=w;var y=function(){y.__super__.constructor.apply(this,arguments)};r(y,p);y.prototype._calcGeoms=function(){var a,c,b,d,g,e,f,h,q;c=this._getIdFunc();
this.geoms={};h=this.statData;q=[];e=0;for(f=h.length;e<f;e++){b=h[e];a={};for(d in b)g=b[d],a[d]={"in":[g]};q.push(this.geoms[c(b)]={marks:{"0":{type:"text",x:this._getValue(b,"x"),y:this._getValue(b,"y"),text:this._getValue(b,"text"),color:this._getValue(b,"color"),size:this._getValue(b,"size"),opacity:this._getValue(b,"opacity"),"text-anchor":"center"}},evtData:a})}return q};c=y;var B=function(){B.__super__.constructor.apply(this,arguments)};r(B,p);B.prototype._calcGeoms=function(){var a,c,b,d,
g,e,f;c=this._getIdFunc();this.geoms={};e=this.statData;f=[];d=0;for(g=e.length;d<g;d++)b=e[d],a={},this._getValue(b,"x"),this._getValue(b,"y"),f.push(this.geoms[c(b)]={marks:{"0":{type:"rect",x:[s.lower(this._getValue(b,"x")),s.upper(this._getValue(b,"x"))],y:[s.lower(this._getValue(b,"y")),s.upper(this._getValue(b,"y"))],color:this._getValue(b,"color"),size:this._getValue(b,"size"),opacity:this._getValue(b,"opacity")}},evtData:a});return f};d=B;var D=function(){D.__super__.constructor.apply(this,
arguments)};r(D,p);D.prototype._calcGeoms=function(){var a,c,b,d,g,e,f,h,q,j,l,m;c=this._getIdFunc();this.geoms={};j=this.statData;m=[];h=0;for(q=j.length;h<q;h++){d=j[h];a={};e=this._getValue(d,"x");f=this._getValue(d,"y");b=s.lower(e);g=s.upper(e);e=s.middle(e);a={marks:{},evtData:a};f.q1&&(a.marks={iqr:{type:"path",x:[b,b,g,g,b],y:[f.q2,f.q4,f.q4,f.q2,f.q2],stroke:this._getValue(d,"color"),fill:"none",size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")},lower:{type:"line",x:[e,e],
y:[f.q1,f.q2],color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")},upper:{type:"line",x:[e,e],y:[f.q4,f.q5],color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")},middle:{type:"line",x:[b,g],y:[f.q3,f.q3],color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")}});l=f.outliers;b=0;for(f=l.length;b<f;b++)g=l[b],a.marks[b]={type:"circle",x:e,y:g,color:this._getValue(d,"color"),
size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")};m.push(this.geoms[c(d)]=a)}return m};l=D;this.poly=n}).call(this);
(function(){var j;j=this.poly||{};j.dim={};j.dim.make=function(b,j,e){var f,a,c,d,m,z,n;b={width:null!=(a=b.width)?a:400,height:null!=(c=b.height)?c:400,paddingLeft:null!=(d=b.paddingLeft)?d:10,paddingRight:null!=(m=b.paddingRight)?m:10,paddingTop:null!=(z=b.paddingTop)?z:10,paddingBottom:null!=(n=b.paddingBottom)?n:10,guideTop:10,guideRight:0,guideLeft:5,guideBottom:5};for(f in j)a=j[f],a=a.getDimension(),"left"===a.position?b.guideLeft+=a.width:"right"===a.position?b.guideRight+=a.width:"bottom"===
a.position?b.guideBottom+=a.height:"top"===a.position&&(b.guideTop+=a.height);c=b.height-b.guideTop-b.paddingTop;m=f=j=d=0;for(z=e.length;m<z;m++)a=e[m],a=a.getDimension(),a.height+f>c&&(j+=d+5,d=f=0),a.width>d&&(d=a.width),f+=a.height;b.guideRight+=j+d;b.chartHeight=b.height-b.paddingTop-b.paddingBottom-b.guideTop-b.guideBottom;b.chartWidth=b.width-b.paddingLeft-b.paddingRight-b.guideLeft-b.guideRight;return b};j.dim.guess=function(b){var j,e,f,a,c,d;b={width:null!=(j=b.width)?j:400,height:null!=
(e=b.height)?e:400,paddingLeft:null!=(f=b.paddingLeft)?f:10,paddingRight:null!=(a=b.paddingRight)?a:10,paddingTop:null!=(c=b.paddingTop)?c:10,paddingBottom:null!=(d=b.paddingBottom)?d:10,guideLeft:30,guideRight:40,guideTop:10,guideBottom:30};b.chartHeight=b.height-b.paddingTop-b.paddingBottom-b.guideTop-b.guideBottom;b.chartWidth=b.width-b.paddingLeft-b.paddingRight-b.guideLeft-b.guideRight;return b};this.poly=j}).call(this);
(function(){var j,b,l,e,f,a,c,d,m,z=Object.prototype.hasOwnProperty;c=function(a,c){function b(){this.constructor=a}for(var d in c)z.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a};d=this.poly||{};d.paper=function(a,c,b,e){var f,h,j;if(!("undefined"!==typeof Raphael&&null!==Raphael))throw d.error.depn("The dependency Raphael is not included.");a=Raphael(a,c,b);c=a.rect(0,0,c,b).attr("stroke-width",0);c.click(e("reset"));h=e("select");j=f=null;c.drag(function(a,
c,b,d){return null!=j?f={x:d,y:b}:j={x:d,y:b}},function(){return f=j=null},function(){if(null!=j&&null!=f)return h({start:j,end:f})});return a};d.render=function(a,c,b,d,e,f){return{add:function(h,k){var j;j=m[d.type][h.type].render(c,b,d,h,e);null!=f&&j.attr("clip-rect",f);k&&0<_.keys(k).length&&(j.data("e",k),j.click(a("click")),j.hover(a("mover"),a("mout")));return j},remove:function(a){return a.remove()},animate:function(a,c,g){m[d.type][c.type].animate(a,b,d,c,e);g&&0<_.keys(g).length&&a.data("e",
g);return a}}};var n=function(){};n.prototype.render=function(a,c,b,d,e){var f;a=this._make(a);b=this.attr(c,b,d,e);for(f in b)c=b[f],a.attr(f,c);return a};n.prototype._make=function(){throw d.error.impl();};n.prototype.animate=function(a,c,b,d,e){return a.animate(this.attr(c,b,d,e),300)};n.prototype.attr=function(){throw d.error.impl();};n.prototype._makePath=function(a,c,b){null==b&&(b="L");return _.map(a,function(a,d){return(0===d?"M":b)+a+" "+c[d]}).join(" ")};n.prototype._maybeApply=function(a,
c,b){c=c[b];return _.isObject(c)&&"identity"===c.f?c.v:null!=a[b]?a[b].f(c):c};var s=function(){s.__super__.constructor.apply(this,arguments)};c(s,n);s.prototype._make=function(a){return a.circle()};s.prototype.attr=function(a,c,b,d){var e,f;d=c.getXY(d,b);c=d.x;e=d.y;d=b.stroke?this._maybeApply(a,b,"stroke"):this._maybeApply(a,b,"color");return{cx:c,cy:e,r:this._maybeApply(a,b,"size"),fill:this._maybeApply(a,b,"color"),opacity:this._maybeApply(a,b,"opacity"),stroke:d,title:"omgthisiscool!","stroke-width":null!=
(f=b["stroke-width"])?f:"0px"}};b=s;var u=function(){u.__super__.constructor.apply(this,arguments)};c(u,n);u.prototype._make=function(a){return a.path()};u.prototype.attr=function(a,c,b,d){var e;d=c.getXY(d,b);c=d.x;e=d.y;d=b.stroke?this._maybeApply(a,b,"stroke"):this._maybeApply(a,b,"color");return{path:this._makePath(c,e),opacity:this._maybeApply(a,b,"opacity"),stroke:d}};f=u;var v=function(){v.__super__.constructor.apply(this,arguments)};c(v,n);v.prototype._make=function(a){return a.path()};v.prototype.attr=
function(a,c,b,e){var f;f=d.sortArrays(a.x.sortfn,[b.x,b.y]);b.x=f[0];b.y=f[1];e=c.getXY(e,b);c=e.x;f=e.y;e=b.stroke?this._maybeApply(a,b,"stroke"):this._maybeApply(a,b,"color");return{path:this._makePath(c,f),stroke:e,opacity:this._maybeApply(a,b,"opacity")}};e=v;var r=function(){r.__super__.constructor.apply(this,arguments)};c(r,n);r.prototype._make=function(a){return a.path()};r.prototype.attr=function(a,b,c,e){var f,h,j;f=d.sortArrays(a.x.sortfn,[c.x,c.y.top]);h=f[0];j=f[1];f=b.getXY(e,{x:h,y:j});
j=d.sortArrays(function(b){return-a.x.sortfn(b)},[c.x,c.y.bottom]);h=j[0];j=j[1];b=b.getXY(e,{x:h,y:j});h=f.x.concat(b.x);j=f.y.concat(b.y);return{path:this._makePath(h,j),stroke:this._maybeApply(a,c,"color"),opacity:this._maybeApply(a,c,"opacity"),fill:this._maybeApply(a,c,"color"),"stroke-width":"0px"}};j=r;var p=function(){p.__super__.constructor.apply(this,arguments)};c(p,n);p.prototype._make=function(a){return a.rect()};p.prototype.attr=function(a,b,c,d){d=b.getXY(d,c);b=d.x;d=d.y;return{x:_.min(b),
y:_.min(d),width:Math.abs(b[1]-b[0]),height:Math.abs(d[1]-d[0]),fill:this._maybeApply(a,c,"color"),stroke:this._maybeApply(a,c,"color"),opacity:this._maybeApply(a,c,"opacity"),"stroke-width":"0px"}};a=p;var x=function(){x.__super__.constructor.apply(this,arguments)};c(x,n);x.prototype._make=function(a){return a.path()};x.prototype.attr=function(a,b,c,d){var e,f,h,j;j=c.x;h=j[0];j=j[1];e=c.y;f=e[0];e=e[1];c.x=[h,h,j,j];c.y=[f,e,e,f];f=b.getXY(d,c);h=f.x;j=f.y;d=f.r;f=f.t;b.flip&&(h.push(h.splice(0,
1)[0]),j.push(j.splice(0,1)[0]),d.push(d.splice(0,1)[0]),f.push(f.splice(0,1)[0]));b=Math.abs(f[1]-f[0])>Math.PI?1:0;e="M "+h[0]+" "+j[0]+" A "+d[0]+" "+d[0]+" 0 "+b+" 1 "+h[1]+" "+j[1];b=Math.abs(f[3]-f[2])>Math.PI?1:0;e+="L "+h[2]+" "+j[2]+" A "+d[2]+" "+d[2]+" 0 "+b+" 0 "+h[3]+" "+j[3]+" Z";return{path:e,fill:this._maybeApply(a,c,"color"),stroke:this._maybeApply(a,c,"color"),opacity:this._maybeApply(a,c,"opacity"),"stroke-width":"0px"}};l=x;"class HLine extends Renderer # for both cartesian & polar?\n  _make: (paper) -> paper.path()\n  attr: (scales, coord, mark) ->\n    y = scales.y mark.y\n    path: @_makePath([0, 100000], [y, y])\n    stroke: 'black'\n    'stroke-width': '1px'\n\nclass VLine extends Renderer # for both cartesian & polar?\n  _make: (paper) -> paper.path()\n  attr: (scales, coord, mark) ->\n    x = scales.x mark.x\n    path: @_makePath([x, x], [0, 100000])\n    stroke: 'black'\n    'stroke-width': '1px'";
var h=function(){h.__super__.constructor.apply(this,arguments)};c(h,n);h.prototype._make=function(a){return a.text()};h.prototype.attr=function(a,b,c,d){var e;b=b.getXY(d,c);a={x:b.x,y:b.y,r:10,text:this._maybeApply(a,c,"text"),"text-anchor":null!=(e=c["text-anchor"])?e:"left",fill:this._maybeApply(a,c,"color")||"black"};null!=c.transform&&(a.transform=c.transform);return a};c=h;m={cartesian:{circle:new b,line:new e,area:new j,path:new f,text:new c,rect:new a},polar:{circle:new b,path:new f,line:new e,
area:new j,text:new c,rect:new l}}}).call(this);
(function(){var j,b=function(b,f){return function(){return b.apply(f,arguments)}};j=this.poly||{};var l=function(e){this._legacy=b(this._legacy,this);this.handleEvent=b(this.handleEvent,this);this.merge=b(this.merge,this);this.reset=b(this.reset,this);var f;if(null==e)throw j.error.defn("No graph specification is passed in!");this.handlers=[];this.paper=this.dims=this.legends=this.axes=this.scaleSet=this.layers=null;this.coord=null!=(f=e.coord)?f:j.coord.cartesian();this.initial_spec=e;this.dataSubscribed=
!1;this.make(e)};l.prototype.reset=function(){if(null==this.initial_spec)throw j.error.defn("No graph specification is passed in!");return this.make(this.initial_spec)};l.prototype.make=function(b){var f,a,c,d,m,l;null==b&&(b=this.initial_spec);this.spec=b;if(null==b.layers)throw j.error.defn("No layers are defined in the specification.");null==this.layers&&(this.layers=this._makeLayers(this.spec));if(!this.dataSubscribed){f=this.handleEvent("data");c=this.layers;a=0;for(c=c.length;a<c;a++){if(null==
b.layers[a].data)throw j.error.defn("Layer "+a+" does not have data to plot!");b.layers[a].data.subscribe(f)}this.dataSubscribed=!0}c=_.after(this.layers.length,this.merge);m=this.layers;l=[];a=0;for(d=m.length;a<d;a++)f=m[a],l.push(f.make(b.layers[a],c));return l};l.prototype.merge=function(){var b,f,a,c,d,m;f=this._makeDomains(this.spec,this.layers);null==this.scaleSet&&(this.scaleSet=this._makeScaleSet(this.spec,f));this.scaleSet.make(this.spec.guides,f,this.layers);this.dims||(this.dims=this._makeDimensions(this.spec,
this.scaleSet),this.coord.make(this.dims),this.ranges=this.coord.ranges());this.scaleSet.setRanges(this.ranges);this._legacy(f);if(!this.spec.dom)throw j.error.defn("No DOM element specified. Where to make plot?");b=this.spec.dom;f=this.scaleSet.scales;this.coord.setScales(f);null==this.paper&&(this.paper=this._makePaper(b,this.dims.width,this.dims.height,this.handleEvent));b=this.coord.clipping(this.dims);a=j.render(this.handleEvent,this.paper,f,this.coord,!0,b);m=this.layers;c=0;for(d=m.length;c<
d;c++)b=m[c],b.render(a);a=j.render(this.handleEvent,this.paper,f,this.coord,!1);this.scaleSet.makeAxes();this.scaleSet.renderAxes(this.dims,a);this.scaleSet.makeLegends();return this.scaleSet.renderLegends(this.dims,a)};l.prototype.addHandler=function(b){return this.handlers.push(b)};l.prototype.removeHandler=function(b){return this.handlers.splice(_.indexOf(this.handlers,b),1)};l.prototype.handleEvent=function(b){var f;f=this;return _.throttle(function(a){var c,d,j,l;"select"===b?(c=a.start,a=a.end,
this.evtData=f.scaleSet.fromPixels(c,a)):this.evtData="data"===b?{}:this.data("e");j=f.handlers;l=[];a=0;for(d=j.length;a<d;a++)c=j[a],_.isFunction(c)?l.push(c(b,this)):l.push(c.handle(b,this));return l},1E3)};l.prototype._makeLayers=function(b){return _.map(b.layers,function(f){return j.layer.make(f,b.strict)})};l.prototype._makeDomains=function(b,f){null==b.guides&&(b.guides={});return j.domain.make(f,b.guides,b.strict)};l.prototype._makeScaleSet=function(b){this.coord.make(j.dim.guess(b));b=this.coord.ranges();
return j.scaleset(b,this.coord)};l.prototype._makeDimensions=function(b,f){return j.dim.make(b,f.makeAxes(),f.makeLegends())};l.prototype._makePaper=function(b,f,a,c){return j.paper(document.getElementById(b),f,a,c)};l.prototype._legacy=function(b){var f,a,c;this.domains=b;this.scales=this.scaleSet.scales;b=this.scaleSet.makeAxes();this.ticks={};c=[];for(f in b)a=b[f],c.push(this.ticks[f]=a.ticks);return c};j.chart=function(b){return new l(b)};this.poly=j}).call(this);
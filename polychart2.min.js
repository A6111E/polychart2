(function(){var j;j=this.poly||{};j.groupBy=function(b,m){return _.groupBy(b,function(b){return _.reduce(m,function(g,a){return""+g+a+":"+b[a]+";"},"")})};j.linear=function(b,m,f,g){return function(a){return(g-m)/(f-b)*(a-b)+m}};j.median=function(b,m){var f;null==m&&(m=!1);m||(b=_.sortBy(b,function(b){return b}));f=b.length/2;return 0!==f%1?b[Math.floor(f)]:(b[f-1]+b[f])/2};this.poly=j;j.counter=function(){var b;b=0;return function(){return b++}};j.compare=function(b,m){var f,g,a,c,d,l,y,k,s;s=_.sortBy(b,
function(a){return a});k=_.sortBy(m,function(a){return a});s.push(NaN);k.push(NaN);g=[];d=[];f=[];for(a=c=0;!isNaN(s[a])||!isNaN(k[c]);)if(y=s[a],l=k[c],y<l||isNaN(l))g.push(y),a+=1;else if(y>l||isNaN(y))f.push(l),c+=1;else if(y===l)d.push(y),a+=1,c+=1;else throw DataError("Unknown data encounted");return{deleted:g,kept:d,added:f}};j.flatten=function(b){var m,f,g,a;m=[];if(null!=b)if(_.isObject(b))if("scalefn"===b.t)"novalue"!==b.f&&m.push(b.v);else for(f in b)g=b[f],m=m.concat(j.flatten(g));else if(_.isArray(b)){f=
0;for(a=b.length;f<a;f++)g=b[f],m=m.concat(j.flatten(g))}else m.push(b);return m};j.getLabel=function(b,m){return _.chain(b).map(function(b){return b.mapping[m]}).without(null,void 0).uniq().value().join(" | ")};j.strSize=function(b){return 7*(b+"").length};j.sortArrays=function(b,m){return _.zip.apply(_,_.sortBy(_.zip.apply(_,m),function(f){return b(f[0])}))};j.varType=function(b){var m,f,g,a,c;a=f=m=0;for(c=b.length;a<c;a++)g=b[a],null!=g&&((!isNaN(g)||!isNaN(g.replace(/\$|\,/g,"")))&&f++,moment(g).isValid()&&
m++);return f>0.95*b.length?"num":m>0.95*b.length?"date":"cat"};j.coerce=function(b,m){if("cat"===m.type)return b;if("num"===m.type)return isNaN(b)?+(""+b).replace(/\$|\,/g,""):+b;if("date"===m.type)return m.format?"unix"===m.format?moment.unix(b).unix():moment(b,m.format).unix():moment(b).unix()};this.poly=j}).call(this);
(function(){var j;j=this.poly||{};j["const"]={aes:"x y color size opacity shape id text".split(" "),noLegend:["x","y","id","text","tooltip"],trans:{bin:["key","binwidth"],lag:["key","lag"]},stat:{count:["key"],sum:["key"],mean:["key"],box:["key"],median:["key"]},timerange:"second minute hour day week month year".split(" "),metas:{sort:null,stat:null,limit:null,asc:!0},scaleFns:{novalue:function(){return{v:null,f:"novalue",t:"scalefn"}},max:function(b){return{v:b,f:"max",t:"scalefn"}},min:function(b){return{v:b,
f:"min",t:"scalefn"}},upper:function(b){return{v:b,f:"upper",t:"scalefn"}},lower:function(b){return{v:b,f:"lower",t:"scalefn"}},middle:function(b){return{v:b,f:"middle",t:"scalefn"}},jitter:function(b){return{v:b,f:"jitter",t:"scalefn"}},identity:function(b){return{v:b,f:"identity",t:"scalefn"}}},epsilon:Math.pow(10,-7),defaults:{x:{v:null,f:"novalue",t:"scalefn"},y:{v:null,f:"novalue",t:"scalefn"},color:"steelblue",size:2,opacity:0.7}};this.poly=j}).call(this);
(function(){var j,b={}.hasOwnProperty,m=function(a,c){function l(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);l.prototype=c.prototype;a.prototype=new l;a.__super__=c.prototype;return a};j=this.poly||{};var f=function(a){this.message=a;this.name="DefinitionError"};m(f,Error);var g=function(a){this.message=a;this.name="DependencyError"};m(g,Error);var a=function(a){this.message=a;this.name="ModeError"};m(a,Error);var c=function(a){this.message=a;this.name="DataError"};m(c,Error);var d=
function(a){this.message=a;this.name="UnknownInput"};m(d,Error);var l=function(a){this.message=a;this.name="ModeError"};m(l,Error);j.error=function(a){return Error(a)};j.error.data=function(a){return new c(a)};j.error.depn=function(a){return new g(a)};j.error.defn=function(a){return new f(a)};j.error.mode=function(c){return new a(c)};j.error.impl=function(a){return new l(a)};j.error.input=function(a){return new d(a)};this.poly=j}).call(this);
(function(){var j,b,m,f,g=[].indexOf||function(a){for(var c=0,d=this.length;c<d;c++)if(c in this&&this[c]===a)return c;return-1};m=this.poly||{};m.format=function(a,c){switch(a){case "cat":return m.format.identity;case "num":return m.format.number(c);case "date":return m.format.date(c)}};m.format.identity=function(a){return a};j={"0":"",3:"k",6:"m",9:"b",12:"t"};f=function(a,c){return _.isUndefined(j[c])?a+"e"+(0<c?"+":"-")+Math.abs(c):a+j[c]};b=function(a){var c,d,l;if(!isFinite(a))return a;d=""+
a;c=Math.abs(a);1E3<=c&&(l=(""+c).split(/\./),c=l[0].length%3||3,l[0]=d.slice(0,c+(0>a))+l[0].slice(c).replace(/(\d{3})/g,",$1"),d=l.join("."));return d};m.format.number=function(a){return function(c){var d,l;l=0;d=null!=a?a:Math.floor(Math.log(Math.abs(0===c?1:c))/Math.LN10);null!=a&&(2===d||5===d||8===d||11===d)?(d+=1,l=1):-1===d?(d=0,l=null!=a?1:2):-2===d?(d=0,l=null!=a?2:3):1===d||2===d?d=0:3<d&&6>d?d=3:6<d&&9>d?d=6:9<d&&12>d?d=9:12<d&&15>d?d=12:l=null!=a?0:1;c=Math.round(c/Math.pow(10,d-l));
c/=Math.pow(10,l);c=c.toFixed(l);return f(b(c),d)}};m.format.date=function(a){0<=g.call(m["const"].timerange,a)||(a="day");if("second"===a)return function(a){return moment.unix(a).format("h:mm:ss a")};if("minute"===a)return function(a){return moment.unix(a).format("h:mm a")};if("hour"===a)return function(a){return moment.unix(a).format("MMM D h a")};if("day"===a||"week"===a)return function(a){return moment.unix(a).format("MMM D")};if("month"===a)return function(a){return moment.unix(a).format("YY/MM")};
if("year"===a)return function(a){return moment.unix(a).format("YYYY")}}}).call(this);
(function(){poly.xhr=function(j,b,m){var f;f=new XMLHttpRequest;3>arguments.length?(m=b,b=null):b&&f.overrideMimeType&&f.overrideMimeType(b);f.open("GET",j,!0);b&&f.setRequestHeader("Accept",b);f.onreadystatechange=function(){var b;if(4===f.readyState)return b=f.status,b=!b&&f.response||200<=b&&300>b||304===b?f:null,m(b)};return f.send(null)};poly.text=function(j,b,m){3>arguments.length&&(m=b,b=null);return poly.xhr(j,b,function(b){return m(b&&b.responseText)})};poly.json=function(j,b){return poly.text(j,
"application/json",function(m){return b(m?JSON.parse(m):null)})};poly.dsv=function(j,b){var m,f,g,a,c,d,l;l=RegExp("\r\n|["+j+"\r\n]","g");d=RegExp('["'+j+"\n]");m=j.charCodeAt(0);g=function(c){return c.map(a).join(j)};a=function(a){var c;return null!=(c=d.test(a))?c:'"'+a.replace(/\"/g,'""')+{'"':a}};c=null;f=function(a,c){return poly.text(a,b,function(a){return c(a&&f.parse(a))})};f.parse=function(a){return f.parseRows(a,function(a,l){var d,b,q;if(l){q={};d=-1;for(b=c.length;++d<b;)q[c[d]]=a[d];
return q}c=a;return null})};f.parseRows=function(a,c){var d,b,g,q,n,f,h,e;b={};d={};f=[];n=0;q=h=null;l.lastIndex=0;for(e=function(){var e,h,c;if(l.lastIndex>=a.length)return d;if(q)return q=!1,b;c=l.lastIndex;if(34===a.charCodeAt(c)){for(h=c;h++<a.length;)if(34===a.charCodeAt(h)){if(34!==a.charCodeAt(h+1))break;h++}l.lastIndex=h+2;e=a.charCodeAt(h+1);13===e?(q=!0,10===a.charCodeAt(h+2)&&l.lastIndex++):10===e&&(q=!0);return a.substring(c+1,h).replace(/""/g,'"')}if(e=l.exec(a))return q=e[0].charCodeAt(0)!==
m,a.substring(c,e.index);l.lastIndex=a.length;return a.substring(c)};(h=e())!==d;){for(g=[];h!==b&&h!==d;)g.push(h),h=e();(!c||(g=c(g,n++)))&&f.push(g)}return f};f.format=function(a){return a.map(g).join("\n")};return f};poly.csv=poly.dsv(",","text/csv")}).call(this);
(function(){var j,b,m,f,g,a,c,d,l,y,k,s,u,v,q,n,x,h,e,p,w,z,B,D,t,r,A,F,G,R=[].slice,S={}.hasOwnProperty,H=function(a,e){function h(){this.constructor=a}for(var c in e)S.call(e,c)&&(a[c]=e[c]);h.prototype=e.prototype;a.prototype=new h;a.__super__=e.prototype;return a};z=this.poly||{};F=function(a,e){var h,c,r,p;h=a.length;p=['"',"'"];c=0;for(r=p.length;c<r;c++)if(e=p[c],a[0]===e&&a[h-1]===e)return a.slice(1,h-2+1||9E9);return a};G=function(a,e){var h,c,r,p,t;t=[];h=r=0;for(p=a.length;r<p;h=++r)c=
a[h],t.push([c,e[h]]);return t};a=function(a){var e,h,c,r,p;h={};r=0;for(p=a.length;r<p;r++)c=a[r],e=c[0],c=c[1],h[e]=c;return h};l=function(a,e,h){null==h&&(h=null);return e in a&&a[e]||h};y=function(a,e){var h,c,r;c={};for(r in e)h=e[r],h=l(a,r,h),null!==h&&(c[r]=h);return c};v=function(a){var e,h,c,r,p;h={};r=0;for(p=a.length;r<p;r++)for(c in e=a[r],e)h[c]=e[c].concat(l(h,c,[]));return h};c=function(a,e){var h,c,r,p,t;null==e&&(e=function(a){return a});h={};p=0;for(t=a.length;p<t;p++)c=a[p],h[e(c)]=
c;p=[];for(r in h)c=h[r],p.push(c);return p};d=function(a){return function(e){return c(e,function(e){return e[a]})}};B=function(a,e){return""+a+"("+e+")"};D=function(a){return"["+a+"]"};var I=function(a){var e,h,c,r;r=[];h=0;for(c=a.length;h<c;h++)e=a[h],r.push(e);this.buffer=r.reverse()};I.prototype.empty=function(){return 0===this.buffer.length};I.prototype.peek=function(){return this.empty()?null:this.buffer[this.buffer.length-1]};I.prototype.get=function(){return this.empty()?null:this.buffer.pop()};
I.prototype.toString=function(){return B("Stream",D(R.call(this.buffer).reverse()))};var C=function(a){this.tag=a};C.Tag={symbol:"symbol",literal:"literal",lparen:"(",rparen:")",comma:","};C.prototype.toString=function(){return"<"+this.contents().toString()+">"};C.prototype.contents=function(){return[this.tag]};var J=function(a){this.name=a;this.name=F(this.name);J.__super__.constructor.call(this,C.Tag.symbol)};H(J,C);J.prototype.contents=function(){return J.__super__.contents.call(this).concat([this.name])};
g=J;var K=function(a){this.val=a;this.val=F(this.val);K.__super__.constructor.call(this,C.Tag.literal)};H(K,C);K.prototype.contents=function(){return K.__super__.contents.call(this).concat([this.val])};m=K;var E,Q,P,L;P=[C.Tag.lparen,C.Tag.rparen,C.Tag.comma];L=[];E=0;for(Q=P.length;E<Q;E++)t=P[E],L.push(new C(t));b=L[0];f=L[1];j=L[2];A=[[/^\(/,function(){return b}],[/^\)/,function(){return f}],[/^,/,function(){return j}],[/^[+-]?(0x[0-9a-fA-F]+|0?\.\d+|[1-9]\d*(\.\d+)?|0)([eE][+-]?\d+)?/,function(a){return new m(a)}],
[/^(\w|[^\u0000-\u0080])+|'((\\.)|[^\\'])+'|"((\\.)|[^\\"])+"/,function(a){return new g(a)}]];u=function(a){var e,h,c,r;c=0;for(r=A.length;c<r;c++)if(h=A[c],e=h[0],h=h[1],e=e.exec(a))return c=e[0],[a.slice(c.length),h(c)];throw z.error.defn("There is an error in your specification at "+a);};r=function(a){var e,h;for(h=[];;){a=a.replace(/^\s+/,"");if(!a)break;e=u(a);a=e[0];e=e[1];h.push(e)}return h};E=function(){};E.prototype.toString=function(){return B(this.constructor.name,this.contents())};var M=
function(a){this.name=a};H(M,E);M.prototype.contents=function(){return[this.name]};M.prototype.pretty=function(){return this.name};M.prototype.visit=function(a){return a.ident(this,this.name)};var N=function(a){this.val=a};H(N,E);N.prototype.contents=function(){return[this.val]};N.prototype.pretty=function(){return this.val};N.prototype.visit=function(a){return a["const"](this,this.val)};var O=function(a,e){this.fname=a;this.args=e};H(O,E);O.prototype.contents=function(){return[this.fname,D(this.args)]};
O.prototype.pretty=function(){var a,e=this.fname,h,c,r,p;r=this.args;p=[];h=0;for(c=r.length;h<c;h++)a=r[h],p.push(a.pretty());return B(e,p)};O.prototype.visit=function(a){var e;return a.call(this,this.fname,function(){var h,c,r,p;r=this.args;p=[];h=0;for(c=r.length;h<c;h++)e=r[h],p.push(e.visit(a));return p}.call(this))};k=function(a,e,h){var c,r,p,d;r=a.peek();if(null!==r){p=0;for(d=h.length;p<d;p++)if(c=h[p],t=c[0],c=c[1],r.tag===t)return c(a)}return e(a)};p=function(a){throw z.error.defn("There is an error in your specification at "+
a.toString());};q=function(a){var h;h=new I(r(a));a=e(h);if(null!==h.peek())throw z.error.defn("There is an error in your specification at "+h.toString());return a};e=function(a){return k(a,p,[[C.Tag.literal,h],[C.Tag.symbol,w]])};h=function(a){return new N(a.get().val)};w=function(a){var e;e=a.get().name;return k(a,function(){return new M(e)},[[C.Tag.lparen,n(e)]])};n=function(a){return function(e){e.get();e=k(e,x([]),[[C.Tag.rparen,function(a){a.get();return[]}]]);return new O(a,e)}};x=function(a){return function(h){var c,
r;c=e(h);r=a.concat([c]);return k(h,p,[[C.Tag.rparen,function(a){a.get();return r}],[C.Tag.comma,function(a){a.get();return x(r)(a)}]])}};s=function(e){var h;h={trans:[],stat:[]};e.visit({ident:function(a,e){return e},"const":function(a,e){return e},call:function(e,c,r){var p,t;t=c in z["const"].trans?"trans":c in z["const"].stat?"stat":"none";if("none"!==t)return p=z["const"][t][c],r=a(G(p,r)),r.name=e.pretty(),r[t]=c,h[t].push(r),r.name;throw z.error.defn("The operation "+c+" is not recognized. Please check your specifications.");
}});return h};z.parser={tokenize:r,parse:q,layerToData:function(e){var h,r,p,t,l,w,b,A,n;l={};b=null!=(w=e.filter)?w:{};for(r in b)w=b[r],l[q(r).pretty()]=w;p=z["const"].aes;n=[];w=0;for(h=p.length;w<h;w++)b=p[w],n.push([b,null]);h=y(e,a(n));for(r in h)"var"in h[r]||delete h[r];n=[];b=[];w=[];e={};for(r in h)p=h[r],t=q(p["var"]),p["var"]=t.pretty(),t=s(t),n.push(t),b.push(p["var"]),0===t.stat.length&&w.push(p["var"]),"sort"in p&&(t=y(p,z["const"].metas),A=q(t.sort),t.sort=A.pretty(),A=s(A),0!==A.stat.length&&
(t.stat=A.stat),e[p["var"]]=t);h=v(n);r=d("name");w={stats:r(h.stat),groups:c(w)};return{trans:r(h.trans),stats:w,meta:e,select:c(b),filter:l}}};this.poly=z}).call(this);
(function(){var j,b,m,f={}.hasOwnProperty,g=function(a,c){function d(){this.constructor=a}for(var b in c)f.call(c,b)&&(a[b]=c[b]);d.prototype=c.prototype;a.prototype=new d;a.__super__=c.prototype;return a};m=this.poly||{};var a=function(a){var c;null==a&&(a={});this.flip=null!=(c=a.flip)?c:!1;this.scales=null;a=this.flip?["y","x"]:["x","y"];this.x=a[0];this.y=a[1]};a.prototype.make=function(a){return this.dims=a};a.prototype.setScales=function(a){return this.scales={x:a.x.f,y:a.y.f}};a.prototype.clipping=
function(){return[this.dims.paddingLeft+this.dims.guideLeft,this.dims.paddingTop+this.dims.guideTop,this.dims.chartWidth,this.dims.chartHeight]};a.prototype.ranges=function(){};var c=function(){return c.__super__.constructor.apply(this,arguments)};g(c,a);c.prototype.type="cartesian";c.prototype.ranges=function(){var a;a={};a[this.x]={min:this.dims.paddingLeft+this.dims.guideLeft,max:this.dims.paddingLeft+this.dims.guideLeft+this.dims.chartWidth};a[this.y]={min:this.dims.paddingTop+this.dims.guideTop+
this.dims.chartHeight,max:this.dims.paddingTop+this.dims.guideTop};return a};c.prototype.axisType=function(a){return this[a]};c.prototype.getXY=function(a,c){var d,b;if(a)return d={x:_.isArray(c.x)?_.map(c.x,this.scales.x):this.scales.x(c.x),y:_.isArray(c.y)?_.map(c.y,this.scales.y):this.scales.y(c.y)},{x:d[this.x],y:d[this.y]};d=this.scales[this.x];b=this.scales[this.y];return{x:_.isArray(c.x)?_.map(c.x,d):d(c.x),y:_.isArray(c.y)?_.map(c.y,b):b(c.y)}};c.prototype.getAes=function(a,c,d){return{x:d.x(a[this.x],
c[this.x]),y:d.y(a[this.y],c[this.y])}};j=c;var d=function(){var a=this.getXY,c=this;this.getXY=function(){return a.apply(c,arguments)};return d.__super__.constructor.apply(this,arguments)};g(d,a);d.prototype.type="polar";d.prototype.make=function(a){this.dims=a;this.cx=this.dims.paddingLeft+this.dims.guideLeft+this.dims.chartWidth/2;return this.cy=this.dims.paddingTop+this.dims.guideTop+this.dims.chartHeight/2};d.prototype.ranges=function(){var a,c,d;c=[this.x,this.y];a=c[0];d=c[1];c={};c[d]={min:0,
max:2*Math.PI};c[a]={min:0,max:Math.min(this.dims.chartWidth,this.dims.chartHeight)/2-10};return c};d.prototype.axisType=function(a){return"x"===this[a]?"r":"t"};d.prototype.getXY=function(a,c){var d,b,g,f,q,n,x,h,e,p,w,z,B,D,t=this;p=function(a,e){return t.cx+a*Math.cos(e-Math.PI/2)};w=function(a,e){return t.cy+a*Math.sin(e-Math.PI/2)};f=[this.x,this.y];q=f[0];x=f[1];if(a){if(_.isArray(c[q])){f={x:[],y:[],r:[],t:[]};B=c[q];b=d=0;for(z=B.length;d<z;b=++d)n=B[b],n=this.scales[q](n),h=this.scales[x](c[x][b]),
f.x.push(p(n,h)),f.y.push(w(n,h)),f.r.push(n),f.t.push(h);return f}n=this.scales[q](c[q]);h=this.scales[x](c[x]);return{x:p(n,h),y:w(n,h),r:n,t:h}}g=function(a){return _.isObject(a)&&"scalefn"===a.t&&"identity"===a.f};d=function(a,e){var c,d;c=g(a);d=g(e);if(c&&!d)return{x:a.v,y:w(t.scales[q](e),0)};if(c&&d)return{x:a.v,y:e.v};if(!c&&d)return{y:e.v,x:w(t.scales[x](a),0)};n=t.scales[q](e);h=t.scales[x](a);return{x:p(n,h),y:w(n,h)}};if(_.isArray(c.x)){f={x:[],y:[]};D=c.x;b=z=0;for(B=D.length;z<B;b=
++z)e=D[b],b=c.y[b],e=d(e,b),b=e.x,e=e.y,f.x.push(b),f.y.push(e);return f}return d(c.x,c.y)};b=d;m.coord={cartesian:function(a){return new j(a)},polar:function(a){return new b(a)}}}).call(this);
(function(){var j,b,m,f,g,a,c,d,l,y,k;k=this.poly||{};f=k["const"].aes;k.domain={};k.domain.make=function(a,c,b){var q,n,g,h;q=[];g=0;for(h=a.length;g<h;g++)n=a[g],q.push(d(n,c,b));return l(q)};k.domain.sortfn=function(a){switch(a.type){case "num":return function(a){return a};case "date":return function(a){return a};case "cat":return function(c){if(-1===_.indexOf(a.levels,c))return Infinity}}};m=function(a){this.type=a.type;this.min=a.min;this.max=a.max;this.bw=a.bw};b=function(a){this.type=a.type;
this.min=a.min;this.max=a.max;this.bw=a.bw};j=function(a){this.type=a.type;this.levels=a.levels;this.sorted=a.sorted};c=function(a){switch(a.type){case "num":return new m(a);case "date":return new b(a);case "cat":return new j(a)}};d=function(d,b,g){var q,n,l,h,e,p,w,f,B,k,t,r,A;l={};for(q in d.mapping)if(g)l[q]=c(b[q]);else switch(p=a(d.geoms,q),n=null!=(w=d.getMeta(q))?w:{},h=function(a){return null!=b[q]?b[q][a]:null},n.type){case "num":n=null!=(f=h("bw"))?f:n.bw;e=null!=(B=h("min"))?B:_.min(p);
h=null!=(k=h("max"))?k:_.max(p)+(null!=n?n:0);l[q]=c({type:"num",min:e,max:h,bw:n});break;case "date":n=null!=(t=h("bw"))?t:n.bw;e=null!=(r=h("min"))?r:_.min(p);h=h("max");null==h&&(h=_.max(p),n&&(h=moment.unix(h).add(n+"s",1).unix()));l[q]=c({type:"date",min:e,max:h,bw:n});break;case "cat":l[q]=c({type:"cat",levels:null!=(A=h("levels"))?A:_.uniq(p),sorted:null!=h("levels")})}return l};a=function(a,c){var d,b,n,l,h;l=[];for(b in a)for(n in d=a[b],h=d.marks,h)d=h[n],l=l.concat(k.flatten(d[c]));return l};
l=function(a){var c,d,b,n,l;b={};n=0;for(l=f.length;n<l;n++)c=f[n],d=_.without(_.pluck(a,c),void 0),0<d.length&&(b[c]=y(d));return b};g={num:function(a){var d,b;d=_.compact(_.uniq(_.map(a,function(a){return a.bw})));if(1<d.length)throw k.error.data("Not all layers have the same binwidth.");d=null!=(b=d[0])?b:void 0;b=_.min(_.map(a,function(a){return a.min}));a=_.max(_.map(a,function(a){return a.max}));return c({type:"num",min:b,max:a,bw:d})},date:function(a){var d,b;d=_.compact(_.uniq(_.map(a,function(a){return a.bw})));
if(1<d.length)throw k.error.data("Not all layers have the same binwidth.");d=null!=(b=d[0])?b:void 0;b=_.min(_.map(a,function(a){return a.min}));a=_.max(_.map(a,function(a){return a.max}));return c({type:"date",min:b,max:a,bw:d})},cat:function(a){var d;d=_.chain(a).filter(function(a){return a.sorted}).map(function(a){return a.levels}).value();a=_.chain(a).filter(function(a){return!a.sorted}).map(function(a){return a.levels}).value();if(0<d.length&&_.intersection.apply(this,d))throw k.error.data("You are trying to combine incompatiabl sorted domains in the same axis.");
d=[_.flatten(d,!0)];a=_.union.apply(this,d.concat(a));0===d[0].length&&(a=a.sort());return c({type:"cat",levels:a,sorted:!0})}};y=function(a){var c;c=_.uniq(_.map(a,function(a){return a.type}));if(1<c.length)throw k.error.data("You are trying to merge data of different types in the same axis or legend.");return g[c[0]](a)};this.poly=k}).call(this);
(function(){var j,b,m,f,g;m=this.poly||{};m.tick={};m.tick.make=function(a,c,d){var b,j,k,s;b=null;null!=c.ticks?a=c.ticks:(b=null!=(j=c.numticks)?j:5,b=g[d](a,b),a=b.ticks,b=b.step);b=c.labels?function(a){var d;return null!=(d=c.labels[a])?d:a}:c.formatter?c.formatter:m.format(d,b);d={};j=f(b);k=0;for(s=a.length;k<s;k++)b=a[k],d[b]=j(b);return d};j=function(a){this.location=a.location;this.value=a.value;this.index=a.index};f=function(a){var c;c=0;return function(d){return new j({location:d,value:a(d),
index:c++})}};b=function(a,c){var d,b;b=Math.pow(10,Math.floor(Math.log(a/c)/Math.LN10));d=c/a*b;0.15>d?b*=10:0.35>=d?b*=5:0.75>=d&&(b*=2);return b};g={cat:function(a,c){var b,g,f,k,m,j,v;f=Math.max(1,Math.round(a.levels.length/c));k=[];v=a.levels;b=m=0;for(j=v.length;m<j;b=++m)g=v[b],0===b%f&&k.push(g);return{ticks:k}},num:function(a,c){var d,g,f,k;g=a.min;d=a.max;f=b(d-g,c);k=Math.ceil(g/f)*f;for(g=[];k<d;)g.push(k),k+=f;return{ticks:g,step:Math.floor(Math.log(f)/Math.LN10)}},"num-log":function(a,
c){var d,g,f,k,j,u,v,q;u=a.min;j=a.max;g=function(a){return Math.log(a)/Math.LN10};d=function(a){return Math.exp(a*Math.LN10)};k=Math.max(g(u),0);f=g(j);q=b(f-k,c);for(k=Math.ceil(k/q)*q;k<f+m["const"].epsilon;)if(0!==k%1&&0.1>=k%1)k+=q;else{if(k%1>m["const"].epsilon&&(v=Math.floor(k)+g(10*(k%1)),0===v%1)){k+=q;continue}v=d(v);v<u||v>j?k+=q:ticks.push(v)}return{ticks:ticks}},date:function(a,c){var b,g,f,k;b=a.min;g=a.max;f=(g-b)/c;f=1.4>f?"second":84>f?"minute":5040>f?"hour":120960>f?"day":846720>
f?"week":3628800>f?"month":"year";k=[];for(b=moment.unix(b).startOf(f);b.unix()<g;)k.push(b.unix()),b.add(f+"s",1);return{ticks:k,step:f}}};this.poly=m}).call(this);
(function(){var j,b,m,f,g,a,c=function(a,e){return function(){return a.apply(e,arguments)}},d={}.hasOwnProperty,l=function(a,e){function c(){this.constructor=a}for(var b in e)d.call(e,b)&&(a[b]=e[b]);c.prototype=e.prototype;a.prototype=new c;a.__super__=e.prototype;return a},y=[].indexOf||function(a){for(var e=0,c=this.length;e<c;e++)if(e in this&&this[e]===a)return e;return-1};g=this.poly||{};a=g["const"].scaleFns;var k=function(){};k.prototype.getDimension=function(){throw g.error.impl();};var s=
function(){this._modify=c(this._modify,this);this._add=c(this._add,this);this.render=c(this.render,this);this.make=c(this.make,this);this.title=this.line=null;this.position="none";this.titletext=null;this.ticks={};this.pts={}};l(s,k);s.prototype.make=function(a){var e,c,b,d;e=a.domain;b=a.type;c=a.guideSpec;a=a.key;this.titletext=null!=(d=c.title)?d:a;this.ticks=g.tick.make(e,c,b);return this.maxwidth=_.max(_.map(this.ticks,function(a){return g.strSize(a.value)}))};s.prototype.render=function(a,e){var c,
b,d,f,n,t,r,A;b={top:a.paddingTop+a.guideTop,left:a.paddingLeft+a.guideLeft,right:a.paddingLeft+a.guideLeft+a.chartWidth,bottom:a.paddingTop+a.guideTop+a.chartHeight,width:a.chartWidth,height:a.chartHeight};null!=this.line&&e.remove(this.line);this.line=this._renderline(e,b);this.title=null!=this.title?e.animate(this.title,this._makeTitle(b,this.titletext)):e.add(this._makeTitle(b,this.titletext));n=g.compare(_.keys(this.pts),_.keys(this.ticks));d=n.deleted;f=n.kept;c=n.added;n={};r=0;for(A=f.length;r<
A;r++)t=f[r],n[t]=this._modify(e,this.pts[t],this.ticks[t],b);f=0;for(r=c.length;f<r;f++)t=c[f],n[t]=this._add(e,this.ticks[t],b);b=0;for(c=d.length;b<c;b++)t=d[b],this._delete(e,this.pts[t]);this.pts=n;return this.rendered=!0};s.prototype._add=function(a,c,b){var d;d={};d.tick=a.add(this._makeTick(b,c));d.text=a.add(this._makeLabel(b,c));return d};s.prototype._delete=function(a,c){a.remove(c.tick);return a.remove(c.text)};s.prototype._modify=function(a,c,b,d){var f;f={};f.tick=a.animate(c.tick,this._makeTick(d,
b));f.text=a.animate(c.text,this._makeLabel(d,b));return f};s.prototype._renderline=function(){throw g.error.impl();};s.prototype._makeTitle=function(){throw g.error.impl();};s.prototype._makeTick=function(){throw g.error.impl();};s.prototype._makeLabel=function(){throw g.error.impl();};var u=function(){this.make=c(this.make,this);return u.__super__.constructor.apply(this,arguments)};l(u,s);u.prototype.make=function(a){var c,b;this.position=null!=(c=a.guideSpec.position)?c:"bottom";if("top"!==(b=
this.position)&&"bottom"!==b&&"none"!==b)throw g.error.defn("X-axis position can't be "+this.position+".");return u.__super__.make.call(this,a)};u.prototype._renderline=function(c,e){var b,d,f;f="top"===this.position?a.identity(e.top):a.identity(e.bottom);b=a.identity(e.left);d=a.identity(e.left+e.width);return c.add({type:"path",y:[f,f],x:[b,d],stroke:a.identity("black")})};u.prototype._makeTitle=function(c,e){var b;b="top"===this.position?a.identity(c.top-27):a.identity(c.bottom+27);return{type:"text",
x:a.identity(c.left+c.width/2),y:b,text:e,"text-anchor":"middle"}};u.prototype._makeTick=function(c,e){var b,d;"top"===this.position?(b=a.identity(c.top),d=a.identity(c.top-5)):(b=a.identity(c.bottom),d=a.identity(c.bottom+5));return{type:"path",x:[e.location,e.location],y:[b,d],stroke:a.identity("black")}};u.prototype._makeLabel=function(c,e){var b;b="top"===this.position?a.identity(c.top-15):a.identity(c.bottom+15);return{type:"text",x:e.location,y:b,text:e.value,"text-anchor":"middle"}};u.prototype.getDimension=
function(){var a;return{position:null!=(a=this.position)?a:"bottom",height:30,width:"all"}};m=u;var v=function(){this.make=c(this.make,this);return v.__super__.constructor.apply(this,arguments)};l(v,s);v.prototype.make=function(a){var c,b;this.position=null!=(c=a.guideSpec.position)?c:"left";if("left"!==(b=this.position)&&"right"!==b&&"none"!==b)throw g.error.defn("X-axis position can't be "+this.position+".");return v.__super__.make.call(this,a)};v.prototype._renderline=function(c,e){var b,d,f;b=
"left"===this.position?a.identity(e.left):a.identity(e.right);d=a.identity(e.top);f=a.identity(e.top+e.height);return c.add({type:"path",x:[b,b],y:[d,f],stroke:a.identity("black")})};v.prototype._makeTitle=function(c,e){return{type:"text",x:"left"===this.position?a.identity(c.left-this.maxwidth-15):a.identity(c.right+this.maxwidth+15),y:a.identity(c.top+c.height/2),text:e,transform:"r270","text-anchor":"middle"}};v.prototype._makeTick=function(c,e){var b,d;"left"===this.position?(b=a.identity(c.left),
d=a.identity(c.left-5)):(b=a.identity(c.right),d=a.identity(c.right+5));return{type:"path",x:[b,d],y:[e.location,e.location],stroke:a.identity("black")}};v.prototype._makeLabel=function(c,e){return{type:"text",x:"left"===this.position?a.identity(c.left-7):a.identity(c.right+7),y:e.location,text:e.value,"text-anchor":"left"===this.position?"end":"start"}};v.prototype.getDimension=function(){var a;return{position:null!=(a=this.position)?a:"right",height:"all",width:20+this.maxwidth}};f=v;var q=function(){return q.__super__.constructor.apply(this,
arguments)};l(q,s);q.prototype._renderline=function(c,e){var b,d,f;b=a.identity(e.left);d=a.identity(e.top);f=a.identity(e.top+e.height/2);return c.add({type:"path",x:[b,b],y:[d,f],stroke:a.identity("black")})};q.prototype._makeTitle=function(c,e){return{type:"text",x:a.identity(c.left-this.maxwidth-15),y:a.identity(c.top+c.height/4),text:e,transform:"r270","text-anchor":"middle"}};q.prototype._makeTick=function(c,e){return{type:"path",x:[a.identity(c.left),a.identity(c.left-5)],y:[e.location,e.location],
stroke:a.identity("black")}};q.prototype._makeLabel=function(c,e){return{type:"text",x:a.identity(c.left-7),y:e.location,text:e.value,"text-anchor":"end"}};q.prototype.getDimension=function(){return{position:"left",height:"all",width:20+this.maxwidth}};j=q;var n=function(){return n.__super__.constructor.apply(this,arguments)};l(n,s);n.prototype._renderline=function(c,e){var b;b=Math.min(e.width,e.height)/2-10;return c.add({type:"circle",x:a.identity(e.left+e.width/2),y:a.identity(e.top+e.height/2),
size:a.identity(b),color:a.identity("none"),stroke:a.identity("black"),"stroke-width":1})};n.prototype._makeTitle=function(c,e){return{type:"text",x:a.identity(c.left+c.width/2),y:a.identity(c.bottom+27),text:e,"text-anchor":"middle"}};n.prototype._makeTick=function(c,e){Math.min(c.width,c.height);return{type:"path",x:[e.location,e.location],y:[a.max(0),a.max(3)],stroke:a.identity("black")}};n.prototype._makeLabel=function(c,e){Math.min(c.width,c.height);return{type:"text",x:e.location,y:a.max(12),
text:e.value,"text-anchor":"middle"}};n.prototype.getDimension=function(){return{}};b=n;var x=function(a){this.aes=a;this._makeTick=c(this._makeTick,this);this.make=c(this.make,this);this.rendered=!1;this.title=null;this.ticks={};this.pts={}};l(x,k);x.prototype.TITLEHEIGHT=15;x.prototype.TICKHEIGHT=12;x.prototype.SPACING=10;x.prototype.make=function(a){var c,b,d,f;c=a.domain;d=a.type;b=a.guideSpec;this.mapping=a.mapping;a=a.keys;this.titletext=null!=(f=b.title)?f:a;this.ticks=g.tick.make(c,b,d);this.height=
this.TITLEHEIGHT+this.SPACING+this.TICKHEIGHT*_.size(this.ticks);b=g.strSize(this.titletext);c=_.max(_.map(this.ticks,function(a){return g.strSize(a.value)}));return this.maxwidth=Math.max(b,c)};x.prototype.render=function(a,c,b){var d,f,n,q,t,r;a={top:a.paddingTop+a.guideTop+b.y,right:a.paddingLeft+a.guideLeft+a.chartWidth+b.x,width:a.guideRight,height:a.chartHeight};this.title=null!=this.title?c.animate(this.title,this._makeTitle(a,this.titletext)):c.add(this._makeTitle(a,this.titletext));b=g.compare(_.keys(this.pts),
_.keys(this.ticks));d=b.deleted;f=b.kept;b=b.added;n={};t=0;for(r=d.length;t<r;t++)q=d[t],this._delete(c,this.pts[q]);d=0;for(t=f.length;d<t;d++)q=f[d],n[q]=this._modify(c,this.pts[q],this.ticks[q],a);f=0;for(d=b.length;f<d;f++)q=b[f],n[q]=this._add(c,this.ticks[q],a);return this.pts=n};x.prototype.remove=function(a){var c,b,d;d=this.pts;for(c in d)b=d[c],this._delete(a,b);a.remove(this.title);this.title=null;return this.pts={}};x.prototype._add=function(a,c,b){var d;d={};d.tick=a.add(this._makeTick(b,
c));d.text=a.add(this._makeLabel(b,c));return d};x.prototype._delete=function(a,c){a.remove(c.tick);return a.remove(c.text)};x.prototype._modify=function(a,c,b,d){var f;f=[];f.tick=a.animate(c.tick,this._makeTick(d,b));f.text=a.animate(c.text,this._makeLabel(d,b));return f};x.prototype._makeLabel=function(c,b){return{type:"text",x:a.identity(c.right+15),y:a.identity(c.top+(15+12*b.index)+1),text:b.value,"text-anchor":"start"}};x.prototype._makeTick=function(c,b){var d,f,n,q;f={type:"circle",x:a.identity(c.right+
7),y:a.identity(c.top+(15+12*b.index)),color:a.identity("steelblue")};q=this.mapping;for(d in q)n=q[d],0<=y.call(g["const"].noLegend,d)||(n=n[0],f[d]=0<=y.call(this.aes,d)?b.location:null!=n.type&&"const"===n.type?a.identity(n.value):_.isObject(n)?a.identity(g["const"].defaults[d]):a.identity(n));0<=y.call(this.aes,"size")||(f.size=a.identity(5));return f};x.prototype._makeTitle=function(c,b){return{type:"text",x:a.identity(c.right+5),y:a.identity(c.top),text:b,"text-anchor":"start"}};x.prototype.getDimension=
function(){return{position:"right",height:this.height,width:15+this.maxwidth}};g.guide={};g.guide.axis=function(a){if("x"===a)return new m;if("y"===a)return new f;if("r"===a)return new j;if("t"===a)return new b};g.guide.legend=function(a){return new x(a)};this.poly=g}).call(this);
(function(){var j,b,m,f,g,a,c,d,l=function(a,c){return function(){return a.apply(c,arguments)}},y={}.hasOwnProperty,k=function(a,c){function b(){this.constructor=a}for(var e in c)y.call(c,e)&&(a[e]=c[e]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a};d=this.poly||{};d.scale={linear:function(a){return new g(a)},log:function(c){return new a(c)},area:function(a){return new j(a)},color:function(a){return new b(a)},gradient:function(a){return new m(a)},identity:function(a){return new f(a)},
opacity:function(a){return new c(a)}};var s=function(){this.f=null};s.prototype.make=function(a){this.domain=a;this.sortfn=d.domain.sortfn(a);switch(a.type){case "num":return this._makeNum();case "date":return this._makeDate();case "cat":return this._makeCat()}};s.prototype._makeNum=function(){throw d.error.impl("You are using a scale that does not support numbers");};s.prototype._makeDate=function(){throw d.error.impl("You are using a scale that does not support dates");};s.prototype._makeCat=function(){throw d.error.impl("You are using a scale that does not support categoies");
};s.prototype.tickType=function(){switch(this.domain.type){case "num":return this._tickNum(this.domain);case "date":return this._tickDate(this.domain);case "cat":return this._tickCat(this.domain)}};s.prototype._tickNum=function(){return"num"};s.prototype._tickDate=function(){return"date"};s.prototype._tickCat=function(){return"cat"};s.prototype._identityWrapper=function(a){return function(c){return _.isObject(c)&&"scalefn"===c.t&&"identity"===c.f?c.v:a(c)}};var u=function(){this._catWrapper=l(this._catWrapper,
this);this._dateWrapper=l(this._dateWrapper,this);this._numWrapper=l(this._numWrapper,this);this.finv=this.f=null};k(u,s);u.prototype.make=function(a,c){this.range=c;return u.__super__.make.call(this,a)};u.prototype._numWrapper=function(a,c){var b=this;return function(e){var f;f=0.001*(b.range.max>b.range.min?1:-1);if(_.isObject(e)){if("scalefn"===e.t){if("identity"===e.f)return e.v;if("upper"===e.f)return c(e.v+a.bw)-f;if("lower"===e.f)return c(e.v)+f;if("middle"===e.f)return c(e.v+a.bw/2);if("max"===
e.f)return b.range.max+e.v;if("min"===e.f)return b.range.min+e.v}throw d.error.input("Unknown object "+e+" is passed to a scale");}return c(e)}};u.prototype._dateWrapper=function(a,c){var b=this;return function(e){var f;f=0.001*(b.range.max>b.range.min?1:-1);if(_.isObject(e)){if("scalefn"===e.t){if("identity"===e.f)return e.v;if("upper"===e.f)return e=moment.unix(e.v).endOf(a.bw).unix(),c(e)-f;if("lower"===e.f)return e=moment.unix(e.v).startOf(a.bw).unix(),c(e)+f;if("middle"===e.f)return f=moment.unix(e.v).endOf(a.bw).unix(),
e=moment.unix(e.v).startOf(a.bw).unix(),c(f/2+e/2);if("max"===e.f)return b.range.max+e.v;if("min"===e.f)return b.range.min+e.v}throw d.error.input("Unknown object "+e+" is passed to a scale");}return c(e)}};u.prototype._catWrapper=function(a,c){var b=this;return function(e){var f;f=0.001*(b.range.max>b.range.min?1:-1);if(_.isObject(e)){if("scalefn"===e.t){if("identity"===e.f)return e.v;if("upper"===e.f)return c(e.v)+a-f;if("lower"===e.f)return c(e.v)+f;if("middle"===e.f)return c(e.v)+a/2;if("max"===
e.f)return b.range.max+e.v;if("min"===e.f)return b.range.min+e.v}throw d.error.input("Unknown object "+e+" is passed to a scale");}return c(e)+a/2}};var v=function(){return v.__super__.constructor.apply(this,arguments)};k(v,u);v.prototype._makeNum=function(){var a,c;c=d.linear(this.domain.min,this.range.min,this.domain.max,this.range.max);a=d.linear(this.range.min,this.domain.min,this.range.max,this.domain.max);this.f=this._numWrapper(this.domain,c);return this.finv=function(c,b){var e;e=[a(c),a(b)];
return{ge:_.min(e),le:_.max(e)}}};v.prototype._makeDate=function(){var a,c;c=d.linear(this.domain.min,this.range.min,this.domain.max,this.range.max);a=d.linear(this.range.min,this.domain.min,this.range.max,this.domain.max);this.f=this._dateWrapper(this.domain,c);return this.finv=function(c,b){var e;e=[a(c),a(b)];return{ge:_.min(e),le:_.max(e)}}};v.prototype._makeCat=function(){var a,c=this;a=(this.range.max-this.range.min)/this.domain.levels.length;this.f=this._catWrapper(a,function(b){b=_.indexOf(c.domain.levels,
b);return-1===b?null:c.range.min+b*a});return this.finv=function(b,e){var d,f;e<b&&(d=e,e=b,b=d);d=Math.floor(b/a);f=Math.ceil(e/a);return{"in":c.domain.levels.slice(d,f+1||9E9)}}};g=v;var q=function(){return q.__super__.constructor.apply(this,arguments)};k(q,u);q.prototype._makeNum=function(){var a,c,b,e;a=Math.log;b=d.linear(a(this.domain.min),this.range.min,a(this.domain.max),this.range.max);this.f=this._numWrapper(function(c){return b(a(c))});e=d.linear(this.range.min,a(this.domain.min),this.range.max,
a(this.domain.max));c=function(a){return Math.exp(e(a))};return this.finv=function(a,b){var e;e=[c(a),c(b)];return{ge:_.min(e),le:_.max(e)}}};q.prototype._tickNum=function(){return"num-log"};a=q;var n=function(){this._makeNum=l(this._makeNum,this);return n.__super__.constructor.apply(this,arguments)};k(n,s);n.prototype._makeNum=function(){var a,c,b;a=0===this.domain.min?0:1;c=Math.sqrt;b=d.linear(c(this.domain.min),a,c(this.domain.max),10);return this.f=this._identityWrapper(function(a){return b(c(a))})};
j=n;var x=function(){this._makeNum=l(this._makeNum,this);return x.__super__.constructor.apply(this,arguments)};k(x,s);x.prototype._makeNum=function(){return this.f=this._identityWrapper(d.linear(this.domain.min,0===this.domain.min?0:0.1,this.domain.max,1))};c=x;var h=function(){this._makeNum=l(this._makeNum,this);this._makeCat=l(this._makeCat,this);return h.__super__.constructor.apply(this,arguments)};k(h,s);h.prototype._makeCat=function(){var a,c,b=this;c=this.domain.levels.length;a=function(a){return _.indexOf(b.domain.levels,
a)/c+1/(2*c)};return this.f=function(c){return Raphael.hsl(a(c),0.5,0.5)}};h.prototype._makeNum=function(){var a;a=d.linear(this.domain.min,0,this.domain.max,1);return this.f=function(c){return Raphael.hsl(0.5,a(c),0.5)}};b=h;var e=function(){return e.__super__.constructor.apply(this,arguments)};k(e,s);e.prototype._makeCat=function(){};var p=function(a){this._makeNum=l(this._makeNum,this);this.lower=a.lower;this.upper=a.upper};k(p,s);p.prototype._makeNum=function(){var a,c,b,e,f;b=Raphael.color(this.lower);
f=Raphael.color(this.upper);e=d.linear(this.domain.min,b.r,this.domain.max,f.r);c=d.linear(this.domain.min,b.g,this.domain.max,f.g);a=d.linear(this.domain.min,b.b,this.domain.max,f.b);return this.f=this._identityWrapper(function(b){return Raphael.rgb(e(b),c(b),a(b))})};m=p;p=function(){this._makeCat=l(this._makeCat,this)};k(p,s);p.prototype._makeCat=function(){};var w=function(){return w.__super__.constructor.apply(this,arguments)};k(w,s);w.prototype._makeCat=function(){};var z=function(){return z.__super__.constructor.apply(this,
arguments)};k(z,s);z.prototype.make=function(){this.sortfn=function(a){return a};return this.f=this._identityWrapper(function(a){return a})};f=z;this.poly=d}).call(this);
(function(){var j,b,m=[].indexOf||function(b){for(var a=0,c=this.length;a<c;a++)if(a in this&&this[a]===b)return a;return-1};b=this.poly||{};b.scaleset=function(b,a,c){return new j(b,a,c)};var f=function(f,a){this.axes={x:b.guide.axis(a.axisType("x")),y:b.guide.axis(a.axisType("y"))};this.coord=a;this.ranges=f;this.legends=[];this.deletedLegends=[]};f.prototype.make=function(b,a,c){this.guideSpec=b;this.layers=c;this.domains=a;this.domainx=this.domains.x;this.domainy=this.domains.y;this.scales=this._makeScales(b,
a,this.ranges);this.reverse={x:this.scales.x.finv,y:this.scales.y.finv};return this.layerMapping=this._mapLayers(c)};f.prototype.setRanges=function(b){this.ranges=b;this._makeXScale();return this._makeYScale()};f.prototype.setXDomain=function(b){this.domainx=b;return this._makeXScale()};f.prototype.setYDomain=function(b){this.domainy=b;return this._makeYScale()};f.prototype.resetDomains=function(){this.domainx=this.domains.x;this.domainy=this.domains.y;this._makeXScale();return this._makeYScale()};
f.prototype._makeXScale=function(){return this.scales.x.make(this.domainx,this.ranges.x)};f.prototype._makeYScale=function(){return this.scales.y.make(this.domainy,this.ranges.y)};f.prototype._makeScales=function(f,a,c){var d,l,m,k,j,u;l=function(a){return f&&null!=f[a]&&null!=f[a].scale?f[a].scale:null};d={};d.x=null!=(m=l("x"))?m:b.scale.linear();d.x.make(a.x,c.x);d.y=null!=(k=l("y"))?k:b.scale.linear();d.y.make(a.y,c.y);null!=a.color&&(d.color="cat"===a.color.type?null!=(j=l("color"))?j:b.scale.color():
null!=(u=l("color"))?u:b.scale.gradient({upper:"steelblue",lower:"red"}),d.color.make(a.color));null!=a.size&&(d.size=l("size")||b.scale.area(),d.size.make(a.size));null!=a.opacity&&(d.opacity=l("opacity")||b.scale.opacity(),d.opacity.make(a.opacity));d.text=b.scale.identity();d.text.make();return d};f.prototype.fromPixels=function(b,a){var c,d,f,m,k,j,u;c=this.coord.getAes(b,a,this.reverse);f=c.x;m=c.y;d={};u=this.layerMapping.x;k=0;for(j=u.length;k<j;k++)c=u[k],null!=c.type&&"map"===c.type&&(d[c.value]=
f);j=this.layerMapping.y;f=0;for(k=j.length;f<k;f++)c=j[f],null!=c.type&&"map"===c.type&&(d[c.value]=m);return d};f.prototype.getSpec=function(b){return null!=this.guideSpec&&null!=this.guideSpec[b]?this.guideSpec[b]:{}};f.prototype.makeAxes=function(){this.axes.x.make({domain:this.domainx,type:this.scales.x.tickType(),guideSpec:this.getSpec("x"),key:b.getLabel(this.layers,"x")});this.axes.y.make({domain:this.domainy,type:this.scales.y.tickType(),guideSpec:this.getSpec("y"),key:b.getLabel(this.layers,
"y")});return this.axes};f.prototype.renderAxes=function(b,a){this.axes.x.render(b,a);return this.axes.y.render(b,a)};f.prototype._mapLayers=function(b){var a,c;c={};for(a in this.domains)c[a]=_.map(b,function(c){return null!=c.mapping[a]?{type:"map",value:c.mapping[a]}:null!=c.consts[a]?{type:"const",value:c["const"][a]}:c.defaults[a]});return c};f.prototype._mergeAes=function(f){var a,c,d,l,j,k,s;j=[];for(a in this.domains)if(!(0<=m.call(b["const"].noLegend,a))&&(d=_.map(f,function(c){return c.mapping[a]}),
!_.all(d,_.isUndefined))){l=!1;k=0;for(s=j.length;k<s;k++)if(c=j[k],_.isEqual(c.mapped,d)){c.aes.push(a);l=!0;break}l||j.push({aes:[a],mapped:d})}return _.pluck(j,"aes")};f.prototype.makeLegends=function(){var f,a,c,d,l,m;a=this._mergeAes(this.layers);for(d=0;d<this.legends.length;){l=this.legends[d];m=!0;for(c=0;c<a.length;){f=a[c];if(_.isEqual(f,l.aes)){a.splice(c,1);m=!1;break}c++}m?(this.deletedLegends.push(l),this.legends.splice(d,1)):d++}l=0;for(c=a.length;l<c;l++)f=a[l],this.legends.push(b.guide.legend(f));
d=this.legends;a=0;for(c=d.length;a<c;a++)l=d[a],f=l.aes[0],l.make({domain:this.domains[f],guideSpec:this.getSpec(f),type:this.scales[f].tickType(),mapping:this.layerMapping,keys:b.getLabel(this.layers,f)});return this.legends};f.prototype.renderLegends=function(b,a){var c,d,f,m,k,j,u,v,q;f=this.deletedLegends;k=0;for(d=f.length;k<d;k++)c=f[k],c.remove(a);this.deletedLegends=[];k={x:0,y:0};c=this.axes.y.getDimension();"right"===c.position&&(k.x+=c.width);f=0;d=b.height-b.guideTop-b.paddingTop;v=this.legends;
q=[];j=0;for(u=v.length;j<u;j++)c=v[j],m=c.getDimension(),m.height+k.y>d&&(k.x+=f+5,f=k.y=0),m.width>f&&(f=m.width),c.render(b,a,k),q.push(k.y+=m.height);return q};j=f}).call(this);
(function(){var j,b,m,f,g,a,c,d,l,y,k,s=[].indexOf||function(a){for(var c=0,b=this.length;c<b;c++)if(c in this&&this[c]===a)return c;return-1};c=this.poly||{};var u=function(a){this.url=a.url;this.json=a.json;this.csv=a.csv;this.meta=a.meta;this.dataBackend=null!=a.url;this.computeBackend=!1;this.raw=null;null==this.meta&&(this.meta={});this.subscribed=[]};u.prototype.impute=function(a){var b,d,f,e,p,g,k;f=_.keys(a[0]);b=a.slice(0,100);p=0;for(g=f.length;p<g;p++){d=f[p];if(null==(e=this.meta)[d])e[d]=
{};this.meta[d].type||(this.meta[d].type=c.varType(_.pluck(b,d)))}e=0;for(g=a.length;e<g;e++){b=a[e];p=0;for(k=f.length;p<k;p++)d=f[p],b[d]=c.coerce(b[d],this.meta[d])}return this.raw=a};u.prototype.getRaw=function(a){var b=this;this.json&&(this.raw=this.impute(this.json));this.csv&&(this.raw=this.impute(c.csv.parse(this.csv)));if(this.raw)return a(this.raw,this.meta);if(this.url)return c.csv(this.url,function(c){b.raw=b.impute(c);return a(b.raw,b.meta)})};u.prototype.update=function(a){var c=this;
this.json=a.json;this.csv=a.csv;return this.getRaw(function(){var a,b,e,d,f;d=c.subscribed;f=[];b=0;for(e=d.length;b<e;b++)a=d[b],f.push(a());return f})};u.prototype.subscribe=function(a){if(-1===_.indexOf(this.subscribed,a))return this.subscribed.push(a)};u.prototype.unsubscribe=function(a){return this.subscribed.splice(_.indexOf(this.subscribed,a),1)};c.Data=u;var v=function(a,b){var d=this._wrap,f=this;this._wrap=function(){return d.apply(f,arguments)};this.dataObj=a.data;this.initialSpec=c.parser.layerToData(a);
this.prevSpec=null;this.strictmode=b;this.statData=null;this.metaData={}};v.prototype.reset=function(a){return this.make(this.initialSpec,a)};v.prototype.make=function(b,d){var f,h;f=c.parser.layerToData(b);h=this._wrap(d);this.strictmode&&h(this.dataObj.json,{});return this.dataObj.computeBackend?j(f,this.dataObj,h):this.dataObj.getRaw(function(c,b){return a(f,c,b,h)})};v.prototype._wrap=function(a){var c=this;return function(b,d){c.statData=b;c.metaData=d;return a(c.statData,c.metaData)}};c.DataProcess=
v;c.data={};c.data.process=function(a,c,b,d){a=new v(c,b);a.process(d);return a};k={bin:function(a,b,d){var f,e;e=b.name;f=b.binwidth;if("num"===d.type){if(isNaN(f))throw c.error.defn("The binwidth "+f+" is invalid for a numeric varliable");f=+f;b=function(c){return c[e]=f*Math.floor(c[a]/f)};return{trans:b,meta:{bw:f,binned:!0,type:"num"}}}if("date"===d.type){if(!(0<=s.call(c["const"].timerange,f)))throw c.error.defn("The binwidth "+f+" is invalid for a datetime varliable");b=function(c){return c[e]=
moment.unix(c[a]).startOf(f).unix()};return{trans:b,meta:{bw:f,binned:!0,type:"date"}}}},lag:function(a,c,b){var d;d=c.name;c=c.lag;var e,f;f=[];for(e=1;1<=c?e<=c:e>=c;1<=c?++e:--e)f.push(void 0);return{trans:function(c){f.push(c[a]);return c[d]=f.shift()},meta:{type:b.type}}}};y=function(a,c,b){return k[c.trans](a,c,b)};g={lt:function(a,c){return a<c},le:function(a,c){return a<=c},gt:function(a,c){return a>c},ge:function(a,c){return a>=c},"in":function(a,c){return 0<=s.call(c,a)}};f=function(a){var c;
c=[];_.each(a,function(a,b){return _.each(a,function(a,d){return c.push(function(c){return g[d](c[b],a)})})});return function(a){var b,e,d;e=0;for(d=c.length;e<d;e++)if(b=c[e],!b(a))return!1;return!0}};d={sum:function(){return function(a){return _.reduce(_.without(a,void 0,null),function(a,c){return a+c},0)}},count:function(){return function(a){return _.without(a,void 0,null).length}},uniq:function(){return function(a){return _.uniq(_.without(a,void 0,null)).length}},min:function(){return function(a){return _.min(a)}},
max:function(){return function(a){return _.max(a)}},median:function(){return function(a){return c.median(a)}},box:function(){return function(a){var b,d,f,e,p,g;d=a.length;return 5<d?(e=d/2,a=_.sortBy(a,function(a){return a}),b=Math.ceil(e)/2,0!==b%1?(b=Math.floor(b),e=a[b],d=a[d-1-b]):(e=(a[b]+a[b-1])/2,d=(a[d-b]+a[d-b-1])/2),b=d-e,f=e-1.5*b,p=d+1.5*b,b=_.groupBy(a,function(a){return a>=f&&a<=p}),{q1:_.min(b["true"]),q2:e,q3:c.median(a,!0),q4:d,q5:_.max(b["true"]),outliers:null!=(g=b["false"])?g:
[]}):{outliers:a}}}};l=function(a){return d[a.stat](a)};m=function(a,b){var d,f;f={};_.each(b.stats,function(a){var c,b,d;c=a.key;b=a.name;d=l(a);return f[b]=function(a){return d(_.pluck(a,c))}});d=c.groupBy(a,b.groups);return _.map(d,function(a){var c;c={};_.each(b.groups,function(b){return c[b]=a[0][b]});_.each(f,function(b,d){return c[d]=b(a)});return c})};b=function(a,c,b){var d,e,f,g;f=c.sort;g=c.stat;d=c.limit;c=c.asc;g&&(g={stats:[g],groups:[a]},b=m(b,g));e=c?1:-1;b.sort(function(a,c){return a[f]===
c[f]?0:a[f]>=c[f]?1*e:-1*e});d&&(b=b.slice(0,d-1+1||9E9));a=_.uniq(_.pluck(b,a));return{meta:{levels:a,sorted:!0},filter:{"in":a}}};a=function(a,c,d,g){var e,p,k,l,j,s,t,r,A,F,G;k=_.clone(c);null==d&&(d={});c=function(a,c){var b;return d[a]=_.extend(null!=(b=d[a])?b:{},c)};if(a.trans){G=a.trans;l=0;for(A=G.length;l<A;l++){t=G[l];j=t.key;s=y(j,t,d[j]);e=s.trans;s=s.meta;r=0;for(F=k.length;r<F;r++)p=k[r],e(p);c(t.name,s)}}a.filter&&(k=_.filter(k,f(a.filter)));if(a.meta){e={};t=a.meta;for(j in t)s=t[j],
l=b(j,s,k),s=l.meta,l=l.filter,e[j]=l,c(j,s);k=_.filter(k,f(e))}if(a.stats&&a.stats.stats&&0<a.stats.stats.length){k=m(k,a.stats);s=a.stats.stats;a=0;for(j=s.length;a<j;a++)e=s[a],e=e.name,c(e,{type:"num"})}return g(k,d)};j=function(){return console.log("backendProcess")};c.data.frontendProcess=a;this.poly=c}).call(this);
(function(){var j,b,m,f,g,a,c,d,l,y,k,s,u=function(a,c){return function(){return a.apply(c,arguments)}},v={}.hasOwnProperty,q=function(a,c){function b(){this.constructor=a}for(var e in c)v.call(c,e)&&(a[e]=c[e]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a};k=this.poly||{};l=k["const"].aes;s=k["const"].scaleFns;y={x:s.novalue(),y:s.novalue(),color:"steelblue",size:2,opacity:0.9,shape:1};k.layer={};k.layer.toStrictMode=function(a){var c,b,e;b=0;for(e=l.length;b<e;b++)c=
l[b],a[c]&&_.isString(a[c])&&(a[c]={"var":a[c]});return a};k.layer.make=function(e,r){switch(e.type){case "point":return new a(e,r);case "text":return new c(e,r);case "line":return new f(e,r);case "path":return new g(e,r);case "area":return new j(e,r);case "bar":return new b(e,r);case "tile":return new d(e,r);case "box":return new m(e,r)}};var n=function(a,c){this._makeMappings=u(this._makeMappings,this);this.render=u(this.render,this);this.reset=u(this.reset,this);this.initialSpec=k.layer.toStrictMode(a);
this.prevSpec=null;this.dataprocess=new k.DataProcess(this.initialSpec,c);this.pts={}};n.prototype.defaults=_.extend(y,{size:7});n.prototype.reset=function(){return this.make(this.initialSpec)};n.prototype.make=function(a,c){var b,e=this;b=k.layer.toStrictMode(a);this._makeMappings(b);this.dataprocess.make(b,function(a,b){e.statData=a;e.meta=b;if(null==e.statData)throw k.error.data("No data is passed into the layer");e._calcGeoms();return c()});return this.prevSpec=b};n.prototype._calcGeoms=function(){return this.geoms=
{}};n.prototype.getMeta=function(a){return this.mapping[a]?this.meta[this.mapping[a]]:{}};n.prototype.render=function(a){var c,b,e,d,f,g,h;f={};e=k.compare(_.keys(this.pts),_.keys(this.geoms));b=e.deleted;d=e.kept;c=e.added;g=0;for(h=b.length;g<h;g++)e=b[g],this._delete(a,this.pts[e]);b=0;for(g=c.length;b<g;b++)e=c[b],f[e]=this._add(a,this.geoms[e]);c=0;for(b=d.length;c<b;c++)e=d[c],f[e]=this._modify(a,this.pts[e],this.geoms[e]);return this.pts=f};n.prototype._delete=function(a,c){var b,e,d;d=[];
for(b in c)e=c[b],d.push(a.remove(e));return d};n.prototype._modify=function(a,c,b){var e,d,f,g;f={};g=b.marks;for(e in g)d=g[e],f[e]=a.animate(c[e],d,b.evtData);return f};n.prototype._add=function(a,c){var b,e,d,f;d={};f=c.marks;for(b in f)e=f[b],d[b]=a.add(e,c.evtData);return d};n.prototype._makeMappings=function(a){var c,b,e,d;this.mapping={};this.consts={};d=[];b=0;for(e=l.length;b<e;b++)c=l[b],a[c]?(a[c]["var"]&&(this.mapping[c]=a[c]["var"]),a[c]["const"]?d.push(this.consts[c]=a[c]["const"]):
d.push(void 0)):d.push(void 0);return d};n.prototype._getValue=function(a,c){return this.mapping[c]?a[this.mapping[c]]:this.consts[c]?s.identity(this.consts[c]):s.identity(this.defaults[c])};n.prototype._getIdFunc=function(){var a=this;return null!=this.mapping.id?function(c){return a._getValue(c,"id")}:k.counter()};n.prototype._fillZeros=function(a,c){var b,e,d,f;f=[];e=0;for(d=a.length;e<d;e++)b=a[e],f.push(this._getValue(b,"x"));b=_.difference(c,f);f=f.concat(b);e=[];d=0;for(b=b.length;d<b;d++)e.push(0);
var g,h;h=[];d=0;for(g=a.length;d<g;d++)b=a[d],h.push(this._getValue(b,"y"));return{x:f,y:h.concat(e)}};n.prototype._stack=function(a){var c,b,e,d,f,g,h=this;a=k.groupBy(this.statData,a);g=[];for(e in a)c=a[e],d=0,f=null!=this.mapping.y?function(a){return a[h.mapping.y]}:function(){return 0},g.push(function(){var a,e,g;g=[];a=0;for(e=c.length;a<e;a++)b=c[a],b.$lower=d,d+=f(b),g.push(b.$upper=d);return g}());return g};var x=function(){return x.__super__.constructor.apply(this,arguments)};q(x,n);x.prototype._calcGeoms=
function(){var a,c,b,e,d,f,g,h,k;c=this._getIdFunc();this.geoms={};h=this.statData;k=[];f=0;for(g=h.length;f<g;f++){b=h[f];a={};for(e in b)d=b[e],a[e]={"in":[d]};k.push(this.geoms[c(b)]={marks:{"0":{type:"circle",x:this._getValue(b,"x"),y:this._getValue(b,"y"),color:this._getValue(b,"color"),size:this._getValue(b,"size"),opacity:this._getValue(b,"opacity")}},evtData:a})}return k};a=x;var h=function(){return h.__super__.constructor.apply(this,arguments)};q(h,n);h.prototype._calcGeoms=function(){var a,
c,b,e,d,f,g,h,p,l,j,m;e=_.without(_.keys(this.mapping),"x","y");m=[];c=0;for(b=e.length;c<b;c++)f=e[c],m.push(this.mapping[f]);c=k.groupBy(this.statData,m);e=this._getIdFunc();this.geoms={};j=[];for(f in c){a=c[f];h=a[0];b={};p=0;for(l=m.length;p<l;p++)g=m[p],b[g]={"in":[h[g]]};j.push(this.geoms[e(h)]={marks:{"0":{type:"path",x:function(){var c,b,e;e=[];c=0;for(b=a.length;c<b;c++)d=a[c],e.push(this._getValue(d,"x"));return e}.call(this),y:function(){var c,b,e;e=[];c=0;for(b=a.length;c<b;c++)d=a[c],
e.push(this._getValue(d,"y"));return e}.call(this),color:this._getValue(h,"color"),opacity:this._getValue(h,"opacity")}},evtData:b})}return j};g=h;var e=function(){return e.__super__.constructor.apply(this,arguments)};q(e,n);e.prototype._calcGeoms=function(){var a,c,b,e,d,f,g,h,p,m,l,j;a=_.uniq(function(){var a,c,b,e;b=this.statData;e=[];a=0;for(c=b.length;a<c;a++)f=b[a],e.push(this._getValue(f,"x"));return e}.call(this));var n;d=_.without(_.keys(this.mapping),"x","y");n=[];b=0;for(e=d.length;b<e;b++)g=
d[b],n.push(this.mapping[g]);b=k.groupBy(this.statData,n);d=this._getIdFunc();this.geoms={};j=[];for(g in b){c=b[g];p=c[0];e={};m=0;for(l=n.length;m<l;m++)h=n[m],e[h]={"in":[p[h]]};h=this._fillZeros(c,a);c=h.x;h=h.y;j.push(this.geoms[d(p)]={marks:{"0":{type:"line",x:c,y:h,color:this._getValue(p,"color"),opacity:this._getValue(p,"opacity")}},evtData:e})}return j};f=e;var p=function(){return p.__super__.constructor.apply(this,arguments)};q(p,n);p.prototype._calcGeoms=function(){var a,c,b,e,d,f,g,h,
k;this._stack(null!=this.mapping.x?[this.mapping.x]:[]);c=this._getIdFunc();this.geoms={};h=this.statData;k=[];f=0;for(g=h.length;f<g;f++){b=h[f];a={};for(e in b)d=b[e],"y"!==e&&(a[this.mapping[e]]={"in":[d]});k.push(this.geoms[c(b)]={marks:{"0":{type:"rect",x:[s.lower(this._getValue(b,"x")),s.upper(this._getValue(b,"x"))],y:[b.$lower,b.$upper],color:this._getValue(b,"color"),opacity:this._getValue(b,"opacity")}},evtData:a})}return k};b=p;var w=function(){return w.__super__.constructor.apply(this,
arguments)};q(w,n);w.prototype._calcGeoms=function(){var a,c,b,e,d,f,g,h,p,m,j,l,n,w,q,z;a=_.uniq(function(){var a,c,b,e;b=this.statData;e=[];a=0;for(c=b.length;a<c;a++)g=b[a],e.push(this._getValue(g,"x"));return e}.call(this));c={};n=0;for(e=a.length;n<e;n++)p=a[n],c[p]=0;f=_.without(_.keys(this.mapping),"x","y");n=[];e=0;for(d=f.length;e<d;e++)h=f[e],n.push(this.mapping[h]);e=k.groupBy(this.statData,n);f=this._getIdFunc();this.geoms={};z=[];for(h in e){b=e[h];m=b[0];d={};l=0;for(j=n.length;l<j;l++)p=
n[l],d[p]={"in":[m[p]]};w=j=l=void 0;w=[];l=0;for(j=a.length;l<j;l++)p=a[l],w.push(c[p]);l=w;w=0;for(q=b.length;w<q;w++)g=b[w],p=this._getValue(g,"x"),j=this._getValue(g,"y"),c[p]+=j;w=j=b=void 0;w=[];b=0;for(j=a.length;b<j;b++)p=a[b],w.push(c[p]);b=w;z.push(this.geoms[f(m)]={marks:{"0":{type:"area",x:a,y:{bottom:l,top:b},color:this._getValue(m,"color"),opacity:this._getValue(m,"opacity")}},evtData:d})}return z};j=w;var z=function(){return z.__super__.constructor.apply(this,arguments)};q(z,n);z.prototype._calcGeoms=
function(){var a,c,b,e,d,f,g,h,p;c=this._getIdFunc();this.geoms={};h=this.statData;p=[];f=0;for(g=h.length;f<g;f++){b=h[f];a={};for(e in b)d=b[e],a[e]={"in":[d]};p.push(this.geoms[c(b)]={marks:{"0":{type:"text",x:this._getValue(b,"x"),y:this._getValue(b,"y"),text:this._getValue(b,"text"),color:this._getValue(b,"color"),size:this._getValue(b,"size"),opacity:this._getValue(b,"opacity"),"text-anchor":"center"}},evtData:a})}return p};c=z;var B=function(){return B.__super__.constructor.apply(this,arguments)};
q(B,n);B.prototype._calcGeoms=function(){var a,c,b,e,d,f,g;c=this._getIdFunc();this.geoms={};f=this.statData;g=[];e=0;for(d=f.length;e<d;e++)b=f[e],a={},this._getValue(b,"x"),this._getValue(b,"y"),g.push(this.geoms[c(b)]={marks:{"0":{type:"rect",x:[s.lower(this._getValue(b,"x")),s.upper(this._getValue(b,"x"))],y:[s.lower(this._getValue(b,"y")),s.upper(this._getValue(b,"y"))],color:this._getValue(b,"color"),size:this._getValue(b,"size"),opacity:this._getValue(b,"opacity")}},evtData:a});return g};d=
B;var D=function(){return D.__super__.constructor.apply(this,arguments)};q(D,n);D.prototype._calcGeoms=function(){var a,c,b,e,d,f,g,h,p,k,l,j,m;c=this._getIdFunc();this.geoms={};l=this.statData;m=[];h=0;for(p=l.length;h<p;h++){e=l[h];a={};f=this._getValue(e,"x");g=this._getValue(e,"y");b=s.lower(f);d=s.upper(f);f=s.middle(f);a={marks:{},evtData:a};g.q1&&(a.marks={iqr:{type:"path",x:[b,b,d,d,b],y:[g.q2,g.q4,g.q4,g.q2,g.q2],stroke:this._getValue(e,"color"),fill:"none",size:this._getValue(e,"size"),
opacity:this._getValue(e,"opacity")},lower:{type:"line",x:[f,f],y:[g.q1,g.q2],color:this._getValue(e,"color"),size:this._getValue(e,"size"),opacity:this._getValue(e,"opacity")},upper:{type:"line",x:[f,f],y:[g.q4,g.q5],color:this._getValue(e,"color"),size:this._getValue(e,"size"),opacity:this._getValue(e,"opacity")},middle:{type:"line",x:[b,d],y:[g.q3,g.q3],color:this._getValue(e,"color"),size:this._getValue(e,"size"),opacity:this._getValue(e,"opacity")}});j=g.outliers;b=g=0;for(k=j.length;g<k;b=++g)d=
j[b],a.marks[b]={type:"circle",x:f,y:d,color:this._getValue(e,"color"),size:this._getValue(e,"size"),opacity:this._getValue(e,"opacity")};m.push(this.geoms[c(e)]=a)}return m};m=D;this.poly=k}).call(this);
(function(){var j;j=this.poly||{};j.dim={};j.dim.make=function(b,j,f){var g,a,c,d,l,y,k;b={width:null!=(a=b.width)?a:400,height:null!=(c=b.height)?c:400,paddingLeft:null!=(d=b.paddingLeft)?d:10,paddingRight:null!=(l=b.paddingRight)?l:10,paddingTop:null!=(y=b.paddingTop)?y:10,paddingBottom:null!=(k=b.paddingBottom)?k:10,guideTop:10,guideRight:0,guideLeft:5,guideBottom:5};for(g in j)a=j[g],a=a.getDimension(),"left"===a.position?b.guideLeft+=a.width:"right"===a.position?b.guideRight+=a.width:"bottom"===
a.position?b.guideBottom+=a.height:"top"===a.position&&(b.guideTop+=a.height);c=b.height-b.guideTop-b.paddingTop;l=g=j=d=0;for(y=f.length;l<y;l++)a=f[l],a=a.getDimension(),a.height+g>c&&(j+=d+5,d=g=0),a.width>d&&(d=a.width),g+=a.height;b.guideRight+=j+d;b.chartHeight=b.height-b.paddingTop-b.paddingBottom-b.guideTop-b.guideBottom;b.chartWidth=b.width-b.paddingLeft-b.paddingRight-b.guideLeft-b.guideRight;return b};j.dim.guess=function(b){var j,f,g,a,c,d;b={width:null!=(j=b.width)?j:400,height:null!=
(f=b.height)?f:400,paddingLeft:null!=(g=b.paddingLeft)?g:10,paddingRight:null!=(a=b.paddingRight)?a:10,paddingTop:null!=(c=b.paddingTop)?c:10,paddingBottom:null!=(d=b.paddingBottom)?d:10,guideLeft:30,guideRight:40,guideTop:10,guideBottom:30};b.chartHeight=b.height-b.paddingTop-b.paddingBottom-b.guideTop-b.guideBottom;b.chartWidth=b.width-b.paddingLeft-b.paddingRight-b.guideLeft-b.guideRight;return b};this.poly=j}).call(this);
(function(){var j,b,m,f,g,a,c,d,l,y={}.hasOwnProperty;c=function(a,c){function b(){this.constructor=a}for(var d in c)y.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a};d=this.poly||{};d.paper=function(a,c,b,f){var g,h,j;if(!("undefined"!==typeof Raphael&&null!==Raphael))throw d.error.depn("The dependency Raphael is not included.");a=Raphael(a,c,b);c=a.rect(0,0,c,b).attr("stroke-width",0);c.click(f("reset"));h=f("select");j=g=null;c.drag(function(a,
c,b,e){return null!=j?g={x:e,y:b}:j={x:e,y:b}},function(){return g=j=null},function(){if(null!=j&&null!=g)return h({start:j,end:g})});return a};d.render=function(a,c,b,d,f,g){return{add:function(h,j){var k;k=l[d.type][h.type].render(c,b,d,h,f);null!=g&&k.attr("clip-rect",g);j&&0<_.keys(j).length&&(k.data("e",j),k.click(a("click")),k.hover(a("mover"),a("mout")));return k},remove:function(a){return a.remove()},animate:function(a,c,e){l[d.type][c.type].animate(a,b,d,c,f);e&&0<_.keys(e).length&&a.data("e",
e);return a}}};var k=function(){};k.prototype.render=function(a,c,b,d,f){var g;a=this._make(a);b=this.attr(c,b,d,f);for(g in b)c=b[g],a.attr(g,c);return a};k.prototype._make=function(){throw d.error.impl();};k.prototype.animate=function(a,c,b,d,f){return a.animate(this.attr(c,b,d,f),300)};k.prototype.attr=function(){throw d.error.impl();};k.prototype._makePath=function(a,c,b){null==b&&(b="L");return _.map(a,function(a,e){return(0===e?"M":b)+a+" "+c[e]}).join(" ")};k.prototype._maybeApply=function(a,
c,b){c=c[b];return _.isObject(c)&&"identity"===c.f?c.v:null!=a[b]?a[b].f(c):c};var s=function(){return s.__super__.constructor.apply(this,arguments)};c(s,k);s.prototype._make=function(a){return a.circle()};s.prototype.attr=function(a,c,b,d){var f,g;d=c.getXY(d,b);c=d.x;f=d.y;d=b.stroke?this._maybeApply(a,b,"stroke"):this._maybeApply(a,b,"color");return{cx:c,cy:f,r:this._maybeApply(a,b,"size"),fill:this._maybeApply(a,b,"color"),opacity:this._maybeApply(a,b,"opacity"),stroke:d,title:"omgthisiscool!",
"stroke-width":null!=(g=b["stroke-width"])?g:"0px"}};b=s;var u=function(){return u.__super__.constructor.apply(this,arguments)};c(u,k);u.prototype._make=function(a){return a.path()};u.prototype.attr=function(a,c,b,d){var f;d=c.getXY(d,b);c=d.x;f=d.y;d=b.stroke?this._maybeApply(a,b,"stroke"):this._maybeApply(a,b,"color");return{path:this._makePath(c,f),opacity:this._maybeApply(a,b,"opacity"),stroke:d}};g=u;var v=function(){return v.__super__.constructor.apply(this,arguments)};c(v,k);v.prototype._make=
function(a){return a.path()};v.prototype.attr=function(a,c,b,f){var g;g=d.sortArrays(a.x.sortfn,[b.x,b.y]);b.x=g[0];b.y=g[1];f=c.getXY(f,b);c=f.x;g=f.y;f=b.stroke?this._maybeApply(a,b,"stroke"):this._maybeApply(a,b,"color");return{path:this._makePath(c,g),stroke:f,opacity:this._maybeApply(a,b,"opacity")}};f=v;var q=function(){return q.__super__.constructor.apply(this,arguments)};c(q,k);q.prototype._make=function(a){return a.path()};q.prototype.attr=function(a,c,b,f){var g,h,j;g=d.sortArrays(a.x.sortfn,
[b.x,b.y.top]);h=g[0];j=g[1];g=c.getXY(f,{x:h,y:j});j=d.sortArrays(function(c){return-a.x.sortfn(c)},[b.x,b.y.bottom]);h=j[0];j=j[1];c=c.getXY(f,{x:h,y:j});h=g.x.concat(c.x);j=g.y.concat(c.y);return{path:this._makePath(h,j),stroke:this._maybeApply(a,b,"color"),opacity:this._maybeApply(a,b,"opacity"),fill:this._maybeApply(a,b,"color"),"stroke-width":"0px"}};j=q;var n=function(){return n.__super__.constructor.apply(this,arguments)};c(n,k);n.prototype._make=function(a){return a.rect()};n.prototype.attr=
function(a,c,b,d){d=c.getXY(d,b);c=d.x;d=d.y;return{x:_.min(c),y:_.min(d),width:Math.abs(c[1]-c[0]),height:Math.abs(d[1]-d[0]),fill:this._maybeApply(a,b,"color"),stroke:this._maybeApply(a,b,"color"),opacity:this._maybeApply(a,b,"opacity"),"stroke-width":"0px"}};a=n;var x=function(){return x.__super__.constructor.apply(this,arguments)};c(x,k);x.prototype._make=function(a){return a.path()};x.prototype.attr=function(a,c,b,d){var f,g,h,j;j=b.x;h=j[0];j=j[1];f=b.y;g=f[0];f=f[1];b.x=[h,h,j,j];b.y=[g,f,
f,g];g=c.getXY(d,b);h=g.x;j=g.y;d=g.r;g=g.t;c.flip&&(h.push(h.splice(0,1)[0]),j.push(j.splice(0,1)[0]),d.push(d.splice(0,1)[0]),g.push(g.splice(0,1)[0]));c=Math.abs(g[1]-g[0])>Math.PI?1:0;f="M "+h[0]+" "+j[0]+" A "+d[0]+" "+d[0]+" 0 "+c+" 1 "+h[1]+" "+j[1];c=Math.abs(g[3]-g[2])>Math.PI?1:0;f+="L "+h[2]+" "+j[2]+" A "+d[2]+" "+d[2]+" 0 "+c+" 0 "+h[3]+" "+j[3]+" Z";return{path:f,fill:this._maybeApply(a,b,"color"),stroke:this._maybeApply(a,b,"color"),opacity:this._maybeApply(a,b,"opacity"),"stroke-width":"0px"}};
m=x;"class HLine extends Renderer # for both cartesian & polar?\n  _make: (paper) -> paper.path()\n  attr: (scales, coord, mark) ->\n    y = scales.y mark.y\n    path: @_makePath([0, 100000], [y, y])\n    stroke: 'black'\n    'stroke-width': '1px'\n\nclass VLine extends Renderer # for both cartesian & polar?\n  _make: (paper) -> paper.path()\n  attr: (scales, coord, mark) ->\n    x = scales.x mark.x\n    path: @_makePath([x, x], [0, 100000])\n    stroke: 'black'\n    'stroke-width': '1px'";var h=
function(){return h.__super__.constructor.apply(this,arguments)};c(h,k);h.prototype._make=function(a){return a.text()};h.prototype.attr=function(a,c,b,d){var f;c=c.getXY(d,b);a={x:c.x,y:c.y,r:10,text:this._maybeApply(a,b,"text"),"text-anchor":null!=(f=b["text-anchor"])?f:"left",fill:this._maybeApply(a,b,"color")||"black"};null!=b.transform&&(a.transform=b.transform);return a};c=h;l={cartesian:{circle:new b,line:new f,area:new j,path:new g,text:new c,rect:new a},polar:{circle:new b,path:new g,line:new f,
area:new j,text:new c,rect:new m}}}).call(this);
(function(){var j,b=function(b,g){return function(){return b.apply(g,arguments)}};j=this.poly||{};var m=function(f){this._legacy=b(this._legacy,this);this.handleEvent=b(this.handleEvent,this);this.merge=b(this.merge,this);this.reset=b(this.reset,this);var g;if(null==f)throw j.error.defn("No graph specification is passed in!");this.handlers=[];this.paper=this.dims=this.legends=this.axes=this.scaleSet=this.layers=null;this.coord=null!=(g=f.coord)?g:j.coord.cartesian();this.initial_spec=f;this.dataSubscribed=
!1;this.make(f)};m.prototype.reset=function(){if(null==this.initial_spec)throw j.error.defn("No graph specification is passed in!");return this.make(this.initial_spec)};m.prototype.make=function(b){var g,a,c,d,l,m,k;null==b&&(b=this.initial_spec);this.spec=b;if(null==b.layers)throw j.error.defn("No layers are defined in the specification.");null==this.layers&&(this.layers=this._makeLayers(this.spec));if(!this.dataSubscribed){g=this.handleEvent("data");d=this.layers;a=c=0;for(d=d.length;c<d;a=++c){if(null==
b.layers[a].data)throw j.error.defn("Layer "+a+" does not have data to plot!");b.layers[a].data.subscribe(g)}this.dataSubscribed=!0}c=_.after(this.layers.length,this.merge);m=this.layers;k=[];a=d=0;for(l=m.length;d<l;a=++d)g=m[a],k.push(g.make(b.layers[a],c));return k};m.prototype.merge=function(){var b,g,a,c,d,l;g=this._makeDomains(this.spec,this.layers);null==this.scaleSet&&(this.scaleSet=this._makeScaleSet(this.spec,g));this.scaleSet.make(this.spec.guides,g,this.layers);this.dims||(this.dims=this._makeDimensions(this.spec,
this.scaleSet),this.coord.make(this.dims),this.ranges=this.coord.ranges());this.scaleSet.setRanges(this.ranges);this._legacy(g);if(!this.spec.dom)throw j.error.defn("No DOM element specified. Where to make plot?");b=this.spec.dom;g=this.scaleSet.scales;this.coord.setScales(g);null==this.paper&&(this.paper=this._makePaper(b,this.dims.width,this.dims.height,this.handleEvent));b=this.coord.clipping(this.dims);a=j.render(this.handleEvent,this.paper,g,this.coord,!0,b);l=this.layers;c=0;for(d=l.length;c<
d;c++)b=l[c],b.render(a);a=j.render(this.handleEvent,this.paper,g,this.coord,!1);this.scaleSet.makeAxes();this.scaleSet.renderAxes(this.dims,a);this.scaleSet.makeLegends();return this.scaleSet.renderLegends(this.dims,a)};m.prototype.addHandler=function(b){return this.handlers.push(b)};m.prototype.removeHandler=function(b){return this.handlers.splice(_.indexOf(this.handlers,b),1)};m.prototype.handleEvent=function(b){var g;g=this;return _.throttle(function(a){var c,d,j,m;"select"===b?(c=a.start,a=a.end,
this.evtData=g.scaleSet.fromPixels(c,a)):this.evtData="data"===b?{}:this.data("e");j=g.handlers;m=[];a=0;for(d=j.length;a<d;a++)c=j[a],_.isFunction(c)?m.push(c(b,this)):m.push(c.handle(b,this));return m},1E3)};m.prototype._makeLayers=function(b){return _.map(b.layers,function(g){return j.layer.make(g,b.strict)})};m.prototype._makeDomains=function(b,g){null==b.guides&&(b.guides={});return j.domain.make(g,b.guides,b.strict)};m.prototype._makeScaleSet=function(b){this.coord.make(j.dim.guess(b));b=this.coord.ranges();
return j.scaleset(b,this.coord)};m.prototype._makeDimensions=function(b,g){return j.dim.make(b,g.makeAxes(),g.makeLegends())};m.prototype._makePaper=function(b,g,a,c){return j.paper(document.getElementById(b),g,a,c)};m.prototype._legacy=function(b){var g,a,c;this.domains=b;this.scales=this.scaleSet.scales;b=this.scaleSet.makeAxes();this.ticks={};c=[];for(g in b)a=b[g],c.push(this.ticks[g]=a.ticks);return c};j.chart=function(b){return new m(b)};this.poly=j}).call(this);
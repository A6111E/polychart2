window.polyjs=function(h){if(!h){h={groupBy:function(a,b){return _.groupBy(a,function(a){return _.reduce(b,function(b,e){return""+b+e+":"+a[e]+";"},"")})},linear:function(a,b,c,d){return function(e){return(d-b)/(c-a)*(e-a)+b}},median:function(a,b){var c;null==b&&(b=!1);b||(a=_.sortBy(a,function(a){return a}));c=a.length/2;return 0!==c%1?a[Math.floor(c)]:(a[c-1]+a[c])/2},counter:function(){var a;a=0;return function(){return a++}},compare:function(a,b){var c,d,e,f,g,k,h,u,j;j=_.sortBy(a,function(a){return a});
u=_.sortBy(b,function(a){return a});d=[];e=[];c=[];for(h=g=0;h<j.length||g<u.length;)if(k=j[h],f=u[g],h>=j.length)c.push(f),g+=1;else if(g>=u.length)d.push(k),h+=1;else if(k<f)d.push(k),h+=1;else if(k>f)c.push(f),g+=1;else if(k===f)e.push(k),h+=1,g+=1;else throw DataError("Unknown data encounted");return{deleted:d,kept:e,added:c}},flatten:function(a){var b,c,d,e;b=[];if(null!=a)if(_.isObject(a))if("scalefn"===a.t)"novalue"!==a.f&&b.push(a.v);else for(c in a)d=a[c],b=b.concat(h.flatten(d));else if(_.isArray(a)){c=
0;for(e=a.length;c<e;c++)d=a[c],b=b.concat(h.flatten(d))}else b.push(a);return b},getLabel:function(a,b){return _.chain(a).map(function(a){return a.mapping[b]}).without(null,void 0).uniq().value().join(" | ")},strSize:function(a){return 7*(a+"").length},sortArrays:function(a,b){return _.zip.apply(_,_.sortBy(_.zip.apply(_,b),function(b){return a(b[0])}))},varType:function(a){var b,c,d,e,f;e=c=b=0;for(f=a.length;e<f;e++)d=a[e],null!=d&&((!isNaN(d)||!isNaN(d.replace(/\$|\,/g,"")))&&c++,moment(d).isValid()&&
b++);return c>0.95*a.length?"num":b>0.95*a.length?"date":"cat"},coerce:function(a,b){if("cat"===b.type)return a;if("num"===b.type)return isNaN(a)?+(""+a).replace(/\$|\,/g,""):+a;if("date"===b.type)return b.format?"unix"===b.format?moment.unix(a).unix():moment(a,b.format).unix():moment(a).unix()}};h["const"]={aes:"x y color size opacity shape id text".split(" "),noLegend:["x","y","id","text","tooltip"],trans:{bin:["key","binwidth"],lag:["key","lag"]},stat:{count:["key"],sum:["key"],mean:["key"],box:["key"],
median:["key"]},timerange:"second minute hour day week month year".split(" "),metas:{sort:null,stat:null,limit:null,asc:!0},scaleFns:{novalue:function(){return{v:null,f:"novalue",t:"scalefn"}},max:function(a){return{v:a,f:"max",t:"scalefn"}},min:function(a){return{v:a,f:"min",t:"scalefn"}},upper:function(a){return{v:a,f:"upper",t:"scalefn"}},lower:function(a){return{v:a,f:"lower",t:"scalefn"}},middle:function(a){return{v:a,f:"middle",t:"scalefn"}},jitter:function(a){return{v:a,f:"jitter",t:"scalefn"}},
identity:function(a){return{v:a,f:"identity",t:"scalefn"}}},epsilon:Math.pow(10,-7),defaults:{x:{v:null,f:"novalue",t:"scalefn"},y:{v:null,f:"novalue",t:"scalefn"},color:"steelblue",size:2,opacity:0.7}};var wc={}.hasOwnProperty,Q=function(a,b){function c(){this.constructor=a}for(var d in b)wc.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},ib=function(a){this.message=a;this.name="DefinitionError"};Q(ib,Error);var jb=function(a){this.message=a;this.name=
"DependencyError"};Q(jb,Error);var kb=function(a){this.message=a;this.name="ModeError"};Q(kb,Error);var lb=function(a){this.message=a;this.name="DataError"};Q(lb,Error);var mb=function(a){this.message=a;this.name="UnknownInput"};Q(mb,Error);var nb=function(a){this.message=a;this.name="ModeError"};Q(nb,Error);h.error=function(a){return Error(a)};h.error.data=function(a){return new lb(a)};h.error.depn=function(a){return new jb(a)};h.error.defn=function(a){return new ib(a)};h.error.mode=function(a){return new kb(a)};
h.error.impl=function(a){return new nb(a)};h.error.input=function(a){return new mb(a)};var Fa,ob,pb,xc=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};h.format=function(a,b){switch(a){case "cat":return h.format.identity;case "num":return h.format.number(b);case "date":return h.format.date(b)}};h.format.identity=function(a){return a};Fa={"0":"",3:"k",6:"m",9:"b",12:"t"};pb=function(a,b){return _.isUndefined(Fa[b])?a+"e"+(0<b?"+":"-")+Math.abs(b):
a+Fa[b]};ob=function(a){var b,c,d;if(!isFinite(a))return a;c=""+a;b=Math.abs(a);1E3<=b&&(d=(""+b).split(/\./),b=d[0].length%3||3,d[0]=c.slice(0,b+(0>a))+d[0].slice(b).replace(/(\d{3})/g,",$1"),c=d.join("."));return c};h.format.number=function(a){return function(b){var c,d;d=0;c=null!=a?a:Math.floor(Math.log(Math.abs(0===b?1:b))/Math.LN10);null!=a&&(2===c||5===c||8===c||11===c)?(c+=1,d=1):-1===c?(c=0,d=null!=a?1:2):-2===c?(c=0,d=null!=a?2:3):1===c||2===c?c=0:3<c&&6>c?c=3:6<c&&9>c?c=6:9<c&&12>c?c=9:
12<c&&15>c?c=12:d=null!=a?0:1;b=Math.round(b/Math.pow(10,c-d));b/=Math.pow(10,d);b=b.toFixed(d);return pb(ob(b),c)}};h.format.date=function(a){if(0<=xc.call(h["const"].timerange,a)){if("second"===a)return function(a){return moment.unix(a).format("h:mm:ss a")};if("minute"===a)return function(a){return moment.unix(a).format("h:mm a")};if("hour"===a)return function(a){return moment.unix(a).format("MMM D h a")};if("day"===a||"week"===a)return function(a){return moment.unix(a).format("MMM D")};if("month"===
a)return function(a){return moment.unix(a).format("YY/MM")};if("year"===a)return function(a){return moment.unix(a).format("YYYY")}}else return moment.unix(date).format(a)};h.xhr=function(a,b,c){var d;d=new XMLHttpRequest;3>arguments.length?(c=b,b=null):b&&d.overrideMimeType&&d.overrideMimeType(b);d.open("GET",a,!0);b&&d.setRequestHeader("Accept",b);d.onreadystatechange=function(){var a;if(4===d.readyState)return a=d.status,a=!a&&d.response||200<=a&&300>a||304===a?d:null,c(a)};return d.send(null)};
h.text=function(a,b,c){3>arguments.length&&(c=b,b=null);return h.xhr(a,b,function(a){return c(a&&a.responseText)})};h.json=function(a,b){return h.text(a,"application/json",function(a){return b(a?JSON.parse(a):null)})};h.dsv=function(a,b){var c,d,e,f,g,k,m;m=RegExp("\r\n|["+a+"\r\n]","g");k=RegExp('["'+a+"\n]");c=a.charCodeAt(0);e=function(b){return b.map(f).join(a)};f=function(a){var b;return null!=(b=k.test(a))?b:'"'+a.replace(/\"/g,'""')+{'"':a}};g=null;d=function(a,c){return h.text(a,b,function(a){return c(a&&
d.parse(a))})};d.parse=function(a){return d.parseRows(a,function(a,b){var c,d,e;if(b){e={};c=-1;for(d=g.length;++c<d;)e[g[c]]=a[c];return e}g=a;return null})};d.parseRows=function(a,b){var d,e,f,g,k,h,j,l;e={};d={};h=[];k=0;g=j=null;m.lastIndex=0;for(l=function(){var b,f,k;if(m.lastIndex>=a.length)return d;if(g)return g=!1,e;k=m.lastIndex;if(34===a.charCodeAt(k)){for(f=k;f++<a.length;)if(34===a.charCodeAt(f)){if(34!==a.charCodeAt(f+1))break;f++}m.lastIndex=f+2;b=a.charCodeAt(f+1);13===b?(g=!0,10===
a.charCodeAt(f+2)&&m.lastIndex++):10===b&&(g=!0);return a.substring(k+1,f).replace(/""/g,'"')}if(b=m.exec(a))return g=b[0].charCodeAt(0)!==c,a.substring(k,b.index);m.lastIndex=a.length;return a.substring(k)};(j=l())!==d;){for(f=[];j!==e&&j!==d;)f.push(j),j=l();(!b||(f=b(f,k++)))&&h.push(f)}return h};d.format=function(a){return a.map(e).join("\n")};return d};h.csv=h.dsv(",","text/csv");var qb,rb,sb,tb,ub,Ga,oa,vb,Ha,Ia,U,Ja,wb,xb,V,yb,Ka,zb,La,Ma,Ab,pa,Na,qa,Oa,Pa,Qa,Bb,yc=[].slice,zc={}.hasOwnProperty,
W=function(a,b){function c(){this.constructor=a}for(var d in b)zc.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};Qa=function(a,b){var c,d,e,f;c=a.length;f=['"',"'"];d=0;for(e=f.length;d<e;d++)if(b=f[d],a[0]===b&&a[c-1]===b)return a.slice(1,+(c-2)+1||9E9);return a};Bb=function(a,b){var c,d,e,f,g;g=[];c=e=0;for(f=a.length;e<f;c=++e)d=a[c],g.push([d,b[c]]);return g};Ga=function(a){var b,c,d,e,f;c={};e=0;for(f=a.length;e<f;e++)d=a[e],b=d[0],d=d[1],c[b]=
d;return c};Ha=function(a,b,c){null==c&&(c=null);return b in a&&a[b]||c};Ia=function(a,b){var c,d,e;d={};for(e in b)c=b[e],c=Ha(a,e,c),null!==c&&(d[e]=c);return d};xb=function(a){var b,c,d,e,f;c={};e=0;for(f=a.length;e<f;e++)for(d in b=a[e],b)c[d]=b[d].concat(Ha(c,d,[]));return c};oa=function(a,b){var c,d,e,f,g;null==b&&(b=function(a){return a});c={};f=0;for(g=a.length;f<g;f++)d=a[f],c[b(d)]=d;f=[];for(e in c)d=c[e],f.push(d);return f};vb=function(a){return function(b){return oa(b,function(b){return b[a]})}};
pa=function(a,b){return""+a+"("+b+")"};Na=function(a){return"["+a+"]"};var X=function(a){var b,c,d,e;e=[];c=0;for(d=a.length;c<d;c++)b=a[c],e.push(b);this.buffer=e.reverse()};X.prototype.empty=function(){return 0===this.buffer.length};X.prototype.peek=function(){return this.empty()?null:this.buffer[this.buffer.length-1]};X.prototype.get=function(){return this.empty()?null:this.buffer.pop()};X.prototype.toString=function(){return pa("Stream",Na(yc.call(this.buffer).reverse()))};var s=function(a){this.tag=
a};s.Tag={symbol:"symbol",literal:"literal",lparen:"(",rparen:")",comma:","};s.prototype.toString=function(){return"<"+this.contents().toString()+">"};s.prototype.contents=function(){return[this.tag]};var Y=function(a){this.name=a;this.name=Qa(this.name);Y.__super__.constructor.call(this,s.Tag.symbol)};W(Y,s);Y.prototype.contents=function(){return Y.__super__.contents.call(this).concat([this.name])};ub=Y;var Z=function(a){this.val=a;this.val=Qa(this.val);Z.__super__.constructor.call(this,s.Tag.literal)};
W(Z,s);Z.prototype.contents=function(){return Z.__super__.contents.call(this).concat([this.val])};sb=Z;var ra,Cb,Ra,$;Ra=[s.Tag.lparen,s.Tag.rparen,s.Tag.comma];$=[];ra=0;for(Cb=Ra.length;ra<Cb;ra++)qa=Ra[ra],$.push(new s(qa));rb=$[0];tb=$[1];qb=$[2];Pa=[[/^\(/,function(){return rb}],[/^\)/,function(){return tb}],[/^,/,function(){return qb}],[/^[+-]?(0x[0-9a-fA-F]+|0?\.\d+|[1-9]\d*(\.\d+)?|0)([eE][+-]?\d+)?/,function(a){return new sb(a)}],[/^(\w|[^\u0000-\u0080])+|'((\\.)|[^\\'])+'|"((\\.)|[^\\"])+"/,
function(a){return new ub(a)}]];wb=function(a){var b,c,d,e;d=0;for(e=Pa.length;d<e;d++)if(c=Pa[d],b=c[0],c=c[1],b=b.exec(a))return d=b[0],[a.slice(d.length),c(d)];throw h.error.defn("There is an error in your specification at "+a);};Oa=function(a){var b,c;for(c=[];;){a=a.replace(/^\s+/,"");if(!a)break;b=wb(a);a=b[0];b=b[1];c.push(b)}return c};var sa=function(){};sa.prototype.toString=function(){return pa(this.constructor.name,this.contents())};var aa=function(a){this.name=a};W(aa,sa);aa.prototype.contents=
function(){return[this.name]};aa.prototype.pretty=function(){return this.name};aa.prototype.visit=function(a){return a.ident(this,this.name)};var ba=function(a){this.val=a};W(ba,sa);ba.prototype.contents=function(){return[this.val]};ba.prototype.pretty=function(){return this.val};ba.prototype.visit=function(a){return a["const"](this,this.val)};var ca=function(a,b){this.fname=a;this.args=b};W(ca,sa);ca.prototype.contents=function(){return[this.fname,Na(this.args)]};ca.prototype.pretty=function(){var a,
b=this.fname,c,d,e,f;e=this.args;f=[];c=0;for(d=e.length;c<d;c++)a=e[c],f.push(a.pretty());return pa(b,f)};ca.prototype.visit=function(a){var b;return a.call(this,this.fname,function(){var c,d,e,f;e=this.args;f=[];c=0;for(d=e.length;c<d;c++)b=e[c],f.push(b.visit(a));return f}.call(this))};U=function(a,b,c){var d,e,f,g;e=a.peek();if(null!==e){f=0;for(g=c.length;f<g;f++)if(d=c[f],qa=d[0],d=d[1],e.tag===qa)return d(a)}return b(a)};Ma=function(a){throw h.error.defn("There is an error in your specification at "+
a.toString());};V=function(a){var b;b=new X(Oa(a));a=La(b);if(null!==b.peek())throw h.error.defn("There is an error in your specification at "+b.toString());return a};La=function(a){return U(a,Ma,[[s.Tag.literal,zb],[s.Tag.symbol,Ab]])};zb=function(a){return new ba(a.get().val)};Ab=function(a){var b;b=a.get().name;return U(a,function(){return new aa(b)},[[s.Tag.lparen,yb(b)]])};yb=function(a){return function(b){b.get();b=U(b,Ka([]),[[s.Tag.rparen,function(a){a.get();return[]}]]);return new ca(a,b)}};
Ka=function(a){return function(b){var c,d;c=La(b);d=a.concat([c]);return U(b,Ma,[[s.Tag.rparen,function(a){a.get();return d}],[s.Tag.comma,function(a){a.get();return Ka(d)(a)}]])}};Ja=function(a){var b;b={trans:[],stat:[]};a.visit({ident:function(a,b){return b},"const":function(a,b){return b},call:function(a,d,e){var f,g;g=d in h["const"].trans?"trans":d in h["const"].stat?"stat":"none";if("none"!==g)return f=h["const"][g][d],e=Ga(Bb(f,e)),e.name=a.pretty(),e[g]=d,b[g].push(e),e.name;throw h.error.defn("The operation "+
d+" is not recognized. Please check your specifications.");}});return b};h.parser={tokenize:Oa,parse:V,layerToData:function(a){var b,c,d,e,f,g,k,m,j;f={};k=null!=(g=a.filter)?g:{};for(c in k)g=k[c],f[V(c).pretty()]=g;d=h["const"].aes;j=[];g=0;for(b=d.length;g<b;g++)k=d[g],j.push([k,null]);b=Ia(a,Ga(j));for(c in b)"var"in b[c]||delete b[c];j=[];k=[];g=[];a={};for(c in b)d=b[c],e=V(d["var"]),d["var"]=e.pretty(),e=Ja(e),j.push(e),k.push(d["var"]),0===e.stat.length&&g.push(d["var"]),"sort"in d&&(e=Ia(d,
h["const"].metas),m=V(e.sort),e.sort=m.pretty(),m=Ja(m),0!==m.stat.length&&(e.stat=m.stat),a[d["var"]]=e);b=xb(j);c=vb("name");g={stats:c(b.stat),groups:oa(g)};return{trans:c(b.trans),stats:g,meta:a,select:oa(k),filter:f}}};var Db,Eb,Ac={}.hasOwnProperty,Fb=function(a,b){function c(){this.constructor=a}for(var d in b)Ac.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},O=function(a){var b;null==a&&(a={});this.flip=null!=(b=a.flip)?b:!1;this.scales=
null;a=this.flip?["y","x"]:["x","y"];this.x=a[0];this.y=a[1]};O.prototype.make=function(a){return this.dims=a};O.prototype.setScales=function(a){return this.scales={x:a.x.f,y:a.y.f}};O.prototype.clipping=function(){return[this.dims.paddingLeft+this.dims.guideLeft,this.dims.paddingTop+this.dims.guideTop,this.dims.chartWidth,this.dims.chartHeight]};O.prototype.getScale=function(){};O.prototype.ranges=function(){};var G=function(){return G.__super__.constructor.apply(this,arguments)};Fb(G,O);G.prototype.type=
"cartesian";G.prototype.getScale=function(a){if("x"===a||"y"===a)return this.scales[this[a]];throw h.error.input("Coordinates only keep x & y scales");};G.prototype.ranges=function(){var a;a={};a[this.x]={min:this.dims.paddingLeft+this.dims.guideLeft,max:this.dims.paddingLeft+this.dims.guideLeft+this.dims.chartWidth};a[this.y]={min:this.dims.paddingTop+this.dims.guideTop+this.dims.chartHeight,max:this.dims.paddingTop+this.dims.guideTop};return a};G.prototype.axisType=function(a){return this[a]};G.prototype.getXY=
function(a,b){var c,d;if(a)return c={x:_.isArray(b.x)?_.map(b.x,this.scales.x):this.scales.x(b.x),y:_.isArray(b.y)?_.map(b.y,this.scales.y):this.scales.y(b.y)},{x:c[this.x],y:c[this.y]};c=this.scales[this.x];d=this.scales[this.y];return{x:_.isArray(b.x)?_.map(b.x,c):c(b.x),y:_.isArray(b.y)?_.map(b.y,d):d(b.y)}};G.prototype.getAes=function(a,b,c){return{x:c.x(a[this.x],b[this.x]),y:c.y(a[this.y],b[this.y])}};Db=G;var H=function(){var a=this.getXY,b=this;this.getXY=function(){return a.apply(b,arguments)};
return H.__super__.constructor.apply(this,arguments)};Fb(H,O);H.prototype.type="polar";H.prototype.make=function(a){this.dims=a;this.cx=this.dims.paddingLeft+this.dims.guideLeft+this.dims.chartWidth/2;return this.cy=this.dims.paddingTop+this.dims.guideTop+this.dims.chartHeight/2};H.prototype.getScale=function(a){if("r"===a)return this.scales[this.x];if("t"===a)return this.scales[this.y];throw h.error.input("Coordinates only keep r & t scales");};H.prototype.ranges=function(){var a,b,c;b=[this.x,this.y];
a=b[0];c=b[1];b={};b[c]={min:0,max:2*Math.PI};b[a]={min:0,max:Math.min(this.dims.chartWidth,this.dims.chartHeight)/2-10};return b};H.prototype.axisType=function(a){return"x"===this[a]?"r":"t"};H.prototype.getXY=function(a,b){var c,d,e,f,g,k,h,j,p,r,q,J,l,n,R=this;r=function(a,b){return R.cx+a*Math.cos(b-Math.PI/2)};q=function(a,b){return R.cy+a*Math.sin(b-Math.PI/2)};f=[this.x,this.y];g=f[0];h=f[1];if(a){if(_.isArray(b[g])){f={x:[],y:[],r:[],t:[]};l=b[g];d=c=0;for(J=l.length;c<J;d=++c)k=l[d],k=this.scales[g](k),
j=this.scales[h](b[h][d]),f.x.push(r(k,j)),f.y.push(q(k,j)),f.r.push(k),f.t.push(j);return f}k=this.scales[g](b[g]);j=this.scales[h](b[h]);return{x:r(k,j),y:q(k,j),r:k,t:j}}e=function(a){return _.isObject(a)&&"scalefn"===a.t&&"identity"===a.f};c=function(a,b){var c,d;c=e(a);d=e(b);if(c&&!d)return{x:a.v,y:q(R.scales[g](b),0)};if(c&&d)return{x:a.v,y:b.v};if(!c&&d)return{y:b.v,x:q(R.scales[h](a),0)};k=R.scales[g](b);j=R.scales[h](a);return{x:r(k,j),y:q(k,j)}};if(_.isArray(b.x)){f={x:[],y:[]};n=b.x;d=
J=0;for(l=n.length;J<l;d=++J)p=n[d],d=b.y[d],p=c(p,d),d=p.x,p=p.y,f.x.push(d),f.y.push(p);return f}return c(b.x,b.y)};Eb=H;h.coord={cartesian:function(a){return new Db(a)},polar:function(a){return new Eb(a)}};var Gb,Hb,Ib,Sa,Jb,Kb,K,Lb,Mb,Nb;Sa=h["const"].aes;h.domain={};h.domain.make=function(a,b,c){var d,e,f,g;d=[];f=0;for(g=a.length;f<g;f++)e=a[f],d.push(Lb(e,b,c));return Mb(d)};h.domain.sortfn=function(a){switch(a.type){case "num":return function(a){return a};case "date":return function(a){return a};
case "cat":return function(b){if(-1===_.indexOf(a.levels,b))return Infinity}}};Ib=function(a){this.type=a.type;this.min=a.min;this.max=a.max;this.bw=a.bw};Hb=function(a){this.type=a.type;this.min=a.min;this.max=a.max;this.bw=a.bw};Gb=function(a){this.type=a.type;this.levels=a.levels;this.sorted=a.sorted};K=function(a){switch(a.type){case "num":return new Ib(a);case "date":return new Hb(a);case "cat":return new Gb(a)}};Lb=function(a,b,c){var d,e,f,g,k,h,j,p,r,q,J,l,n;f={};for(d in a.mapping)if(c)f[d]=
K(b[d]);else switch(h=Kb(a.geoms,d),e=null!=(j=a.getMeta(d))?j:{},g=function(a){return null!=b[d]?b[d][a]:null},e.type){case "num":e=null!=(p=g("bw"))?p:e.bw;k=null!=(r=g("min"))?r:_.min(h);g=null!=(q=g("max"))?q:_.max(h)+(null!=e?e:0);f[d]=K({type:"num",min:k,max:g,bw:e});break;case "date":e=null!=(J=g("bw"))?J:e.bw;k=null!=(l=g("min"))?l:_.min(h);g=g("max");null==g&&(g=_.max(h),e&&(g=moment.unix(g).add(e+"s",1).unix()));f[d]=K({type:"date",min:k,max:g,bw:e});break;case "cat":f[d]=K({type:"cat",
levels:null!=(n=g("levels"))?n:_.uniq(h),sorted:null!=g("levels")})}return f};Kb=function(a,b){var c,d,e,f,g;f=[];for(d in a)for(e in c=a[d],g=c.marks,g)c=g[e],f=f.concat(h.flatten(c[b]));return f};Mb=function(a){var b,c,d,e,f;d={};e=0;for(f=Sa.length;e<f;e++)b=Sa[e],c=_.without(_.pluck(a,b),void 0),0<c.length&&(d[b]=Nb(c));return d};Jb={num:function(a){var b,c;b=_.compact(_.uniq(_.map(a,function(a){return a.bw})));if(1<b.length)throw h.error.data("Not all layers have the same binwidth.");b=null!=
(c=b[0])?c:void 0;c=_.min(_.map(a,function(a){return a.min}));a=_.max(_.map(a,function(a){return a.max}));return K({type:"num",min:c,max:a,bw:b})},date:function(a){var b,c;b=_.compact(_.uniq(_.map(a,function(a){return a.bw})));if(1<b.length)throw h.error.data("Not all layers have the same binwidth.");b=null!=(c=b[0])?c:void 0;c=_.min(_.map(a,function(a){return a.min}));a=_.max(_.map(a,function(a){return a.max}));return K({type:"date",min:c,max:a,bw:b})},cat:function(a){var b;b=_.chain(a).filter(function(a){return a.sorted}).map(function(a){return a.levels}).value();
a=_.chain(a).filter(function(a){return!a.sorted}).map(function(a){return a.levels}).value();if(0<b.length&&_.intersection.apply(this,b))throw h.error.data("You are trying to combine incompatiabl sorted domains in the same axis.");b=[_.flatten(b,!0)];a=_.union.apply(this,b.concat(a));0===b[0].length&&(a=a.sort());return K({type:"cat",levels:a,sorted:!0})}};Nb=function(a){var b;b=_.uniq(_.map(a,function(a){return a.type}));if(1<b.length)throw h.error.data("You are trying to merge data of different types in the same axis or legend.");
return Jb[b[0]](a)};var Ob,Ta,Pb,Qb;h.tick={};h.tick.make=function(a,b,c){var d,e,f,g;d=null;null!=b.ticks?a=b.ticks:(d=null!=(e=b.numticks)?e:5,d=Qb[c](a,d),a=d.ticks,d=d.step);d=b.labels?function(a){var c;return null!=(c=b.labels[a])?c:a}:b.formatter?b.formatter:h.format(c,d);c={};e=Pb(d);f=0;for(g=a.length;f<g;f++)d=a[f],c[d]=e(d);return c};Ob=function(a){this.location=a.location;this.value=a.value;this.index=a.index};Pb=function(a){var b;b=0;return function(c){return new Ob({location:c,value:a(c),
index:b++})}};Ta=function(a,b){var c,d;d=Math.pow(10,Math.floor(Math.log(a/b)/Math.LN10));c=b/a*d;0.15>c?d*=10:0.35>=c?d*=5:0.75>=c&&(d*=2);return d};Qb={cat:function(a,b){var c,d,e,f,g,h,m;e=Math.max(1,Math.round(a.levels.length/b));f=[];m=a.levels;c=g=0;for(h=m.length;g<h;c=++g)d=m[c],0===c%e&&f.push(d);return{ticks:f}},num:function(a,b){var c,d,e,f;d=a.min;c=a.max;e=Ta(c-d,b);f=Math.ceil(d/e)*e;for(d=[];f<c;)d.push(f),f+=e;return{ticks:d,step:Math.floor(Math.log(e)/Math.LN10)}},"num-log":function(a,
b){var c,d,e,f,g,k,m,j;k=a.min;g=a.max;d=function(a){return Math.log(a)/Math.LN10};c=function(a){return Math.exp(a*Math.LN10)};f=Math.max(d(k),0);e=d(g);j=Ta(e-f,b);for(f=Math.ceil(f/j)*j;f<e+h["const"].epsilon;)if(0!==f%1&&0.1>=f%1)f+=j;else{if(f%1>h["const"].epsilon&&(m=Math.floor(f)+d(10*(f%1)),0===m%1)){f+=j;continue}m=c(m);m<k||m>g?f+=j:ticks.push(m)}return{ticks:ticks}},date:function(a,b){var c,d,e,f,g;e=a.min;d=a.max;f=(d-e)/b;f=1.4>f?"second":84>f?"minute":5040>f?"hour":120960>f?"day":846720>
f?"week":3628800>f?"month":"year";g=[];c=moment.unix(e).startOf(f);for(c.unix()<e&&c.add(f+"s",1);c.unix()<d;)g.push(c.unix()),c.add(f+"s",1);return{ticks:g,step:f}}};var Rb,Sb,Tb,Ub,j,L=function(a,b){return function(){return a.apply(b,arguments)}},Bc={}.hasOwnProperty,S=function(a,b){function c(){this.constructor=a}for(var d in b)Bc.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},Ua=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in
this&&this[b]===a)return b;return-1};j=h["const"].scaleFns;var Va=function(){};Va.prototype.getDimension=function(){throw h.error.impl();};var w=function(){this._modify=L(this._modify,this);this._add=L(this._add,this);this.render=L(this.render,this);this.make=L(this.make,this);this.title=this.line=null;this.position="none";this.titletext=null;this.ticks={};this.pts={}};S(w,Va);w.prototype.make=function(a){var b,c,d,e;b=a.domain;d=a.type;c=a.guideSpec;a=a.key;this.titletext=null!=(e=c.title)?e:a;this.ticks=
h.tick.make(b,c,d);return this.maxwidth=_.max(_.map(this.ticks,function(a){return h.strSize(a.value)}))};w.prototype.render=function(a,b,c){var d,e,f,g,k,m;this.coord=b;e={top:a.paddingTop+a.guideTop,left:a.paddingLeft+a.guideLeft,right:a.paddingLeft+a.guideLeft+a.chartWidth,bottom:a.paddingTop+a.guideTop+a.chartHeight,width:a.chartWidth,height:a.chartHeight};e.centerx=e.left+e.width/2;e.centery=e.top+e.height/2;e.radius=Math.min(e.width,e.height)/2-10;null!=this.line&&c.remove(this.line);this.line=
this._renderline(c,e);this.title=null!=this.title?c.animate(this.title,this._makeTitle(e,this.titletext)):c.add(this._makeTitle(e,this.titletext));b=h.compare(_.keys(this.pts),_.keys(this.ticks));a=b.deleted;f=b.kept;d=b.added;b={};k=0;for(m=f.length;k<m;k++)g=f[k],b[g]=this._modify(c,this.pts[g],this.ticks[g],e);f=0;for(k=d.length;f<k;f++)g=d[f],b[g]=this._add(c,this.ticks[g],e);e=0;for(d=a.length;e<d;e++)g=a[e],this._delete(c,this.pts[g]);this.pts=b;return this.rendered=!0};w.prototype._add=function(a,
b,c){var d;d={};d.tick=a.add(this._makeTick(c,b));d.text=a.add(this._makeLabel(c,b));d.grid=a.add(this._makeGrid(c,b));d.grid.toBack();return d};w.prototype._delete=function(a,b){a.remove(b.tick);a.remove(b.text);return a.remove(b.grid)};w.prototype._modify=function(a,b,c,d){var e;e={};e.tick=a.animate(b.tick,this._makeTick(d,c));e.text=a.animate(b.text,this._makeLabel(d,c));e.grid=a.animate(b.grid,this._makeGrid(d,c));e.grid.toBack();return e};w.prototype._renderline=function(){throw h.error.impl();
};w.prototype._makeTitle=function(){throw h.error.impl();};w.prototype._makeTick=function(a){if(!a)throw h.error.impl();a.type="path";a.stroke=j.identity("black");return a};w.prototype._makeLabel=function(a){if(!a)throw h.error.impl();a.type="text";return a};w.prototype._makeGrid=function(a){if(!a)throw h.error.impl();a.stroke="#999";return a};var y=function(){this.make=L(this.make,this);return y.__super__.constructor.apply(this,arguments)};S(y,w);y.prototype.make=function(a){var b,c;this.position=
null!=(b=a.guideSpec.position)?b:"bottom";if("top"!==(c=this.position)&&"bottom"!==c&&"none"!==c)throw h.error.defn("X-axis position can't be "+this.position+".");return y.__super__.make.call(this,a)};y.prototype._renderline=function(a,b){var c,d,e;e="top"===this.position?j.identity(b.top):j.identity(b.bottom);c=j.identity(b.left);d=j.identity(b.left+b.width);return a.add({type:"path",y:[e,e],x:[c,d],stroke:j.identity("black")})};y.prototype._makeTitle=function(a,b){var c;c="top"===this.position?
j.identity(a.top-27):j.identity(a.bottom+27);return{type:"text",x:j.identity(a.left+a.width/2),y:c,text:b,"text-anchor":"middle"}};y.prototype._makeTick=function(a,b){var c,d;"top"===this.position?(c=j.identity(a.top),d=j.identity(a.top-5)):(c=j.identity(a.bottom),d=j.identity(a.bottom+5));return y.__super__._makeTick.call(this,{x:[b.location,b.location],y:[c,d]})};y.prototype._makeLabel=function(a,b){var c;c="top"===this.position?j.identity(a.top-15):j.identity(a.bottom+15);return y.__super__._makeLabel.call(this,
{x:b.location,y:c,text:b.value,"text-anchor":"middle"})};y.prototype._makeGrid=function(a,b){var c,d;c=j.identity(a.top);d=j.identity(a.bottom);return y.__super__._makeGrid.call(this,{type:"path",x:[b.location,b.location],y:[c,d]})};y.prototype.getDimension=function(){var a;return{position:null!=(a=this.position)?a:"bottom",height:30,width:"all"}};Tb=y;var z=function(){this.make=L(this.make,this);return z.__super__.constructor.apply(this,arguments)};S(z,w);z.prototype.make=function(a){var b,c;this.position=
null!=(b=a.guideSpec.position)?b:"left";if("left"!==(c=this.position)&&"right"!==c&&"none"!==c)throw h.error.defn("X-axis position can't be "+this.position+".");return z.__super__.make.call(this,a)};z.prototype._renderline=function(a,b){var c,d,e;c="left"===this.position?j.identity(b.left):j.identity(b.right);d=j.identity(b.top);e=j.identity(b.top+b.height);return a.add({type:"path",x:[c,c],y:[d,e],stroke:j.identity("black")})};z.prototype._makeTitle=function(a,b){return{type:"text",x:"left"===this.position?
j.identity(a.left-this.maxwidth-15):j.identity(a.right+this.maxwidth+15),y:j.identity(a.top+a.height/2),text:b,transform:"r270","text-anchor":"middle"}};z.prototype._makeTick=function(a,b){var c,d;"left"===this.position?(c=j.identity(a.left),d=j.identity(a.left-5)):(c=j.identity(a.right),d=j.identity(a.right+5));return z.__super__._makeTick.call(this,{x:[c,d],y:[b.location,b.location]})};z.prototype._makeLabel=function(a,b){var c;c="left"===this.position?j.identity(a.left-7):j.identity(a.right+7);
return z.__super__._makeLabel.call(this,{x:c,y:b.location,text:b.value,"text-anchor":"left"===this.position?"end":"start"})};z.prototype._makeGrid=function(a,b){var c,d;c=j.identity(a.left);d=j.identity(a.right);return z.__super__._makeGrid.call(this,{type:"path",y:[b.location,b.location],x:[c,d]})};z.prototype.getDimension=function(){var a;return{position:null!=(a=this.position)?a:"right",height:"all",width:20+this.maxwidth}};Ub=z;var D=function(){return D.__super__.constructor.apply(this,arguments)};
S(D,w);D.prototype._renderline=function(a,b){var c,d,e;c=j.identity(b.left);d=j.identity(b.top);e=j.identity(b.top+b.height/2);return a.add({type:"path",x:[c,c],y:[d,e],stroke:j.identity("black")})};D.prototype._makeTitle=function(a,b){return{type:"text",x:j.identity(a.left-this.maxwidth-15),y:j.identity(a.top+a.height/4),text:b,transform:"r270","text-anchor":"middle"}};D.prototype._makeTick=function(a,b){return D.__super__._makeTick.call(this,{x:[j.identity(a.left),j.identity(a.left-5)],y:[b.location,
b.location]})};D.prototype._makeLabel=function(a,b){return D.__super__._makeLabel.call(this,{x:j.identity(a.left-7),y:b.location,text:b.value,"text-anchor":"end"})};D.prototype._makeGrid=function(a,b){return D.__super__._makeGrid.call(this,{type:"circle",x:j.identity(a.centerx),y:j.identity(a.centery),size:j.identity(this.coord.getScale("r")(b.location)),fill:j.identity("white"),"stroke-width":1})};D.prototype.getDimension=function(){return{position:"left",height:"all",width:20+this.maxwidth}};Rb=
D;var E=function(){return E.__super__.constructor.apply(this,arguments)};S(E,w);E.prototype._renderline=function(a,b){return a.add({type:"circle",x:j.identity(b.centerx),y:j.identity(b.centery),size:j.identity(b.radius),color:j.identity("none"),stroke:j.identity("black"),"stroke-width":1})};E.prototype._makeTitle=function(a,b){return{type:"text",x:j.identity(a.left+a.width/2),y:j.identity(a.bottom+27),text:b,"text-anchor":"middle"}};E.prototype._makeTick=function(a,b){return E.__super__._makeTick.call(this,
{x:[b.location,b.location],y:[j.max(0),j.max(3)]})};E.prototype._makeLabel=function(a,b){return E.__super__._makeLabel.call(this,{x:b.location,y:j.max(12),text:b.value,"text-anchor":"middle"})};E.prototype._makeGrid=function(a,b){var c,d,e,f;d=j.identity(a.centerx);f=j.identity(a.centery);c=this.coord.getScale("t")(b.location)-Math.PI/2;e=j.identity(a.centerx+a.radius*Math.cos(c));c=j.identity(a.centery+a.radius*Math.sin(c));return E.__super__._makeGrid.call(this,{type:"path",y:[f,c],x:[d,e]})};E.prototype.getDimension=
function(){return{}};Sb=E;var x=function(a){this.aes=a;this._makeTick=L(this._makeTick,this);this.make=L(this.make,this);this.rendered=!1;this.title=null;this.ticks={};this.pts={}};S(x,Va);x.prototype.TITLEHEIGHT=15;x.prototype.TICKHEIGHT=12;x.prototype.SPACING=10;x.prototype.make=function(a){var b,c,d,e;b=a.domain;d=a.type;c=a.guideSpec;this.mapping=a.mapping;a=a.keys;this.titletext=null!=(e=c.title)?e:a;this.ticks=h.tick.make(b,c,d);this.height=this.TITLEHEIGHT+this.SPACING+this.TICKHEIGHT*_.size(this.ticks);
c=h.strSize(this.titletext);b=_.max(_.map(this.ticks,function(a){return h.strSize(a.value)}));return this.maxwidth=Math.max(c,b)};x.prototype.render=function(a,b,c){var d,e,f,g,k,m;a={top:a.paddingTop+a.guideTop+c.y,right:a.paddingLeft+a.guideLeft+a.chartWidth+c.x,width:a.guideRight,height:a.chartHeight};this.title=null!=this.title?b.animate(this.title,this._makeTitle(a,this.titletext)):b.add(this._makeTitle(a,this.titletext));c=h.compare(_.keys(this.pts),_.keys(this.ticks));d=c.deleted;e=c.kept;
c=c.added;f={};k=0;for(m=d.length;k<m;k++)g=d[k],this._delete(b,this.pts[g]);d=0;for(k=e.length;d<k;d++)g=e[d],f[g]=this._modify(b,this.pts[g],this.ticks[g],a);e=0;for(d=c.length;e<d;e++)g=c[e],f[g]=this._add(b,this.ticks[g],a);return this.pts=f};x.prototype.remove=function(a){var b,c,d;d=this.pts;for(b in d)c=d[b],this._delete(a,c);a.remove(this.title);this.title=null;return this.pts={}};x.prototype._add=function(a,b,c){var d;d={};d.tick=a.add(this._makeTick(c,b));d.text=a.add(this._makeLabel(c,
b));return d};x.prototype._delete=function(a,b){a.remove(b.tick);return a.remove(b.text)};x.prototype._modify=function(a,b,c,d){var e;e=[];e.tick=a.animate(b.tick,this._makeTick(d,c));e.text=a.animate(b.text,this._makeLabel(d,c));return e};x.prototype._makeLabel=function(a,b){return{type:"text",x:j.identity(a.right+15),y:j.identity(a.top+(15+12*b.index)+1),text:b.value,"text-anchor":"start"}};x.prototype._makeTick=function(a,b){var c,d,e,f;d={type:"circle",x:j.identity(a.right+7),y:j.identity(a.top+
(15+12*b.index)),color:j.identity("steelblue")};f=this.mapping;for(c in f)e=f[c],0<=Ua.call(h["const"].noLegend,c)||(e=e[0],d[c]=0<=Ua.call(this.aes,c)?b.location:null!=e.type&&"const"===e.type?j.identity(e.value):_.isObject(e)?j.identity(h["const"].defaults[c]):j.identity(e));0<=Ua.call(this.aes,"size")||(d.size=j.identity(5));return d};x.prototype._makeTitle=function(a,b){return{type:"text",x:j.identity(a.right+5),y:j.identity(a.top),text:b,"text-anchor":"start"}};x.prototype.getDimension=function(){return{position:"right",
height:this.height,width:15+this.maxwidth}};h.guide={};h.guide.axis=function(a){if("x"===a)return new Tb;if("y"===a)return new Ub;if("r"===a)return new Rb;if("t"===a)return new Sb};h.guide.legend=function(a){return new x(a)};var Vb,Wb,Xb,Yb,Zb,$b,ac,I=function(a,b){return function(){return a.apply(b,arguments)}},Cc={}.hasOwnProperty,F=function(a,b){function c(){this.constructor=a}for(var d in b)Cc.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};h.scale=
{linear:function(a){return new Zb(a)},log:function(a){return new $b(a)},area:function(a){return new Vb(a)},color:function(a){return new Wb(a)},gradient:function(a){return new Xb(a)},identity:function(a){return new Yb(a)},opacity:function(a){return new ac(a)}};var t=function(){this.f=null};t.prototype.make=function(a){this.domain=a;this.sortfn=h.domain.sortfn(a);switch(a.type){case "num":return this._makeNum();case "date":return this._makeDate();case "cat":return this._makeCat()}};t.prototype._makeNum=
function(){throw h.error.impl("You are using a scale that does not support numbers");};t.prototype._makeDate=function(){throw h.error.impl("You are using a scale that does not support dates");};t.prototype._makeCat=function(){throw h.error.impl("You are using a scale that does not support categoies");};t.prototype.tickType=function(){switch(this.domain.type){case "num":return this._tickNum(this.domain);case "date":return this._tickDate(this.domain);case "cat":return this._tickCat(this.domain)}};t.prototype._tickNum=
function(){return"num"};t.prototype._tickDate=function(){return"date"};t.prototype._tickCat=function(){return"cat"};t.prototype._identityWrapper=function(a){return function(b){return _.isObject(b)&&"scalefn"===b.t&&"identity"===b.f?b.v:a(b)}};var M=function(){this._catWrapper=I(this._catWrapper,this);this._dateWrapper=I(this._dateWrapper,this);this._numWrapper=I(this._numWrapper,this);this.finv=this.f=null};F(M,t);M.prototype.make=function(a,b){this.range=b;return M.__super__.make.call(this,a)};M.prototype._numWrapper=
function(a,b){var c=this;return function(d){var e;e=0.001*(c.range.max>c.range.min?1:-1);if(_.isObject(d)){if("scalefn"===d.t){if("identity"===d.f)return d.v;if("upper"===d.f)return b(d.v+a.bw)-e;if("lower"===d.f)return b(d.v)+e;if("middle"===d.f)return b(d.v+a.bw/2);if("max"===d.f)return c.range.max+d.v;if("min"===d.f)return c.range.min+d.v}throw h.error.input("Unknown object "+d+" is passed to a scale");}return b(d)}};M.prototype._dateWrapper=function(a,b){var c=this;return function(d){var e;e=
0.001*(c.range.max>c.range.min?1:-1);if(_.isObject(d)){if("scalefn"===d.t){if("identity"===d.f)return d.v;if("upper"===d.f)return d="week"!==a.bw?moment.unix(d.v).endOf(a.bw).unix():moment.unix(d.v).day(7).unix(),b(d)-e;if("lower"===d.f)return d="week"!==a.bw?moment.unix(d.v).startOf(a.bw).unix():moment.unix(d.v).day(0).unix(),b(d)+e;if("middle"===d.f)return e="week"!==a.bw?moment.unix(d.v).endOf(a.bw).unix():moment.unix(d.v).day(7).unix(),d="week"!==a.bw?moment.unix(d.v).startOf(a.bw).unix():moment.unix(d.v).day(0).unix(),
b(e/2+d/2);if("max"===d.f)return c.range.max+d.v;if("min"===d.f)return c.range.min+d.v}throw h.error.input("Unknown object "+d+" is passed to a scale");}return b(d)}};M.prototype._catWrapper=function(a,b){var c=this;return function(d){var e;e=0.001*(c.range.max>c.range.min?1:-1);if(_.isObject(d)){if("scalefn"===d.t){if("identity"===d.f)return d.v;if("upper"===d.f)return b(d.v)+a-e;if("lower"===d.f)return b(d.v)+e;if("middle"===d.f)return b(d.v)+a/2;if("max"===d.f)return c.range.max+d.v;if("min"===
d.f)return c.range.min+d.v}throw h.error.input("Unknown object "+d+" is passed to a scale");}return b(d)+a/2}};var T=function(){return T.__super__.constructor.apply(this,arguments)};F(T,M);T.prototype._makeNum=function(){var a,b;b=h.linear(this.domain.min,this.range.min,this.domain.max,this.range.max);a=h.linear(this.range.min,this.domain.min,this.range.max,this.domain.max);this.f=this._numWrapper(this.domain,b);return this.finv=function(b,d){var e;e=[a(b),a(d)];return{ge:_.min(e),le:_.max(e)}}};
T.prototype._makeDate=function(){var a,b;b=h.linear(this.domain.min,this.range.min,this.domain.max,this.range.max);a=h.linear(this.range.min,this.domain.min,this.range.max,this.domain.max);this.f=this._dateWrapper(this.domain,b);return this.finv=function(b,d){var e;e=[a(b),a(d)];return{ge:_.min(e),le:_.max(e)}}};T.prototype._makeCat=function(){var a,b=this;a=(this.range.max-this.range.min)/this.domain.levels.length;this.f=this._catWrapper(a,function(c){c=_.indexOf(b.domain.levels,c);return-1===c?
null:b.range.min+c*a});return this.finv=function(c,d){var e,f;d<c&&(e=d,d=c,c=e);e=Math.floor(c/a);f=Math.ceil(d/a);return{"in":b.domain.levels.slice(e,+f+1||9E9)}}};Zb=T;var da=function(){return da.__super__.constructor.apply(this,arguments)};F(da,M);da.prototype._makeNum=function(){var a,b,c,d;a=Math.log;c=h.linear(a(this.domain.min),this.range.min,a(this.domain.max),this.range.max);this.f=this._numWrapper(function(b){return c(a(b))});d=h.linear(this.range.min,a(this.domain.min),this.range.max,
a(this.domain.max));b=function(a){return Math.exp(d(a))};return this.finv=function(a,c){var d;d=[b(a),b(c)];return{ge:_.min(d),le:_.max(d)}}};da.prototype._tickNum=function(){return"num-log"};$b=da;var ta=function(){this._makeNum=I(this._makeNum,this);return ta.__super__.constructor.apply(this,arguments)};F(ta,t);ta.prototype._makeNum=function(){var a,b,c;a=0===this.domain.min?0:1;b=Math.sqrt;c=h.linear(b(this.domain.min),a,b(this.domain.max),10);return this.f=this._identityWrapper(function(a){return c(b(a))})};
Vb=ta;var ua=function(){this._makeNum=I(this._makeNum,this);return ua.__super__.constructor.apply(this,arguments)};F(ua,t);ua.prototype._makeNum=function(){return this.f=this._identityWrapper(h.linear(this.domain.min,0===this.domain.min?0:0.1,this.domain.max,1))};ac=ua;var ea=function(){this._makeNum=I(this._makeNum,this);this._makeCat=I(this._makeCat,this);return ea.__super__.constructor.apply(this,arguments)};F(ea,t);ea.prototype._makeCat=function(){var a,b,c=this;b=this.domain.levels.length;a=
function(a){return _.indexOf(c.domain.levels,a)/b+1/(2*b)};return this.f=function(b){return Raphael.hsl(a(b),0.5,0.5)}};ea.prototype._makeNum=function(){var a;a=h.linear(this.domain.min,0,this.domain.max,1);return this.f=function(b){return Raphael.hsl(0.5,a(b),0.5)}};Wb=ea;var Wa=function(){return Wa.__super__.constructor.apply(this,arguments)};F(Wa,t);Wa.prototype._makeCat=function(){};var Xa=function(a){this._makeNum=I(this._makeNum,this);this.lower=a.lower;this.upper=a.upper};F(Xa,t);Xa.prototype._makeNum=
function(){var a,b,c,d,e;c=Raphael.color(this.lower);e=Raphael.color(this.upper);d=h.linear(this.domain.min,c.r,this.domain.max,e.r);b=h.linear(this.domain.min,c.g,this.domain.max,e.g);a=h.linear(this.domain.min,c.b,this.domain.max,e.b);return this.f=this._identityWrapper(function(c){return Raphael.rgb(d(c),b(c),a(c))})};Xb=Xa;var bc=function(){this._makeCat=I(this._makeCat,this)};F(bc,t);bc.prototype._makeCat=function(){};var Ya=function(){return Ya.__super__.constructor.apply(this,arguments)};F(Ya,
t);Ya.prototype._makeCat=function(){};var va=function(){return va.__super__.constructor.apply(this,arguments)};F(va,t);va.prototype.make=function(){this.sortfn=function(a){return a};return this.f=this._identityWrapper(function(a){return a})};Yb=va;var cc,Dc=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};h.scaleset=function(a,b,c){return new cc(a,b,c)};var v=function(a,b){this.axes={x:h.guide.axis(b.axisType("x")),y:h.guide.axis(b.axisType("y"))};
this.coord=b;this.ranges=a;this.legends=[];this.deletedLegends=[]};v.prototype.make=function(a,b,c){this.guideSpec=a;this.layers=c;this.domains=b;this.domainx=this.domains.x;this.domainy=this.domains.y;this.scales=this._makeScales(a,b,this.ranges);this.reverse={x:this.scales.x.finv,y:this.scales.y.finv};return this.layerMapping=this._mapLayers(c)};v.prototype.setRanges=function(a){this.ranges=a;this._makeXScale();return this._makeYScale()};v.prototype.setXDomain=function(a){this.domainx=a;return this._makeXScale()};
v.prototype.setYDomain=function(a){this.domainy=a;return this._makeYScale()};v.prototype.resetDomains=function(){this.domainx=this.domains.x;this.domainy=this.domains.y;this._makeXScale();return this._makeYScale()};v.prototype._makeXScale=function(){return this.scales.x.make(this.domainx,this.ranges.x)};v.prototype._makeYScale=function(){return this.scales.y.make(this.domainy,this.ranges.y)};v.prototype._makeScales=function(a,b,c){var d,e,f,g,k,m;e=function(b){return a&&null!=a[b]&&null!=a[b].scale?
a[b].scale:null};d={};d.x=null!=(f=e("x"))?f:h.scale.linear();d.x.make(b.x,c.x);d.y=null!=(g=e("y"))?g:h.scale.linear();d.y.make(b.y,c.y);null!=b.color&&(d.color="cat"===b.color.type?null!=(k=e("color"))?k:h.scale.color():null!=(m=e("color"))?m:h.scale.gradient({upper:"steelblue",lower:"red"}),d.color.make(b.color));null!=b.size&&(d.size=e("size")||h.scale.area(),d.size.make(b.size));null!=b.opacity&&(d.opacity=e("opacity")||h.scale.opacity(),d.opacity.make(b.opacity));d.text=h.scale.identity();d.text.make();
return d};v.prototype.fromPixels=function(a,b){var c,d,e,f,g,h,m;c=this.coord.getAes(a,b,this.reverse);e=c.x;f=c.y;d={};m=this.layerMapping.x;g=0;for(h=m.length;g<h;g++)c=m[g],null!=c.type&&"map"===c.type&&(d[c.value]=e);h=this.layerMapping.y;e=0;for(g=h.length;e<g;e++)c=h[e],null!=c.type&&"map"===c.type&&(d[c.value]=f);return d};v.prototype.getSpec=function(a){return null!=this.guideSpec&&null!=this.guideSpec[a]?this.guideSpec[a]:{}};v.prototype.makeAxes=function(){this.axes.x.make({domain:this.domainx,
type:this.scales.x.tickType(),guideSpec:this.getSpec("x"),key:h.getLabel(this.layers,"x")});this.axes.y.make({domain:this.domainy,type:this.scales.y.tickType(),guideSpec:this.getSpec("y"),key:h.getLabel(this.layers,"y")});return this.axes};v.prototype.renderAxes=function(a,b){this.axes.x.render(a,this.coord,b);return this.axes.y.render(a,this.coord,b)};v.prototype._mapLayers=function(a){var b,c;c={};for(b in this.domains)c[b]=_.map(a,function(a){return null!=a.mapping[b]?{type:"map",value:a.mapping[b]}:
null!=a.consts[b]?{type:"const",value:a["const"][b]}:a.defaults[b]});return c};v.prototype._mergeAes=function(a){var b,c,d,e,f,g,k;f=[];for(b in this.domains)if(!(0<=Dc.call(h["const"].noLegend,b))&&(d=_.map(a,function(a){return a.mapping[b]}),!_.all(d,_.isUndefined))){e=!1;g=0;for(k=f.length;g<k;g++)if(c=f[g],_.isEqual(c.mapped,d)){c.aes.push(b);e=!0;break}e||f.push({aes:[b],mapped:d})}return _.pluck(f,"aes")};v.prototype.makeLegends=function(){var a,b,c,d,e,f;b=this._mergeAes(this.layers);for(d=
0;d<this.legends.length;){e=this.legends[d];f=!0;for(c=0;c<b.length;){a=b[c];if(_.isEqual(a,e.aes)){b.splice(c,1);f=!1;break}c++}f?(this.deletedLegends.push(e),this.legends.splice(d,1)):d++}e=0;for(c=b.length;e<c;e++)a=b[e],this.legends.push(h.guide.legend(a));d=this.legends;b=0;for(c=d.length;b<c;b++)e=d[b],a=e.aes[0],e.make({domain:this.domains[a],guideSpec:this.getSpec(a),type:this.scales[a].tickType(),mapping:this.layerMapping,keys:h.getLabel(this.layers,a)});return this.legends};v.prototype.renderLegends=
function(a,b){var c,d,e,f,g,h,m,j,p;e=this.deletedLegends;g=0;for(d=e.length;g<d;g++)c=e[g],c.remove(b);this.deletedLegends=[];g={x:0,y:0};c=this.axes.y.getDimension();"right"===c.position&&(g.x+=c.width);e=0;d=a.height-a.guideTop-a.paddingTop;j=this.legends;p=[];h=0;for(m=j.length;h<m;h++)c=j[h],f=c.getDimension(),f.height+g.y>d&&(g.x+=e+5,e=g.y=0),f.width>e&&(e=f.width),c.render(a,b,g),p.push(g.y+=f.height);return p};cc=v;var dc,ec,Za,$a,fc,ab,gc,hc,ic,jc,kc=[].indexOf||function(a){for(var b=0,
c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},n=function(a){this.url=a.url;this.json=a.json;this.csv=a.csv;this.meta=a.meta;this.dataBackend=null!=a.url;this.computeBackend=!1;this.raw=null;null==this.meta&&(this.meta={});this.subscribed=[]};n.prototype.impute=function(a){var b,c,d,e,f,g,k;d=_.keys(a[0]);b=a.slice(0,100);f=0;for(g=d.length;f<g;f++){c=d[f];if(null==(e=this.meta)[c])e[c]={};this.meta[c].type||(this.meta[c].type=h.varType(_.pluck(b,c)))}e=0;for(g=a.length;e<g;e++){b=
a[e];f=0;for(k=d.length;f<k;f++)c=d[f],_.isString(b[c])&&(b[c]=h.coerce(b[c],this.meta[c]))}this.key=d;return this.raw=a};n.prototype.getRaw=function(a){var b=this;if(this.raw)return a(this.raw,this.meta);this.json&&(this.raw=this.impute(this.json));this.csv&&(this.raw=this.impute(h.csv.parse(this.csv)));if(this.raw)return a(this.raw,this.meta);if(this.url)return h.csv(this.url,function(c){b.raw=b.impute(c);return a(b.raw,b.meta)})};n.prototype.update=function(a){var b=this;this.json=a.json;this.csv=
a.csv;this.raw=null;return this.getRaw(function(){var a,d,e,f,g;f=b.subscribed;g=[];d=0;for(e=f.length;d<e;d++)a=f[d],g.push(a());return g})};n.prototype.subscribe=function(a){if(-1===_.indexOf(this.subscribed,a))return this.subscribed.push(a)};n.prototype.unsubscribe=function(a){return this.subscribed.splice(_.indexOf(this.subscribed,a),1)};n.prototype.keys=function(){return this.key};n.prototype.rename=function(){return!0};n.prototype.renameMany=function(){return!0};n.prototype.remove=function(){return!1};
n.prototype.filter=function(){return this};n.prototype.sort=function(){return this};n.prototype.derive=function(){return this};n.prototype.getMeta=function(a){return this.meta[a]};n.prototype.type=function(a){a=this.meta[a].type;return"num"===a?"number":a};n.prototype.get=function(a){return _.pluck(this.raw,a)};n.prototype.len=function(){return this.raw.length};n.prototype.getObject=function(a){return this.raw[a]};n.prototype.max=function(a){return _.max(this.get(a))};n.prototype.min=function(a){return _.min(this.get(a))};
h.Data=n;var fa=function(a,b){var c=this._wrap,d=this;this._wrap=function(){return c.apply(d,arguments)};this.dataObj=a.data;this.initialSpec=h.parser.layerToData(a);this.prevSpec=null;this.strictmode=b;this.statData=null;this.metaData={}};fa.prototype.reset=function(a){return this.make(this.initialSpec,a)};fa.prototype.make=function(a,b){var c,d;c=h.parser.layerToData(a);d=this._wrap(b);this.strictmode&&d(this.dataObj.json,{});return this.dataObj.computeBackend?dc(c,this.dataObj,d):this.dataObj.getRaw(function(a,
b){return ab(c,a,b,d)})};fa.prototype._wrap=function(a){var b=this;return function(c,d){b.statData=c;b.metaData=d;return a(b.statData,b.metaData)}};h.DataProcess=fa;h.data={};h.data.process=function(a,b,c,d){a=new fa(b,c);a.process(d);return a};jc={bin:function(a,b,c){var d,e;e=b.name;d=b.binwidth;if("num"===c.type){if(isNaN(d))throw h.error.defn("The binwidth "+d+" is invalid for a numeric varliable");d=+d;b=function(b){return b[e]=d*Math.floor(b[a]/d)};return{trans:b,meta:{bw:d,binned:!0,type:"num"}}}if("date"===
c.type){if(!(0<=kc.call(h["const"].timerange,d)))throw h.error.defn("The binwidth "+d+" is invalid for a datetime varliable");b=function(b){return"week"===d?b[e]=moment.unix(b[a]).day(0).unix():b[e]=moment.unix(b[a]).startOf(d).unix()};return{trans:b,meta:{bw:d,binned:!0,type:"date"}}}},lag:function(a,b,c){var d;d=b.name;b=b.lag;var e,f;f=[];for(e=1;1<=b?e<=b:e>=b;1<=b?++e:--e)f.push(void 0);return{trans:function(b){f.push(b[a]);return b[d]=f.shift()},meta:{type:c.type}}}};ic=function(a,b,c){return jc[b.trans](a,
b,c)};fc={lt:function(a,b){return a<b},le:function(a,b){return a<=b},gt:function(a,b){return a>b},ge:function(a,b){return a>=b},"in":function(a,b){return 0<=kc.call(b,a)}};$a=function(a){var b;b=[];_.each(a,function(a,d){return _.each(a,function(a,c){return b.push(function(b){return fc[c](b[d],a)})})});return function(a){var d,e,f;e=0;for(f=b.length;e<f;e++)if(d=b[e],!d(a))return!1;return!0}};gc={sum:function(){return function(a){return _.reduce(_.without(a,void 0,null),function(a,c){return a+c},
0)}},count:function(){return function(a){return _.without(a,void 0,null).length}},uniq:function(){return function(a){return _.uniq(_.without(a,void 0,null)).length}},min:function(){return function(a){return _.min(a)}},max:function(){return function(a){return _.max(a)}},median:function(){return function(a){return h.median(a)}},box:function(){return function(a){var b,c,d,e,f,g;c=a.length;return 5<c?(e=c/2,a=_.sortBy(a,function(a){return a}),b=Math.ceil(e)/2,0!==b%1?(b=Math.floor(b),e=a[b],c=a[c-1-b]):
(e=(a[b]+a[b-1])/2,c=(a[c-b]+a[c-b-1])/2),b=c-e,d=e-1.5*b,f=c+1.5*b,b=_.groupBy(a,function(a){return a>=d&&a<=f}),{q1:_.min(b["true"]),q2:e,q3:h.median(a,!0),q4:c,q5:_.max(b["true"]),outliers:null!=(g=b["false"])?g:[]}):{outliers:a}}}};hc=function(a){return gc[a.stat](a)};Za=function(a,b){var c,d;d={};_.each(b.stats,function(a){var b,c,h;b=a.key;c=a.name;h=hc(a);return d[c]=function(a){return h(_.pluck(a,b))}});c=h.groupBy(a,b.groups);return _.map(c,function(a){var c;c={};_.each(b.groups,function(b){return c[b]=
a[0][b]});_.each(d,function(b,d){return c[d]=b(a)});return c})};ec=function(a,b,c){var d,e,f,g;f=b.sort;g=b.stat;d=b.limit;b=b.asc;g&&(g={stats:[g],groups:[a]},c=Za(c,g));e=b?1:-1;c.sort(function(a,b){return a[f]===b[f]?0:a[f]>=b[f]?1*e:-1*e});d&&(c=c.slice(0,+(d-1)+1||9E9));a=_.uniq(_.pluck(c,a));return{meta:{levels:a,sorted:!0},filter:{"in":a}}};ab=function(a,b,c,d){var e,f,g,h,j,u,p,r,q,l,n;g=_.clone(b);null==c&&(c={});b=function(a,b){var d;return c[a]=_.extend(null!=(d=c[a])?d:{},b)};if(a.trans){n=
a.trans;h=0;for(q=n.length;h<q;h++){p=n[h];j=p.key;u=ic(j,p,c[j]);e=u.trans;u=u.meta;r=0;for(l=g.length;r<l;r++)f=g[r],e(f);b(p.name,u)}}a.filter&&(g=_.filter(g,$a(a.filter)));if(a.meta){e={};p=a.meta;for(j in p)u=p[j],h=ec(j,u,g),u=h.meta,h=h.filter,e[j]=h,b(j,u);g=_.filter(g,$a(e))}if(a.stats&&a.stats.stats&&0<a.stats.stats.length){g=Za(g,a.stats);u=a.stats.stats;a=0;for(j=u.length;a<j;a++)e=u[a],e=e.name,b(e,{type:"num"})}return d(g,c)};dc=function(){return console.log("backendProcess")};h.data.frontendProcess=
ab;var lc,mc,nc,oc,pc,qc,rc,sc,ga,tc,A,bb=function(a,b){return function(){return a.apply(b,arguments)}},Ec={}.hasOwnProperty,N=function(a,b){function c(){this.constructor=a}for(var d in b)Ec.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};ga=h["const"].aes;A=h["const"].scaleFns;tc={x:A.novalue(),y:A.novalue(),color:"steelblue",size:2,opacity:0.9,shape:1};h.layer={};h.layer.toStrictMode=function(a){var b,c,d;c=0;for(d=ga.length;c<d;c++)b=ga[c],a[b]&&
_.isString(a[b])&&(a[b]={"var":a[b]});return a};h.layer.make=function(a,b){switch(a.type){case "point":return new qc(a,b);case "text":return new rc(a,b);case "line":return new oc(a,b);case "path":return new pc(a,b);case "area":return new lc(a,b);case "bar":return new mc(a,b);case "tile":return new sc(a,b);case "box":return new nc(a,b)}};var l=function(a,b){this._makeMappings=bb(this._makeMappings,this);this.render=bb(this.render,this);this.reset=bb(this.reset,this);this.initialSpec=h.layer.toStrictMode(a);
this.prevSpec=null;this.dataprocess=new h.DataProcess(this.initialSpec,b);this.pts={}};l.prototype.defaults=_.extend(tc,{size:7});l.prototype.reset=function(){return this.make(this.initialSpec)};l.prototype.make=function(a,b){var c,d=this;c=h.layer.toStrictMode(a);this._makeMappings(c);this.dataprocess.make(c,function(a,c){d.statData=a;d.meta=c;if(null==d.statData)throw h.error.data("No data is passed into the layer");d._calcGeoms();return b()});return this.prevSpec=c};l.prototype._calcGeoms=function(){return this.geoms=
{}};l.prototype.getMeta=function(a){return this.mapping[a]?this.meta[this.mapping[a]]:{}};l.prototype.render=function(a){var b,c,d,e,f,g,k;f={};d=h.compare(_.keys(this.pts),_.keys(this.geoms));c=d.deleted;e=d.kept;b=d.added;g=0;for(k=c.length;g<k;g++)d=c[g],this._delete(a,this.pts[d]);c=0;for(g=b.length;c<g;c++)d=b[c],f[d]=this._add(a,this.geoms[d]);b=0;for(c=e.length;b<c;b++)d=e[b],f[d]=this._modify(a,this.pts[d],this.geoms[d]);return this.pts=f};l.prototype._delete=function(a,b){var c,d,e;e=[];
for(c in b)d=b[c],e.push(a.remove(d));return e};l.prototype._modify=function(a,b,c){var d,e,f,g;f={};g=c.marks;for(d in g)e=g[d],f[d]=a.animate(b[d],e,c.evtData);return f};l.prototype._add=function(a,b){var c,d,e,f;e={};f=b.marks;for(c in f)d=f[c],e[c]=a.add(d,b.evtData);return e};l.prototype._makeMappings=function(a){var b,c,d,e;this.mapping={};this.consts={};e=[];c=0;for(d=ga.length;c<d;c++)b=ga[c],a[b]?(a[b]["var"]&&(this.mapping[b]=a[b]["var"]),a[b]["const"]?e.push(this.consts[b]=a[b]["const"]):
e.push(void 0)):e.push(void 0);return e};l.prototype._getValue=function(a,b){return this.mapping[b]?a[this.mapping[b]]:this.consts[b]?A.identity(this.consts[b]):A.identity(this.defaults[b])};l.prototype._getIdFunc=function(){var a=this;return null!=this.mapping.id?function(b){return a._getValue(b,"id")}:h.counter()};l.prototype._fillZeros=function(a,b){var c,d,e,f;f=[];d=0;for(e=a.length;d<e;d++)c=a[d],f.push(this._getValue(c,"x"));c=_.difference(b,f);f=f.concat(c);d=[];e=0;for(c=c.length;e<c;e++)d.push(0);
var g,h;h=[];e=0;for(g=a.length;e<g;e++)c=a[e],h.push(this._getValue(c,"y"));return{x:f,y:h.concat(d)}};l.prototype._stack=function(a){var b,c,d,e,f,g,k=this;a=h.groupBy(this.statData,a);g=[];for(d in a)b=a[d],e=0,f=null!=this.mapping.y?function(a){return a[k.mapping.y]}:function(){return 0},g.push(function(){var a,d,g;g=[];a=0;for(d=b.length;a<d;a++)c=b[a],c.$lower=e,e+=f(c),g.push(c.$upper=e);return g}());return g};var wa=function(){return wa.__super__.constructor.apply(this,arguments)};N(wa,l);
wa.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,h,j;b=this._getIdFunc();this.geoms={};h=this.statData;j=[];f=0;for(g=h.length;f<g;f++){c=h[f];a={};for(d in c)e=c[d],a[d]={"in":[e]};j.push(this.geoms[b(c)]={marks:{"0":{type:"circle",x:this._getValue(c,"x"),y:this._getValue(c,"y"),color:this._getValue(c,"color"),size:this._getValue(c,"size"),opacity:this._getValue(c,"opacity")}},evtData:a})}return j};qc=wa;var xa=function(){return xa.__super__.constructor.apply(this,arguments)};N(xa,l);xa.prototype._calcGeoms=
function(){var a,b,c,d,e,f,g,k,j,u,p,l;d=_.without(_.keys(this.mapping),"x","y");l=[];b=0;for(c=d.length;b<c;b++)f=d[b],l.push(this.mapping[f]);b=h.groupBy(this.statData,l);d=this._getIdFunc();this.geoms={};p=[];for(f in b){a=b[f];k=a[0];c={};j=0;for(u=l.length;j<u;j++)g=l[j],c[g]={"in":[k[g]]};p.push(this.geoms[d(k)]={marks:{"0":{type:"path",x:function(){var b,c,d;d=[];b=0;for(c=a.length;b<c;b++)e=a[b],d.push(this._getValue(e,"x"));return d}.call(this),y:function(){var b,c,d;d=[];b=0;for(c=a.length;b<
c;b++)e=a[b],d.push(this._getValue(e,"y"));return d}.call(this),color:this._getValue(k,"color"),opacity:this._getValue(k,"opacity")}},evtData:c})}return p};pc=xa;var ya=function(){return ya.__super__.constructor.apply(this,arguments)};N(ya,l);ya.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,k,j,l,p,r;a=_.uniq(function(){var a,b,c,d;c=this.statData;d=[];a=0;for(b=c.length;a<b;a++)f=c[a],d.push(this._getValue(f,"x"));return d}.call(this));var q;e=_.without(_.keys(this.mapping),"x","y");q=[];c=0;
for(d=e.length;c<d;c++)g=e[c],q.push(this.mapping[g]);c=h.groupBy(this.statData,q);e=this._getIdFunc();this.geoms={};r=[];for(g in c){b=c[g];j=b[0];d={};l=0;for(p=q.length;l<p;l++)k=q[l],d[k]={"in":[j[k]]};k=this._fillZeros(b,a);b=k.x;k=k.y;r.push(this.geoms[e(j)]={marks:{"0":{type:"line",x:b,y:k,color:this._getValue(j,"color"),opacity:this._getValue(j,"opacity")}},evtData:d})}return r};oc=ya;var za=function(){return za.__super__.constructor.apply(this,arguments)};N(za,l);za.prototype._calcGeoms=
function(){var a,b,c,d,e,f,g,h,j;this._stack(null!=this.mapping.x?[this.mapping.x]:[]);b=this._getIdFunc();this.geoms={};h=this.statData;j=[];f=0;for(g=h.length;f<g;f++){c=h[f];a={};for(d in c)e=c[d],"y"!==d&&(a[this.mapping[d]]={"in":[e]});j.push(this.geoms[b(c)]={marks:{"0":{type:"rect",x:[A.lower(this._getValue(c,"x")),A.upper(this._getValue(c,"x"))],y:[c.$lower,c.$upper],color:this._getValue(c,"color"),opacity:this._getValue(c,"opacity")}},evtData:a})}return j};mc=za;var Aa=function(){return Aa.__super__.constructor.apply(this,
arguments)};N(Aa,l);Aa.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,j,m,l,p,r,q,n,t,s;a=_.uniq(function(){var a,b,c,d;c=this.statData;d=[];a=0;for(b=c.length;a<b;a++)g=c[a],d.push(this._getValue(g,"x"));return d}.call(this));b={};q=0;for(d=a.length;q<d;q++)m=a[q],b[m]=0;f=_.without(_.keys(this.mapping),"x","y");q=[];d=0;for(e=f.length;d<e;d++)j=f[d],q.push(this.mapping[j]);d=h.groupBy(this.statData,q);f=this._getIdFunc();this.geoms={};s=[];for(j in d){c=d[j];l=c[0];e={};r=0;for(p=q.length;r<
p;r++)m=q[r],e[m]={"in":[l[m]]};n=p=r=void 0;n=[];r=0;for(p=a.length;r<p;r++)m=a[r],n.push(b[m]);r=n;n=0;for(t=c.length;n<t;n++)g=c[n],m=this._getValue(g,"x"),p=this._getValue(g,"y"),b[m]+=p;n=p=c=void 0;n=[];c=0;for(p=a.length;c<p;c++)m=a[c],n.push(b[m]);c=n;s.push(this.geoms[f(l)]={marks:{"0":{type:"area",x:a,y:{bottom:r,top:c},color:this._getValue(l,"color"),opacity:this._getValue(l,"opacity")}},evtData:e})}return s};lc=Aa;var Ba=function(){return Ba.__super__.constructor.apply(this,arguments)};
N(Ba,l);Ba.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,h,j;b=this._getIdFunc();this.geoms={};h=this.statData;j=[];f=0;for(g=h.length;f<g;f++){c=h[f];a={};for(d in c)e=c[d],a[d]={"in":[e]};j.push(this.geoms[b(c)]={marks:{"0":{type:"text",x:this._getValue(c,"x"),y:this._getValue(c,"y"),text:this._getValue(c,"text"),color:this._getValue(c,"color"),size:this._getValue(c,"size"),opacity:this._getValue(c,"opacity"),"text-anchor":"center"}},evtData:a})}return j};rc=Ba;var Ca=function(){return Ca.__super__.constructor.apply(this,
arguments)};N(Ca,l);Ca.prototype._calcGeoms=function(){var a,b,c,d,e,f,g;b=this._getIdFunc();this.geoms={};f=this.statData;g=[];d=0;for(e=f.length;d<e;d++)c=f[d],a={},this._getValue(c,"x"),this._getValue(c,"y"),g.push(this.geoms[b(c)]={marks:{"0":{type:"rect",x:[A.lower(this._getValue(c,"x")),A.upper(this._getValue(c,"x"))],y:[A.lower(this._getValue(c,"y")),A.upper(this._getValue(c,"y"))],color:this._getValue(c,"color"),size:this._getValue(c,"size"),opacity:this._getValue(c,"opacity")}},evtData:a});
return g};sc=Ca;var Da=function(){return Da.__super__.constructor.apply(this,arguments)};N(Da,l);Da.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,h,j,l,p,n,q;b=this._getIdFunc();this.geoms={};p=this.statData;q=[];h=0;for(j=p.length;h<j;h++){d=p[h];a={};f=this._getValue(d,"x");g=this._getValue(d,"y");c=A.lower(f);e=A.upper(f);f=A.middle(f);a={marks:{},evtData:a};g.q1&&(a.marks={iqr:{type:"path",x:[c,c,e,e,c],y:[g.q2,g.q4,g.q4,g.q2,g.q2],stroke:this._getValue(d,"color"),fill:"none",size:this._getValue(d,
"size"),opacity:this._getValue(d,"opacity")},lower:{type:"line",x:[f,f],y:[g.q1,g.q2],color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")},upper:{type:"line",x:[f,f],y:[g.q4,g.q5],color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")},middle:{type:"line",x:[c,e],y:[g.q3,g.q3],color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")}});n=g.outliers;c=g=0;for(l=n.length;g<
l;c=++g)e=n[c],a.marks[c]={type:"circle",x:f,y:e,color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")};q.push(this.geoms[b(d)]=a)}return q};nc=Da;h.dim={};h.dim.make=function(a,b,c){var d,e,f,g,h,j,l;a={width:null!=(e=a.width)?e:400,height:null!=(f=a.height)?f:400,paddingLeft:null!=(g=a.paddingLeft)?g:10,paddingRight:null!=(h=a.paddingRight)?h:10,paddingTop:null!=(j=a.paddingTop)?j:10,paddingBottom:null!=(l=a.paddingBottom)?l:10,guideTop:10,guideRight:0,
guideLeft:5,guideBottom:5};for(d in b)e=b[d],e=e.getDimension(),"left"===e.position?a.guideLeft+=e.width:"right"===e.position?a.guideRight+=e.width:"bottom"===e.position?a.guideBottom+=e.height:"top"===e.position&&(a.guideTop+=e.height);f=a.height-a.guideTop-a.paddingTop;h=d=b=g=0;for(j=c.length;h<j;h++)e=c[h],e=e.getDimension(),e.height+d>f&&(b+=g+5,g=d=0),e.width>g&&(g=e.width),d+=e.height;a.guideRight+=b+g;a.chartHeight=a.height-a.paddingTop-a.paddingBottom-a.guideTop-a.guideBottom;a.chartWidth=
a.width-a.paddingLeft-a.paddingRight-a.guideLeft-a.guideRight;return a};h.dim.guess=function(a){var b,c,d,e,f,g;a={width:null!=(b=a.width)?b:400,height:null!=(c=a.height)?c:400,paddingLeft:null!=(d=a.paddingLeft)?d:10,paddingRight:null!=(e=a.paddingRight)?e:10,paddingTop:null!=(f=a.paddingTop)?f:10,paddingBottom:null!=(g=a.paddingBottom)?g:10,guideLeft:30,guideRight:40,guideTop:10,guideBottom:30};a.chartHeight=a.height-a.paddingTop-a.paddingBottom-a.guideTop-a.guideBottom;a.chartWidth=a.width-a.paddingLeft-
a.paddingRight-a.guideLeft-a.guideRight;return a};var cb,db,uc,eb,fb,vc,gb,hb,Fc={}.hasOwnProperty,P=function(a,b){function c(){this.constructor=a}for(var d in b)Fc.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};h.paper=function(a,b,c,d){var e,f,g;if(!("undefined"!==typeof Raphael&&null!==Raphael))throw h.error.depn("The dependency Raphael is not included.");a=Raphael(a,b,c);b=a.rect(0,0,b,c).attr("stroke-width",0);b.click(d("reset"));f=d("select");
g=e=null;b.drag(function(a,b,c,d){return null!=g?e={x:d,y:c}:g={x:d,y:c}},function(){return e=g=null},function(){if(null!=g&&null!=e)return f({start:g,end:e})});return a};h.render=function(a,b,c,d,e,f){return{add:function(g,h){var j;j=hb[d.type][g.type].render(b,c,d,g,e);null!=f&&j.attr("clip-rect",f);h&&0<_.keys(h).length&&(j.data("e",h),j.click(a("click")),j.hover(a("mover"),a("mout")));return j},remove:function(a){return a.remove()},animate:function(a,b,f){hb[d.type][b.type].animate(a,c,d,b,e);
f&&0<_.keys(f).length&&a.data("e",f);return a}}};var B=function(){};B.prototype.render=function(a,b,c,d,e){var f;a=this._make(a);c=this.attr(b,c,d,e);for(f in c)b=c[f],a.attr(f,b);return a};B.prototype._make=function(){throw h.error.impl();};B.prototype.animate=function(a,b,c,d,e){return a.animate(this.attr(b,c,d,e),300)};B.prototype.attr=function(){throw h.error.impl();};B.prototype._makePath=function(a,b,c){null==c&&(c="L");return _.map(a,function(a,e){return(0===e?"M":c)+a+" "+b[e]}).join(" ")};
B.prototype._maybeApply=function(a,b,c){b=b[c];return _.isObject(b)&&"identity"===b.f?b.v:null!=a[c]?a[c].f(b):b};var ha=function(){return ha.__super__.constructor.apply(this,arguments)};P(ha,B);ha.prototype._make=function(a){return a.circle()};ha.prototype.attr=function(a,b,c,d){var e,f;d=b.getXY(d,c);b=d.x;e=d.y;d=c.stroke?this._maybeApply(a,c,"stroke"):this._maybeApply(a,c,"color");return{cx:b,cy:e,r:this._maybeApply(a,c,"size"),fill:this._maybeApply(a,c,"color"),opacity:this._maybeApply(a,c,"opacity"),
stroke:d,"stroke-width":null!=(f=c["stroke-width"])?f:"0px"}};db=ha;var ia=function(){return ia.__super__.constructor.apply(this,arguments)};P(ia,B);ia.prototype._make=function(a){return a.path()};ia.prototype.attr=function(a,b,c,d){var e;d=b.getXY(d,c);b=d.x;e=d.y;d=c.stroke?this._maybeApply(a,c,"stroke"):this._maybeApply(a,c,"color");return{path:this._makePath(b,e),opacity:this._maybeApply(a,c,"opacity"),stroke:d}};fb=ia;var ja=function(){return ja.__super__.constructor.apply(this,arguments)};P(ja,
B);ja.prototype._make=function(a){return a.path()};ja.prototype.attr=function(a,b,c,d){var e;e=h.sortArrays(a.x.sortfn,[c.x,c.y]);c.x=e[0];c.y=e[1];d=b.getXY(d,c);b=d.x;e=d.y;d=c.stroke?this._maybeApply(a,c,"stroke"):this._maybeApply(a,c,"color");return{path:this._makePath(b,e),stroke:d,opacity:this._maybeApply(a,c,"opacity")}};eb=ja;var ka=function(){return ka.__super__.constructor.apply(this,arguments)};P(ka,B);ka.prototype._make=function(a){return a.path()};ka.prototype.attr=function(a,b,c,d){var e,
f,g;e=h.sortArrays(a.x.sortfn,[c.x,c.y.top]);f=e[0];g=e[1];e=b.getXY(d,{x:f,y:g});g=h.sortArrays(function(b){return-a.x.sortfn(b)},[c.x,c.y.bottom]);f=g[0];g=g[1];b=b.getXY(d,{x:f,y:g});f=e.x.concat(b.x);g=e.y.concat(b.y);return{path:this._makePath(f,g),stroke:this._maybeApply(a,c,"color"),opacity:this._maybeApply(a,c,"opacity"),fill:this._maybeApply(a,c,"color"),"stroke-width":"0px"}};cb=ka;var la=function(){return la.__super__.constructor.apply(this,arguments)};P(la,B);la.prototype._make=function(a){return a.rect()};
la.prototype.attr=function(a,b,c,d){d=b.getXY(d,c);b=d.x;d=d.y;return{x:_.min(b),y:_.min(d),width:Math.abs(b[1]-b[0]),height:Math.abs(d[1]-d[0]),fill:this._maybeApply(a,c,"color"),stroke:this._maybeApply(a,c,"color"),opacity:this._maybeApply(a,c,"opacity"),"stroke-width":"0px"}};vc=la;var ma=function(){return ma.__super__.constructor.apply(this,arguments)};P(ma,B);ma.prototype._make=function(a){return a.path()};ma.prototype.attr=function(a,b,c,d){var e,f,g,h;h=c.x;g=h[0];h=h[1];e=c.y;f=e[0];e=e[1];
c.x=[g,g,h,h];c.y=[f,e,e,f];f=b.getXY(d,c);g=f.x;h=f.y;d=f.r;f=f.t;b.flip&&(g.push(g.splice(0,1)[0]),h.push(h.splice(0,1)[0]),d.push(d.splice(0,1)[0]),f.push(f.splice(0,1)[0]));b=Math.abs(f[1]-f[0])>Math.PI?1:0;e="M "+g[0]+" "+h[0]+" A "+d[0]+" "+d[0]+" 0 "+b+" 1 "+g[1]+" "+h[1];b=Math.abs(f[3]-f[2])>Math.PI?1:0;e+="L "+g[2]+" "+h[2]+" A "+d[2]+" "+d[2]+" 0 "+b+" 0 "+g[3]+" "+h[3]+" Z";return{path:e,fill:this._maybeApply(a,c,"color"),stroke:this._maybeApply(a,c,"color"),opacity:this._maybeApply(a,
c,"opacity"),"stroke-width":"0px"}};uc=ma;"class HLine extends Renderer # for both cartesian & polar?\n  _make: (paper) -> paper.path()\n  attr: (scales, coord, mark) ->\n    y = scales.y mark.y\n    path: @_makePath([0, 100000], [y, y])\n    stroke: 'black'\n    'stroke-width': '1px'\n\nclass VLine extends Renderer # for both cartesian & polar?\n  _make: (paper) -> paper.path()\n  attr: (scales, coord, mark) ->\n    x = scales.x mark.x\n    path: @_makePath([x, x], [0, 100000])\n    stroke: 'black'\n    'stroke-width': '1px'";
var na=function(){return na.__super__.constructor.apply(this,arguments)};P(na,B);na.prototype._make=function(a){return a.text()};na.prototype.attr=function(a,b,c,d){var e;b=b.getXY(d,c);a={x:b.x,y:b.y,r:10,text:this._maybeApply(a,c,"text"),"text-anchor":null!=(e=c["text-anchor"])?e:"left",fill:this._maybeApply(a,c,"color")||"black"};null!=c.transform&&(a.transform=c.transform);return a};gb=na;hb={cartesian:{circle:new db,line:new eb,area:new cb,path:new fb,text:new gb,rect:new vc},polar:{circle:new db,
path:new fb,line:new eb,area:new cb,text:new gb,rect:new uc}};var Ea=function(a,b){return function(){return a.apply(b,arguments)}},C=function(a){this._legacy=Ea(this._legacy,this);this.handleEvent=Ea(this.handleEvent,this);this.merge=Ea(this.merge,this);this.reset=Ea(this.reset,this);var b;if(null==a)throw h.error.defn("No graph specification is passed in!");this.handlers=[];this.paper=this.dims=this.legends=this.axes=this.scaleSet=this.layers=null;this.coord=null!=(b=a.coord)?b:h.coord.cartesian();
this.initial_spec=a;this.dataSubscribed=!1;this.make(a)};C.prototype.reset=function(){if(null==this.initial_spec)throw h.error.defn("No graph specification is passed in!");return this.make(this.initial_spec)};C.prototype.make=function(a){var b,c,d,e,f,g,j;null==a&&(a=this.initial_spec);this.spec=a;if(null==a.layers)throw h.error.defn("No layers are defined in the specification.");null==this.layers&&(this.layers=this._makeLayers(this.spec));if(!this.dataSubscribed){b=this.handleEvent("data");e=this.layers;
c=d=0;for(e=e.length;d<e;c=++d){if(null==a.layers[c].data)throw h.error.defn("Layer "+c+" does not have data to plot!");a.layers[c].data.subscribe(b)}this.dataSubscribed=!0}d=_.after(this.layers.length,this.merge);g=this.layers;j=[];c=e=0;for(f=g.length;e<f;c=++e)b=g[c],j.push(b.make(a.layers[c],d));return j};C.prototype.merge=function(){var a,b,c,d,e,f;b=this._makeDomains(this.spec,this.layers);null==this.scaleSet&&(this.scaleSet=this._makeScaleSet(this.spec,b));this.scaleSet.make(this.spec.guides,
b,this.layers);this.dims||(this.dims=this._makeDimensions(this.spec,this.scaleSet),this.coord.make(this.dims),this.ranges=this.coord.ranges());this.scaleSet.setRanges(this.ranges);this._legacy(b);if(!this.spec.dom)throw h.error.defn("No DOM element specified. Where to make plot?");a=this.spec.dom;b=this.scaleSet.scales;this.coord.setScales(b);this.scaleSet.coord=this.coord;null==this.paper&&(this.paper=this._makePaper(a,this.dims.width,this.dims.height,this.handleEvent));a=this.coord.clipping(this.dims);
c=h.render(this.handleEvent,this.paper,b,this.coord,!0,a);f=this.layers;d=0;for(e=f.length;d<e;d++)a=f[d],a.render(c);c=h.render(this.handleEvent,this.paper,b,this.coord,!1);this.scaleSet.makeAxes();this.scaleSet.renderAxes(this.dims,c);this.scaleSet.makeLegends();return this.scaleSet.renderLegends(this.dims,c)};C.prototype.addHandler=function(a){return this.handlers.push(a)};C.prototype.removeHandler=function(a){return this.handlers.splice(_.indexOf(this.handlers,a),1)};C.prototype.handleEvent=function(a){var b;
b=this;return _.throttle(function(c){var d,e,f,g;"select"===a?(d=c.start,c=c.end,this.evtData=b.scaleSet.fromPixels(d,c)):this.evtData="data"===a?{}:this.data("e");f=b.handlers;g=[];c=0;for(e=f.length;c<e;c++)d=f[c],_.isFunction(d)?g.push(d(a,this)):g.push(d.handle(a,this));return g},1E3)};C.prototype._makeLayers=function(a){return _.map(a.layers,function(b){return h.layer.make(b,a.strict)})};C.prototype._makeDomains=function(a,b){null==a.guides&&(a.guides={});return h.domain.make(b,a.guides,a.strict)};
C.prototype._makeScaleSet=function(a){this.coord.make(h.dim.guess(a));a=this.coord.ranges();return h.scaleset(a,this.coord)};C.prototype._makeDimensions=function(a,b){return h.dim.make(a,b.makeAxes(),b.makeLegends())};C.prototype._makePaper=function(a,b,c,d){_.isString(a)&&(a=document.getElementById(a));return h.paper(a,b,c,d)};C.prototype._legacy=function(a){var b,c,d;this.domains=a;this.scales=this.scaleSet.scales;a=this.scaleSet.makeAxes();this.ticks={};d=[];for(b in a)c=a[b],d.push(this.ticks[b]=
c.ticks);return d};h.chart=function(a){return new C(a)}}return h}(window.polyjs);
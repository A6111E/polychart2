window.polyjs=function(h){if(!h){h={groupBy:function(a,b){return _.groupBy(a,function(a){return _.reduce(b,function(b,e){return""+b+e+":"+a[e]+";"},"")})},linear:function(a,b,c,d){return function(e){return(d-b)/(c-a)*(e-a)+b}},median:function(a,b){var c;null==b&&(b=!1);b||(a=_.sortBy(a,function(a){return a}));c=a.length/2;return 0!==c%1?a[Math.floor(c)]:(a[c-1]+a[c])/2},counter:function(){var a;a=0;return function(){return a++}},compare:function(a,b){var c,d,e,f,g,k,h,r,p;p=_.sortBy(a,function(a){return a});
r=_.sortBy(b,function(a){return a});d=[];e=[];c=[];for(h=g=0;h<p.length||g<r.length;)if(k=p[h],f=r[g],h>=p.length)c.push(f),g+=1;else if(g>=r.length)d.push(k),h+=1;else if(k<f)d.push(k),h+=1;else if(k>f)c.push(f),g+=1;else if(k===f)e.push(k),h+=1,g+=1;else throw DataError("Unknown data encounted");return{deleted:d,kept:e,added:c}},flatten:function(a){var b,c,d,e;b=[];if(null!=a)if(_.isObject(a))if("scalefn"===a.t)"novalue"!==a.f&&b.push(a.v);else for(c in a)d=a[c],b=b.concat(h.flatten(d));else if(_.isArray(a)){c=
0;for(e=a.length;c<e;c++)d=a[c],b=b.concat(h.flatten(d))}else b.push(a);return b},getLabel:function(a,b){return _.chain(a).map(function(a){return a.mapping[b]}).without(null,void 0).uniq().value().join(" | ")},strSize:function(a){return 7*(a+"").length},sortArrays:function(a,b){return _.zip.apply(_,_.sortBy(_.zip.apply(_,b),function(b){return a(b[0])}))},varType:function(a){var b,c,d,e,f;e=c=b=0;for(f=a.length;e<f;e++)d=a[e],null!=d&&((!isNaN(d)||!isNaN(d.replace(/\$|\,/g,"")))&&c++,moment(d).isValid()&&
b++);return c>0.95*a.length?"num":b>0.95*a.length?"date":"cat"},coerce:function(a,b){if("cat"===b.type)return a;if("num"===b.type)return isNaN(a)?+(""+a).replace(/\$|\,/g,""):+a;if("date"===b.type)return b.format?"unix"===b.format?moment.unix(a).unix():moment(a,b.format).unix():moment(a).unix()}};h["const"]={aes:"x y color size opacity shape id text".split(" "),noLegend:["x","y","id","text","tooltip"],trans:{bin:["key","binwidth"],lag:["key","lag"]},stat:{count:["key"],sum:["key"],mean:["key"],box:["key"],
median:["key"]},timerange:"second minute hour day week month year".split(" "),metas:{sort:null,stat:null,limit:null,asc:!0},scaleFns:{novalue:function(){return{v:null,f:"novalue",t:"scalefn"}},max:function(a){return{v:a,f:"max",t:"scalefn"}},min:function(a){return{v:a,f:"min",t:"scalefn"}},upper:function(a){return{v:a,f:"upper",t:"scalefn"}},lower:function(a){return{v:a,f:"lower",t:"scalefn"}},middle:function(a){return{v:a,f:"middle",t:"scalefn"}},jitter:function(a){return{v:a,f:"jitter",t:"scalefn"}},
identity:function(a){return{v:a,f:"identity",t:"scalefn"}}},epsilon:Math.pow(10,-7),defaults:{x:{v:null,f:"novalue",t:"scalefn"},y:{v:null,f:"novalue",t:"scalefn"},color:"steelblue",size:2,opacity:0.7}};var yc={}.hasOwnProperty,Q=function(a,b){function c(){this.constructor=a}for(var d in b)yc.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},jb=function(a){this.message=a;this.name="DefinitionError"};Q(jb,Error);var kb=function(a){this.message=a;this.name=
"DependencyError"};Q(kb,Error);var lb=function(a){this.message=a;this.name="ModeError"};Q(lb,Error);var mb=function(a){this.message=a;this.name="DataError"};Q(mb,Error);var nb=function(a){this.message=a;this.name="UnknownInput"};Q(nb,Error);var ob=function(a){this.message=a;this.name="ModeError"};Q(ob,Error);h.error=function(a){return Error(a)};h.error.data=function(a){return new mb(a)};h.error.depn=function(a){return new kb(a)};h.error.defn=function(a){return new jb(a)};h.error.mode=function(a){return new lb(a)};
h.error.impl=function(a){return new ob(a)};h.error.input=function(a){return new nb(a)};var Ha,pb,qb,zc=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};h.format=function(a,b){switch(a){case "cat":return h.format.identity;case "num":return h.format.number(b);case "date":return h.format.date(b)}};h.format.identity=function(a){return a};Ha={"0":"",3:"k",6:"m",9:"b",12:"t"};qb=function(a,b){return _.isUndefined(Ha[b])?a+"e"+(0<b?"+":"-")+Math.abs(b):
a+Ha[b]};pb=function(a){var b,c,d;if(!isFinite(a))return a;c=""+a;b=Math.abs(a);1E3<=b&&(d=(""+b).split(/\./),b=d[0].length%3||3,d[0]=c.slice(0,b+(0>a))+d[0].slice(b).replace(/(\d{3})/g,",$1"),c=d.join("."));return c};h.format.number=function(a){return function(b){var c,d;d=0;c=null!=a?a:Math.floor(Math.log(Math.abs(0===b?1:b))/Math.LN10);null!=a&&(2===c||5===c||8===c||11===c)?(c+=1,d=1):-1===c?(c=0,d=null!=a?1:2):-2===c?(c=0,d=null!=a?2:3):1===c||2===c?c=0:3<c&&6>c?c=3:6<c&&9>c?c=6:9<c&&12>c?c=9:
12<c&&15>c?c=12:d=null!=a?0:1;b=Math.round(b/Math.pow(10,c-d));b/=Math.pow(10,d);b=b.toFixed(d);return qb(pb(b),c)}};h.format.date=function(a){if(0<=zc.call(h["const"].timerange,a)){if("second"===a)return function(a){return moment.unix(a).format("h:mm:ss a")};if("minute"===a)return function(a){return moment.unix(a).format("h:mm a")};if("hour"===a)return function(a){return moment.unix(a).format("MMM D h a")};if("day"===a||"week"===a)return function(a){return moment.unix(a).format("MMM D")};if("month"===
a)return function(a){return moment.unix(a).format("YY/MM")};if("year"===a)return function(a){return moment.unix(a).format("YYYY")}}else return moment.unix(date).format(a)};h.xhr=function(a,b,c){var d;d=new XMLHttpRequest;3>arguments.length?(c=b,b=null):b&&d.overrideMimeType&&d.overrideMimeType(b);d.open("GET",a,!0);b&&d.setRequestHeader("Accept",b);d.onreadystatechange=function(){var a;if(4===d.readyState)return a=d.status,a=!a&&d.response||200<=a&&300>a||304===a?d:null,c(a)};return d.send(null)};
h.text=function(a,b,c){3>arguments.length&&(c=b,b=null);return h.xhr(a,b,function(a){return c(a&&a.responseText)})};h.json=function(a,b){return h.text(a,"application/json",function(a){return b(a?JSON.parse(a):null)})};h.dsv=function(a,b){var c,d,e,f,g,k,l;l=RegExp("\r\n|["+a+"\r\n]","g");k=RegExp('["'+a+"\n]");c=a.charCodeAt(0);e=function(b){return b.map(f).join(a)};f=function(a){var b;return null!=(b=k.test(a))?b:'"'+a.replace(/\"/g,'""')+{'"':a}};g=null;d=function(a,c){return h.text(a,b,function(a){return c(a&&
d.parse(a))})};d.parse=function(a){return d.parseRows(a,function(a,b){var c,d,e;if(b){e={};c=-1;for(d=g.length;++c<d;)e[g[c]]=a[c];return e}g=a;return null})};d.parseRows=function(a,b){var d,e,f,g,k,h,j,m;e={};d={};h=[];k=0;g=j=null;l.lastIndex=0;for(m=function(){var b,f,k;if(l.lastIndex>=a.length)return d;if(g)return g=!1,e;k=l.lastIndex;if(34===a.charCodeAt(k)){for(f=k;f++<a.length;)if(34===a.charCodeAt(f)){if(34!==a.charCodeAt(f+1))break;f++}l.lastIndex=f+2;b=a.charCodeAt(f+1);13===b?(g=!0,10===
a.charCodeAt(f+2)&&l.lastIndex++):10===b&&(g=!0);return a.substring(k+1,f).replace(/""/g,'"')}if(b=l.exec(a))return g=b[0].charCodeAt(0)!==c,a.substring(k,b.index);l.lastIndex=a.length;return a.substring(k)};(j=m())!==d;){for(f=[];j!==e&&j!==d;)f.push(j),j=m();(!b||(f=b(f,k++)))&&h.push(f)}return h};d.format=function(a){return a.map(e).join("\n")};return d};h.csv=h.dsv(",","text/csv");var rb,sb,tb,ub,vb,Ia,pa,wb,Ja,Ka,U,La,xb,yb,V,zb,Ma,Ab,Na,Oa,Bb,qa,Pa,ra,Qa,Ra,Sa,Cb,Ac=[].slice,Bc={}.hasOwnProperty,
W=function(a,b){function c(){this.constructor=a}for(var d in b)Bc.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};Sa=function(a,b){var c,d,e,f;c=a.length;f=['"',"'"];d=0;for(e=f.length;d<e;d++)if(b=f[d],a[0]===b&&a[c-1]===b)return a.slice(1,+(c-2)+1||9E9);return a};Cb=function(a,b){var c,d,e,f,g;g=[];c=e=0;for(f=a.length;e<f;c=++e)d=a[c],g.push([d,b[c]]);return g};Ia=function(a){var b,c,d,e,f;c={};e=0;for(f=a.length;e<f;e++)d=a[e],b=d[0],d=d[1],c[b]=
d;return c};Ja=function(a,b,c){null==c&&(c=null);return b in a&&a[b]||c};Ka=function(a,b){var c,d,e;d={};for(e in b)c=b[e],c=Ja(a,e,c),null!==c&&(d[e]=c);return d};yb=function(a){var b,c,d,e,f;c={};e=0;for(f=a.length;e<f;e++)for(d in b=a[e],b)c[d]=b[d].concat(Ja(c,d,[]));return c};pa=function(a,b){var c,d,e,f,g;null==b&&(b=function(a){return a});c={};f=0;for(g=a.length;f<g;f++)d=a[f],c[b(d)]=d;f=[];for(e in c)d=c[e],f.push(d);return f};wb=function(a){return function(b){return pa(b,function(b){return b[a]})}};
qa=function(a,b){return""+a+"("+b+")"};Pa=function(a){return"["+a+"]"};var X=function(a){var b,c,d,e;e=[];c=0;for(d=a.length;c<d;c++)b=a[c],e.push(b);this.buffer=e.reverse()};X.prototype.empty=function(){return 0===this.buffer.length};X.prototype.peek=function(){return this.empty()?null:this.buffer[this.buffer.length-1]};X.prototype.get=function(){return this.empty()?null:this.buffer.pop()};X.prototype.toString=function(){return qa("Stream",Pa(Ac.call(this.buffer).reverse()))};var t=function(a){this.tag=
a};t.Tag={symbol:"symbol",literal:"literal",lparen:"(",rparen:")",comma:","};t.prototype.toString=function(){return"<"+this.contents().toString()+">"};t.prototype.contents=function(){return[this.tag]};var Y=function(a){this.name=a;this.name=Sa(this.name);Y.__super__.constructor.call(this,t.Tag.symbol)};W(Y,t);Y.prototype.contents=function(){return Y.__super__.contents.call(this).concat([this.name])};vb=Y;var Z=function(a){this.val=a;this.val=Sa(this.val);Z.__super__.constructor.call(this,t.Tag.literal)};
W(Z,t);Z.prototype.contents=function(){return Z.__super__.contents.call(this).concat([this.val])};tb=Z;var sa,Db,Ta,$;Ta=[t.Tag.lparen,t.Tag.rparen,t.Tag.comma];$=[];sa=0;for(Db=Ta.length;sa<Db;sa++)ra=Ta[sa],$.push(new t(ra));sb=$[0];ub=$[1];rb=$[2];Ra=[[/^\(/,function(){return sb}],[/^\)/,function(){return ub}],[/^,/,function(){return rb}],[/^[+-]?(0x[0-9a-fA-F]+|0?\.\d+|[1-9]\d*(\.\d+)?|0)([eE][+-]?\d+)?/,function(a){return new tb(a)}],[/^(\w|[^\u0000-\u0080])+|'((\\.)|[^\\'])+'|"((\\.)|[^\\"])+"/,
function(a){return new vb(a)}]];xb=function(a){var b,c,d,e;d=0;for(e=Ra.length;d<e;d++)if(c=Ra[d],b=c[0],c=c[1],b=b.exec(a))return d=b[0],[a.slice(d.length),c(d)];throw h.error.defn("There is an error in your specification at "+a);};Qa=function(a){var b,c;for(c=[];;){a=a.replace(/^\s+/,"");if(!a)break;b=xb(a);a=b[0];b=b[1];c.push(b)}return c};var ta=function(){};ta.prototype.toString=function(){return qa(this.constructor.name,this.contents())};var aa=function(a){this.name=a};W(aa,ta);aa.prototype.contents=
function(){return[this.name]};aa.prototype.pretty=function(){return this.name};aa.prototype.visit=function(a){return a.ident(this,this.name)};var ba=function(a){this.val=a};W(ba,ta);ba.prototype.contents=function(){return[this.val]};ba.prototype.pretty=function(){return this.val};ba.prototype.visit=function(a){return a["const"](this,this.val)};var ca=function(a,b){this.fname=a;this.args=b};W(ca,ta);ca.prototype.contents=function(){return[this.fname,Pa(this.args)]};ca.prototype.pretty=function(){var a,
b=this.fname,c,d,e,f;e=this.args;f=[];c=0;for(d=e.length;c<d;c++)a=e[c],f.push(a.pretty());return qa(b,f)};ca.prototype.visit=function(a){var b;return a.call(this,this.fname,function(){var c,d,e,f;e=this.args;f=[];c=0;for(d=e.length;c<d;c++)b=e[c],f.push(b.visit(a));return f}.call(this))};U=function(a,b,c){var d,e,f,g;e=a.peek();if(null!==e){f=0;for(g=c.length;f<g;f++)if(d=c[f],ra=d[0],d=d[1],e.tag===ra)return d(a)}return b(a)};Oa=function(a){throw h.error.defn("There is an error in your specification at "+
a.toString());};V=function(a){var b;b=new X(Qa(a));a=Na(b);if(null!==b.peek())throw h.error.defn("There is an error in your specification at "+b.toString());return a};Na=function(a){return U(a,Oa,[[t.Tag.literal,Ab],[t.Tag.symbol,Bb]])};Ab=function(a){return new ba(a.get().val)};Bb=function(a){var b;b=a.get().name;return U(a,function(){return new aa(b)},[[t.Tag.lparen,zb(b)]])};zb=function(a){return function(b){b.get();b=U(b,Ma([]),[[t.Tag.rparen,function(a){a.get();return[]}]]);return new ca(a,b)}};
Ma=function(a){return function(b){var c,d;c=Na(b);d=a.concat([c]);return U(b,Oa,[[t.Tag.rparen,function(a){a.get();return d}],[t.Tag.comma,function(a){a.get();return Ma(d)(a)}]])}};La=function(a){var b;b={trans:[],stat:[]};a.visit({ident:function(a,b){return b},"const":function(a,b){return b},call:function(a,d,e){var f,g;g=d in h["const"].trans?"trans":d in h["const"].stat?"stat":"none";if("none"!==g)return f=h["const"][g][d],e=Ia(Cb(f,e)),e.name=a.pretty(),e[g]=d,b[g].push(e),e.name;throw h.error.defn("The operation "+
d+" is not recognized. Please check your specifications.");}});return b};h.parser={tokenize:Qa,parse:V,layerToData:function(a){var b,c,d,e,f,g,k,l,r;f={};k=null!=(g=a.filter)?g:{};for(c in k)g=k[c],f[V(c).pretty()]=g;d=h["const"].aes;r=[];g=0;for(b=d.length;g<b;g++)k=d[g],r.push([k,null]);b=Ka(a,Ia(r));for(c in b)"var"in b[c]||delete b[c];r=[];k=[];g=[];a={};for(c in b)d=b[c],e=V(d["var"]),d["var"]=e.pretty(),e=La(e),r.push(e),k.push(d["var"]),0===e.stat.length&&g.push(d["var"]),"sort"in d&&(e=Ka(d,
h["const"].metas),l=V(e.sort),e.sort=l.pretty(),l=La(l),0!==l.stat.length&&(e.stat=l.stat),a[d["var"]]=e);b=yb(r);c=wb("name");g={stats:c(b.stat),groups:pa(g)};return{trans:c(b.trans),stats:g,meta:a,select:pa(k),filter:f}}};var Eb,Fb,Cc={}.hasOwnProperty,Gb=function(a,b){function c(){this.constructor=a}for(var d in b)Cc.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},P=function(a){var b;null==a&&(a={});this.flip=null!=(b=a.flip)?b:!1;this.scales=
null;a=this.flip?["y","x"]:["x","y"];this.x=a[0];this.y=a[1]};P.prototype.make=function(a){return this.dims=a};P.prototype.setScales=function(a){return this.scales={x:a.x.f,y:a.y.f}};P.prototype.clipping=function(){return[this.dims.paddingLeft+this.dims.guideLeft,this.dims.paddingTop+this.dims.guideTop,this.dims.chartWidth,this.dims.chartHeight]};P.prototype.getScale=function(){};P.prototype.ranges=function(){};var H=function(){return H.__super__.constructor.apply(this,arguments)};Gb(H,P);H.prototype.type=
"cartesian";H.prototype.getScale=function(a){if("x"===a||"y"===a)return this.scales[this[a]];throw h.error.input("Coordinates only keep x & y scales");};H.prototype.ranges=function(){var a;a={};a[this.x]={min:this.dims.paddingLeft+this.dims.guideLeft,max:this.dims.paddingLeft+this.dims.guideLeft+this.dims.chartWidth};a[this.y]={min:this.dims.paddingTop+this.dims.guideTop+this.dims.chartHeight,max:this.dims.paddingTop+this.dims.guideTop};return a};H.prototype.axisType=function(a){return this[a]};H.prototype.getXY=
function(a,b){var c,d;if(a)return c={x:_.isArray(b.x)?_.map(b.x,this.scales.x):this.scales.x(b.x),y:_.isArray(b.y)?_.map(b.y,this.scales.y):this.scales.y(b.y)},{x:c[this.x],y:c[this.y]};c=this.scales[this.x];d=this.scales[this.y];return{x:_.isArray(b.x)?_.map(b.x,c):c(b.x),y:_.isArray(b.y)?_.map(b.y,d):d(b.y)}};H.prototype.getAes=function(a,b,c){return{x:c.x(a[this.x],b[this.x]),y:c.y(a[this.y],b[this.y])}};Eb=H;var I=function(){var a=this.getXY,b=this;this.getXY=function(){return a.apply(b,arguments)};
return I.__super__.constructor.apply(this,arguments)};Gb(I,P);I.prototype.type="polar";I.prototype.make=function(a){this.dims=a;this.cx=this.dims.paddingLeft+this.dims.guideLeft+this.dims.chartWidth/2;return this.cy=this.dims.paddingTop+this.dims.guideTop+this.dims.chartHeight/2};I.prototype.getScale=function(a){if("r"===a)return this.scales[this.x];if("t"===a)return this.scales[this.y];throw h.error.input("Coordinates only keep r & t scales");};I.prototype.ranges=function(){var a,b,c;b=[this.x,this.y];
a=b[0];c=b[1];b={};b[c]={min:0,max:2*Math.PI};b[a]={min:0,max:Math.min(this.dims.chartWidth,this.dims.chartHeight)/2-10};return b};I.prototype.axisType=function(a){return"x"===this[a]?"r":"t"};I.prototype.getXY=function(a,b){var c,d,e,f,g,k,h,r,j,q,D,s,m,n,R=this;q=function(a,b){return R.cx+a*Math.cos(b-Math.PI/2)};D=function(a,b){return R.cy+a*Math.sin(b-Math.PI/2)};f=[this.x,this.y];g=f[0];h=f[1];if(a){if(_.isArray(b[g])){f={x:[],y:[],r:[],t:[]};m=b[g];d=c=0;for(s=m.length;c<s;d=++c)k=m[d],k=this.scales[g](k),
r=this.scales[h](b[h][d]),f.x.push(q(k,r)),f.y.push(D(k,r)),f.r.push(k),f.t.push(r);return f}k=this.scales[g](b[g]);r=this.scales[h](b[h]);return{x:q(k,r),y:D(k,r),r:k,t:r}}e=function(a){return _.isObject(a)&&"scalefn"===a.t&&"identity"===a.f};c=function(a,b){var c,d;c=e(a);d=e(b);if(c&&!d)return{x:a.v,y:D(R.scales[g](b),0)};if(c&&d)return{x:a.v,y:b.v};if(!c&&d)return{y:b.v,x:D(R.scales[h](a),0)};k=R.scales[g](b);r=R.scales[h](a);return{x:q(k,r),y:D(k,r)}};if(_.isArray(b.x)){f={x:[],y:[]};n=b.x;d=
s=0;for(m=n.length;s<m;d=++s)j=n[d],d=b.y[d],j=c(j,d),d=j.x,j=j.y,f.x.push(d),f.y.push(j);return f}return c(b.x,b.y)};Fb=I;h.coord={cartesian:function(a){return new Eb(a)},polar:function(a){return new Fb(a)}};var Hb,Ib,Jb,Ua,Kb,Lb,K,Mb,Nb,Ob;Ua=h["const"].aes;h.domain={};h.domain.make=function(a,b,c){var d,e,f,g;d=[];f=0;for(g=a.length;f<g;f++)e=a[f],d.push(Mb(e,b,c));return Nb(d)};h.domain.sortfn=function(a){switch(a.type){case "num":return function(a){return a};case "date":return function(a){return a};
case "cat":return function(b){if(-1===_.indexOf(a.levels,b))return Infinity}}};Jb=function(a){this.type=a.type;this.min=a.min;this.max=a.max;this.bw=a.bw};Ib=function(a){this.type=a.type;this.min=a.min;this.max=a.max;this.bw=a.bw};Hb=function(a){this.type=a.type;this.levels=a.levels;this.sorted=a.sorted};K=function(a){switch(a.type){case "num":return new Jb(a);case "date":return new Ib(a);case "cat":return new Hb(a)}};Mb=function(a,b,c){var d,e,f,g,k,h,j,p,q,D,s,m,n;f={};for(d in a.mapping)if(c)f[d]=
K(b[d]);else switch(h=Lb(a.geoms,d),e=null!=(j=a.getMeta(d))?j:{},g=function(a){return null!=b[d]?b[d][a]:null},e.type){case "num":e=null!=(p=g("bw"))?p:e.bw;k=null!=(q=g("min"))?q:_.min(h);g=null!=(D=g("max"))?D:_.max(h)+(null!=e?e:0);f[d]=K({type:"num",min:k,max:g,bw:e});break;case "date":e=null!=(s=g("bw"))?s:e.bw;k=null!=(m=g("min"))?m:_.min(h);g=g("max");null==g&&(g=_.max(h),e&&(g=moment.unix(g).add(e+"s",1).unix()));f[d]=K({type:"date",min:k,max:g,bw:e});break;case "cat":f[d]=K({type:"cat",
levels:null!=(n=g("levels"))?n:_.uniq(h),sorted:null!=g("levels")})}return f};Lb=function(a,b){var c,d,e,f,g;f=[];for(d in a)for(e in c=a[d],g=c.marks,g)c=g[e],f=f.concat(h.flatten(c[b]));return f};Nb=function(a){var b,c,d,e,f;d={};e=0;for(f=Ua.length;e<f;e++)b=Ua[e],c=_.without(_.pluck(a,b),void 0),0<c.length&&(d[b]=Ob(c));return d};Kb={num:function(a){var b,c;b=_.compact(_.uniq(_.map(a,function(a){return a.bw})));if(1<b.length)throw h.error.data("Not all layers have the same binwidth.");b=null!=
(c=b[0])?c:void 0;c=_.min(_.map(a,function(a){return a.min}));a=_.max(_.map(a,function(a){return a.max}));return K({type:"num",min:c,max:a,bw:b})},date:function(a){var b,c;b=_.compact(_.uniq(_.map(a,function(a){return a.bw})));if(1<b.length)throw h.error.data("Not all layers have the same binwidth.");b=null!=(c=b[0])?c:void 0;c=_.min(_.map(a,function(a){return a.min}));a=_.max(_.map(a,function(a){return a.max}));return K({type:"date",min:c,max:a,bw:b})},cat:function(a){var b;b=_.chain(a).filter(function(a){return a.sorted}).map(function(a){return a.levels}).value();
a=_.chain(a).filter(function(a){return!a.sorted}).map(function(a){return a.levels}).value();if(0<b.length&&_.intersection.apply(this,b))throw h.error.data("You are trying to combine incompatiabl sorted domains in the same axis.");b=[_.flatten(b,!0)];a=_.union.apply(this,b.concat(a));0===b[0].length&&(a=a.sort());return K({type:"cat",levels:a,sorted:!0})}};Ob=function(a){var b;b=_.uniq(_.map(a,function(a){return a.type}));if(1<b.length)throw h.error.data("You are trying to merge data of different types in the same axis or legend.");
return Kb[b[0]](a)};var Pb,Va,Qb,Rb;h.tick={};h.tick.make=function(a,b,c){var d,e,f,g;d=null;null!=b.ticks?a=b.ticks:(d=null!=(e=b.numticks)?e:5,d=Rb[c](a,d),a=d.ticks,d=d.step);d=b.labels?function(a){var c;return null!=(c=b.labels[a])?c:a}:b.formatter?b.formatter:h.format(c,d);c={};e=Qb(d);f=0;for(g=a.length;f<g;f++)d=a[f],c[d]=e(d);return c};Pb=function(a){this.location=a.location;this.value=a.value;this.index=a.index};Qb=function(a){var b;b=0;return function(c){return new Pb({location:c,value:a(c),
index:b++})}};Va=function(a,b){var c,d;d=Math.pow(10,Math.floor(Math.log(a/b)/Math.LN10));c=b/a*d;0.15>c?d*=10:0.35>=c?d*=5:0.75>=c&&(d*=2);return d};Rb={cat:function(a,b){var c,d,e,f,g,h,l;e=Math.max(1,Math.round(a.levels.length/b));f=[];l=a.levels;c=g=0;for(h=l.length;g<h;c=++g)d=l[c],0===c%e&&f.push(d);return{ticks:f}},num:function(a,b){var c,d,e,f;d=a.min;c=a.max;e=Va(c-d,b);f=Math.ceil(d/e)*e;for(d=[];f<c;)d.push(f),f+=e;return{ticks:d,step:Math.floor(Math.log(e)/Math.LN10)}},"num-log":function(a,
b){var c,d,e,f,g,k,l,j;k=a.min;g=a.max;d=function(a){return Math.log(a)/Math.LN10};c=function(a){return Math.exp(a*Math.LN10)};f=Math.max(d(k),0);e=d(g);j=Va(e-f,b);for(f=Math.ceil(f/j)*j;f<e+h["const"].epsilon;)if(0!==f%1&&0.1>=f%1)f+=j;else{if(f%1>h["const"].epsilon&&(l=Math.floor(f)+d(10*(f%1)),0===l%1)){f+=j;continue}l=c(l);l<k||l>g?f+=j:ticks.push(l)}return{ticks:ticks}},date:function(a,b){var c,d,e,f,g;e=a.min;d=a.max;f=(d-e)/b;f=1.4>f?"second":84>f?"minute":5040>f?"hour":120960>f?"day":846720>
f?"week":3628800>f?"month":"year";g=[];c=moment.unix(e).startOf(f);for(c.unix()<e&&c.add(f+"s",1);c.unix()<d;)g.push(c.unix()),c.add(f+"s",1);return{ticks:g,step:f}}};var Sb,Tb,Ub,Vb,j,L=function(a,b){return function(){return a.apply(b,arguments)}},Dc={}.hasOwnProperty,S=function(a,b){function c(){this.constructor=a}for(var d in b)Dc.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},Wa=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in
this&&this[b]===a)return b;return-1};j=h["const"].scaleFns;var Xa=function(){};Xa.prototype.getDimension=function(){throw h.error.impl();};var w=function(){this._modify=L(this._modify,this);this._add=L(this._add,this);this.render=L(this.render,this);this.make=L(this.make,this);this.title=this.line=null;this.position="none";this.titletext=null;this.ticks={};this.pts={}};S(w,Xa);w.prototype.make=function(a){var b,c,d,e,f,g,k,l;b=a.domain;d=a.type;c=a.guideSpec;a=a.key;this.titletext=null!=(e=c.title)?
e:a;this.renderTick=null!=(f=c.renderTick)?f:!0;this.renderGrid=null!=(g=c.renderGrid)?g:!0;this.renderLabel=null!=(k=c.renderLabel)?k:!0;this.renderLine=null!=(l=c.renderLine)?l:!0;this.ticks=h.tick.make(b,c,d);return this.maxwidth=_.max(_.map(this.ticks,function(a){return h.strSize(a.value)}))};w.prototype.render=function(a,b,c){var d,e,f,g,k,l;this.coord=b;e={top:a.paddingTop+a.guideTop,left:a.paddingLeft+a.guideLeft,right:a.paddingLeft+a.guideLeft+a.chartWidth,bottom:a.paddingTop+a.guideTop+a.chartHeight,
width:a.chartWidth,height:a.chartHeight};e.centerx=e.left+e.width/2;e.centery=e.top+e.height/2;e.radius=Math.min(e.width,e.height)/2-10;this.renderLine&&(null!=this.line&&c.remove(this.line),this.line=this._renderline(c,e));this.title=null!=this.title?c.animate(this.title,this._makeTitle(e,this.titletext)):c.add(this._makeTitle(e,this.titletext));b=h.compare(_.keys(this.pts),_.keys(this.ticks));a=b.deleted;f=b.kept;d=b.added;b={};k=0;for(l=f.length;k<l;k++)g=f[k],b[g]=this._modify(c,this.pts[g],this.ticks[g],
e);f=0;for(k=d.length;f<k;f++)g=d[f],b[g]=this._add(c,this.ticks[g],e);e=0;for(d=a.length;e<d;e++)g=a[e],this._delete(c,this.pts[g]);this.pts=b;return this.rendered=!0};w.prototype._add=function(a,b,c){var d;d={};this.renderTick&&(d.tick=a.add(this._makeTick(c,b)));this.renderLabel&&(d.text=a.add(this._makeLabel(c,b)));this.renderGrid&&(d.grid=a.add(this._makeGrid(c,b)),d.grid.toBack());return d};w.prototype._delete=function(a,b){this.renderTick&&a.remove(b.tick);this.renderLabel&&a.remove(b.text);
if(this.renderGrid)return a.remove(b.grid)};w.prototype._modify=function(a,b,c,d){var e;e={};this.renderTick&&(e.tick=a.animate(b.tick,this._makeTick(d,c)));this.renderLabel&&(e.text=a.animate(b.text,this._makeLabel(d,c)));this.renderGrid&&(e.grid=a.animate(b.grid,this._makeGrid(d,c)),e.grid.toBack());return e};w.prototype._renderline=function(){throw h.error.impl();};w.prototype._makeTitle=function(){throw h.error.impl();};w.prototype._makeTick=function(a){if(!a)throw h.error.impl();a.type="path";
a.stroke=j.identity("black");return a};w.prototype._makeLabel=function(a){if(!a)throw h.error.impl();a.type="text";return a};w.prototype._makeGrid=function(a){if(!a)throw h.error.impl();a.stroke="#CCC";a["stroke-dasharray"]="- ";a["stroke-dashoffset"]=3;return a};var A=function(){this.make=L(this.make,this);return A.__super__.constructor.apply(this,arguments)};S(A,w);A.prototype.make=function(a){var b,c;this.position=null!=(b=a.guideSpec.position)?b:"bottom";if("top"!==(c=this.position)&&"bottom"!==
c&&"none"!==c)throw h.error.defn("X-axis position can't be "+this.position+".");return A.__super__.make.call(this,a)};A.prototype._renderline=function(a,b){var c,d,e;e="top"===this.position?j.identity(b.top):j.identity(b.bottom);c=j.identity(b.left);d=j.identity(b.left+b.width);return a.add({type:"path",y:[e,e],x:[c,d],stroke:j.identity("black")})};A.prototype._makeTitle=function(a,b){var c;c="top"===this.position?j.identity(a.top-27):j.identity(a.bottom+27);return{type:"text",x:j.identity(a.left+
a.width/2),y:c,text:b,"text-anchor":"middle"}};A.prototype._makeTick=function(a,b){var c,d;"top"===this.position?(c=j.identity(a.top),d=j.identity(a.top-5)):(c=j.identity(a.bottom),d=j.identity(a.bottom+5));return A.__super__._makeTick.call(this,{x:[b.location,b.location],y:[c,d]})};A.prototype._makeLabel=function(a,b){var c;c="top"===this.position?j.identity(a.top-15):j.identity(a.bottom+15);return A.__super__._makeLabel.call(this,{x:b.location,y:c,text:b.value,"text-anchor":"middle"})};A.prototype._makeGrid=
function(a,b){var c,d;c=j.identity(a.top);d=j.identity(a.bottom);return A.__super__._makeGrid.call(this,{type:"path",x:[b.location,b.location],y:[c,d]})};A.prototype.getDimension=function(){var a;return{position:null!=(a=this.position)?a:"bottom",height:30,width:"all"}};Ub=A;var B=function(){this.make=L(this.make,this);return B.__super__.constructor.apply(this,arguments)};S(B,w);B.prototype.make=function(a){var b,c;this.position=null!=(b=a.guideSpec.position)?b:"left";if("left"!==(c=this.position)&&
"right"!==c&&"none"!==c)throw h.error.defn("X-axis position can't be "+this.position+".");return B.__super__.make.call(this,a)};B.prototype._renderline=function(a,b){var c,d,e;c="left"===this.position?j.identity(b.left):j.identity(b.right);d=j.identity(b.top);e=j.identity(b.top+b.height);return a.add({type:"path",x:[c,c],y:[d,e],stroke:j.identity("black")})};B.prototype._makeTitle=function(a,b){return{type:"text",x:"left"===this.position?j.identity(a.left-this.maxwidth-15):j.identity(a.right+this.maxwidth+
15),y:j.identity(a.top+a.height/2),text:b,transform:"r270","text-anchor":"middle"}};B.prototype._makeTick=function(a,b){var c,d;"left"===this.position?(c=j.identity(a.left),d=j.identity(a.left-5)):(c=j.identity(a.right),d=j.identity(a.right+5));return B.__super__._makeTick.call(this,{x:[c,d],y:[b.location,b.location]})};B.prototype._makeLabel=function(a,b){var c;c="left"===this.position?j.identity(a.left-7):j.identity(a.right+7);return B.__super__._makeLabel.call(this,{x:c,y:b.location,text:b.value,
"text-anchor":"left"===this.position?"end":"start"})};B.prototype._makeGrid=function(a,b){var c,d;c=j.identity(a.left);d=j.identity(a.right);return B.__super__._makeGrid.call(this,{type:"path",y:[b.location,b.location],x:[c,d]})};B.prototype.getDimension=function(){var a;return{position:null!=(a=this.position)?a:"right",height:"all",width:20+this.maxwidth}};Vb=B;var E=function(){return E.__super__.constructor.apply(this,arguments)};S(E,w);E.prototype._renderline=function(a,b){var c,d,e;c=j.identity(b.left);
d=j.identity(b.top);e=j.identity(b.top+b.height/2);return a.add({type:"path",x:[c,c],y:[d,e],stroke:j.identity("black")})};E.prototype._makeTitle=function(a,b){return{type:"text",x:j.identity(a.left-this.maxwidth-15),y:j.identity(a.top+a.height/4),text:b,transform:"r270","text-anchor":"middle"}};E.prototype._makeTick=function(a,b){return E.__super__._makeTick.call(this,{x:[j.identity(a.left),j.identity(a.left-5)],y:[b.location,b.location]})};E.prototype._makeLabel=function(a,b){return E.__super__._makeLabel.call(this,
{x:j.identity(a.left-7),y:b.location,text:b.value,"text-anchor":"end"})};E.prototype._makeGrid=function(a,b){return E.__super__._makeGrid.call(this,{type:"circle",x:j.identity(a.centerx),y:j.identity(a.centery),size:j.identity(this.coord.getScale("r")(b.location)),fill:j.identity("white"),"stroke-width":1})};E.prototype.getDimension=function(){return{position:"left",height:"all",width:20+this.maxwidth}};Sb=E;var F=function(){return F.__super__.constructor.apply(this,arguments)};S(F,w);F.prototype._renderline=
function(a,b){return a.add({type:"circle",x:j.identity(b.centerx),y:j.identity(b.centery),size:j.identity(b.radius),color:j.identity("none"),stroke:j.identity("black"),"stroke-width":1})};F.prototype._makeTitle=function(a,b){return{type:"text",x:j.identity(a.left+a.width/2),y:j.identity(a.bottom+27),text:b,"text-anchor":"middle"}};F.prototype._makeTick=function(a,b){return F.__super__._makeTick.call(this,{x:[b.location,b.location],y:[j.max(0),j.max(3)]})};F.prototype._makeLabel=function(a,b){return F.__super__._makeLabel.call(this,
{x:b.location,y:j.max(12),text:b.value,"text-anchor":"middle"})};F.prototype._makeGrid=function(a,b){var c,d,e,f;d=j.identity(a.centerx);f=j.identity(a.centery);c=this.coord.getScale("t")(b.location)-Math.PI/2;e=j.identity(a.centerx+a.radius*Math.cos(c));c=j.identity(a.centery+a.radius*Math.sin(c));return F.__super__._makeGrid.call(this,{type:"path",y:[f,c],x:[d,e]})};F.prototype.getDimension=function(){return{}};Tb=F;var x=function(a){this.aes=a;this._makeTick=L(this._makeTick,this);this.make=L(this.make,
this);this.rendered=!1;this.title=null;this.ticks={};this.pts={}};S(x,Xa);x.prototype.TITLEHEIGHT=15;x.prototype.TICKHEIGHT=12;x.prototype.SPACING=10;x.prototype.make=function(a){var b,c,d,e;b=a.domain;d=a.type;c=a.guideSpec;this.mapping=a.mapping;a=a.keys;this.titletext=null!=(e=c.title)?e:a;this.ticks=h.tick.make(b,c,d);this.height=this.TITLEHEIGHT+this.SPACING+this.TICKHEIGHT*_.size(this.ticks);c=h.strSize(this.titletext);b=_.max(_.map(this.ticks,function(a){return h.strSize(a.value)}));return this.maxwidth=
Math.max(c,b)};x.prototype.render=function(a,b,c){var d,e,f,g,k,l;a={top:a.paddingTop+a.guideTop+c.y,right:a.paddingLeft+a.guideLeft+a.chartWidth+c.x,width:a.guideRight,height:a.chartHeight};this.title=null!=this.title?b.animate(this.title,this._makeTitle(a,this.titletext)):b.add(this._makeTitle(a,this.titletext));c=h.compare(_.keys(this.pts),_.keys(this.ticks));d=c.deleted;e=c.kept;c=c.added;f={};k=0;for(l=d.length;k<l;k++)g=d[k],this._delete(b,this.pts[g]);d=0;for(k=e.length;d<k;d++)g=e[d],f[g]=
this._modify(b,this.pts[g],this.ticks[g],a);e=0;for(d=c.length;e<d;e++)g=c[e],f[g]=this._add(b,this.ticks[g],a);return this.pts=f};x.prototype.remove=function(a){var b,c,d;d=this.pts;for(b in d)c=d[b],this._delete(a,c);a.remove(this.title);this.title=null;return this.pts={}};x.prototype._add=function(a,b,c){var d;d={};d.tick=a.add(this._makeTick(c,b));d.text=a.add(this._makeLabel(c,b));return d};x.prototype._delete=function(a,b){a.remove(b.tick);return a.remove(b.text)};x.prototype._modify=function(a,
b,c,d){var e;e=[];e.tick=a.animate(b.tick,this._makeTick(d,c));e.text=a.animate(b.text,this._makeLabel(d,c));return e};x.prototype._makeLabel=function(a,b){return{type:"text",x:j.identity(a.right+15),y:j.identity(a.top+(15+12*b.index)+1),text:b.value,"text-anchor":"start"}};x.prototype._makeTick=function(a,b){var c,d,e,f;d={type:"circle",x:j.identity(a.right+7),y:j.identity(a.top+(15+12*b.index)),color:j.identity("steelblue")};f=this.mapping;for(c in f)e=f[c],0<=Wa.call(h["const"].noLegend,c)||(e=
e[0],d[c]=0<=Wa.call(this.aes,c)?b.location:null!=e.type&&"const"===e.type?j.identity(e.value):_.isObject(e)?j.identity(h["const"].defaults[c]):j.identity(e));0<=Wa.call(this.aes,"size")||(d.size=j.identity(5));return d};x.prototype._makeTitle=function(a,b){return{type:"text",x:j.identity(a.right+5),y:j.identity(a.top),text:b,"text-anchor":"start"}};x.prototype.getDimension=function(){return{position:"right",height:this.height,width:15+this.maxwidth}};h.guide={};h.guide.axis=function(a){if("x"===
a)return new Ub;if("y"===a)return new Vb;if("r"===a)return new Sb;if("t"===a)return new Tb};h.guide.legend=function(a){return new x(a)};var Wb,Xb,Yb,Zb,$b,ac,bc,J=function(a,b){return function(){return a.apply(b,arguments)}},Ec={}.hasOwnProperty,G=function(a,b){function c(){this.constructor=a}for(var d in b)Ec.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};h.scale={linear:function(a){return new $b(a)},log:function(a){return new ac(a)},area:function(a){return new Wb(a)},
color:function(a){return new Xb(a)},gradient:function(a){return new Yb(a)},identity:function(a){return new Zb(a)},opacity:function(a){return new bc(a)}};var u=function(){this.f=null};u.prototype.make=function(a){this.domain=a;this.sortfn=h.domain.sortfn(a);switch(a.type){case "num":return this._makeNum();case "date":return this._makeDate();case "cat":return this._makeCat()}};u.prototype._makeNum=function(){throw h.error.impl("You are using a scale that does not support numbers");};u.prototype._makeDate=
function(){throw h.error.impl("You are using a scale that does not support dates");};u.prototype._makeCat=function(){throw h.error.impl("You are using a scale that does not support categoies");};u.prototype.tickType=function(){switch(this.domain.type){case "num":return this._tickNum(this.domain);case "date":return this._tickDate(this.domain);case "cat":return this._tickCat(this.domain)}};u.prototype._tickNum=function(){return"num"};u.prototype._tickDate=function(){return"date"};u.prototype._tickCat=
function(){return"cat"};u.prototype._identityWrapper=function(a){return function(b){return _.isObject(b)&&"scalefn"===b.t&&"identity"===b.f?b.v:a(b)}};var M=function(){this._catWrapper=J(this._catWrapper,this);this._dateWrapper=J(this._dateWrapper,this);this._numWrapper=J(this._numWrapper,this);this.finv=this.f=null};G(M,u);M.prototype.make=function(a,b){this.range=b;this.space=0.05;return M.__super__.make.call(this,a)};M.prototype._numWrapper=function(a,b){var c=this;return function(d){var e,f,g;
if(_.isObject(d)){if("scalefn"===d.t){if("identity"===d.f)return d.v;if("middle"===d.f)return b(d.v+a.bw/2);if("max"===d.f)return c.range.max+d.v;if("min"===d.f)return c.range.min+d.v;g=b(d.v+a.bw);e=b(d.v);f=(g-e)*c.space;if("upper"===d.f)return g-f;if("lower"===d.f)return e+f}throw h.error.input("Unknown object "+d+" is passed to a scale");}return b(d)}};M.prototype._dateWrapper=function(a,b){var c=this;return function(d){var e,f,g;if(_.isObject(d)){if("scalefn"===d.t){if("identity"===d.f)return d.v;
if("max"===d.f)return c.range.max+d.v;if("min"===d.f)return c.range.min+d.v;g="week"!==a.bw?moment.unix(d.v).endOf(a.bw).unix():moment.unix(d.v).day(7).unix();g=b(g);e="week"!==a.bw?moment.unix(d.v).startOf(a.bw).unix():moment.unix(d.v).day(0).unix();e=b(e);f=(g-e)*c.space;if("upper"===d.f)return g-f;if("lower"===d.f)return e+f;if("middle"===d.f)return g/2+e/2}throw h.error.input("Unknown object "+d+" is passed to a scale");}return b(d)}};M.prototype._catWrapper=function(a,b){var c=this;return function(d){var e;
e=a*c.space;if(_.isObject(d)){if("scalefn"===d.t){if("identity"===d.f)return d.v;if("upper"===d.f)return b(d.v)+a-e;if("lower"===d.f)return b(d.v)+e;if("middle"===d.f)return b(d.v)+a/2;if("max"===d.f)return c.range.max+d.v;if("min"===d.f)return c.range.min+d.v}throw h.error.input("Unknown object "+d+" is passed to a scale");}return b(d)+a/2}};var T=function(){return T.__super__.constructor.apply(this,arguments)};G(T,M);T.prototype._makeNum=function(){var a,b;b=h.linear(this.domain.min,this.range.min,
this.domain.max,this.range.max);a=h.linear(this.range.min,this.domain.min,this.range.max,this.domain.max);this.f=this._numWrapper(this.domain,b);return this.finv=function(b,d){var e;e=[a(b),a(d)];return{ge:_.min(e),le:_.max(e)}}};T.prototype._makeDate=function(){var a,b;b=h.linear(this.domain.min,this.range.min,this.domain.max,this.range.max);a=h.linear(this.range.min,this.domain.min,this.range.max,this.domain.max);this.f=this._dateWrapper(this.domain,b);return this.finv=function(b,d){var e;e=[a(b),
a(d)];return{ge:_.min(e),le:_.max(e)}}};T.prototype._makeCat=function(){var a,b=this;a=(this.range.max-this.range.min)/this.domain.levels.length;this.f=this._catWrapper(a,function(c){c=_.indexOf(b.domain.levels,c);return-1===c?null:b.range.min+c*a});return this.finv=function(c,d){var e,f;d<c&&(e=d,d=c,c=e);e=Math.floor(c/a);f=Math.ceil(d/a);return{"in":b.domain.levels.slice(e,+f+1||9E9)}}};$b=T;var da=function(){return da.__super__.constructor.apply(this,arguments)};G(da,M);da.prototype._makeNum=
function(){var a,b,c,d;a=Math.log;c=h.linear(a(this.domain.min),this.range.min,a(this.domain.max),this.range.max);this.f=this._numWrapper(function(b){return c(a(b))});d=h.linear(this.range.min,a(this.domain.min),this.range.max,a(this.domain.max));b=function(a){return Math.exp(d(a))};return this.finv=function(a,c){var d;d=[b(a),b(c)];return{ge:_.min(d),le:_.max(d)}}};da.prototype._tickNum=function(){return"num-log"};ac=da;var ua=function(){this._makeNum=J(this._makeNum,this);return ua.__super__.constructor.apply(this,
arguments)};G(ua,u);ua.prototype._makeNum=function(){var a,b,c;a=0===this.domain.min?0:1;b=Math.sqrt;c=h.linear(b(this.domain.min),a,b(this.domain.max),10);return this.f=this._identityWrapper(function(a){return c(b(a))})};Wb=ua;var va=function(){this._makeNum=J(this._makeNum,this);return va.__super__.constructor.apply(this,arguments)};G(va,u);va.prototype._makeNum=function(){return this.f=this._identityWrapper(h.linear(this.domain.min,0===this.domain.min?0:0.1,this.domain.max,1))};bc=va;var ea=function(){this._makeNum=
J(this._makeNum,this);this._makeCat=J(this._makeCat,this);return ea.__super__.constructor.apply(this,arguments)};G(ea,u);ea.prototype._makeCat=function(){var a,b,c=this;b=this.domain.levels.length;a=function(a){return _.indexOf(c.domain.levels,a)/b+1/(2*b)};return this.f=function(b){return Raphael.hsl(a(b),0.5,0.5)}};ea.prototype._makeNum=function(){var a;a=h.linear(this.domain.min,0,this.domain.max,1);return this.f=function(b){return Raphael.hsl(0.5,a(b),0.5)}};Xb=ea;var Ya=function(){return Ya.__super__.constructor.apply(this,
arguments)};G(Ya,u);Ya.prototype._makeCat=function(){};var Za=function(a){this._makeNum=J(this._makeNum,this);this.lower=a.lower;this.upper=a.upper};G(Za,u);Za.prototype._makeNum=function(){var a,b,c,d,e;c=Raphael.color(this.lower);e=Raphael.color(this.upper);d=h.linear(this.domain.min,c.r,this.domain.max,e.r);b=h.linear(this.domain.min,c.g,this.domain.max,e.g);a=h.linear(this.domain.min,c.b,this.domain.max,e.b);return this.f=this._identityWrapper(function(c){return Raphael.rgb(d(c),b(c),a(c))})};
Yb=Za;var cc=function(){this._makeCat=J(this._makeCat,this)};G(cc,u);cc.prototype._makeCat=function(){};var $a=function(){return $a.__super__.constructor.apply(this,arguments)};G($a,u);$a.prototype._makeCat=function(){};var wa=function(){return wa.__super__.constructor.apply(this,arguments)};G(wa,u);wa.prototype.make=function(){this.sortfn=function(a){return a};return this.f=this._identityWrapper(function(a){return a})};Zb=wa;var dc,Fc=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in
this&&this[b]===a)return b;return-1};h.scaleset=function(a,b,c){return new dc(a,b,c)};var v=function(a,b){this.axes={x:h.guide.axis(b.axisType("x")),y:h.guide.axis(b.axisType("y"))};this.coord=b;this.ranges=a;this.legends=[];this.deletedLegends=[]};v.prototype.make=function(a,b,c){this.guideSpec=a;this.layers=c;this.domains=b;this.domainx=this.domains.x;this.domainy=this.domains.y;this.scales=this._makeScales(a,b,this.ranges);this.reverse={x:this.scales.x.finv,y:this.scales.y.finv};return this.layerMapping=
this._mapLayers(c)};v.prototype.setRanges=function(a){this.ranges=a;this._makeXScale();return this._makeYScale()};v.prototype.setXDomain=function(a){this.domainx=a;return this._makeXScale()};v.prototype.setYDomain=function(a){this.domainy=a;return this._makeYScale()};v.prototype.resetDomains=function(){this.domainx=this.domains.x;this.domainy=this.domains.y;this._makeXScale();return this._makeYScale()};v.prototype._makeXScale=function(){return this.scales.x.make(this.domainx,this.ranges.x)};v.prototype._makeYScale=
function(){return this.scales.y.make(this.domainy,this.ranges.y)};v.prototype._makeScales=function(a,b,c){var d,e,f,g,k,l;e=function(b){return a&&null!=a[b]&&null!=a[b].scale?a[b].scale:null};d={};d.x=null!=(f=e("x"))?f:h.scale.linear();d.x.make(b.x,c.x);d.y=null!=(g=e("y"))?g:h.scale.linear();d.y.make(b.y,c.y);null!=b.color&&(d.color="cat"===b.color.type?null!=(k=e("color"))?k:h.scale.color():null!=(l=e("color"))?l:h.scale.gradient({upper:"steelblue",lower:"red"}),d.color.make(b.color));null!=b.size&&
(d.size=e("size")||h.scale.area(),d.size.make(b.size));null!=b.opacity&&(d.opacity=e("opacity")||h.scale.opacity(),d.opacity.make(b.opacity));d.text=h.scale.identity();d.text.make();return d};v.prototype.fromPixels=function(a,b){var c,d,e,f,g,h,l;c=this.coord.getAes(a,b,this.reverse);e=c.x;f=c.y;d={};l=this.layerMapping.x;g=0;for(h=l.length;g<h;g++)c=l[g],null!=c.type&&"map"===c.type&&(d[c.value]=e);h=this.layerMapping.y;e=0;for(g=h.length;e<g;e++)c=h[e],null!=c.type&&"map"===c.type&&(d[c.value]=
f);return d};v.prototype.getSpec=function(a){return null!=this.guideSpec&&null!=this.guideSpec[a]?this.guideSpec[a]:{}};v.prototype.makeAxes=function(){this.axes.x.make({domain:this.domainx,type:this.scales.x.tickType(),guideSpec:this.getSpec("x"),key:h.getLabel(this.layers,"x")});this.axes.y.make({domain:this.domainy,type:this.scales.y.tickType(),guideSpec:this.getSpec("y"),key:h.getLabel(this.layers,"y")});return this.axes};v.prototype.renderAxes=function(a,b){this.axes.x.render(a,this.coord,b);
return this.axes.y.render(a,this.coord,b)};v.prototype._mapLayers=function(a){var b,c;c={};for(b in this.domains)c[b]=_.map(a,function(a){return null!=a.mapping[b]?{type:"map",value:a.mapping[b]}:null!=a.consts[b]?{type:"const",value:a["const"][b]}:a.defaults[b]});return c};v.prototype._mergeAes=function(a){var b,c,d,e,f,g,k;f=[];for(b in this.domains)if(!(0<=Fc.call(h["const"].noLegend,b))&&(d=_.map(a,function(a){return a.mapping[b]}),!_.all(d,_.isUndefined))){e=!1;g=0;for(k=f.length;g<k;g++)if(c=
f[g],_.isEqual(c.mapped,d)){c.aes.push(b);e=!0;break}e||f.push({aes:[b],mapped:d})}return _.pluck(f,"aes")};v.prototype.makeLegends=function(){var a,b,c,d,e,f;b=this._mergeAes(this.layers);for(d=0;d<this.legends.length;){e=this.legends[d];f=!0;for(c=0;c<b.length;){a=b[c];if(_.isEqual(a,e.aes)){b.splice(c,1);f=!1;break}c++}f?(this.deletedLegends.push(e),this.legends.splice(d,1)):d++}e=0;for(c=b.length;e<c;e++)a=b[e],this.legends.push(h.guide.legend(a));d=this.legends;b=0;for(c=d.length;b<c;b++)e=d[b],
a=e.aes[0],e.make({domain:this.domains[a],guideSpec:this.getSpec(a),type:this.scales[a].tickType(),mapping:this.layerMapping,keys:h.getLabel(this.layers,a)});return this.legends};v.prototype.renderLegends=function(a,b){var c,d,e,f,g,h,l,j,p;e=this.deletedLegends;g=0;for(d=e.length;g<d;g++)c=e[g],c.remove(b);this.deletedLegends=[];g={x:0,y:0};c=this.axes.y.getDimension();"right"===c.position&&(g.x+=c.width);e=0;d=a.height-a.guideTop-a.paddingTop;j=this.legends;p=[];h=0;for(l=j.length;h<l;h++)c=j[h],
f=c.getDimension(),f.height+g.y>d&&(g.x+=e+5,e=g.y=0),f.width>e&&(e=f.width),c.render(a,b,g),p.push(g.y+=f.height);return p};dc=v;var ec,fc,ab,bb,gc,cb,hc,ic,jc,kc,lc=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},n=function(a){this.url=a.url;this.json=a.json;this.csv=a.csv;this.meta=a.meta;this.dataBackend=null!=a.url;this.computeBackend=!1;this.raw=null;null==this.meta&&(this.meta={});this.subscribed=[]};n.prototype.impute=function(a){var b,
c,d,e,f,g,k;d=_.keys(a[0]);b=a.slice(0,100);f=0;for(g=d.length;f<g;f++){c=d[f];if(null==(e=this.meta)[c])e[c]={};this.meta[c].type||(this.meta[c].type=h.varType(_.pluck(b,c)))}e=0;for(g=a.length;e<g;e++){b=a[e];f=0;for(k=d.length;f<k;f++)c=d[f],_.isString(b[c])&&(b[c]=h.coerce(b[c],this.meta[c]))}this.key=d;return this.raw=a};n.prototype.getRaw=function(a){var b=this;if(this.raw)return a(this.raw,this.meta);this.json&&(this.raw=this.impute(this.json));this.csv&&(this.raw=this.impute(h.csv.parse(this.csv)));
if(this.raw)return a(this.raw,this.meta);if(this.url)return h.csv(this.url,function(c){b.raw=b.impute(c);return a(b.raw,b.meta)})};n.prototype.update=function(a){var b=this;this.json=a.json;this.csv=a.csv;this.raw=null;return this.getRaw(function(){var a,d,e,f,g;f=b.subscribed;g=[];d=0;for(e=f.length;d<e;d++)a=f[d],g.push(a());return g})};n.prototype.subscribe=function(a){if(-1===_.indexOf(this.subscribed,a))return this.subscribed.push(a)};n.prototype.unsubscribe=function(a){return this.subscribed.splice(_.indexOf(this.subscribed,
a),1)};n.prototype.keys=function(){return this.key};n.prototype.rename=function(){return!0};n.prototype.renameMany=function(){return!0};n.prototype.remove=function(){return!1};n.prototype.filter=function(){return this};n.prototype.sort=function(){return this};n.prototype.derive=function(){return this};n.prototype.getMeta=function(a){return this.meta[a]};n.prototype.type=function(a){a=this.meta[a].type;return"num"===a?"number":a};n.prototype.get=function(a){return _.pluck(this.raw,a)};n.prototype.len=
function(){return this.raw.length};n.prototype.getObject=function(a){return this.raw[a]};n.prototype.max=function(a){return _.max(this.get(a))};n.prototype.min=function(a){return _.min(this.get(a))};h.Data=n;var fa=function(a,b){var c=this._wrap,d=this;this._wrap=function(){return c.apply(d,arguments)};this.dataObj=a.data;this.initialSpec=h.parser.layerToData(a);this.prevSpec=null;this.strictmode=b;this.statData=null;this.metaData={}};fa.prototype.reset=function(a){return this.make(this.initialSpec,
a)};fa.prototype.make=function(a,b){var c,d;c=h.parser.layerToData(a);d=this._wrap(b);this.strictmode&&d(this.dataObj.json,{});return this.dataObj.computeBackend?ec(c,this.dataObj,d):this.dataObj.getRaw(function(a,b){return cb(c,a,b,d)})};fa.prototype._wrap=function(a){var b=this;return function(c,d){b.statData=c;b.metaData=d;return a(b.statData,b.metaData)}};h.DataProcess=fa;h.data={};h.data.process=function(a,b,c,d){a=new fa(b,c);a.process(d);return a};kc={bin:function(a,b,c){var d,e;e=b.name;d=
b.binwidth;if("num"===c.type){if(isNaN(d))throw h.error.defn("The binwidth "+d+" is invalid for a numeric varliable");d=+d;b=function(b){return b[e]=d*Math.floor(b[a]/d)};return{trans:b,meta:{bw:d,binned:!0,type:"num"}}}if("date"===c.type){if(!(0<=lc.call(h["const"].timerange,d)))throw h.error.defn("The binwidth "+d+" is invalid for a datetime varliable");b=function(b){return"week"===d?b[e]=moment.unix(b[a]).day(0).unix():b[e]=moment.unix(b[a]).startOf(d).unix()};return{trans:b,meta:{bw:d,binned:!0,
type:"date"}}}},lag:function(a,b,c){var d;d=b.name;b=b.lag;var e,f;f=[];for(e=1;1<=b?e<=b:e>=b;1<=b?++e:--e)f.push(void 0);return{trans:function(b){f.push(b[a]);return b[d]=f.shift()},meta:{type:c.type}}}};jc=function(a,b,c){return kc[b.trans](a,b,null!=c?c:{})};gc={lt:function(a,b){return a<b},le:function(a,b){return a<=b},gt:function(a,b){return a>b},ge:function(a,b){return a>=b},"in":function(a,b){return 0<=lc.call(b,a)}};bb=function(a){var b;b=[];_.each(a,function(a,d){return _.each(a,function(a,
c){return b.push(function(b){return gc[c](b[d],a)})})});return function(a){var d,e,f;e=0;for(f=b.length;e<f;e++)if(d=b[e],!d(a))return!1;return!0}};hc={sum:function(){return function(a){return _.reduce(_.without(a,void 0,null),function(a,c){return a+c},0)}},count:function(){return function(a){return _.without(a,void 0,null).length}},uniq:function(){return function(a){return _.uniq(_.without(a,void 0,null)).length}},min:function(){return function(a){return _.min(a)}},max:function(){return function(a){return _.max(a)}},
median:function(){return function(a){return h.median(a)}},box:function(){return function(a){var b,c,d,e,f,g;c=a.length;return 5<c?(e=c/2,a=_.sortBy(a,function(a){return a}),b=Math.ceil(e)/2,0!==b%1?(b=Math.floor(b),e=a[b],c=a[c-1-b]):(e=(a[b]+a[b-1])/2,c=(a[c-b]+a[c-b-1])/2),b=c-e,d=e-1.5*b,f=c+1.5*b,b=_.groupBy(a,function(a){return a>=d&&a<=f}),{q1:_.min(b["true"]),q2:e,q3:h.median(a,!0),q4:c,q5:_.max(b["true"]),outliers:null!=(g=b["false"])?g:[]}):{outliers:a}}}};ic=function(a){return hc[a.stat](a)};
ab=function(a,b){var c,d;d={};_.each(b.stats,function(a){var b,c,h;b=a.key;c=a.name;h=ic(a);return d[c]=function(a){return h(_.pluck(a,b))}});c=h.groupBy(a,b.groups);return _.map(c,function(a){var c;c={};_.each(b.groups,function(b){return c[b]=a[0][b]});_.each(d,function(b,d){return c[d]=b(a)});return c})};fc=function(a,b,c){var d,e,f,g;f=b.sort;g=b.stat;d=b.limit;b=b.asc;g&&(g={stats:[g],groups:[a]},c=ab(c,g));e=b?1:-1;c.sort(function(a,b){return a[f]===b[f]?0:a[f]>=b[f]?1*e:-1*e});d&&(c=c.slice(0,
+(d-1)+1||9E9));a=_.uniq(_.pluck(c,a));return{meta:{levels:a,sorted:!0},filter:{"in":a}}};cb=function(a,b,c,d){var e,f,g,h,l,j,p,q,D,m,n;g=_.clone(b);null==c&&(c={});b=function(a,b){var d;return c[a]=_.extend(null!=(d=c[a])?d:{},b)};if(a.trans){n=a.trans;h=0;for(D=n.length;h<D;h++){p=n[h];l=p.key;j=jc(l,p,c[l]);e=j.trans;j=j.meta;q=0;for(m=g.length;q<m;q++)f=g[q],e(f);b(p.name,j)}}a.filter&&(g=_.filter(g,bb(a.filter)));if(a.meta){e={};p=a.meta;for(l in p)j=p[l],h=fc(l,j,g),j=h.meta,h=h.filter,e[l]=
h,b(l,j);g=_.filter(g,bb(e))}if(a.stats&&a.stats.stats&&0<a.stats.stats.length){g=ab(g,a.stats);j=a.stats.stats;a=0;for(l=j.length;a<l;a++)e=j[a],e=e.name,b(e,{type:"num"})}return d(g,c)};ec=function(){return console.log("backendProcess")};h.data.frontendProcess=cb;var mc,nc,oc,pc,qc,rc,sc,tc,ga,uc,y,db=function(a,b){return function(){return a.apply(b,arguments)}},Gc={}.hasOwnProperty,N=function(a,b){function c(){this.constructor=a}for(var d in b)Gc.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;
a.prototype=new c;a.__super__=b.prototype;return a};ga=h["const"].aes;y=h["const"].scaleFns;uc={x:y.novalue(),y:y.novalue(),color:"steelblue",size:2,opacity:0.9,shape:1};h.layer={};h.layer.toStrictMode=function(a){var b,c,d;c=0;for(d=ga.length;c<d;c++)b=ga[c],a[b]&&_.isString(a[b])&&(a[b]={"var":a[b]});return a};h.layer.make=function(a,b){switch(a.type){case "point":return new rc(a,b);case "text":return new sc(a,b);case "line":return new pc(a,b);case "path":return new qc(a,b);case "area":return new mc(a,
b);case "bar":return new nc(a,b);case "tile":return new tc(a,b);case "box":return new oc(a,b)}};var m=function(a,b){this._makeMappings=db(this._makeMappings,this);this.render=db(this.render,this);this.reset=db(this.reset,this);this.initialSpec=h.layer.toStrictMode(a);this.prevSpec=null;this.dataprocess=new h.DataProcess(this.initialSpec,b);this.pts={}};m.prototype.defaults=_.extend(uc,{size:7});m.prototype.reset=function(){return this.make(this.initialSpec)};m.prototype.make=function(a,b){var c,d=
this;c=h.layer.toStrictMode(a);this._makeMappings(c);this.dataprocess.make(c,function(a,c){d.statData=a;d.meta=c;if(null==d.statData)throw h.error.data("No data is passed into the layer");d._calcGeoms();return b()});return this.prevSpec=c};m.prototype._calcGeoms=function(){return this.geoms={}};m.prototype.getMeta=function(a){return this.mapping[a]?this.meta[this.mapping[a]]:{}};m.prototype.render=function(a){var b,c,d,e,f,g,k;f={};d=h.compare(_.keys(this.pts),_.keys(this.geoms));c=d.deleted;e=d.kept;
b=d.added;g=0;for(k=c.length;g<k;g++)d=c[g],this._delete(a,this.pts[d]);c=0;for(g=b.length;c<g;c++)d=b[c],f[d]=this._add(a,this.geoms[d]);b=0;for(c=e.length;b<c;b++)d=e[b],f[d]=this._modify(a,this.pts[d],this.geoms[d]);return this.pts=f};m.prototype._delete=function(a,b){var c,d,e;e=[];for(c in b)d=b[c],e.push(a.remove(d));return e};m.prototype._modify=function(a,b,c){var d,e,f,g;f={};g=c.marks;for(d in g)e=g[d],f[d]=a.animate(b[d],e,c.evtData);return f};m.prototype._add=function(a,b){var c,d,e,f;
e={};f=b.marks;for(c in f)d=f[c],e[c]=a.add(d,b.evtData);return e};m.prototype._makeMappings=function(a){var b,c,d,e;this.mapping={};this.consts={};e=[];c=0;for(d=ga.length;c<d;c++)b=ga[c],a[b]?(a[b]["var"]&&(this.mapping[b]=a[b]["var"]),a[b]["const"]?e.push(this.consts[b]=a[b]["const"]):e.push(void 0)):e.push(void 0);return e};m.prototype._getValue=function(a,b){return this.mapping[b]?a[this.mapping[b]]:this.consts[b]?y.identity(this.consts[b]):y.identity(this.defaults[b])};m.prototype._getIdFunc=
function(){var a=this;return null!=this.mapping.id?function(b){return a._getValue(b,"id")}:h.counter()};m.prototype._fillZeros=function(a,b){var c,d,e,f;f=[];d=0;for(e=a.length;d<e;d++)c=a[d],f.push(this._getValue(c,"x"));c=_.difference(b,f);f=f.concat(c);d=[];e=0;for(c=c.length;e<c;e++)d.push(0);var g,h;h=[];e=0;for(g=a.length;e<g;e++)c=a[e],h.push(this._getValue(c,"y"));return{x:f,y:h.concat(d)}};m.prototype._stack=function(a){var b,c,d,e,f,g,k=this;a=h.groupBy(this.statData,a);g=[];for(d in a)b=
a[d],e=0,f=null!=this.mapping.y?function(a){return a[k.mapping.y]}:function(){return 0},g.push(function(){var a,d,g;g=[];a=0;for(d=b.length;a<d;a++)c=b[a],c.$lower=e,e+=f(c),g.push(c.$upper=e);return g}());return g};var xa=function(){return xa.__super__.constructor.apply(this,arguments)};N(xa,m);xa.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,h,l;b=this._getIdFunc();this.geoms={};h=this.statData;l=[];f=0;for(g=h.length;f<g;f++){c=h[f];a={};for(d in c)e=c[d],a[d]={"in":[e]};l.push(this.geoms[b(c)]=
{marks:{"0":{type:"circle",x:this._getValue(c,"x"),y:this._getValue(c,"y"),color:this._getValue(c,"color"),size:this._getValue(c,"size"),opacity:this._getValue(c,"opacity")}},evtData:a})}return l};rc=xa;var ya=function(){return ya.__super__.constructor.apply(this,arguments)};N(ya,m);ya.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,k,l,j,p,q;d=_.without(_.keys(this.mapping),"x","y");q=[];b=0;for(c=d.length;b<c;b++)f=d[b],q.push(this.mapping[f]);b=h.groupBy(this.statData,q);d=this._getIdFunc();
this.geoms={};p=[];for(f in b){a=b[f];k=a[0];c={};l=0;for(j=q.length;l<j;l++)g=q[l],c[g]={"in":[k[g]]};p.push(this.geoms[d(k)]={marks:{"0":{type:"path",x:function(){var b,c,d;d=[];b=0;for(c=a.length;b<c;b++)e=a[b],d.push(this._getValue(e,"x"));return d}.call(this),y:function(){var b,c,d;d=[];b=0;for(c=a.length;b<c;b++)e=a[b],d.push(this._getValue(e,"y"));return d}.call(this),color:this._getValue(k,"color"),opacity:this._getValue(k,"opacity")}},evtData:c})}return p};qc=ya;var za=function(){return za.__super__.constructor.apply(this,
arguments)};N(za,m);za.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,k,l,j,p,q;a=_.uniq(function(){var a,b,c,d;c=this.statData;d=[];a=0;for(b=c.length;a<b;a++)f=c[a],d.push(this._getValue(f,"x"));return d}.call(this));var m;e=_.without(_.keys(this.mapping),"x","y");m=[];c=0;for(d=e.length;c<d;c++)g=e[c],m.push(this.mapping[g]);c=h.groupBy(this.statData,m);e=this._getIdFunc();this.geoms={};q=[];for(g in c){b=c[g];l=b[0];d={};j=0;for(p=m.length;j<p;j++)k=m[j],d[k]={"in":[l[k]]};k=this._fillZeros(b,
a);b=k.x;k=k.y;q.push(this.geoms[e(l)]={marks:{"0":{type:"line",x:b,y:k,color:this._getValue(l,"color"),opacity:this._getValue(l,"opacity")}},evtData:d})}return q};pc=za;var Aa=function(){return Aa.__super__.constructor.apply(this,arguments)};N(Aa,m);Aa.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,h,j;this._stack(null!=this.mapping.x?[this.mapping.x]:[]);b=this._getIdFunc();this.geoms={};h=this.statData;j=[];f=0;for(g=h.length;f<g;f++){c=h[f];a={};for(d in c)e=c[d],"y"!==d&&(a[this.mapping[d]]=
{"in":[e]});j.push(this.geoms[b(c)]={marks:{"0":{type:"rect",x:[y.lower(this._getValue(c,"x")),y.upper(this._getValue(c,"x"))],y:[c.$lower,c.$upper],color:this._getValue(c,"color"),opacity:this._getValue(c,"opacity")}},evtData:a})}return j};nc=Aa;var Ba=function(){return Ba.__super__.constructor.apply(this,arguments)};N(Ba,m);Ba.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,k,j,m,p,q,n,s,u,t;a=_.uniq(function(){var a,b,c,d;c=this.statData;d=[];a=0;for(b=c.length;a<b;a++)g=c[a],d.push(this._getValue(g,
"x"));return d}.call(this));b={};n=0;for(d=a.length;n<d;n++)j=a[n],b[j]=0;f=_.without(_.keys(this.mapping),"x","y");n=[];d=0;for(e=f.length;d<e;d++)k=f[d],n.push(this.mapping[k]);d=h.groupBy(this.statData,n);f=this._getIdFunc();this.geoms={};t=[];for(k in d){c=d[k];m=c[0];e={};q=0;for(p=n.length;q<p;q++)j=n[q],e[j]={"in":[m[j]]};s=p=q=void 0;s=[];q=0;for(p=a.length;q<p;q++)j=a[q],s.push(b[j]);q=s;s=0;for(u=c.length;s<u;s++)g=c[s],j=this._getValue(g,"x"),p=this._getValue(g,"y"),b[j]+=p;s=p=c=void 0;
s=[];c=0;for(p=a.length;c<p;c++)j=a[c],s.push(b[j]);c=s;t.push(this.geoms[f(m)]={marks:{"0":{type:"area",x:a,y:{bottom:q,top:c},color:this._getValue(m,"color"),opacity:this._getValue(m,"opacity")}},evtData:e})}return t};mc=Ba;var Ca=function(){return Ca.__super__.constructor.apply(this,arguments)};N(Ca,m);Ca.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,h,j;b=this._getIdFunc();this.geoms={};h=this.statData;j=[];f=0;for(g=h.length;f<g;f++){c=h[f];a={};for(d in c)e=c[d],a[d]={"in":[e]};j.push(this.geoms[b(c)]=
{marks:{"0":{type:"text",x:this._getValue(c,"x"),y:this._getValue(c,"y"),text:this._getValue(c,"text"),color:this._getValue(c,"color"),size:this._getValue(c,"size"),opacity:this._getValue(c,"opacity"),"text-anchor":"center"}},evtData:a})}return j};sc=Ca;var Da=function(){return Da.__super__.constructor.apply(this,arguments)};N(Da,m);Da.prototype._calcGeoms=function(){var a,b,c,d,e,f,g;b=this._getIdFunc();this.geoms={};f=this.statData;g=[];d=0;for(e=f.length;d<e;d++)c=f[d],a={},this._getValue(c,"x"),
this._getValue(c,"y"),g.push(this.geoms[b(c)]={marks:{"0":{type:"rect",x:[y.lower(this._getValue(c,"x")),y.upper(this._getValue(c,"x"))],y:[y.lower(this._getValue(c,"y")),y.upper(this._getValue(c,"y"))],color:this._getValue(c,"color"),size:this._getValue(c,"size"),opacity:this._getValue(c,"opacity")}},evtData:a});return g};tc=Da;var Ea=function(){return Ea.__super__.constructor.apply(this,arguments)};N(Ea,m);Ea.prototype._calcGeoms=function(){var a,b,c,d,e,f,g,h,j,m,p,q,n;b=this._getIdFunc();this.geoms=
{};p=this.statData;n=[];h=0;for(j=p.length;h<j;h++){d=p[h];a={};f=this._getValue(d,"x");g=this._getValue(d,"y");c=y.lower(f);e=y.upper(f);f=y.middle(f);a={marks:{},evtData:a};g.q1&&(a.marks={iqr:{type:"rect",x:[c,e],y:[g.q2,g.q4],stroke:this._getValue(d,"color"),color:y.identity("white"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity"),"stroke-width":"1px"},q1:{type:"pline",x:[c,e],y:[g.q1,g.q1],color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,
"opacity")},lower:{type:"pline",x:[f,f],y:[g.q1,g.q2],color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")},q5:{type:"pline",x:[c,e],y:[g.q5,g.q5],color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")},upper:{type:"pline",x:[f,f],y:[g.q4,g.q5],color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")},middle:{type:"pline",x:[c,e],y:[g.q3,g.q3],color:this._getValue(d,"color"),
size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")}});q=g.outliers;c=g=0;for(m=q.length;g<m;c=++g)e=q[c],a.marks[c]={type:"circle",x:f,y:e,color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")};n.push(this.geoms[b(d)]=a)}return n};oc=Ea;h.dim={};h.dim.make=function(a,b,c){var d,e,f,g,h,j,m;a={width:null!=(e=a.width)?e:400,height:null!=(f=a.height)?f:400,paddingLeft:null!=(g=a.paddingLeft)?g:10,paddingRight:null!=(h=a.paddingRight)?h:10,paddingTop:null!=
(j=a.paddingTop)?j:10,paddingBottom:null!=(m=a.paddingBottom)?m:10,guideTop:10,guideRight:0,guideLeft:5,guideBottom:5};for(d in b)e=b[d],e=e.getDimension(),"left"===e.position?a.guideLeft+=e.width:"right"===e.position?a.guideRight+=e.width:"bottom"===e.position?a.guideBottom+=e.height:"top"===e.position&&(a.guideTop+=e.height);f=a.height-a.guideTop-a.paddingTop;h=d=b=g=0;for(j=c.length;h<j;h++)e=c[h],e=e.getDimension(),e.height+d>f&&(b+=g+5,g=d=0),e.width>g&&(g=e.width),d+=e.height;a.guideRight+=
b+g;a.chartHeight=a.height-a.paddingTop-a.paddingBottom-a.guideTop-a.guideBottom;a.chartWidth=a.width-a.paddingLeft-a.paddingRight-a.guideLeft-a.guideRight;return a};h.dim.guess=function(a){var b,c,d,e,f,g;a={width:null!=(b=a.width)?b:400,height:null!=(c=a.height)?c:400,paddingLeft:null!=(d=a.paddingLeft)?d:10,paddingRight:null!=(e=a.paddingRight)?e:10,paddingTop:null!=(f=a.paddingTop)?f:10,paddingBottom:null!=(g=a.paddingBottom)?g:10,guideLeft:30,guideRight:40,guideTop:10,guideBottom:30};a.chartHeight=
a.height-a.paddingTop-a.paddingBottom-a.guideTop-a.guideBottom;a.chartWidth=a.width-a.paddingLeft-a.paddingRight-a.guideLeft-a.guideRight;return a};var eb,fb,vc,Fa,gb,wc,xc,hb,ib,Hc={}.hasOwnProperty,O=function(a,b){function c(){this.constructor=a}for(var d in b)Hc.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};h.paper=function(a,b,c,d){var e,f,g;if(!("undefined"!==typeof Raphael&&null!==Raphael))throw h.error.depn("The dependency Raphael is not included.");
a=Raphael(a,b,c);b=a.rect(0,0,b,c).attr("stroke-width",0);b.click(d("reset"));f=d("select");g=e=null;b.drag(function(a,b,c,d){return null!=g?e={x:d,y:c}:g={x:d,y:c}},function(){return e=g=null},function(){if(null!=g&&null!=e)return f({start:g,end:e})});return a};h.render=function(a,b,c,d,e,f){return{add:function(g,h){var j;j=ib[d.type][g.type].render(b,c,d,g,e);null!=f&&j.attr("clip-rect",f);h&&0<_.keys(h).length&&(j.data("e",h),j.click(a("click")),j.hover(a("mover"),a("mout")));return j},remove:function(a){return a.remove()},
animate:function(a,b,f){ib[d.type][b.type].animate(a,c,d,b,e);f&&0<_.keys(f).length&&a.data("e",f);return a}}};var z=function(){};z.prototype.render=function(a,b,c,d,e){var f;a=this._make(a);c=this.attr(b,c,d,e);for(f in c)b=c[f],a.attr(f,b);return a};z.prototype._make=function(){throw h.error.impl();};z.prototype.animate=function(a,b,c,d,e){return a.animate(this.attr(b,c,d,e),300)};z.prototype.attr=function(){throw h.error.impl();};z.prototype._makePath=function(a,b,c){null==c&&(c="L");return _.map(a,
function(a,e){return(0===e?"M":c)+a+" "+b[e]}).join(" ")};z.prototype._maybeApply=function(a,b,c){b=b[c];return _.isObject(b)&&"identity"===b.f?b.v:null!=a[c]?a[c].f(b):b};z.prototype._shared=function(a,b,c){var d,e=this;d=function(d){if(null!=b[d]&&null==c[d])return c[d]=e._maybeApply(a,b,d)};d("opacity");d("stroke-width");d("stroke-dasharray");d("stroke-dashoffset");d("transform");return c};var ha=function(){return ha.__super__.constructor.apply(this,arguments)};O(ha,z);ha.prototype._make=function(a){return a.circle()};
ha.prototype.attr=function(a,b,c,d){var e;d=b.getXY(d,c);b=d.x;e=d.y;d=this._maybeApply(a,c,c.stroke?"stroke":"color");b={cx:b,cy:e,r:this._maybeApply(a,c,"size"),stroke:d};if((d=this._maybeApply(a,c,"color"))&&"none"!==d)b.fill=d;return this._shared(a,c,b)};fb=ha;var ia=function(){return ia.__super__.constructor.apply(this,arguments)};O(ia,z);ia.prototype._make=function(a){return a.path()};ia.prototype.attr=function(a,b,c,d){var e;d=b.getXY(d,c);b=d.x;e=d.y;d=this._maybeApply(a,c,c.stroke?"stroke":
"color");return this._shared(a,c,{path:this._makePath(b,e),stroke:d})};gb=ia;var ja=function(){return ja.__super__.constructor.apply(this,arguments)};O(ja,z);ja.prototype._make=function(a){return a.path()};ja.prototype.attr=function(a,b,c,d){var e;e=h.sortArrays(a.x.sortfn,[c.x,c.y]);c.x=e[0];c.y=e[1];d=b.getXY(d,c);b=d.x;e=d.y;d=this._maybeApply(a,c,c.stroke?"stroke":"color");return this._shared(a,c,{path:this._makePath(b,e),stroke:d})};Fa=ja;var ka=function(){return ka.__super__.constructor.apply(this,
arguments)};O(ka,z);ka.prototype._make=function(a){return a.path()};ka.prototype.attr=function(a,b,c,d){var e,f,g,j,l,m;b=b.getXY(d,c);l=b.x;m=b.y;d=b.r;j=b.t;debugger;var p,n;if(_.max(d)-_.min(d)<h["const"].epsilon){d=d[0];b="M "+l[0]+" "+m[0];f=p=1;for(n=l.length-1;1<=n?p<=n:p>=n;f=1<=n?++p:--p)g=Math.abs(j[f]-j[f-1])>Math.PI?1:0,e=0<j[f]-j[f-1]?1:0,b+="A "+d+" "+d+" 0 "+g+" "+e+" "+l[f]+" "+m[f]}else b=this._makePath(l,m);d=this._maybeApply(a,c,c.stroke?"stroke":"color");return this._shared(a,
c,{path:b,stroke:d})};wc=ka;var la=function(){return la.__super__.constructor.apply(this,arguments)};O(la,z);la.prototype._make=function(a){return a.path()};la.prototype.attr=function(a,b,c,d){var e,f,g;e=h.sortArrays(a.x.sortfn,[c.x,c.y.top]);f=e[0];g=e[1];e=b.getXY(d,{x:f,y:g});g=h.sortArrays(function(b){return-a.x.sortfn(b)},[c.x,c.y.bottom]);f=g[0];g=g[1];b=b.getXY(d,{x:f,y:g});f=e.x.concat(b.x);g=e.y.concat(b.y);return this._shared(a,c,{path:this._makePath(f,g),stroke:this._maybeApply(a,c,"color"),
fill:this._maybeApply(a,c,"color"),"stroke-width":"0px"})};eb=la;var ma=function(){return ma.__super__.constructor.apply(this,arguments)};O(ma,z);ma.prototype._make=function(a){return a.rect()};ma.prototype.attr=function(a,b,c,d){var e;d=b.getXY(d,c);b=d.x;e=d.y;d=this._maybeApply(a,c,c.stroke?"stroke":"color");return this._shared(a,c,{x:_.min(b),y:_.min(e),width:Math.abs(b[1]-b[0]),height:Math.abs(e[1]-e[0]),fill:this._maybeApply(a,c,"color"),stroke:d,"stroke-width":this._maybeApply(a,c,"stroke-width")})};
xc=ma;var na=function(){return na.__super__.constructor.apply(this,arguments)};O(na,z);na.prototype._make=function(a){return a.path()};na.prototype.attr=function(a,b,c,d){var e,f,g,h;h=c.x;g=h[0];h=h[1];e=c.y;f=e[0];e=e[1];c.x=[g,g,h,h];c.y=[f,e,e,f];f=b.getXY(d,c);g=f.x;h=f.y;d=f.r;f=f.t;b.flip&&(g.push(g.splice(0,1)[0]),h.push(h.splice(0,1)[0]),d.push(d.splice(0,1)[0]),f.push(f.splice(0,1)[0]));e=Math.abs(f[1]-f[0])>Math.PI?1:0;b="M "+g[0]+" "+h[0]+" A "+d[0]+" "+d[0]+" 0 "+e+" 1 "+g[1]+" "+h[1];
e=Math.abs(f[3]-f[2])>Math.PI?1:0;b+="L "+g[2]+" "+h[2]+" A "+d[2]+" "+d[2]+" 0 "+e+" 0 "+g[3]+" "+h[3]+" Z";d=this._maybeApply(a,c,c.stroke?"stroke":"color");return this._shared(a,c,{path:b,fill:this._maybeApply(a,c,"color"),stroke:d,"stroke-width":this._maybeApply(a,c,"stroke-width")})};vc=na;var oa=function(){return oa.__super__.constructor.apply(this,arguments)};O(oa,z);oa.prototype._make=function(a){return a.text()};oa.prototype.attr=function(a,b,c,d){var e;b=b.getXY(d,c);return this._shared(a,
c,{x:b.x,y:b.y,r:10,text:this._maybeApply(a,c,"text"),"text-anchor":null!=(e=c["text-anchor"])?e:"left",fill:this._maybeApply(a,c,"color")||"black"})};hb=oa;ib={cartesian:{circle:new fb,line:new Fa,pline:new Fa,area:new eb,path:new gb,text:new hb,rect:new xc},polar:{circle:new fb,path:new gb,line:new Fa,pline:new wc,area:new eb,text:new hb,rect:new vc}};var Ga=function(a,b){return function(){return a.apply(b,arguments)}},C=function(a){this._legacy=Ga(this._legacy,this);this.handleEvent=Ga(this.handleEvent,
this);this.merge=Ga(this.merge,this);this.reset=Ga(this.reset,this);var b;if(null==a)throw h.error.defn("No graph specification is passed in!");this.handlers=[];this.paper=this.dims=this.legends=this.axes=this.scaleSet=this.layers=null;this.coord=null!=(b=a.coord)?b:h.coord.cartesian();this.initial_spec=a;this.dataSubscribed=!1;this.make(a)};C.prototype.reset=function(){if(null==this.initial_spec)throw h.error.defn("No graph specification is passed in!");return this.make(this.initial_spec)};C.prototype.make=
function(a){var b,c,d,e,f,g,j;null==a&&(a=this.initial_spec);this.spec=a;if(null==a.layers)throw h.error.defn("No layers are defined in the specification.");null==this.layers&&(this.layers=this._makeLayers(this.spec));if(!this.dataSubscribed){b=this.handleEvent("data");e=this.layers;c=d=0;for(e=e.length;d<e;c=++d){if(null==a.layers[c].data)throw h.error.defn("Layer "+c+" does not have data to plot!");a.layers[c].data.subscribe(b)}this.dataSubscribed=!0}d=_.after(this.layers.length,this.merge);g=this.layers;
j=[];c=e=0;for(f=g.length;e<f;c=++e)b=g[c],j.push(b.make(a.layers[c],d));return j};C.prototype.merge=function(){var a,b,c,d,e,f;b=this._makeDomains(this.spec,this.layers);null==this.scaleSet&&(this.scaleSet=this._makeScaleSet(this.spec,b));this.scaleSet.make(this.spec.guides,b,this.layers);this.dims||(this.dims=this._makeDimensions(this.spec,this.scaleSet),this.coord.make(this.dims),this.ranges=this.coord.ranges());this.scaleSet.setRanges(this.ranges);this._legacy(b);if(!(null!=this.spec.render&&
!1===this.spec.render)){if(!this.spec.dom)throw h.error.defn("No DOM element specified. Where to make plot?");a=this.spec.dom;b=this.scaleSet.scales;this.coord.setScales(b);this.scaleSet.coord=this.coord;null==this.paper&&(this.paper=this._makePaper(a,this.dims.width,this.dims.height,this.handleEvent));a=this.coord.clipping(this.dims);c=h.render(this.handleEvent,this.paper,b,this.coord,!0,a);f=this.layers;d=0;for(e=f.length;d<e;d++)a=f[d],a.render(c);c=h.render(this.handleEvent,this.paper,b,this.coord,
!1);this.scaleSet.makeAxes();this.scaleSet.renderAxes(this.dims,c);this.scaleSet.makeLegends();return this.scaleSet.renderLegends(this.dims,c)}};C.prototype.addHandler=function(a){return this.handlers.push(a)};C.prototype.removeHandler=function(a){return this.handlers.splice(_.indexOf(this.handlers,a),1)};C.prototype.handleEvent=function(a){var b;b=this;return _.throttle(function(c){var d,e,f,g;"select"===a?(d=c.start,c=c.end,this.evtData=b.scaleSet.fromPixels(d,c)):this.evtData="data"===a?{}:this.data("e");
f=b.handlers;g=[];c=0;for(e=f.length;c<e;c++)d=f[c],_.isFunction(d)?g.push(d(a,this)):g.push(d.handle(a,this));return g},1E3)};C.prototype._makeLayers=function(a){return _.map(a.layers,function(b){return h.layer.make(b,a.strict)})};C.prototype._makeDomains=function(a,b){null==a.guides&&(a.guides={});return h.domain.make(b,a.guides,a.strict)};C.prototype._makeScaleSet=function(a){this.coord.make(h.dim.guess(a));a=this.coord.ranges();return h.scaleset(a,this.coord)};C.prototype._makeDimensions=function(a,
b){return h.dim.make(a,b.makeAxes(),b.makeLegends())};C.prototype._makePaper=function(a,b,c,d){_.isString(a)&&(a=document.getElementById(a));return h.paper(a,b,c,d)};C.prototype._legacy=function(a){var b,c,d;this.domains=a;this.scales=this.scaleSet.scales;a=this.scaleSet.makeAxes();this.ticks={};d=[];for(b in a)c=a[b],d.push(this.ticks[b]=c.ticks);return d};h.chart=function(a){return new C(a)}}return h}(window.polyjs);
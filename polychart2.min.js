window.polyjs=function(Q){if(!Q){var d={};(function(){var g=[].indexOf||function(d){for(var l=0,c=this.length;l<c;l++)if(l in this&&this[l]===d)return l;return-1};d.groupBy=function(g,l){return _.groupBy(g,d.stringify(l))};d.stringify=function(d){return function(l){return _.reduce(d,function(c,b){return""+c+b+":"+l[b]+";"},"")}};d.cross=function(g,l){var c,b,e,f,h,r,m,q,v,s;null==l&&(l=[]);e=_.difference(_.keys(g),l);if(0===e.length)return[{}];c=[];f=e[0];e=d.cross(g,l.concat(f));s=g[f];r=0;for(q=
s.length;r<q;r++)for(h=s[r],m=0,v=e.length;m<v;m++)b=e[m],b=_.clone(b),b[f]=h,c.push(b);return c};d.filter=function(d,l,c){var b,e,f,h;e=[];f=0;for(h=d.length;f<h;f++)b=d[f],b[l]===c&&e.push(b);return e};d.intersect=function(d,l){var c,b,e,f,h;b=function(b){var c,e,f,s,u;e=[];u=d[b]["in"];f=0;for(s=u.length;f<s;f++)c=u[f],0<=g.call(l[b]["in"],c)&&e.push(c);return{"in":e}};c=function(b){var c,e,f,s,u;e=function(c){return c[b].lt?{type:"lt",val:c[b].lt}:c[b].le?{type:"le",val:c[b].le}:{type:null,val:null}};
c=function(c){return c[b].gt?{type:"gt",val:c[b].gt}:c[b].ge?{type:"ge",val:c[b].ge}:{type:null,val:null}};c=[c(d),c(l)];s=[e(d),e(l)];c.sort(function(b,c){return c.val-b.val});s.sort(function(b,c){return b.val-c.val});e={};c[0].type&&c[0].val&&(u=c[0],f=u.type,u=u.val,c[0].val===c[1].val&&c[0].type!==c[1].type&&(f="lt"),e[f]=u);s[0].type&&s[0].val&&(u=s[0],f=u.type,u=u.val,s[0].val===s[1].val&&s[0].type!==s[1].type&&(f="lt"),e[f]=u);if(c[0].type&&s[0].type&&(c[0].val>s[0].val||c[0].val===s[0].val&&
("lt"===c[0].key||"gt"===s[0].key)))throw"No intersection found!";return e};f={};for(e in d)h=d[e],f[e]=e in l?"in"in d[e]?b(e):c(e):h;for(e in l)h=l[e],e in f||(f[e]=h);return f};d.linear=function(g,l,c,b){if(_.isFinite(g)&&_.isFinite(l)&&_.isFinite(c)&&_.isFinite(b))return function(e){return(b-l)/(c-g)*(e-g)+l};throw d.error.input("Attempting to create linear function from infinity");};d.median=function(d,l){var c;null==l&&(l=!1);l||(d=_.sortBy(d,function(b){return b}));c=d.length/2;return 0!==
c%1?d[Math.floor(c)]:(d[c-1]+d[c])/2};d.counter=function(){var d;d=0;return function(){return d++}};d.sample=function(d,l){return _.pick(d,_.shuffle(_.keys(d)).splice(0,l))};d.compare=function(d,l){var c,b,e,f,h,r,m,q,v;v=_.sortBy(d,function(b){return b});q=_.sortBy(l,function(b){return b});b=[];e=[];c=[];for(m=h=0;m<v.length||h<q.length;)if(r=v[m],f=q[h],m>=v.length)c.push(f),h+=1;else if(h>=q.length)b.push(r),m+=1;else if(r<f)b.push(r),m+=1;else if(r>f)c.push(f),h+=1;else if(r===f)e.push(r),m+=
1,h+=1;else throw DataError("Unknown data encounted");return{deleted:b,kept:e,added:c}};d.flatten=function(g){var l,c,b,e;l=[];if(null!=g)if(_.isObject(g))if("scalefn"===g.t)"novalue"!==g.f&&l.push(g.v);else for(c in g)b=g[c],l=l.concat(d.flatten(b));else if(_.isArray(g))for(c=0,e=g.length;c<e;c++)b=g[c],l=l.concat(d.flatten(b));else l.push(g);return l};d.getLabel=function(d,l){return _.chain(d).map(function(c){return c.mapping[l]}).without(null,void 0).uniq().value().join(" | ")};d.strSize=function(d){d=
(d+"").length;return 10>d?6*d:5*(d-10)+60};d.sortArrays=function(d,l){var c;c=_.zip.apply(_,l);c.sort(function(b,c){return d(b[0],c[0])});return _.zip.apply(_,c)};d.isDefined=function(g){return _.isObject(g)?"scalefn"===g.t&&"novalue"!==g.f?d.isDefined(g.v):!0:void 0!==g&&null!==g&&!(_.isNumber(g)&&_.isNaN(g))};d.isURI=function(d){var l;return _.isString(d)?(l=RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$",
"i"),l.test(d)):!1}}).call(this);(function(){d["const"]={aes:"x y color size opacity shape id text".split(" "),noDomain:["id","text","tooltip"],noLegend:["x","y","id","text","tooltip"],trans:{bin:["key","binwidth"],lag:["key","lag"]},stat:{count:["key"],unique:["key"],sum:["key"],mean:["key"],box:["key"],median:["key"]},timerange:"second minute hour day week month twomonth quarter sixmonth year twoyear fiveyear decade".split(" "),metas:{sort:null,stat:null,limit:null,asc:!1},scaleFns:{novalue:function(){return{v:null,
f:"novalue",t:"scalefn"}},max:function(d){return{v:d,f:"max",t:"scalefn"}},min:function(d){return{v:d,f:"min",t:"scalefn"}},upper:function(d,n,l){return{v:d,n:n,m:l,f:"upper",t:"scalefn"}},lower:function(d,n,l){return{v:d,n:n,m:l,f:"lower",t:"scalefn"}},middle:function(d){return{v:d,f:"middle",t:"scalefn"}},jitter:function(d){return{v:d,f:"jitter",t:"scalefn"}},identity:function(d){return{v:d,f:"identity",t:"scalefn"}}},epsilon:Math.pow(10,-7),defaults:{x:{v:null,f:"novalue",t:"scalefn"},y:{v:null,
f:"novalue",t:"scalefn"},color:"steelblue",size:2,opacity:0.7}}}).call(this);(function(){var g,n,l,c,b,e,f,h,r,m={}.hasOwnProperty,q=function(b,c){function u(){this.constructor=b}for(var k in c)m.call(c,k)&&(b[k]=c[k]);u.prototype=c.prototype;b.prototype=new u;b.__super__=c.prototype;return b};n=function(b){function c(b){this.message=b;this.name="DefinitionError"}q(c,b);return c}(Error);l=function(b){function c(b){this.message=b;this.name="DependencyError"}q(c,b);return c}(Error);b=function(b){function c(b){this.message=
b;this.name="ModeError"}q(c,b);return c}(Error);g=function(b){function c(b){this.message=b;this.name="DataError"}q(c,b);return c}(Error);r=function(b){function c(b){this.message=b;this.name="UnknownInput"}q(c,b);return c}(Error);e=function(b){function c(b){this.message=b;this.name="ModeError"}q(c,b);return c}(Error);f=function(b){function c(b){this.message=b;this.name="ScaleError"}q(c,b);return c}(Error);c=function(b){function c(b){this.message=b;this.name="MissingData"}q(c,b);return c}(Error);h=
function(b){function c(b){this.message=b;this.name="Type"}q(c,b);return c}(Error);d.error=function(b){return Error(b)};d.error.data=function(b){return new g(b)};d.error.depn=function(b){return new l(b)};d.error.defn=function(b){return new n(b)};d.error.mode=function(c){return new b(c)};d.error.impl=function(b){return new e(b)};d.error.input=function(b){return new r(b)};d.error.scale=function(b){return new f(b)};d.error.missing=function(b){return new c(b)};d.error.type=function(b){return new h(b)}}).call(this);
(function(){var g,n,l,c,b,e,f={}.hasOwnProperty,h=function(b,c){function d(){this.constructor=b}for(var e in c)f.call(c,e)&&(b[e]=c[e]);d.prototype=c.prototype;b.prototype=new d;b.__super__=c.prototype;return b},r=function(b,c){return function(){return b.apply(c,arguments)}};c=function(){function b(){}b.prototype.render=function(){return d.error.impl()};b.prototype.dispose=function(){return d.error.impl()};return b}();n=function(c){function e(){return b=e.__super__.constructor.apply(this,arguments)}
h(e,c);e.prototype.getDimension=function(){throw d.error.impl();};return e}(c);l=function(b){function c(){return e=c.__super__.constructor.apply(this,arguments)}h(c,b);c.prototype.getDimension=function(){throw d.error.impl();};c.prototype.make=function(){throw d.error.impl();};return c}(c);g=function(b){function c(b){this.type=null!=b?b:null;this.dispose=r(this.dispose,this);this.geoms={};this.pts={}}h(c,b);c.prototype.set=function(b){return this.geoms=b};c.prototype.render=function(b){var c,u,k,
e,p,t,f;p={};k=d.compare(_.keys(this.pts),_.keys(this.geoms));u=k.deleted;e=k.kept;c=k.added;t=0;for(f=u.length;t<f;t++)k=u[t],this._delete(b,this.pts[k]);u=0;for(t=c.length;u<t;u++)k=c[u],p[k]=this._add(b,this.geoms[k]);c=0;for(u=e.length;c<u;c++)k=e[c],p[k]=this._modify(b,this.pts[k],this.geoms[k]);return this.pts=p};c.prototype._delete=function(b,c){var e,k,d;d=[];for(e in c)k=c[e],d.push(b.remove(k));return d};c.prototype._modify=function(b,c,e){var k,d,p,t;p={};t=e.marks;for(d in t){k=t[d];try{p[d]=
c[d]?c[d].data("m").type===k.type?b.animate(c[d],k,e.evtData,e.tooltip):(b.remove(c[d]),b.add(k,e.evtData,e.tooltip,this.type)):b.add(k,e.evtData,e.tooltip,this.type)}catch(f){if(k=f,"MissingData"===k.name)console.log(k.message);else throw k;}}return p};c.prototype._add=function(b,c){var e,k,d,p;d={};p=c.marks;for(k in p){e=p[k];try{d[k]=b.add(e,c.evtData,c.tooltip,this.type)}catch(t){if(e=t,"MissingData"===e.name)console.log(e.message);else throw e;}}return d};c.prototype.dispose=function(b){var c,
e,k;k=this.pts;for(c in k)e=k[c],this._delete(b,e);return this.pts={}};return c}(c);d.Renderable=c;d.Guide=n;d.GuideSet=l;d.Geometry=g}).call(this);(function(){var g,n,l=[].slice;g=function(){function c(b,c,d){b.getContext?this.context=b.getContext("2d"):b.polyGeom=this;b.width=c;b.height=d;this.items=[];this._counter=0}c.prototype._makeItem=function(b,c){var d;d=new n(b,this._newId(),this,c);this.items.push(d);return d};c.prototype._newId=function(){return this._counter+=1};c.prototype.rect=function(){var b;
b=1<=arguments.length?l.call(arguments,0):[];return this._makeItem("rect",b)};c.prototype.circle=function(){var b;b=1<=arguments.length?l.call(arguments,0):[];return this._makeItem("circle",b)};c.prototype.path=function(){var b;b=1<=arguments.length?l.call(arguments,0):[];return this._makeItem("path",b)};c.prototype.text=function(){var b;b=1<=arguments.length?l.call(arguments,0):[];return this._makeItem("text",b)};c.prototype.remove=function(b){var c,d,h,l,m;m=this.items;d=h=0;for(l=m.length;h<l;d=
++h)if(c=m[d],d.id===b)return this.items.splice(c,1)};c.prototype.toBack=function(b){b=this.remove(b)[0];return a.push(b)};c.prototype.toFront=function(b){b=this.remove(b)[0];return a.unshift(b)};c.prototype._resetContext=function(){this.context.fillStyle="#000000";this.context.strokeStyle="#000000";this.context.globalAlpha=1;return this.context.lineWidth=0.5};c.prototype._stringToHex=function(b){switch(b){case "black":return"#000000";case "white":return"#ffffff";case "steelblue":return"#4692B4";
default:return b}};return c}();n=function(){function c(b,c,d,h){this.type=b;this.id=c;this.canvas=d;this._attr={};this._interact={};this.attr(h)}c.prototype.attr=function(b){var c,f,h;if(1===b.len&&_.isObject(b[0])){f=b[0];h=[];for(c in f)b=f[c],h.push(this._attr[c]=b);return h}if(2===b.len&&null!=b[0]&&null!=b[1])return this._attr[b[0]]=b[1];if(2<b.len)switch(this.type){case "rect":return this._attr=_.extend(this._attr,{x:b[0],y:b[1],width:b[2],height:b[3]});case "circle":return this._attr=_.extend(this._attr,
{x:b[0],y:b[1],r:b[2]});case "path":return this._attr=_.extend(this._attr,{path:b[0]});case "text":return this._attr=_.extend(this._attr,{x:b[0],y:b[1],text:b[2]});default:throw d.error.defn("Unknown geometry type!");}};c.prototype.remove=function(){return this.canvas.remove(this.id)};c.prototype.toBack=function(){return this.canvas.toBack(this.id)};c.prototype.toFront=function(){return this.canvas.toFront};c.prototype.animate=function(){var b;b=1<=arguments.length?l.call(arguments,0):[];return this._attr.animate=
b};c.prototype.click=function(b){return this._interact.click=b};c.prototype.drag=function(b,c,d){return this._interact.drag={onmove:b,onstart:c,onend:d}};c.prototype.hover=function(b){return this._interact.hover=b};c.prototype.data=function(b,c){var d;null==(d=this._interact).data&&(d.data={});return this._interact.data[b]=c};c.prototype.touchstart=function(b){return this._interact.touchstart=b};c.prototype.touchend=function(b){return this._interact.touchend=b};c.prototype.touchmove=function(b){return this._interact.touchmove=
b};c.prototype.touchcancel=function(b){return this._interact.touchcancel=b};return c}();d.canvas=function(c,b,d){return new g(c,b,d)}}).call(this);(function(){var g,n;d.offset=function(d){var c,b,e;c={top:0,left:0};if(b=d&&d.ownerDocument)return e=b.documentElement,"undefined"!==typeof d.getBoundingClientRect&&(c=d.getBoundingClientRect()),d=null!==b&&b===b.window?b:9===b.nodeType&&b.defaultView,{top:c.top+d.pageYOffset-e.clientTop,left:c.left+d.pageXOffset-e.clientLeft}};d.getXY=function(d,c){var b,
e;-1!==c.type.indexOf("mouse")?(e=c.clientX,b=c.clientY):-1!==c.type.indexOf("touch")&&(b=c.changedTouches[0],e=b.clientX,b=b.clientY);return{x:e+(document.documentElement&&document.documentElement.scrollLeft||document.body.scrollLeft)-d.left,y:b+(document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop)-d.top}};d.touchToMouse=function(d,c,b){var e,f,h;null==b&&(b=!1);e=c.lastEvent;h=0<e.touches.length&&e.touches[0]||0<e.changedTouches.length&&e.changedTouches[0];f=document.createEvent("MouseEvent");
f.initMouseEvent(d,e.bubbles,e.cancelable,e.view,e.detail,h.screenX,h.screenY,h.clientX,h.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,1,e.target);return b?(window.clearTimeout(c.pressTimer),c.pressTimer=window.setTimeout(function(){return e.target.dispatchEvent(f)},b)):e.target.dispatchEvent(f)};g={lastStart:0,lastTouch:0,lastEvent:null,pressTimer:0};n=window.alert;d.touch=function(l,c,b,e){c.tooltip=c.data("t");c.evtData=c.data("e");g.lastEvent=b;b.preventDefault();if("touchstart"===l)return g.lastStart=
b.timeStamp,d.touchToMouse("mousedown",g),g.pressTimer=window.setTimeout(function(){return d.touchToMouse("mouseover",g)},800),window.alert=function(){var b;window.clearTimeout(g.pressTimer);b=arguments;return window.setTimeout(function(){n.apply(window,b);return window.alert=n},100)};if("touchmove"===l){l=e.paper.getById(b.target.raphaelid);e=d.offset(e.dom);e=d.getXY(e,b);if(600<b.timeStamp-g.lastStart&&l.isPointInside(e.x,e.y))return d.touchToMouse("mouseover",g);window.clearTimeout(g.pressTimer);
return d.touchToMouse("mouseout",g)}if("touchend"===l){if(window.clearTimeout(g.pressTimer),d.touchToMouse("mouseup",g),d.touchToMouse("mouseout",g,400),800>b.timeStamp-g.lastStart)return d.touchToMouse("click",g)}else if("touchcancel"===l)return window.clearTimeout(g.pressTimer),d.touchToMouse("mouseout",g),d.touchToMouse("mouseup",g,300)}}).call(this);(function(){var g,n,l;d.format=function(c,b){switch(c){case "cat":return d.format.identity;case "num":return d.format.number(b);case "date":return d.format.date(b);
case "none":return d.format.identity}};d.format.identity=function(c){return c};g={0:"",3:"k",6:"m",9:"b",12:"t"};l=function(c,b){return _.isUndefined(g[b])?c+"e"+(0<b?"+":"-")+Math.abs(b):c+g[b]};n=function(c){var b,d,f;if(!isFinite(c))return c;d=""+c;b=Math.abs(c);1E4<=b&&(f=(""+b).split(/\./),b=f[0].length%3||3,f[0]=d.slice(0,b+(0>c))+f[0].slice(b).replace(/(\d{3})/g,",$1"),d=f.join("."));return d};d.format.number=function(c){return function(b){var d,f;f=0;d=null!=c?c:Math.floor(Math.log(Math.abs(0===
b?1:b))/Math.LN10);null==c||2!==d&&5!==d&&8!==d&&11!==d?-1===d?(d=0,f=null!=c?1:2):-2===d?(d=0,f=null!=c?2:3):1===d||2===d?d=0:3<d&&6>d?d=3:6<d&&9>d?d=6:9<d&&12>d?d=9:12<d&&15>d?d=12:f=null!=c?0:1:(d+=1,f=1);b=Math.round(b/Math.pow(10,d-f));b/=Math.pow(10,f);b=b.toFixed(f);return l(n(b),d)}};d.format.date=function(c){return-1!==_.indexOf(d["const"].timerange,c)?"second"===c?function(b){return moment.unix(b).format("h:mm:ss a")}:"minute"===c?function(b){return moment.unix(b).format("h:mm a")}:"hour"===
c?function(b){return moment.unix(b).format("MMM D h a")}:"day"===c||"week"===c?function(b){return moment.unix(b).format("MMM D")}:"month"===c||"twomonth"===c||"quarter"===c||"sixmonth"===c?function(b){return moment.unix(b).format("YYYY/MM")}:function(b){return moment.unix(b).format("YYYY")}:function(b){return moment.unix(b).format(c)}};d.format._number_instance=d.format.number();d.format.value=function(c){return _.isNumber(c)?d.format._number_instance(c):c}}).call(this);(function(){var g,n;d.type=
{};d.type.impute=function(d){var c,b,e,f,h,r;h=b=f=c=0;for(r=d.length;h<r;h++)e=d[h],null!=e&&(void 0!==e&&null!==e)&&(b++,isNaN(e)&&isNaN(e.replace(/\$|\,/g,""))||f++,e=moment(e),null!=e&&e.isValid()&&c++);return f>0.95*b?"num":c>0.95*b?"date":"cat"};d.type.coerce=function(d,c){if(_.isUndefined(d)||_.isNull(d)||"cat"===c.type)return d;if("num"===c.type)return isNaN(d)?+(""+d).replace(/\$|\,/g,""):+d;if("date"===c.type)return c.format?"unix"===c.format?moment.unix(d).unix():moment(d,c.format).unix():
moment(d).unix()};d.type.compare=function(d){switch(d){case "cat":return g;default:return n}};g=function(d,c){var b,e;if(d===c)return 0;_.isString(d)||(d=""+d);_.isString(c)||(c=""+c);b=d.toLowerCase();e=c.toLowerCase();return b===e?d<c?-1:d>c?1:0:b<e?-1:b>e?1:0};n=function(d,c){return d===c?0:null===d?1:null===c?-1:d<c?-1:d>c?1:0}}).call(this);(function(){d.spec={};d.spec.toStrictMode=function(g){var n,l,c,b,e,f,h,r;g=_.clone(g);null==g.layers&&g.layer&&(g.layers=[g.layer]);null==g.guides&&g.guide&&
(g.guides=g.guide);null==g.guides&&(g.guides={});if(g.layers)for(f=g.layers,n=l=0,b=f.length;l<b;n=++l){c=f[n];r=d["const"].aes;e=0;for(h=r.length;e<h;e++)n=r[e],c[n]&&_.isString(c[n])&&(c[n]={"var":c[n]});null==c.sample&&(c.sample=500)}if(g.facet)for(c=["var","x","y"],f=0,n=c.length;f<n;f++)b=c[f],(l=g.facet[b])&&_.isString(l)&&(g.facet[b]={"var":l});else g.facet={type:"none"};g.coord||(g.coord={type:"cartesian",flip:!1});_.isString(g.dom)&&(g.dom=document.getElementById(g.dom));return g};d.spec.check=
function(g){var n,l,c,b,e;if(null==g.layers||0===g.layers.length)throw d.error.defn("No layers are defined in the specification.");e=g.layers;n=c=0;for(b=e.length;c<b;n=++c){l=e[n];if(null==l.data)throw d.error.defn("Layer "+(n+1)+" does not have data to plot!");if(!l.data.isData)throw d.error.defn("Data must be a Polychart Data object.");}if((null==g.render||!1!==g.render)&&!g.dom)throw d.error.defn("No DOM element specified. Where to make plot?");return g}}).call(this);(function(){d.xhr=function(d,
n,l){var c;c=new XMLHttpRequest;3>arguments.length?(l=n,n=null):n&&c.overrideMimeType&&c.overrideMimeType(n);c.open("GET",d,!0);n&&c.setRequestHeader("Accept",n);c.onreadystatechange=function(){var b;if(4===c.readyState)return b=c.status,b=!b&&c.response||200<=b&&300>b||304===b?c:null,l(b)};return c.send(null)};d.text=function(g,n,l){3>arguments.length&&(l=n,n=null);return d.xhr(g,n,function(c){return l(c&&c.responseText)})};d.json=function(g,n){return d.text(g,"application/json",function(d){return n(d?
JSON.parse(d):null)})};d.dsv=function(g,n){var l,c,b,e,f,h,r;r=RegExp("\r\n|["+g+"\r\n]","g");h=RegExp('["'+g+"\n]");l=g.charCodeAt(0);b=function(b){return b.map(e).join(g)};e=function(b){var c;return null!=(c=h.test(b))?c:'"'+b.replace(/\"/g,'""')+{'"':b}};f=null;c=function(b,e){return d.text(b,n,function(b){return e(b&&c.parse(b))})};c.parse=function(b){return c.parseRows(b,function(b,c){var d,u,k;if(c){k={};d=-1;for(u=f.length;++d<u;)k[f[d]]=b[d];return k}f=b;return null})};c.parseRows=function(b,
c){var d,e,u,k,x,p,t,f;e={};d={};p=[];x=0;k=t=null;r.lastIndex=0;for(f=function(){var c,t,p;if(r.lastIndex>=b.length)return d;if(k)return k=!1,e;p=r.lastIndex;if(34===b.charCodeAt(p)){for(t=p;t++<b.length;)if(34===b.charCodeAt(t)){if(34!==b.charCodeAt(t+1))break;t++}r.lastIndex=t+2;c=b.charCodeAt(t+1);13===c?(k=!0,10===b.charCodeAt(t+2)&&r.lastIndex++):10===c&&(k=!0);return b.substring(p+1,t).replace(/""/g,'"')}if(c=r.exec(b))return k=c[0].charCodeAt(0)!==l,b.substring(p,c.index);r.lastIndex=b.length;
return b.substring(p)};(t=f())!==d;){for(u=[];t!==e&&t!==d;)u.push(t),t=f();c&&!(u=c(u,x++))||p.push(u)}return p};c.format=function(c){return c.map(b).join("\n")};return c};d.csv=d.dsv(",","text/csv")}).call(this);(function(){var g,n,l,c,b,e,f,h,r,m,q,v,s,u,k,x,p,t,z,D,B,F,G,A,C,w,y,E,H,J,K,P,L,M,N=[].slice,O={}.hasOwnProperty,I=function(b,c){function d(){this.constructor=b}for(var k in c)O.call(c,k)&&(b[k]=c[k]);d.prototype=c.prototype;b.prototype=new d;b.__super__=c.prototype;return b};L=function(b,
c){var d,k,t,p;d=b.length;p=['"',"'"];k=0;for(t=p.length;k<t;k++)if(c=p[k],b[0]===c&&b[d-1]===c)return b.slice(1,+(d-2)+1||9E9);return b};M=function(b){return function(c,d){var k,t,p,u,e;e=[];k=p=0;for(u=c.length;p<u;k=++p)t=c[k],e.push(b(t,d[k]));return e}}(function(b,c){return[b,c]});v=function(b){var c,d,k,t,p;d={};t=0;for(p=b.length;t<p;t++)k=b[t],c=k[0],k=k[1],d[c]=k;return d};k=function(b,c,d){null==d&&(d=null);return c in b&&b[c]||d};x=function(b,c){var d,t,p;t={};for(p in c)d=c[p],d=k(b,p,
d),null!==d&&(t[p]=d);return t};D=function(b){var c,d,t,p,u;d={};p=0;for(u=b.length;p<u;p++)for(t in c=b[p],c)d[t]=c[t].concat(k(d,t,[]));return d};s=function(b,c){var d,k,t,p,u;null==c&&(c=function(b){return b});d={};p=0;for(u=b.length;p<u;p++)k=b[p],d[c(k)]=k;p=[];for(t in d)k=d[t],p.push(k);return p};u=function(b){return function(c){return s(c,function(c){return c[b]})}};E=function(b,c){return""+b+"("+c+")"};H=function(b){return"["+b+"]"};r=function(){function b(c){var d,k,t,p;p=[];k=0;for(t=c.length;k<
t;k++)d=c[k],p.push(d);this.buffer=p.reverse()}b.prototype.empty=function(){return 0===this.buffer.length};b.prototype.peek=function(){return this.empty()?null:this.buffer[this.buffer.length-1]};b.prototype.get=function(){return this.empty()?null:this.buffer.pop()};b.prototype.toString=function(){return E("Stream",H(N.call(this.buffer).reverse()))};return b}();q=function(){function b(c){this.tag=c}b.Tag={symbol:"symbol",literal:"literal",lparen:"(",rparen:")",comma:","};b.prototype.toString=function(){return"<"+
this.contents().toString()+">"};b.prototype.contents=function(){return[this.tag]};return b}();m=function(b){function c(b){this.name=b;this.name=L(this.name);c.__super__.constructor.call(this,q.Tag.symbol)}I(c,b);c.prototype.contents=function(){return c.__super__.contents.call(this).concat([this.name])};return c}(q);f=function(b){function c(b){this.val=b;this.val=L(this.val);c.__super__.constructor.call(this,q.Tag.literal)}I(c,b);c.prototype.contents=function(){return c.__super__.contents.call(this).concat([this.val])};
return c}(q);c=function(){var b,c,d,k;d=[q.Tag.lparen,q.Tag.rparen,q.Tag.comma];k=[];b=0;for(c=d.length;b<c;b++)J=d[b],k.push(new q(J));return k}();e=c[0];h=c[1];n=c[2];P=[[/^\(/,function(){return e}],[/^\)/,function(){return h}],[/^,/,function(){return n}],[/^[+-]?(0x[0-9a-fA-F]+|0?\.\d+|[1-9]\d*(\.\d+)?|0)([eE][+-]?\d+)?/,function(b){return new f(b)}],[/^(\w|[^\u0000-\u0080])+|'((\\.)|[^\\'])+'|"((\\.)|[^\\"])+"/,function(b){return new m(b)}]];z=function(b){var c,k,t,p;t=0;for(p=P.length;t<p;t++)if(k=
P[t],c=k[0],k=k[1],c=c.exec(b))return t=c[0],[b.slice(t.length),k(t)];throw d.error.defn("There is an error in your specification at "+b);};K=function(b){var c,d;for(d=[];;){b=b.replace(/^\s+/,"");if(!b)break;c=z(b);b=c[0];c=c[1];d.push(c)}return d};c=function(){function b(){}b.prototype.toString=function(){return E(this.constructor.name,this.contents())};return b}();b=function(b){function c(b){this.name=b}I(c,b);c.prototype.contents=function(){return[this.name]};c.prototype.pretty=function(){return this.name};
c.prototype.visit=function(b){return b.ident(this,this.name)};return c}(c);l=function(b){function c(b){this.val=b}I(c,b);c.prototype.contents=function(){return[this.val]};c.prototype.pretty=function(){return this.val};c.prototype.visit=function(b){return b["const"](this,this.val)};return c}(c);g=function(b){function c(b,d){this.fname=b;this.args=d}I(c,b);c.prototype.contents=function(){return[this.fname,H(this.args)]};c.prototype.pretty=function(){var b,c=this.fname,d,k,t,p;t=this.args;p=[];d=0;for(k=
t.length;d<k;d++)b=t[d],p.push(b.pretty());return E(c,p)};c.prototype.visit=function(b){var c;return b.call(this,this.fname,function(){var d,k,t,p;t=this.args;p=[];d=0;for(k=t.length;d<k;d++)c=t[d],p.push(c.visit(b));return p}.call(this))};return c}(c);p=function(b,c,d){var k,t,p,u;t=b.peek();if(null!==t)for(p=0,u=d.length;p<u;p++)if(k=d[p],J=k[0],k=k[1],t.tag===J)return k(b);return c(b)};w=function(b){throw d.error.defn("There is an error in your specification at "+b.toString());};B=function(b){var c;
c=new r(K(b));b=C(c);if(null!==c.peek())throw d.error.defn("There is an error in your specification at "+c.toString());return b};C=function(b){return p(b,w,[[q.Tag.literal,A],[q.Tag.symbol,y]])};A=function(b){return new l(b.get().val)};y=function(c){var d;d=c.get().name;return p(c,function(){return new b(d)},[[q.Tag.lparen,F(d)]])};F=function(b){return function(c){c.get();c=p(c,G([]),[[q.Tag.rparen,function(b){b.get();return[]}]]);return new g(b,c)}};G=function(b){return function(c){var d,k;d=C(c);
k=b.concat([d]);return p(c,w,[[q.Tag.rparen,function(b){b.get();return k}],[q.Tag.comma,function(b){b.get();return G(k)(b)}]])}};t=function(b){var c;c={trans:[],stat:[]};b.visit({ident:function(b,c){return c},"const":function(b,c){return c},call:function(b,k,t){var p,u;u=k in d["const"].trans?"trans":k in d["const"].stat?"stat":"none";if("none"!==u)return p=d["const"][u][k],t=v(M(p,t)),t.name=b.pretty(),t[u]=k,c[u].push(t),t.name;throw d.error.defn("The operation "+k+" is not recognized. Please check your specifications.");
}});return c};d.parser={tokenize:K,parse:B,layerToData:function(b,c){var k,p,e,f,w,y,z,E,q,h;null==c&&(c=[]);w={};z=null!=(q=b.filter)?q:{};for(p in z)q=z[p],w[B(p).pretty()]=q;y=[];z=0;for(q=c.length;z<q;z++)p=c[z],y.push(B(p["var"]).pretty());c=y;k=_.pick(b,d["const"].aes);for(p in k)"var"in k[p]||delete k[p];h=[];q=[];y=[];z={};for(p in k)e=k[p],"count(*)"===e["var"]?q.push(e["var"]):(f=B(e["var"]),e["var"]=f.pretty(),f=t(f),h.push(f),q.push(e["var"]),0===f.stat.length&&y.push(e["var"]),"sort"in
e&&(f=x(e,d["const"].metas),"count(*)"===f.sort?E={sort:"count(*)",asc:f.asc,stat:[],trans:[]}:(E=B(f.sort),f.sort=E.pretty(),E=t(E)),0!==E.stat.length&&(f.stat=E.stat[0]),z[e["var"]]=f));k=0;for(e=c.length;k<e;k++)if(p=c[k],f=B(p),p=f.pretty(),f=t(f),h.push(f),q.push(p),0===f.stat.length)y.push(p);else throw d.error.defn("Facet variable should not contain statistics!");h=D(h);p=u("name");y={stats:p(h.stat),groups:s(y)};return{trans:p(h.trans),stats:y,meta:z,select:s(q),filter:w}}}}).call(this);(function(){var g,
n,l,c,b,e={}.hasOwnProperty,f=function(b,c){function d(){this.constructor=b}for(var f in c)e.call(c,f)&&(b[f]=c[f]);d.prototype=c.prototype;b.prototype=new d;b.__super__=c.prototype;return b},h=function(b,c){return function(){return b.apply(c,arguments)}};n=function(){function b(c){var d;this.spec=c;null==this.spec&&(this.spec={});this.flip=null!=(d=this.spec.flip)?d:!1;this.scales=null;c=this.flip?["y","x"]:["x","y"];this.x=c[0];this.y=c[1]}b.prototype.make=function(b){return this.dims=b};b.prototype.setScales=
function(b){return this.scales={x:b.x.f,y:b.y.f}};b.prototype.clipping=function(b){return[b.x,b.y,this.dims.eachWidth,this.dims.eachHeight]};b.prototype.getScale=function(b){};b.prototype.ranges=function(){};return b}();g=function(b){function e(){return c=e.__super__.constructor.apply(this,arguments)}f(e,b);e.prototype.type="cartesian";e.prototype.getScale=function(b){if("x"===b||"y"===b)return this.scales[this[b]];throw d.error.input("Coordinates only keep x & y scales");};e.prototype.ranges=function(){var b;
b={};b[this.x]={min:0,max:this.dims.eachWidth};b[this.y]={min:this.dims.eachHeight,max:0};return b};e.prototype.axisType=function(b){return this[b]};e.prototype.getXY=function(b,c){var d,e;if(b)return d={x:_.isArray(c.x)?_.map(c.x,this.scales.x):this.scales.x(c.x),y:_.isArray(c.y)?_.map(c.y,this.scales.y):this.scales.y(c.y)},{x:d[this.x],y:d[this.y]};d=this.scales[this.x];e=this.scales[this.y];return{x:_.isArray(c.x)?_.map(c.x,d):d(c.x),y:_.isArray(c.y)?_.map(c.y,e):e(c.y)}};e.prototype.getAes=function(b,
c,d){return{x:d.x(b[this.x],c[this.x]),y:d.y(b[this.y],c[this.y])}};return e}(n);l=function(c){function e(){this.getXY=h(this.getXY,this);return b=e.__super__.constructor.apply(this,arguments)}f(e,c);e.prototype.type="polar";e.prototype.make=function(b){this.dims=b;this.cx=this.dims.eachWidth/2;return this.cy=this.dims.eachHeight/2};e.prototype.getScale=function(b){if("r"===b)return this.scales[this.x];if("t"===b)return this.scales[this.y];throw d.error.input("Coordinates only keep r & t scales");
};e.prototype.ranges=function(){var b,c,d;c=[this.x,this.y];b=c[0];d=c[1];c={};c[d]={min:0,max:2*Math.PI};c[b]={min:0,max:Math.min(this.dims.eachWidth,this.dims.eachHeight)/2-10};return c};e.prototype.axisType=function(b){return"x"===this[b]?"r":"t"};e.prototype.getXY=function(b,c){var d,e,k,f,p,t,z,h,g,r,m,A,l,w,y=this;r=function(b,c){return y.cx+b*Math.cos(c-Math.PI/2)};m=function(b,c){return y.cy+b*Math.sin(c-Math.PI/2)};f=[this.x,this.y];p=f[0];z=f[1];if(b){if(_.isArray(c[p])){f={x:[],y:[],r:[],
t:[]};l=c[p];e=d=0;for(A=l.length;d<A;e=++d)t=l[e],t=this.scales[p](t),h=this.scales[z](c[z][e]),f.x.push(r(t,h)),f.y.push(m(t,h)),f.r.push(t),f.t.push(h);return f}t=this.scales[p](c[p]);h=this.scales[z](c[z]);return{x:r(t,h),y:m(t,h),r:t,t:h}}k=function(b){return _.isObject(b)&&"scalefn"===b.t&&"identity"===b.f};d=function(b,c){var d,e;d=k(b);e=k(c);if(d&&!e)return{x:b.v,y:m(y.scales[p](c),0)};if(d&&e)return{x:b.v,y:c.v};if(!d&&e)return{y:c.v,x:m(y.scales[z](b),0)};t=y.scales[p](c);h=y.scales[z](b);
return{x:r(t,h),y:m(t,h)}};if(_.isArray(c.x)){f={x:[],y:[]};w=c.x;e=A=0;for(l=w.length;A<l;e=++A)g=w[e],e=c.y[e],g=d(g,e),e=g.x,g=g.y,f.x.push(e),f.y.push(g);return f}return d(c.x,c.y)};return e}(n);d.coord={cartesian:function(b){return new g(b)},polar:function(b){return new l(b)}};d.coord.make=function(b){if(null==b||null==b.type)return d.coord.cartesian();switch(b.type){case "cartesian":return d.coord.cartesian(b);case "polar":return d.coord.polar(b);default:throw d.error.defn("No such coordinate type "+
b.type+".");}}}).call(this);(function(){var g,n,l,c,b,e,f,h,r,m=[].indexOf||function(b){for(var c=0,d=this.length;c<d;c++)if(c in this&&this[c]===b)return c;return-1};c=d["const"].aes;d.domain={};d.domain.make=function(b,c,e,f){var k,x,p;k=[];for(p in b)x=b[p],k.push(h(x.geoms,c[p],e,f));return d.domain.merge(k)};d.domain.compare=function(b){return b?"cat"===b.type?function(c,d){c=_.indexOf(b.levels,c);d=_.indexOf(b.levels,d);return-1===c?1:-1===d?-1:c<d?-1:c>d?1:0}:d.type.compare(b.type):function(b){return b}};
l=function(){return function(b){this.type=b.type;this.min=b.min;this.max=b.max;this.bw=b.bw}}();n=function(){return function(b){this.type=b.type;this.min=b.min;this.max=b.max;this.bw=b.bw}}();g=function(){return function(b){this.type=b.type;this.levels=b.levels;this.sorted=b.sorted}}();f=function(b){"cat"!==b.type&&b.max===b.min&&(b.bw?(b.max+=b.bw,b.min-=b.bw):0===b.max?b.max+=1:(b.max*=1.1,b.min/=1.1));switch(b.type){case "num":return new l(b);case "date":return new n(b);case "cat":return new g(b)}};
h=function(b,c,h,u){var k,x,p,t,z,g,B,l,r,A,C,w,y,E,H,J,K,n,L,M,N,O,I;p={};for(k in c)if(g=c[k],!(0<=m.call(d["const"].noDomain,k)))if(u)p[k]=f(h[k]);else{B=e(b,k);if(0===B.length)throw d.error.input("Dataset is none?");t=function(b){return null!=h[k]?h[k][b]:null};switch(g.type){case "num":x=null!=(l=t("bw"))?l:g.bw;if(1<B.length)g=null!=(r=t("min"))?r:_.min(B),z=null!=(J=t("max"))?J:_.max(B)+(null!=x?x:0);else if(1===B.length){debugger;x?(g=null!=(K=t("min"))?K:B[0],z=null!=(n=t("max"))?n:B[0]+
x):(g=null!=(L=t("min"))?L:B[0]-1,z=null!=(M=t("max"))?M:B[0]+1)}else g=null!=(N=t("min"))?N:0,z=null!=(O=null!=(I=t("max"))?I:x)?O:1;p[k]=f({type:"num",min:g,max:z,bw:x});break;case "date":x=null!=(A=t("bw"))?A:g.bw;g=null!=(C=t("min"))?C:_.min(B);z=t("max");null==z&&(z=_.max(B),z=function(){switch(x){case "week":return moment.unix(z).add("days",7).unix();case "twomonth":return moment.unix(z).add("months",2).unix();case "quarter":return moment.unix(z).add("months",4).unix();case "sixmonth":return moment.unix(z).add("months",
6).unix();case "twoyear":return moment.unix(z).add("years",2).unix();case "fiveyear":return moment.unix(z).add("years",5).unix();case "decade":return moment.unix(z).add("years",10).unix();default:return moment.unix(z).add(x+"s",1).unix()}}());p[k]=f({type:"date",min:g,max:z,bw:x});break;case "cat":p[k]=f({type:"cat",levels:null!=(w=null!=(y=t("levels"))?y:g.levels)?w:_.uniq(B),sorted:null!=(E=null!=(H=t("levels"))?H:g.sorted)?E:!1})}}return p};e=function(b,c){var e,f,k,x,p;x=[];for(f in b)for(k in e=
b[f],p=e.marks,p)e=p[k],x=x.concat(d.flatten(e[c]));p=[];k=0;for(e=x.length;k<e;k++)f=x[k],d.isDefined(f)&&p.push(f);return p};d.domain.merge=function(b){var d,e,f,k,x;f={};k=0;for(x=c.length;k<x;k++)d=c[k],e=_.without(_.pluck(b,d),void 0),0<e.length&&(f[d]=r(e));return f};b={num:function(b){var c,e;c=_.compact(_.uniq(_.map(b,function(b){return b.bw})));if(1<c.length)throw d.error.data("Not all layers have the same binwidth.");c=null!=(e=c[0])?e:void 0;e=_.min(_.map(b,function(b){return b.min}));
b=_.max(_.map(b,function(b){return b.max}));return f({type:"num",min:e,max:b,bw:c})},date:function(b){var c,e;c=_.compact(_.uniq(_.map(b,function(b){return b.bw})));if(1<c.length)throw d.error.data("Not all layers have the same binwidth.");c=null!=(e=c[0])?e:void 0;e=_.min(_.map(b,function(b){return b.min}));b=_.max(_.map(b,function(b){return b.max}));return f({type:"date",min:e,max:b,bw:c})},cat:function(b){var c,e,u,k,x,p,t,z;k=[];x=0;for(t=b.length;x<t;x++)if(e=b[x],e.sorted){c=!0;p=0;for(z=k.length;p<
z;p++)u=k[p],_.isEqual(u,e.levels)&&(c=!1);c&&k.push(e.levels)}b=_.chain(b).filter(function(b){return!b.sorted}).map(function(b){return b.levels}).value();if(1<k.length&&_.intersection.apply(this,k))throw d.error.data("You are trying to combine incompatible sorted domains in the same axis.");k=[_.flatten(k,!0)];b=_.union.apply(this,k.concat(b));0===k[0].length&&(b=b.sort());return f({type:"cat",levels:b,sorted:0!==k[0].length})}};r=function(c){var e;e=_.uniq(_.map(c,function(b){return b.type}));if(1<
e.length)throw d.error.data("You are trying to merge data of different types in the same axis or legend.");return b[e[0]](c)}}).call(this);(function(){var g,n,l,c;d.tick={};d.tick.make=function(b,e,f){var h,g,m,q,v,s,u,k;v=null;h=function(b){return b};null!=e.ticks?s="num"===f?_.filter(e.ticks,function(c){return c>=b.min&&c<=b.max}):e.ticks:(h=null!=(s=e.numticks)?s:5,h=c[f](b,h),s=h.ticks,v=h.step);h=e.labels?function(b){var c;return null!=(c=e.labels[b])?c:b}:e.formatter?e.formatter:d.format(f.split("-")[0],
v);v={};f=l(f,h);if(s)for(g=u=0,k=s.length-1;0<=k?u<=k:u>=k;g=0<=k?++u:--u)q=0===g?null:s[g-1],m=g===s.length-1?null:s[g+1],g=s[g],m=f(g,q,m),v[m.value]=m;return{ticks:v,ticksFormatter:h}};g=function(){return function(b){this.location=b.location;this.value=b.value;this.index=b.index;this.evtData=b.evtData}}();l=function(b,c){var d;d=0;return function(h,l,m){var q;"cat"===b?q={"in":[h]}:(q={},null!=l&&(q.ge=l),null!=m&&(q.le=m));return new g({location:h,value:c(h),index:d++,evtData:q})}};n=function(b,
c){var d,h;h=Math.pow(10,Math.floor(Math.log(b/c)/Math.LN10));d=c/b*h;0.15>d?h*=10:0.35>=d?h*=5:0.75>=d&&(h*=2);return h};c={none:function(){return{}},cat:function(b,c){var d,h,g,l,q,v,s;g=Math.max(1,Math.round(b.levels.length/c));l=[];s=b.levels;d=q=0;for(v=s.length;q<v;d=++q)h=s[d],0===d%g&&l.push(h);return{ticks:l}},num:function(b,c){var d,h,g,l;h=b.min;d=b.max;g=n(d-h,c);l=Math.ceil(h/g)*g;for(h=[];l<d;)h.push(l),l+=g;return{ticks:h,step:Math.floor(Math.log(g)/Math.LN10)}},"num-log":function(b,
c){var f,h,g,l,q,v,s,u,k;u=[];v=b.min;q=b.max;h=function(b){return Math.log(b)/Math.LN10};f=function(b){return Math.exp(b*Math.LN10)};l=Math.max(h(v),0);g=h(q);s=n(g-l,c);for(k=Math.ceil(l/s)*s;k<g+d["const"].epsilon;){if(!(0!==k%1&&0.1>=k%1)){if(k%1>d["const"].epsilon){if(l=Math.floor(k)+h(10*(k%1)),0===l%1){k+=s;continue}}else l=k;l=f(l);l<v||l>q||u.push(l)}k+=s}return{ticks:u}},date:function(b,c){var d,h,g,l,q,v;g=b.min;h=b.max;q=(h-g)/c;q=1.4>q?"second":84>q?"minute":5040>q?"hour":120960>q?"day":
846720>q?"week":3628800>q?"month":7257600>q?"twomonth":14515200>q?"quarter":21772800>q?"sixmonth":44150400>q?"year":88300800>q?"twoyear":220752E3>q?"fiveyear":"decade";v=[];d=moment.unix(g).startOf(q);l=function(){switch(q){case "twomonth":return["months",2];case "quarter":return["months",4];case "sixmonth":return["months",6];case "twoyear":return["years",2];case "fiveyear":return["years",5];case "decade":return["years",10];default:return[q+"s",1]}}();for(d.unix()<g&&d.add(l[0],l[1]);d.unix()<h;)v.push(d.unix()),
d.add(l[0],l[1]);return{ticks:v,step:q}}}}).call(this);(function(){var g,n,l,c,b,e,f,h,r,m,q=function(b,c){return function(){return b.apply(c,arguments)}},v={}.hasOwnProperty,s=function(b,c){function d(){this.constructor=b}for(var p in c)v.call(c,p)&&(b[p]=c[p]);d.prototype=c.prototype;b.prototype=new d;b.__super__=c.prototype;return b};e=d["const"].scaleFns;g=function(b){function c(){this.render=q(this.render,this);this.make=q(this.make,this);this.position="none";this.title=this.titletext=null}s(c,
b);c.prototype.make=function(b){var c,d,k,e;c=b.guideSpec;k=b.title;d=b.position;this.size=b.size;this.color=b.color;b=function(b,d){var k;return null!=(k=c[b])?k:d};this.titletext=b("title",k);this.position=null!=(e=b("position",d))?e:this.defaultPosition;if("out"===this.position)return this.position="bottom"};c.prototype.render=function(b,c,d){if("none"!==this.position)return null!=this.title&&b.remove(this.title),this.title=b.add(this._makeTitle(c,d),null,null,"guide-"+this.titleType);if(null!=
this.title)return b.remove(this.title)};c.prototype.dispose=function(b){b.remove(this.title);return this.title=null};c.prototype._makeTitle=function(){throw d.error.impl();};c.prototype.getDimension=function(){var b;b={};"none"!==this.position&&(b[this.position]=10);return b};return c}(d.Guide);l=function(b){function c(){return f=c.__super__.constructor.apply(this,arguments)}s(c,b);c.prototype.defaultPosition="bottom";c.prototype.titleType="titleH";c.prototype._makeTitle=function(b,c){var d,k,f,u,
h;d="top"===this.position?b.paddingTop+b.guideTop-(null!=(k=c.top)?k:0)-2:b.height-b.paddingBottom-b.guideBottom+(null!=(f=c.bottom)?f:0);return{type:"text",x:e.identity(b.paddingLeft+b.guideLeft+(b.width-b.paddingLeft-b.guideLeft-b.paddingRight-b.guideRight)/2),y:e.identity(d),color:e.identity(null!=(u=this.color)?u:"black"),size:e.identity(null!=(h=this.size)?h:12),text:this.titletext,"text-anchor":"middle"}};return c}(g);b=function(b){function c(){return h=c.__super__.constructor.apply(this,arguments)}
s(c,b);c.prototype.defaultPosition="left";c.prototype.titleType="titleV";c.prototype._makeTitle=function(b,c){var d,k,f,u,h;d="left"===this.position?b.paddingLeft+b.guideLeft-(null!=(k=c.left)?k:0)-7:b.width-b.paddingRight-b.guideRight+(null!=(f=c.right)?f:0);k=b.paddingTop+b.guideTop+(b.height-b.paddingTop-b.guideTop-b.paddingBottom-b.guideBottom)/2;return{type:"text",x:e.identity(d),y:e.identity(k),color:e.identity(null!=(u=this.color)?u:"black"),size:e.identity(null!=(h=this.size)?h:12),text:this.titletext,
"text-anchor":"middle",transform:"r270"}};return c}(g);c=function(b){function c(){return r=c.__super__.constructor.apply(this,arguments)}s(c,b);c.prototype.titleType="title";c.prototype._makeTitle=function(b,c){var d,k;return{type:"text",x:e.identity(b.width/2),y:e.identity(20),color:e.identity(null!=(d=this.color)?d:"black"),size:e.identity(null!=(k=this.size)?k:12),text:this.titletext,"font-size":"13px","font-weight":"bold","text-anchor":"middle"}};return c}(g);n=function(b){function c(){this.render=
q(this.render,this);this.make=q(this.make,this);return m=c.__super__.constructor.apply(this,arguments)}s(c,b);c.prototype.make=function(b){var c;c=b.title;this.size=b.size;this.color=b.color;return this.titletext=c};c.prototype.render=function(b,c,d){return null!=this.title?this.title=b.animate(this.title,this._makeTitle(c,d)):this.title=b.add(this._makeTitle(c,d),null,null,"guide-facet-title")};c.prototype._makeTitle=function(b,c){var d,k;return{type:"text",x:e.identity(c.x+b.eachWidth/2),y:e.identity(c.y-
7),color:e.identity(null!=(d=this.color)?d:"black"),size:e.identity(null!=(k=this.size)?k:12),text:this.titletext,"text-anchor":"middle"}};return c}(g);null==d.guide&&(d.guide={});d.guide.title=function(d){return"y"===d||"r"===d?new b:"main"===d?new c:"facet"===d?new n:new l}}).call(this);(function(){var g,n,l,c,b,e,f,h,r,m,q,v={}.hasOwnProperty,s=function(b,c){function d(){this.constructor=b}for(var k in c)v.call(c,k)&&(b[k]=c[k]);d.prototype=c.prototype;b.prototype=new d;b.__super__=c.prototype;
return b},u=function(b,c){return function(){return b.apply(c,arguments)}},k=[].indexOf||function(b){for(var c=0,d=this.length;c<d;c++)if(c in this&&this[c]===b)return c;return-1};f=d["const"].scaleFns;g=function(b){function c(){this.axesGeoms={}}s(c,b);c.prototype.make=function(b){var c,k,e,p;this.domains=b.domains;this.coord=b.coord;this.scales=b.scales;this.specs=b.specs;this.labels=b.labels;return this.axes={x:d.guide.axis(this.coord.axisType("x"),{domain:this.domains.x,type:this.scales.x.tickType(),
guideSpec:null!=(c=this.specs.x)?c:{},key:null!=(k=this.labels.x)?k:"x"}),y:d.guide.axis(this.coord.axisType("y"),{domain:this.domains.y,type:this.scales.y.tickType(),guideSpec:null!=(e=this.specs.y)?e:{},key:null!=(p=this.labels.y)?p:"y"})}};c.prototype.getDimension=function(b){var c,d,k;b={};k=this.axes;for(d in k)c=k[d],c=c.getDimension(),"left"===c.position?b.left=c.width:"right"===c.position?b.right=c.width:"bottom"===c.position?b.bottom=c.height:"top"===c.position&&(b.top=c.height);return b};
c.prototype.render=function(b,c,k){var e,p,f,u,h,w,y,x,g,l,m,s,r,q,v,n;h=_.keys(k.indices);f=d.compare(_.keys(this.axesGeoms),h).deleted;m=0;for(s=f.length;m<s;m++)for(u in y=f[m],q=this.axesGeoms[y],q)p=q[u],p.dispose(c());p={top:0,left:0,right:b.eachWidth,bottom:b.eachHeight,width:b.eachWidth,height:b.eachHeight};f=k.edge(this.axes.x.position);u=k.edge(this.axes.y.position);m={renderLabel:!1,renderTick:!1};s={renderLabel:!1,renderTick:!1};"r"===this.axes.x.type&&(m.renderLine=!1);"r"===this.axes.y.type&&
(s.renderLine=!1);n=[];q=0;for(v=h.length;q<v;q++)y=h[q],x=k.getOffset(b,y),null==(r=this.axesGeoms)[y]&&(r[y]={x:new d.Geometry("guide"),y:new d.Geometry("guide")}),l=c(x,!1,!1),x=f(y)?{}:m,this.axesGeoms[y].x.set(this.axes.x.calculate(p,this.coord,x)),this.axesGeoms[y].x.render(l),x=u(y)?{}:s,this.axesGeoms[y].y.set(this.axes.y.calculate(p,this.coord,x)),this.axesGeoms[y].y.render(l),n.push(function(){var b,c,d,k;d=["x","y"];k=[];b=0;for(c=d.length;b<c;b++)e=d[b],k.push(function(){var b,c;b=this.axesGeoms[y][e].pts;
c=[];for(w in b)g=b[w],g.grid?c.push(g.grid.toBack()):c.push(void 0);return c}.call(this));return k}.call(this));return n};c.prototype.dispose=function(b){var c,d,k;k=this.axesGeoms;for(d in k)c=k[d],c.x.dispose(b),c.y.dispose(b);return this.axesGeoms={}};return c}(d.GuideSet);n=function(b){function c(b){this.calculate=u(this.calculate,this);var e,p,f,h,x;e=b.domain;h=b.type;p=b.guideSpec;b=b.key;f=function(b,c){var d;return null!=(d=p[b])?d:c};this.position=f("position",this.defaultPosition);if(x=
this.position,0>k.call(this.validPositions,x))throw d.error.defn("X-axis position can't be "+this.position+".");this.titletext=f("title",b);this.renderTick=f("renderTick",this.renderTickDefault);this.renderGrid=f("renderGrid",this.renderGridDefault);this.renderLabel=f("renderLabel",this.renderLabelDefault);this.renderLine=f("renderLine",this.renderLineDefault);this.gridColor=f("gridColor",this.gridColor);e=d.tick.make(e,p,h);this.ticks=e.ticks;this.ticksFormatter=e.ticksFormatter;this.maxwidth=_.max(_.map(this.ticks,
function(b){return d.strSize(b.value)}));this.maxwidth=Math.max(this.maxwidth,0)}s(c,b);c.prototype.renderTickDefault=!0;c.prototype.renderGridDefault=!0;c.prototype.renderLabelDefault=!0;c.prototype.renderLineDefault=!0;c.prototype.calculate=function(b,c,d){var k,e,p,f,u,w,h;this.coord=c;if("none"===this.position)return{};null==d&&(d={});b.centerx=b.left+b.width/2;b.centery=b.top+b.height/2;b.radius=Math.min(b.width,b.height)/2-10;c={};this.renderLine&&(c.line={marks:{0:this._renderline(b)}});f=
this.ticks;for(k in f)p=f[k],e={},this.renderTick&&(null!=(u=d.renderTick)?u:1)&&(e.tick=this._makeTick(b,p)),this.renderLabel&&(null!=(w=d.renderLabel)?w:1)&&(e.text=this._makeLabel(b,p)),this.renderGrid&&(null!=(h=d.renderGrid)?h:1)&&(e.grid=this._makeGrid(b,p)),c[k]={marks:e};return c};c.prototype._makeTick=function(b){if(!b)throw d.error.impl();b.type="path";b.stroke=f.identity("#666");b.color=f.identity("#666");return b};c.prototype._makeLabel=function(b){if(!b)throw d.error.impl();b.type="text";
b.stroke=f.identity("#666");b.color=f.identity("#666");return b};c.prototype._makeGrid=function(b){if(!b)throw d.error.impl();b.stroke=null!=this.gridColor?this.gridColor:"#EFEFEF";return b};return c}(d.Guide);b=function(b){function c(){return h=c.__super__.constructor.apply(this,arguments)}s(c,b);c.prototype.type="x";c.prototype.renderGridDefault=!1;c.prototype.defaultPosition="bottom";c.prototype.validPositions=["top","bottom","none"];c.prototype._renderline=function(b){var c,d;d="top"===this.position?
f.identity(b.top):f.identity(b.bottom);c=f.identity(b.left);b=f.identity(b.left+b.width);return{type:"path",y:[d,d],x:[c,b],stroke:f.identity("#666")}};c.prototype._makeTick=function(b,d){var k,e;"top"===this.position?(k=f.identity(b.top),e=f.identity(b.top-5)):(k=f.identity(b.bottom),e=f.identity(b.bottom+5));return c.__super__._makeTick.call(this,{x:[d.location,d.location],y:[k,e]})};c.prototype._makeLabel=function(b,d){var k;k="top"===this.position?f.identity(b.top-15):f.identity(b.bottom+15);
return c.__super__._makeLabel.call(this,{x:d.location,y:k,text:d.value,"text-anchor":"middle"})};c.prototype._makeGrid=function(b,d){var k,e;k=f.identity(b.top);e=f.identity(b.bottom);return c.__super__._makeGrid.call(this,{type:"path",x:[d.location,d.location],y:[k,e]})};c.prototype.getDimension=function(){var b;return{position:null!=(b=this.position)?b:"bottom",height:30,width:"all"}};return c}(n);e=function(b){function c(){return r=c.__super__.constructor.apply(this,arguments)}s(c,b);c.prototype.type=
"y";c.prototype.renderLineDefault=!1;c.prototype.renderTickDefault=!1;c.prototype.defaultPosition="left";c.prototype.validPositions=["left","right","none"];c.prototype._renderline=function(b){var c,d;c="left"===this.position?f.identity(b.left):f.identity(b.right);d=f.identity(b.top);b=f.identity(b.top+b.height);return{type:"path",x:[c,c],y:[d,b],stroke:f.identity("#666")}};c.prototype._makeTick=function(b,d){var k,e;"left"===this.position?(k=f.identity(b.left),e=f.identity(b.left-5)):(k=f.identity(b.right),
e=f.identity(b.right+5));return c.__super__._makeTick.call(this,{x:[k,e],y:[d.location,d.location]})};c.prototype._makeLabel=function(b,d){var k;k="left"===this.position?f.identity(b.left-7):f.identity(b.right+7);return c.__super__._makeLabel.call(this,{x:k,y:d.location,text:d.value,"text-anchor":"left"===this.position?"end":"start"})};c.prototype._makeGrid=function(b,d){var k,e;k=f.identity(b.left);e=f.identity(b.right);return c.__super__._makeGrid.call(this,{type:"path",y:[d.location,d.location],
x:[k,e]})};c.prototype.getDimension=function(){var b;return{position:null!=(b=this.position)?b:"right",height:"all",width:5+this.maxwidth}};return c}(n);l=function(b){function c(){return m=c.__super__.constructor.apply(this,arguments)}s(c,b);c.prototype.type="r";c.prototype.defaultPosition="left";c.prototype.validPositions=["left","right","none"];c.prototype._renderline=function(b){var c,d;c=f.identity(b.left);d=f.identity(b.top);b=f.identity(b.top+b.height/2);return{type:"path",x:[c,c],y:[d,b],stroke:f.identity("#666")}};
c.prototype._makeTick=function(b,d){return c.__super__._makeTick.call(this,{x:[f.identity(b.left),f.identity(b.left-5)],y:[d.location,d.location]})};c.prototype._makeLabel=function(b,d){return c.__super__._makeLabel.call(this,{x:f.identity(b.left-7),y:d.location,text:d.value,"text-anchor":"end"})};c.prototype._makeGrid=function(b,d){return c.__super__._makeGrid.call(this,{type:"circle",x:f.identity(b.centerx),y:f.identity(b.centery),size:f.identity(this.coord.getScale("r")(d.location)),color:f.identity("none"),
"fill-opacity":0,"stroke-width":1})};c.prototype.getDimension=function(){return{position:"left",height:"all",width:5+this.maxwidth}};return c}(n);c=function(b){function c(){return q=c.__super__.constructor.apply(this,arguments)}s(c,b);c.prototype.type="t";c.prototype.defaultPosition="out";c.prototype.validPositions=["out","none"];c.prototype._renderline=function(b){return{type:"circle",x:f.identity(b.centerx),y:f.identity(b.centery),size:f.identity(b.radius),color:f.identity("none"),stroke:f.identity("#666"),
"stroke-width":1}};c.prototype._makeTick=function(b,d){return c.__super__._makeTick.call(this,{x:[d.location,d.location],y:[f.max(0),f.max(3)]})};c.prototype._makeLabel=function(b,d){return c.__super__._makeLabel.call(this,{x:d.location,y:f.max(12),text:d.value,"text-anchor":"middle"})};c.prototype._makeGrid=function(b,d){var k,e,u,h;e=f.identity(b.centerx);h=f.identity(b.centery);k=this.coord.getScale("t")(d.location)-Math.PI/2;u=f.identity(b.centerx+b.radius*Math.cos(k));k=f.identity(b.centery+
b.radius*Math.sin(k));return c.__super__._makeGrid.call(this,{type:"path",y:[h,k],x:[e,u]})};c.prototype.getDimension=function(){return{}};return c}(n);null==d.guide&&(d.guide={});d.guide.axis=function(d,k){if("x"===d)return new b(k);if("y"===d)return new e(k);if("r"===d)return new l(k);if("t"===d)return new c(k)};d.guide.axes=function(b){return new g(b)}}).call(this);(function(){var g,n,l,c,b,e,f,h={}.hasOwnProperty,r=function(b,c){function d(){this.constructor=b}for(var k in c)h.call(c,k)&&(b[k]=
c[k]);d.prototype=c.prototype;b.prototype=new d;b.__super__=c.prototype;return b},m=[].indexOf||function(b){for(var c=0,d=this.length;c<d;c++)if(c in this&&this[c]===b)return c;return-1},q=function(b,c){return function(){return b.apply(c,arguments)}};b=d["const"].scaleFns;d.guide.legends=function(){return new l};d.guide.legend=function(b,d){return"left"===d||"right"===d?new c(b):new g(b)};l=function(b){function c(){this.legends=[];this.deletedLegends=[]}r(c,b);c.prototype.make=function(b){var c,e,
f,t,h,g,l,m,r,A,C,w;f=b.domains;m=b.layers;t=b.guideSpec;C=b.scales;l=b.layerMapping;this.position=b.position;e=b.dims;null==this.postion&&(this.postion="right");if("none"!==this.position){c=this._mergeAes(f,m);for(g=0;g<this.legends.length;){r=this.legends[g];A=!0;for(h=0;h<c.length;){b=c[h];if(_.isEqual(b,r.aes)){c.splice(h,1);A=!1;break}h++}A?(this.deletedLegends.push(r),this.legends.splice(g,1)):g++}r=0;for(h=c.length;r<h;r++)b=c[r],this.legends.push(d.guide.legend(b,this.position));g=this.legends;
A=[];c=0;for(h=g.length;c<h;c++)r=g[c],b=r.aes[0],A.push(r.make({domain:f[b],position:this.position,guideSpec:null!=(w=t[b])?w:{},type:C[b].tickType(),mapping:l,keys:d.getLabel(m,b),dims:e}));return A}};c.prototype._mergeAes=function(b,c){var e,f,h,g,l,r,q;l=[];for(e in b)if(!(0<=m.call(d["const"].noLegend,e)||(h=_.map(c,function(b){return b.mapping[e]}),_.all(h,_.isUndefined)))){g=!1;r=0;for(q=l.length;r<q;r++)if(f=l[r],_.isEqual(f.mapped,h)){f.aes.push(e);g=!0;break}g||l.push({aes:[e],mapped:h})}return _.pluck(l,
"aes")};c.prototype.getDimension=function(b){var c,d,e;c={};if("left"===(d=this.position)||"right"===d)c[this.position]=this._leftrightWidth(b);else if("top"===(e=this.position)||"bottom"===e)c[this.position]=this._topbottomHeight(b);return c};c.prototype._leftrightWidth=function(b){var c,d,e,f,h,g,l,m;f=b.chartHeight;h=0;c=10;d=0;m=this.legends;g=0;for(l=m.length;g<l;g++)e=m[g],e=e.getDimension(b),e.height+d>f&&(c+=h+5,h=d=0),e.width>h&&(h=e.width),d+=e.height;return c+h};c.prototype._topbottomHeight=
function(b){var c,d,e,f,h;d=10;h=this.legends;e=0;for(f=h.length;e<f;e++)c=h[e],c=c.getDimension(b),d+=c.height+10;return d};c.prototype.render=function(b,c,d){var e,f,h,g,l;f=c();l=this.deletedLegends;h=0;for(g=l.length;h<g;h++)e=l[h],e.dispose(f);this.deletedLegends=[];if("left"===this.position||"right"===this.position)return this._renderV(b,c,d);if("top"===this.position||"bottom"===this.position)return this._renderH(b,c,d)};c.prototype._renderV=function(b,c,d){var e,f,h,g,l,m,r,A,C,w,y,E,H;e=b.paddingTop+
b.guideTop;f="left"===this.position?b.paddingLeft:b.width-b.guideRight-b.paddingRight;l=0;g=b.height-b.guideTop-b.paddingTop;A=10;r="right"===this.position?d.right:0;E=this.legends;H=[];w=0;for(y=E.length;w<y;w++)h=E[w],m=h.getDimension(b),m.height+d.y>g&&(r+=l+5,l=A=0),m.width>l&&(l=m.width),C={x:r+f,y:A+e},h.render(c(C,!1,!1),l),H.push(A+=m.height);return H};c.prototype._renderH=function(b,c,d){var e,f,h,g,l,m;e=b.paddingLeft;f="top"===this.position?b.paddingTop:b.height-b.guideBottom-b.paddingBottom;
f={x:e,y:"top"===this.position?d.top+f:d.bottom+f+10};l=this.legends;m=[];h=0;for(g=l.length;h<g;h++)d=l[h],e=d.getDimension(b),d.render(c(f,!1,!1)),m.push(f.y+=e.height+10);return m};c.prototype.dispose=function(b){var c,d,e,f,h;f=this.legends;h=[];d=0;for(e=f.length;d<e;d++)c=f[d],h.push(c.dispose(b));return h};return c}(d.GuideSet);n=function(c){function e(b){this.aes=b;this._makeEvtData=q(this._makeEvtData,this);this._makeTick=q(this._makeTick,this);this.geometry=new d.Geometry("guide")}r(e,c);
e.prototype.TITLEHEIGHT=15;e.prototype.TICKHEIGHT=12;e.prototype.SPACING=10;e.prototype.make=function(b){var c,e,f,h,g;c=b.domain;f=b.type;e=b.guideSpec;this.mapping=b.mapping;this.position=b.position;b=b.keys;this.titletext=null!=(h=e.title)?h:b;return g=d.tick.make(c,e,f),this.ticks=g.ticks,g};e.prototype.calculate=function(){var b,c,d,e,f;c={};c.title={marks:{0:this._makeTitle(this.titletext)}};f=this.ticks;for(d in f)b=f[d],e={},e.tick=this._makeTick(b),e.text=this._makeLabel(b),b=this._makeEvtData(b),
c[d]={marks:e,evtData:b};return c};e.prototype.render=function(b){this.geometry.set(this.calculate());return this.geometry.render(b)};e.prototype.dispose=function(b){return this.geometry.dispose(b)};e.prototype._makeTitle=function(c,d){null==d&&(d={x:0,y:0});return{type:"text",x:b.identity(d.x+5),y:b.identity(d.y),color:b.identity("black"),text:c,"text-anchor":"start"}};e.prototype._makeLabel=function(c,d){d||(d={x:0,y:15+12*c.index});return{type:"text",x:b.identity(d.x+20),y:b.identity(d.y+1),color:b.identity("black"),
text:c.value,"text-anchor":"start"}};e.prototype._makeTick=function(c,e){var f,h,g,l;e||(e={x:0,y:15+12*c.index});h={type:"circle",x:b.identity(e.x+10),y:b.identity(e.y),color:b.identity("steelblue")};l=this.mapping;for(f in l)g=l[f],0<=m.call(d["const"].noLegend,f)||(g=g[0],0<=m.call(this.aes,f)?h[f]=c.location:null!=g.type&&"const"===g.type?h[f]=b.identity(g.value):_.isObject(g)?h[f]=b.identity(d["const"].defaults[f]):h[f]=b.identity(g));_.isObject(h.size)&&(h.size=b.identity(5));return h};e.prototype._makeEvtData=
function(b){var c,d,e,f,h,g,l;d={};l=this.mapping;for(c in l)for(f=l[c],h=0,g=f.length;h<g;h++)e=f[h],0<=m.call(this.aes,c)&&"map"===e.type&&(d[e.value]=b.evtData);return d};return e}(d.Guide);c=function(b){function c(){return e=c.__super__.constructor.apply(this,arguments)}r(c,b);c.prototype.make=function(b){var e;c.__super__.make.call(this,b);this.height=this.TITLEHEIGHT+this.SPACING+this.TICKHEIGHT*_.size(this.ticks);e=d.strSize(this.titletext);b=_.max(_.map(this.ticks,function(b){return d.strSize(b.value)}));
return this.maxwidth=Math.max(e,b)};c.prototype.getDimension=function(){return{position:this.position,height:this.height,width:15+this.maxwidth}};return c}(n);g=function(b){function c(){return f=c.__super__.constructor.apply(this,arguments)}r(c,b);c.prototype.TICKSPACING=25;c.prototype.make=function(b){var e,f,h,g;c.__super__.make.call(this,b);this.maxwidth=b.dims.width;this.height=this.TITLEHEIGHT+this.SPACING;b=0;this.height+=this.TICKHEIGHT;g=this.ticks;f=0;for(h=g.length;f<h;f++)e=g[f],e=d.strSize(e.value)+
this.TICKSPACING,b+e<this.maxwidth?b+=e:(this.height+=this.TICKHEIGHT,b=e);return null};c.prototype.calculate=function(){var b,c,e,f,h,g,l;c={};c.title={marks:{0:this._makeTitle(this.titletext)}};h={x:0,y:this.TITLEHEIGHT};l=this.ticks;for(e in l)g=l[e],f={},f.tick=this._makeTick(g,h),f.text=this._makeLabel(g,h),b=this._makeEvtData(g,h),c[e]={marks:f,evtData:b},b=d.strSize(g.value)+this.TICKSPACING,h.x+b<this.maxwidth?h.x+=b:(h.x=0,h.y+=this.TICKHEIGHT);return c};c.prototype.getDimension=function(){return{position:this.position,
height:this.height,width:"all"}};return c}(n)}).call(this);(function(){var g,n,l,c,b,e,f,h,r,m,q,v,s,u,k,x,p,t=function(b,c){return function(){return b.apply(c,arguments)}},z={}.hasOwnProperty,D=function(b,c){function d(){this.constructor=b}for(var e in c)z.call(c,e)&&(b[e]=c[e]);d.prototype=c.prototype;b.prototype=new d;b.__super__=c.prototype;return b};m=function(){function b(c){this.f=null}b.prototype.make=function(b){this.domain=b;this.compare=d.domain.compare(b);if(!b)return this._makeNone();
switch(b.type){case "num":return this._makeNum();case "date":return this._makeDate();case "cat":return this._makeCat()}};b.prototype._makeNone=function(){throw d.error.impl("You are using a scale that does not support null values");};b.prototype._makeNum=function(){throw d.error.impl("You are using a scale that does not support numbers");};b.prototype._makeDate=function(){throw d.error.impl("You are using a scale that does not support dates");};b.prototype._makeCat=function(){throw d.error.impl("You are using a scale that does not support categories");
};b.prototype.tickType=function(){if(!this.domain)return this._tickNone();switch(this.domain.type){case "num":return this._tickNum();case "date":return this._tickDate();case "cat":return this._tickCat()}};b.prototype._tickNone=function(){return"none"};b.prototype._tickNum=function(){return"num"};b.prototype._tickDate=function(){return"date"};b.prototype._tickCat=function(){return"cat"};b.prototype._identityWrapper=function(b){return function(c){return _.isObject(c)&&"scalefn"===c.t&&"identity"===
c.f?c.v:b(c)}};return b}();g=function(b){function c(b){this._catWrapper=t(this._catWrapper,this);this._dateWrapper=t(this._dateWrapper,this);this._numWrapper=t(this._numWrapper,this);this.finv=this.f=null}D(c,b);c.prototype.make=function(b,d,e){this.range=d;this.space=e;_.isNumber(this.space)||(this.space=0.05);return c.__super__.make.call(this,b)};c.prototype._makeNone=function(){var b,c=this;b=(this.range.max-this.range.min)*this.space;this.f=this._NaNCheckWrap(function(d){var e;if(_.isObject(d)){if("identity"===
d.f)return d.v;if("middle"===d.f)return c.range.max/2+c.range.min/2;if("max"===d.f)return c.range.max;if("min"===d.f)return c.range.min;if("upper"===d.f&&!d.m)return c.range.max-b;if("lower"===d.f&&!d.m)return c.range.min+b;e=(c.range.max-c.range.min-2*b)/d.m;if("upper"===d.f)return c.range.min+b+(d.n+1)*e;if("lower"===d.f)return c.range.min+b+d.n*e}return c.range.max/2+c.range.min/2});return this.finv=function(){return{}}};c.prototype._NaNCheckWrap=function(b){return function(c){if(d.isDefined(c)){c=
b(c);if(isNaN(c)||Infinity===c||-Infinity===c)throw d.error.scale("Scale outputed a value that is not finite.");return c}}};c.prototype._numWrapper=function(b,c){var e=this;return this._NaNCheckWrap(function(k){var f,h,g;if(_.isObject(k)){if("scalefn"===k.t){if("identity"===k.f)return k.v;if("middle"===k.f)return c(k.v+b.bw/2);if("max"===k.f)return e.range.max+k.v;if("min"===k.f)return e.range.min+k.v;if("upper"===(f=k.f)||"lower"===f){g=c(k.v+b.bw);f=c(k.v);h=(g-f)*e.space;if("upper"===k.f&&!k.m)return g-
h;if("lower"===k.f&&!k.m)return f+h;g=(g-f-2*h)/k.m;if("upper"===k.f)return f+h+(k.n+1)*g;if("lower"===k.f)return f+h+k.n*g}}throw d.error.input("Unknown object "+k+" is passed to a scale");}return c(k)})};c.prototype._dateWrapper=function(b,c){var e=this;return this._NaNCheckWrap(function(k){var f,h,g,p;if(_.isObject(k)){if("scalefn"===k.t){if("identity"===k.f)return k.v;if("max"===k.f)return e.range.max+k.v;if("min"===k.f)return e.range.min+k.v;if("upper"===(f=k.f)||"middle"===f||"lower"===f){p=
function(b,c,d){var e;null==d&&(d=0);e=moment.unix(k.v).startOf(c);e[c](b*Math.floor(e[c]()/b)+b*d);return e.unix()};g=function(){switch(b.bw){case "week":return moment.unix(k.v).day(7).unix();case "twomonth":return p(2,"month");case "quarter":return p(4,"month");case "sixmonth":return p(6,"month");case "twoyear":return p(2,"year");case "fiveyear":return p(5,"year");case "decade":return p(10,"year");default:return moment.unix(k.v).endOf(b.bw).unix()}}();g=c(g);f=function(){switch(b.bw){case "week":return moment.unix(k.v).day(0).unix();
case "twomonth":return p(2,"month",1);case "quarter":return p(4,"month",1);case "sixmonth":return p(6,"month",1);case "twoyear":return p(2,"year",1);case "fiveyear":return p(5,"year",1);case "decade":return p(10,"year",1);default:return moment.unix(k.v).startOf(b.bw).unix()}}();f=c(f);h=(g-f)*e.space;if("middle"===k.f)return g/2+f/2;if("upper"===k.f&&!k.m)return g-h;if("lower"===k.f&&!k.m)return f+h;g=(g-f-2*h)/k.m;if("upper"===k.f)return f+h+(k.n+1)*g;if("lower"===k.f)return f+h+k.n*g}}throw d.error.input("Unknown object "+
k+" is passed to a scale");}return c(k)})};c.prototype._catWrapper=function(b,c){var e=this;return this._NaNCheckWrap(function(k){var f,h,g;h=b*e.space;if(_.isObject(k)){if("scalefn"===k.t){if("identity"===k.f)return k.v;if("max"===k.f)return e.range.max+k.v;if("min"===k.f)return e.range.min+k.v;if("upper"===(f=k.f)||"middle"===f||"lower"===f){g=c(k.v)+b;f=c(k.v);if("middle"===k.f)return g/2+f/2;if("upper"===k.f&&!k.m)return g-h;if("lower"===k.f&&!k.m)return f+h;g=(g-f-2*h)/k.m;if("upper"===k.f)return f+
h+(k.n+1)*g;if("lower"===k.f)return f+h+k.n*g}}throw d.error.input("Unknown object "+k+" is passed to a scale");}return c(k)+b/2})};return c}(m);e=function(b){function c(){return q=c.__super__.constructor.apply(this,arguments)}D(c,b);c.prototype._makeNum=function(){var b,c;c=d.linear(this.domain.min,this.range.min,this.domain.max,this.range.max);b=d.linear(this.range.min,this.domain.min,this.range.max,this.domain.max);this.f=this._numWrapper(this.domain,c);return this.finv=function(c,d){var e;e=[b(c),
b(d)];return{ge:_.min(e),le:_.max(e)}}};c.prototype._makeDate=function(){var b,c;c=d.linear(this.domain.min,this.range.min,this.domain.max,this.range.max);b=d.linear(this.range.min,this.domain.min,this.range.max,this.domain.max);this.f=this._dateWrapper(this.domain,c);return this.finv=function(c,d){var e;e=[b(c),b(d)];return{ge:_.min(e),le:_.max(e)}}};c.prototype._makeCat=function(){var b,c=this;b=(this.range.max-this.range.min)/this.domain.levels.length;this.f=this._catWrapper(b,function(d){d=_.indexOf(c.domain.levels,
d);return-1===d?null:c.range.min+d*b});return this.finv=function(d,e){var k;e<d&&(k=[e,d],d=k[0],e=k[1]);return{"in":c.domain.levels.slice(Math.floor(d/b),+Math.floor(e/b)+1||9E9)}}};return c}(g);f=function(b){function c(){return v=c.__super__.constructor.apply(this,arguments)}D(c,b);c.prototype._makeNum=function(){var b,c,e,k;if(0>this.domain.min)throw d.error.input("Log scale cannot handle zero or negative input.");b=Math.log;e=d.linear(b(this.domain.min),this.range.min,b(this.domain.max),this.range.max);
this.f=this._numWrapper(this.domain,function(c){return e(b(c))});k=d.linear(this.range.min,b(this.domain.min),this.range.max,b(this.domain.max));c=function(b){return Math.exp(k(b))};return this.finv=function(b,d){var e;e=[c(b),c(d)];return{ge:_.min(e),le:_.max(e)}}};c.prototype._tickNum=function(){return"num-log"};return c}(g);g=function(b){function c(){this._makeDate=t(this._makeDate,this);this._makeNum=t(this._makeNum,this);return s=c.__super__.constructor.apply(this,arguments)}D(c,b);c.prototype._makeNum=
function(){var b,c,e;b=0===this.domain.min?0:1;c=Math.sqrt;e=d.linear(c(this.domain.min),b,c(this.domain.max),10);return this.f=this._identityWrapper(function(b){return e(c(b))})};c.prototype._makeDate=function(){return this._makeNum()};return c}(m);h=function(b){function c(){this._makeDate=t(this._makeDate,this);this._makeNum=t(this._makeNum,this);return u=c.__super__.constructor.apply(this,arguments)}D(c,b);c.prototype._makeNum=function(){return this.f=this._identityWrapper(d.linear(this.domain.min,
0===this.domain.min?0:0.1,this.domain.max,1))};c.prototype._makeDate=function(){return this._makeNum()};return c}(m);r=function(b){function c(){this._makeCat=t(this._makeCat,this);return k=c.__super__.constructor.apply(this,arguments)}D(c,b);c.prototype._makeCat=function(){var b,c,d,e=this;d=this.domain.levels.length;if(9>=d)return b="#E41A1C #377EB8 #4DAF4A #984EA3 #FF7F00 #FFFF33 #A65628 #F781BF #999999".split(" "),this.f=function(c){c=_.indexOf(e.domain.levels,c);return b[c]};c=function(b){return _.indexOf(e.domain.levels,
b)/d+1/(2*d)};return this.f=function(b){return Raphael.hsl(c(b),0.5,0.5)}};return c}(m);l=function(b){function c(b){this._makeDate=t(this._makeDate,this);this._makeNum=t(this._makeNum,this);this.lower=b.lower;this.upper=b.upper}D(c,b);c.prototype._makeNum=function(){var b,c,e,k,f;e=Raphael.color(this.lower);f=Raphael.color(this.upper);k=d.linear(this.domain.min,e.r,this.domain.max,f.r);c=d.linear(this.domain.min,e.g,this.domain.max,f.g);b=d.linear(this.domain.min,e.b,this.domain.max,f.b);return this.f=
this._identityWrapper(function(d){return Raphael.rgb(k(d),c(d),b(d))})};c.prototype._makeDate=function(){return this._makeNum()};return c}(m);c=function(b){function c(b){this._makeDate=t(this._makeDate,this);this._makeCat=t(this._makeCat,this);this._makeNum=t(this._makeNum,this);this.lower=b.lower;this.middle=b.middle;this.upper=b.upper;this.midpoint=b.midpoint;null==this.midpoint&&(this.midpoint=0)}D(c,b);c.prototype._makeNum=function(){var b,c,e,k,f,h,g,p,l,t=this;f=Raphael.color(this.lower);h=
Raphael.color(this.middle);l=Raphael.color(this.upper);g=d.linear(this.domain.min,f.r,this.midpoint,h.r);e=d.linear(this.domain.min,f.g,this.midpoint,h.g);b=d.linear(this.domain.min,f.b,this.midpoint,h.b);p=d.linear(this.midpoint,h.r,this.domain.max,l.r);k=d.linear(this.midpoint,h.g,this.domain.max,l.g);c=d.linear(this.midpoint,h.b,this.domain.max,l.b);return this.f=this._identityWrapper(function(d){return d<t.midpoint?Raphael.rgb(g(d),e(d),b(d)):Raphael.rgb(p(d),k(d),c(d))})};c.prototype._makeCat=
function(){};c.prototype._makeDate=function(){return this._makeNum()};return c}(m);n=function(b){function c(b){this["function"]=b["function"]}D(c,b);c.prototype.make=function(b){this.domain=b;this.compare=d.domain.compare(b);return this.f=this._identityWrapper(this["function"])};return c}(m);(function(b){function c(){return x=c.__super__.constructor.apply(this,arguments)}D(c,b);c.prototype._makeCat=function(){};return c})(m);b=function(b){function c(){return p=c.__super__.constructor.apply(this,arguments)}
D(c,b);c.prototype.make=function(b){this.domain=b;this.compare=function(b,c){return 0};return this.f=this._identityWrapper(function(b){return b})};return c}(m);d.scale={};d.scale.Base=m;d.scale.classes={linear:e,log:f,area:g,palette:r,gradient:l,gradient2:c,identity:b,opacity:h,custom:n};d.scale.make=function(b){var c;c=b.type;if(c in d.scale.classes)return new d.scale.classes[c](b);throw d.error.defn("No such scale "+b.type+".");}}).call(this);(function(){var g,n=[].indexOf||function(d){for(var c=
0,b=this.length;c<b;c++)if(c in this&&this[c]===d)return c;return-1};d.scaleset=function(d,c,b){return new g(d,c,b)};g=function(){function g(c,b){this.coord=b;this.ranges=c;this.axes=d.guide.axes();this.legends=d.guide.legends()}g.prototype.make=function(c,b,d){this.guideSpec=c;this.layers=d;this.domains=b;this.scales=this._makeScales(c,b,this.ranges);this.reverse={x:this.scales.x.finv,y:this.scales.y.finv};return this.layerMapping=this._mapLayers(d)};g.prototype.setRanges=function(c){var b,d,f,h;
this.ranges=c;f=["x","y"];h=[];b=0;for(d=f.length;b<d;b++)c=f[b],h.push(this.scales[c].make(this.domains[c],this.ranges[c],this.getSpec(c).padding));return h};g.prototype._makeScales=function(c,b,e){var f,h;h=function(b){var e,f;if(c&&null!=c[b]&&null!=c[b].scale){if(_.isFunction(c[b].scale))return{type:"custom","function":c[b].scale};switch(b){case "x":e=["linear","log"];break;case "y":e=["linear","log"];break;case "color":e=["palette","gradient","gradient2"];break;case "size":e=["linear","log"];
break;case "opacity":e=["opacity"];break;case "shape":e=["linear","log","area"];break;case "id":e=["identity"];break;case "text":e=["identity"];break;default:e=[]}if(f=c[b].scale.type,0<=n.call(e,f))return c[b].scale;throw d.error.scale("Aesthetic "+b+" cannot have scale "+c[b].scale.type);}return null};f={};f.x=d.scale.make(h("x")||{type:"linear"});f.x.make(b.x,e.x,this.getSpec("x").padding);f.y=d.scale.make(h("y")||{type:"linear"});f.y.make(b.y,e.y,this.getSpec("y").padding);null!=b.color&&("cat"===
b.color.type?f.color=d.scale.make(h("color")||{type:"palette"}):(e={type:"gradient",upper:"steelblue",lower:"red"},f.color=d.scale.make(h("color")||e)),f.color.make(b.color));null!=b.size&&(f.size=d.scale.make(h("size")||{type:"area"}),f.size.make(b.size));null!=b.opacity&&(f.opacity=d.scale.make(h("opacity")||{type:"opacity"}),f.opacity.make(b.opacity));f.text=d.scale.make({type:"identity"});f.text.make();return f};g.prototype.fromPixels=function(c,b){var d,f,h,g,l,q,n;null!=c&&null!=b&&(d=this.coord.getAes(c,
b,this.reverse),h=d.x,g=d.y);f={};n=this.layerMapping.x;l=0;for(q=n.length;l<q;l++)d=n[l],null!=d.type&&"map"===d.type&&(f[d.value]=null!=h?h:null);q=this.layerMapping.y;h=0;for(l=q.length;h<l;h++)d=q[h],null!=d.type&&"map"===d.type&&(f[d.value]=null!=g?g:null);return f};g.prototype.getSpec=function(c){return null!=this.guideSpec&&null!=this.guideSpec[c]?this.guideSpec[c]:{}};g.prototype.makeGuides=function(c,b){var d,f;this.makeAxes();this.makeTitles(null!=(d=c.title)?d:"");this.makeLegends(null!=
(f=c.legendPosition)?f:"right",b);return{axes:this.axes,legends:this.legends,title:this.title}};g.prototype.renderGuides=function(c,b,d){this.axes.render(c,b,d);this.renderTitles(c,b);return this.renderLegends(c,b)};g.prototype.disposeGuides=function(c){this.axes.dispose(c);this.legends.dispose(c);this.titles.x.dispose(c);this.titles.y.dispose(c);this.titles.main.dispose(c);return this.titles={}};g.prototype.makeTitles=function(c){null==this.titles&&(this.titles={x:d.guide.title(this.coord.axisType("x")),
y:d.guide.title(this.coord.axisType("y")),main:d.guide.title("main")});this.titles.main.make({title:c,guideSpec:{},position:"top"});this.titles.x.make({guideSpec:this.getSpec("x"),title:d.getLabel(this.layers,"x")});return this.titles.y.make({guideSpec:this.getSpec("y"),title:d.getLabel(this.layers,"y")})};g.prototype.titleOffset=function(c){var b,d,f,h,g,l,q;c={};l=this.titles;for(d in l)for(b=l[d],f=b.getDimension(),q=["left","right","top"," bottom"],h=0,g=q.length;h<g;h++)b=q[h],f[b]&&(null==c[b]&&
(c[b]=0),c[b]+=f[b]);return c};g.prototype.renderTitles=function(c,b){var d;b=b({},!1,!1);d=this.axesOffset(c);this.titles.x.render(b,c,d);this.titles.y.render(b,c,d);return this.titles.main.render(b,c,d)};g.prototype.makeAxes=function(){var c;return this.axes.make({domains:{x:this.domains.x,y:this.domains.y},coord:this.coord,scales:this.scales,specs:null!=(c=this.guideSpec)?c:{},labels:{x:d.getLabel(this.layers,"x"),y:d.getLabel(this.layers,"y")}})};g.prototype.axesOffset=function(c){return this.axes.getDimension(c)};
g.prototype._mapLayers=function(c){var b,e,f,h,g;e={};g=d["const"].aes;f=0;for(h=g.length;f<h;f++)b=g[f],e[b]=_.map(c,function(c){return null!=c.mapping[b]?{type:"map",value:c.mapping[b]}:null!=c.consts[b]?{type:"const",value:c.consts[b]}:c.defaults[b]});return e};g.prototype.makeLegends=function(c,b){null==c&&(c="right");return this.legends.make({domains:this.domains,layers:this.layers,guideSpec:this.guideSpec,scales:this.scales,layerMapping:this.layerMapping,position:c,dims:b})};g.prototype.legendOffset=
function(c){return this.legends.getDimension(c)};g.prototype.renderLegends=function(c,b){var d,f,h,g,l,q,n,s,u;h={left:0,right:0,top:0,bottom:0};d=this.axesOffset(c);g=this.titleOffset(c);n=["left","right","top","bottom"];l=0;for(q=n.length;l<q;l++)f=n[l],h[f]+=null!=(s=d[f])?s:0,h[f]+=null!=(u=g[f])?u:0;return this.legends.render(c,b,h)};return g}()}).call(this);(function(){var g,n,l,c,b,e,f,h,r,m={}.hasOwnProperty,q=function(b,c){function d(){this.constructor=b}for(var e in c)m.call(c,e)&&(b[e]=
c[e]);d.prototype=c.prototype;b.prototype=new d;b.__super__=c.prototype;return b},v=[].indexOf||function(b){for(var c=0,d=this.length;c<d;c++)if(c in this&&this[c]===b)return c;return-1},s=function(b,c){return function(){return b.apply(c,arguments)}};d.data=function(b){var c,e;e=void 0;_.isObject(b)&&4>_.keys(b).length&&"data"in b?(c=b.data,e=b.meta):c=b;switch(h(c)){case "json-object":case "json-grid":case "json-array":return d.data.json(c,e,void 0);case "url":return d.data.url(c,e,void 0);case "csv":return d.data.csv(c,
e);case "api":return d.data.api(c);default:throw d.error.data("Unknown data format.");}};d.data.json=function(b,d,e){return new c({data:b,meta:d,type:e})};d.data.csv=function(b,d){return new c({data:b,meta:d,csv:"csv"})};d.data.url=function(b,c,d){return new l({url:b,computeBackend:c,limit:d})};d.data.api=function(b){return new n({apiFun:b})};h=function(b){if(_.isArray(b))return _.isArray(b[0])?"json-grid":"json-array";if(_.isObject(b))return"json-object";if(_.isString(b))return d.isURI(b)?"url":
"csv";if(_.isFunction(b))return"api";throw d.error.data("Unknown data format.");};b=function(b,c){var e,f,h,g,l,m,r;if(0<b.length){h=_.union(_.keys(c),_.keys(b[0]));e=b.slice(0,100);g=0;for(l=h.length;g<l;g++)f=h[g],null==c[f]&&(c[f]={}),c[f].type||(c[f].type=d.type.impute(_.pluck(e,f)));g=0;for(m=b.length;g<m;g++)for(e=b[g],l=0,r=h.length;l<r;l++)f=h[l],e[f]=d.type.coerce(e[f],c[f]);f=h;h=b}else f=_.keys(c),h=[];return{key:f,raw:h,meta:c}};e=function(b,c){var e,f,h,g,l,m,r,q,A,s,w;m=[];if(0<b.length){g=
c&&_.isArray(c)?c:c&&_.isObject(c)?_.keys(c):_.keys(b[0]);if(_.isArray(c)||!_.isObject(c))c={};e=b.slice(0,100);f=l=0;for(r=g.length;l<r;f=++l)h=g[f],null==c[h]&&(c[h]={}),c[h].type||(c[h].type=d.type.impute(_.pluck(e,f)));q=0;for(s=b.length;q<s;q++){e=b[q];l={};f=A=0;for(w=e.length;A<w;f=++A)r=e[f],h=g[f],l[h]=d.type.coerce(r,c[h]);m.push(l)}h=g;f=m}else h=_.keys(c),f=[];return{key:h,raw:f,meta:c}};r=function(b,c){var e,f,h,g,l,m,r,q,A;h=_.keys(b);l=[];m=0;for(f=h.length;m<f;m++)e=h[m],null==c[e]&&
(c[e]={}),c[e].type||(c[e].type=d.type.impute(b[e].slice(0,100)));if(0<h.length&&(f=b[h[0]].length,0<f))for(e=m=0,A=f-1;0<=A?m<=A:m>=A;e=0<=A?++m:--m){g={};r=0;for(q=h.length;r<q;r++)f=h[r],g[f]=d.type.coerce(b[f][e],c[f]);l.push(g)}return{key:h,raw:l,meta:c}};f=function(c,e){return b(d.csv.parse(c),e)};g=function(){function b(){this.raw=null;this.meta={};this.key=[];this.subscribed=[];this.computeBackend=!1}b.prototype.isData=!0;b.prototype.update=function(){var b,c,d,e,f;e=this.subscribed;f=[];
c=0;for(d=e.length;c<d;c++)b=e[c],f.push(b());return f};b.prototype.subscribe=function(b){if(-1===_.indexOf(this.subscribed,b))return this.subscribed.push(b)};b.prototype.unsubscribe=function(b){return this.subscribed.splice(_.indexOf(this.subscribed,b),1)};b.prototype.keys=function(){return this.key};b.prototype.rename=function(){return!1};b.prototype.renameMany=function(){return!1};b.prototype.remove=function(){return!1};b.prototype.filter=function(){return!1};b.prototype.sort=function(){return!1};
b.prototype.derive=function(){return!1};b.prototype.get=function(b){if(this.raw)return _.pluck(this.raw,b);throw d.error.data("Data has not been fetched or is undefined.");};b.prototype.len=function(){if(this.raw)return this.raw.length;throw d.error.data("Data has not been fetched or is undefined.");};b.prototype.getObject=function(b){if(this.raw)return this.raw[b];throw d.error.data("Data has not been fetched or is undefined.");};b.prototype.max=function(b){return _.max(this.get(b))};b.prototype.min=
function(b){return _.min(this.get(b))};b.prototype.getMeta=function(b){if(this.meta)return this.meta[b]};b.prototype.type=function(b){if(b in this.meta)return b=this.meta[b].type,"num"===b?"number":b;throw d.error.defn("Data does not have column "+b+".");};return b}();c=function(c){function k(b){k.__super__.constructor.call(this);this._setData(b)}q(k,c);k.prototype.getData=function(b){return b(null,this)};k.prototype.update=function(b){this._setData(b);return k.__super__.update.call(this)};k.prototype._setData=
function(c){var k,g,l;_.isObject(c)&&4>_.keys(c).length&&"data"in c?(k=c.data,g=null!=(l=c.meta)?l:{}):(k=c,g={});l=function(){var l;switch(null!=(l=c.type)?l:h(k)){case "json-object":return r(k,g);case "json-grid":return e(k,g);case "json-array":return b(k,g);case "csv":return f(k,g);default:throw d.error.data("Unknown data format.");}}();this.key=l.key;this.raw=l.raw;this.meta=l.meta;return this.data=this.raw};k.prototype._checkRename=function(b,c){if(""===c)throw d.error.defn("Column names cannot be an empty string");
if(-1===_.indexOf(this.key,b))throw d.error.defn("The key "+b+" doesn't exist!");if(-1!==_.indexOf(this.key,c))throw d.error.defn("The key "+c+" already exists!");};k.prototype.rename=function(b,c,d){var e,f,k;null==d&&(d=!1);b=b.toString();c=c.toString();if(b===c)return!0;d||this._checkRename(b,c);k=this.raw;e=0;for(f=k.length;e<f;e++)d=k[e],d[c]=d[b],delete d[b];d=_.indexOf(this.key,b);this.key[d]=c;this.meta[c]=this.meta[b];delete this.meta[b];return!0};k.prototype.renameMany=function(b){var c,
d;for(c in b)d=b[c],c!==d&&this._checkRename(c,d);for(c in b)d=b[c],c!==d&&this.rename(c,d,!0);return!0};k.prototype.remove=function(b){var c,d,e,f;c=_.indexOf(this.key,b);if("-1"===c)return!1;this.key.splice(c,1);delete this.meta[b];f=this.raw;d=0;for(e=f.length;d<e;d++)c=f[d],delete c[b];return!0};k.prototype.filter=function(b){var c,e,f,k,h;b=_.isFunction(b)?b:_.isString(b)?new Function("d","with(d) { return "+b+";}"):function(){return!0};e=[];h=this.raw;f=0;for(k=h.length;f<k;f++)c=h[f],b(c)&&
e.push(c);return d.data.json(e,this.meta)};k.prototype.sort=function(b,c){var e,f,k;k=this.type(b);e=_.clone(this.raw);f=d.type.compare(k);e.sort(function(c,d){return f(c[b],d[b])});c&&e.reverse();return d.data.json(e,this.meta)};k.prototype.derive=function(b,c,e){var f,k,h,g,l,m,r,w;null==e&&(e={});k=e.dryrun;f=e.context;null==c&&(c=_uniqueId("var_"));null==f&&(f={});_.isFunction(b)?(e=b,h=!1):(h=!0,e=new Function("d","with(this) { with(d) { return "+b(b)+";}}"));w=this.raw;m=0;for(r=w.length;m<
r;m++){g=w[m];l=e.call(f,g);if(_.isFunction(l))throw d.error.defn("Derivation function returned another function.");g[c]=l}if(k)return{success:!0,values:_.pluck(this.raw.slice(0,11),c)};0<=v.call(this.key,c)||this.key.push(c);this.meta[c]={type:d.type.impute(_.pluck(this.raw.slice(0,101),c)),derived:!0};h&&(this.meta[c].formula=b);return c};return k}(g);l=function(c){function k(b){this.getData=s(this.getData,this);k.__super__.constructor.call(this);this.url=b.url;this.computeBackend=b.computeBackend;
this.limit=b.limit;null==this.computeBackend&&(this.computeBackend=!1)}q(k,c);k.prototype.getData=function(c,k){var g,l,m=this;if(null!=this.raw&&!this.computeBackend)return c(null,this);g=-1===_.indexOf(this.url,"?")?"?":"&";l=this.url;this.limit&&(l+=""+g+"limit="+this.limit);k&&(l+="&spec="+encodeURIComponent(JSON.stringify(k)));return d.text(l,function(k){var g,l,p;try{k=JSON.parse(k)}catch(q){}_.isObject(k)&&4>_.keys(k).length&&"data"in k?(g=k.data,l=null!=(p=k.meta)?p:{}):(g=k,l={});k=function(){switch(h(g)){case "json-object":return r(g,
l);case "json-grid":return e(g,l);case "json-array":return b(g,l);case "csv":return f(g,l);default:throw d.error.data("Unknown data format.");}}();m.key=k.key;m.raw=k.raw;m.meta=k.meta;m.data=m.raw;return c(null,m)})};k.prototype.update=function(b){this.raw=null;return k.__super__.update.call(this)};k.prototype.renameMany=function(b){return 0===_.keys(b).length};return k}(g);n=function(c){function e(b){this.getData=s(this.getData,this);e.__super__.constructor.call(this);this.apiFun=b.apiFun;this.computeBackend=
!0}q(e,c);e.prototype.getData=function(c,e){var k=this;return this.apiFun(e,function(e,g){var l,p,m,q,u;if(null!=e)return c(e,null);try{g=JSON.parse(g)}catch(w){p=w}try{return l=g.data,m=null!=(q=g.meta)?q:{},u=function(){switch(h(l)){case "json-object":return r(l,m);case "json-grid":return _getArrayofArrays(l,m);case "json-array":return b(l,m);case "csv":return f(l,m);default:throw d.error.data("Unknown data format.");}}(),k.key=u.key,k.raw=u.raw,k.meta=u.meta,k.data=k.raw,c(null,k)}catch(y){return p=
y,c(p)}})};e.prototype.update=function(b){this.raw=null;return e.__super__.update.call(this)};e.prototype.renameMany=function(b){return 0===_.keys(b).length};return e}(g)}).call(this);(function(){var g,n,l,c,b,e,f,h,r,m,q,v=function(b,c){return function(){return b.apply(c,arguments)}},s=[].indexOf||function(b){for(var c=0,d=this.length;c<d;c++)if(c in this&&this[c]===b)return c;return-1};g=function(){function b(c,e,f){this._wrap=v(this._wrap,this);this.layerMeta=c.meta;this.dataObj=c.data;this.initialSpec=
d.parser.layerToData(c,e);this.prevSpec=null;this.strictmode=f;this.statData=null;this.metaData={}}b.prototype.reset=function(b){return this.make(this.initialSpec,b)};b.prototype.make=function(b,c,e){var h,g;g=this._wrap(e);this.strictmode&&g({data:this.dataObj.raw,meta:this.dataObj.meta});if(this.dataObj.computeBackend)return h=d.parser.layerToData(b,c),this.layerMeta&&1>_.size(h.meta)&&(h.meta=this.layerMeta),n(h,this.dataObj,g);h=d.parser.layerToData(b,c);return this.dataObj.getData(function(b,
c){var d,e,k,l;if(null!=b)return g(b,null);if(0<=s.call(h.select,"count(*)")){l=c.data;e=0;for(k=l.length;e<k;e++)d=l[e],d["count(*)"]=1;c.meta["count(*)"]={};c.meta["count(*)"].type="num";h.stats.stats.push({key:"count(*)",name:"count(*)",stat:"count"})}return f(h,c,g)})};b.prototype._wrap=function(b){var c=this;return function(d,e){var f,h;if(null!=d)return b(d,null,null);f=e.data;h=e.meta;c.statData=f;c.metaData=h;return b(null,c.statData,c.metaData)}};return b}();d.DataProcess=g;d.data.process=
function(b,c,d,e){b=new g(c,d);b.process(e);return b};q={bin:function(b,c,e){var f,h;h=c.name;f=c.binwidth;if("num"===e.type){if(isNaN(f))throw d.error.defn("The binwidth "+f+" is invalid for a numeric varliable");f=+f;c=function(c){return c[h]=f*Math.floor(c[b]/f)};return{trans:c,meta:{bw:f,binned:!0,type:"num"}}}if("date"===e.type){if(!(0<=s.call(d["const"].timerange,f)))throw d.error.defn("The binwidth "+f+" is invalid for a datetime varliable");c=function(c){var d;d=function(d,e){var f;f=moment.unix(c[b]).startOf(e);
f[e](d*Math.floor(f[e]()/d));return c[h]=f.unix()};switch(f){case "week":return c[h]=moment.unix(c[b]).day(0).unix();case "twomonth":return d(2,"month");case "quarter":return d(4,"month");case "sixmonth":return d(6,"month");case "twoyear":return d(2,"year");case "fiveyear":return d(5,"year");case "decade":return d(10,"year");default:return c[h]=moment.unix(c[b]).startOf(f).unix()}};return{trans:c,meta:{bw:f,binned:!0,type:"date"}}}},lag:function(b,c,d){var e,f,h;h=c.name;e=c.lag;f=function(){var b,
c;c=[];for(b=1;1<=e?b<=e:b>=e;1<=e?++b:--b)c.push(void 0);return c}();return{trans:function(c){f.push(c[b]);return c[h]=f.shift()},meta:{type:d.type}}}};m=function(b,c,d){return q[c.trans](b,c,null!=d?d:{})};e={lt:function(b,c){return b<c},le:function(b,c){return b<=c},gt:function(b,c){return b>c},ge:function(b,c){return b>=c},"in":function(b,c){return 0<=s.call(c,b)}};b=function(b){var c;c=[];_.each(b,function(b,d){return _.each(b,function(b,f){return c.push(function(c){return e[f](c[d],b)})})});
return function(b){var d,e,f;e=0;for(f=c.length;e<f;e++)if(d=c[e],!d(b))return!1;return!0}};h={sum:function(b){return function(b){return _.reduce(_.without(b,void 0,null),function(b,c){return b+c},0)}},mean:function(b){return function(b){b=_.without(b,void 0,null);return _.reduce(b,function(b,c){return b+c},0)/b.length}},count:function(b){return function(b){return _.without(b,void 0,null).length}},unique:function(b){return function(b){return _.uniq(_.without(b,void 0,null)).length}},min:function(b){return function(b){return _.min(b)}},
max:function(b){return function(b){return _.max(b)}},median:function(b){return function(b){return d.median(b)}},box:function(b){return function(b){var c,e,f,h,g,l;e=b.length;return 5<e?(h=e/2,b=_.sortBy(b,function(b){return b}),c=Math.ceil(h)/2,0!==c%1?(c=Math.floor(c),h=b[c],e=b[e-1-c]):(h=(b[c]+b[c-1])/2,e=(b[e-c]+b[e-c-1])/2),c=e-h,f=h-1.5*c,g=e+1.5*c,c=_.groupBy(b,function(b){return b>=f&&b<=g}),{q1:_.min(c["true"]),q2:h,q3:d.median(b,!0),q4:e,q5:_.max(c["true"]),outliers:null!=(l=c["false"])?
l:[]}):{outliers:b}}}};r=function(b){return h[b.stat](b)};c=function(b,c){var e,f;f={};_.each(c.stats,function(b){var c,d,e;c=b.key;d=b.name;e=r(b);return f[d]=function(b){return e(_.pluck(b,c))}});e=d.groupBy(b,c.groups);return _.map(e,function(b){var d;d={};_.each(c.groups,function(c){return d[c]=b[0][c]});_.each(f,function(c,e){return d[e]=c(b)});return d})};l=function(b,d,e){var f,h,g,l;g=d.sort;l=d.stat;f=d.limit;d=d.asc;l&&(l={stats:[l],groups:[b]},e=c(e,l));h=d?1:-1;e.sort(function(b,c){return b[g]===
c[g]?0:b[g]>=c[g]?1*h:-1*h});f&&(e=e.slice(0,+(f-1)+1||9E9));b=_.uniq(_.pluck(e,b));return{meta:{levels:b,sorted:!0},filter:{"in":b}}};f=function(e,f,h){var g,r,q,s,n,v,G,A,C,w,y,E,H;G=_.clone(f.meta);f=_.clone(f.raw);null==G&&(G={});g=function(b,c){var d;return G[b]=_.extend(null!=(d=G[b])?d:{},c)};if(e.trans)for(H=e.trans,s=0,y=H.length;s<y;s++){A=H[s];n=A.key;v=m(n,A,G[n]);r=v.trans;v=v.meta;C=0;for(E=f.length;C<E;C++)q=f[C],r(q);g(A.name,v)}e.filter&&(f=_.filter(f,b(e.filter)));if(e.meta){r={};
A=e.meta;for(n in A)v=A[n],s=l(n,v,f),v=s.meta,s=s.filter,r[n]=s,g(n,v);f=_.filter(f,b(r))}if(e.stats&&e.stats.stats&&0<e.stats.stats.length)for(f=c(f,e.stats),r=e.stats.stats,n=0,v=r.length;n<v;n++)A=r[n],A=A.name,g(A,{type:"num"});e=null!=(w=e.select)?w:[];w=0;for(g=e.length;w<g;w++)if(n=e[w],null==G[n]&&"count(*)"!==n)throw d.error.defn("You referenced a data column "+n+" that doesn't exist.");return h(null,{data:f,meta:G})};n=function(b,c,d){return c.getData(d,b)};d.data.frontendProcess=f}).call(this);
(function(){var g,n,l,c,b,e,f,h,r,m,q,v,s,u,k,x,p,t,z,D,B,F,G=[].indexOf||function(b){for(var c=0,d=this.length;c<d;c++)if(c in this&&this[c]===b)return c;return-1},A={}.hasOwnProperty,C=function(b,c){function d(){this.constructor=b}for(var e in c)A.call(c,e)&&(b[e]=c[e]);d.prototype=c.prototype;b.prototype=new d;b.__super__=c.prototype;return b};q=d["const"].aes;s=d["const"].scaleFns;v={x:s.novalue(),y:s.novalue(),color:"steelblue",size:5,opacity:0.9,shape:1};c=function(){function b(c,d,e){var f;
this.spec=c;this.guideSpec=e;this.mapping={};this.consts={};e=0;for(f=q.length;e<f;e++)d=q[e],c[d]&&(c[d]["var"]&&(this.mapping[d]=c[d]["var"]),c[d]["const"]&&(this.consts[d]=c[d]["const"]))}b.prototype.defaults=v;b.prototype.calculate=function(b,c){var d,e,f;this.statData=b;this.meta=c;this._calcGeoms();this.geoms=this._sample(this.geoms);c={};f=this.mapping;for(d in f)e=f[d],c[d]=this.meta[e];return{geoms:this.geoms,meta:c}};b.prototype._calcGeoms=function(){throw d.error.impl();};b.prototype._tooltip=
function(b){var c=this;return"function"===typeof this.spec.tooltip?function(d){return c.spec.tooltip(b)}:null!=this.spec.tooltip?function(b){return c.spec.tooltip}:function(e){var f,h,g,k,l,m;l="";k=[];m=c.mapping;for(f in m)g=m[f],-1===k.indexOf(g)&&(k.push(g),h=null!=e&&null!=e[f]?d.format(e[f].domain.type,e[f].domain.bw):function(b){return b},l+="\n"+g+": "+h(b[g]));return l.substr(1)}};b.prototype._sample=function(b){if(!1===this.spec.sample)return b;if(_.isNumber(this.spec.sample))return d.sample(b,
this.spec.sample);throw d.error.defn("A layer's 'sample' definition should be an integer, not "+this.spec.sample);};b.prototype._getValue=function(b,c){return this.mapping[c]?b[this.mapping[c]]:this.consts[c]?s.identity(this.consts[c]):"x"===c||"y"===c?this.defaults[c]:s.identity(this.defaults[c])};b.prototype._getIdFunc=function(){var b=this;return null!=this.mapping.id?function(c){return b._getValue(c,"id")}:d.counter()};b.prototype._fillZeros=function(b,c){var d,e,f;d=function(){var c,d,f;f=[];
c=0;for(d=b.length;c<d;c++)e=b[c],f.push(this._getValue(e,"x"));return f}.call(this);f=_.difference(c,d);return{x:d.concat(f),y:function(){var c,d,f;f=[];c=0;for(d=b.length;c<d;c++)e=b[c],f.push(this._getValue(e,"y"));return f}.call(this).concat(function(){var b,c,d;d=[];b=0;for(c=f.length;b<c;b++)d.push(void 0);return d}())}};b.prototype._stack=function(b){var c,e,f,h,g,k,l=this;b=d.groupBy(this.statData,b);k=[];for(f in b)c=b[f],h=0,g=null!=this.mapping.y?function(b){return b[l.mapping.y]}:function(b){return 0},
k.push(function(){var b,d,f;f=[];b=0;for(d=c.length;b<d;b++)e=c[b],e.$lower=h,h+=parseFloat(g(e)),f.push(e.$upper=h);return f}());return k};b.prototype._dodge=function(b){var c,e,f,h,g,k,l,m,r,w,q,p,s=this;f=_.without(_.keys(this.mapping),"x","y","id");_.toArray(_.pick(this.mapping,f));q=d.groupBy(this.statData,b);p=[];for(g in q){e=q[g];l={};k=1;r=0;for(w=f.length;r<w;r++)c=f[r],b=_.uniq(function(){var b,d,f;f=[];b=0;for(d=e.length;b<d;b++)h=e[b],f.push(this._getValue(h,c));return f}.call(this)),
k*=b.length,b.sort(d.type.compare(this.meta[this.mapping[c]].type)),l[c]=b;m=function(b){var d,e,h,g;d=k;h=e=0;for(g=f.length;h<g;h++)c=f[h],d/=l[c].length,e+=d*_.indexOf(l[c],s._getValue(b,c));return e};p.push(function(){var b,c,d;d=[];b=0;for(c=e.length;b<c;b++)h=e[b],h.$n=m(h),d.push(h.$m=k);return d}())}return p};b.prototype._inLevels=function(b){var c,d,e;d=["x","y"];for(c=d.length;0<c;)return c=d[0],null!=this.guideSpec[c]&&null!=this.guideSpec[c].levels?(e=b[this.spec[c]["var"]],0<=G.call(this.guideSpec[c].levels,
e)):!0};return b}();f=function(b){function c(){return u=c.__super__.constructor.apply(this,arguments)}C(c,b);c.prototype._calcGeoms=function(){var b,c,d,e,f,h,g,k,l;c=this._getIdFunc();this.geoms={};k=this.statData;l=[];h=0;for(g=k.length;h<g;h++){d=k[h];b={};for(e in d)f=d[e],b[e]={"in":[f]};l.push(this.geoms[c(d)]={marks:{0:{type:"circle",x:this._getValue(d,"x"),y:this._getValue(d,"y"),color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._inLevels(d)?this._getValue(d,"opacity"):
0}},evtData:b,tooltip:this._tooltip(d)})}return l};return c}(c);e=function(b){function c(){return k=c.__super__.constructor.apply(this,arguments)}C(c,b);c.prototype._calcGeoms=function(){var b,c,e,f,h,g,k,l,m,r,q,w=this;f=function(){var b,c,d,e;d=_.without(_.keys(this.mapping),"x","y");e=[];b=0;for(c=d.length;b<c;b++)g=d[b],e.push(this.mapping[g]);return e}.call(this);c=d.groupBy(this.statData,f);h=this._getIdFunc();this.geoms={};q=[];for(g in c){b=c[g];l=b[0];e={};m=0;for(r=f.length;m<r;m++)k=f[m],
e[k]={"in":[l[k]]};q.push(this.geoms[h(l)]={marks:{0:{type:"path",x:_.map(b,function(b){return w._getValue(b,"x")}),y:_.map(b,function(b){return w._getValue(b,"y")}),color:this._getValue(l,"color"),opacity:this._getValue(l,"opacity"),size:this._getValue(l,"size")}},evtData:e})}return q};return c}(c);b=function(b){function c(){return x=c.__super__.constructor.apply(this,arguments)}C(c,b);c.prototype.defaults={x:s.novalue(),y:s.novalue(),color:"steelblue",size:1,opacity:0.9,shape:1};c.prototype._calcGeoms=
function(){var b,c,e,f,h,g,k,l,m,r,q,w,p,y,s,n;b=_.uniq(function(){var b,c,d,e;d=this.statData;e=[];b=0;for(c=d.length;b<c;b++)k=d[b],e.push(this._getValue(k,"x"));return e}.call(this));h=function(){var b,c,d,e;d=_.without(_.keys(this.mapping),"x","y");e=[];b=0;for(c=d.length;b<c;b++)l=d[b],e.push(this.mapping[l]);return e}.call(this);e=_.pairs(d.groupBy(this.statData,h));g=this._getIdFunc();this.geoms={};q=1===_.max(e,function(b){return b[1].length})[1].length;n=[];f=w=0;for(y=e.length;w<y;f=++w){r=
e[f];m=r[0];c=r[1];q&&f+1<e.length&&c.push(e[f+1][1][0]);r=c[0];f={};p=0;for(s=h.length;p<s;p++)m=h[p],f[m]={"in":[r[m]]};c=this._fillZeros(c,b);m=c.x;c=c.y;n.push(this.geoms[g(r)]={marks:{0:{type:"line",x:m,y:c,color:this._getValue(r,"color"),opacity:this._getValue(r,"opacity"),size:this._getValue(r,"size")}},evtData:f})}return n};return c}(c);h=function(b){function c(){return p=c.__super__.constructor.apply(this,arguments)}C(c,b);c.prototype._calcGeoms=function(){var b,d,e,f,h,g;c.__super__._calcGeoms.call(this);
h=this.geoms;g=[];for(d in h)b=h[d],g.push(function(){var c,d;c=b.marks;d=[];for(e in c)f=c[e],d.push(f.type="spline");return d}());return g};return c}(b);n=function(b){function c(){return t=c.__super__.constructor.apply(this,arguments)}C(c,b);c.prototype._calcGeoms=function(){var b,c;if(this.mapping.y&&"cat"===this.meta[this.mapping.y].type)throw d.error.defn("The dependent variable of a bar chart cannot be categorical!");if(this.mapping.x&&(b=this.meta[this.mapping.x],"cat"!==b.type&&!b.bw&&!b.binned&&
"num"===b.type&&null==this.guideSpec.x.bw))throw d.error.type("Bar chart x-values need to be binned. Set binwidth or use the bin() transform!");this.position=null!=(c=this.spec.position)?c:"stack";if("stack"===this.position)return this._calcGeomsStack();if("dodge"===this.position)return this._calcGeomsDodge();throw d.error.defn("Bar chart position "+this.position+" is unknown.");};c.prototype._calcGeomsDodge=function(){var b,c,d,e,f,h,g,k,l,m;b=null!=this.mapping.x?[this.mapping.x]:[];this._dodge(b);
this._stack(b.concat("$n"));this.geoms={};c=this._getIdFunc();l=this.statData;m=[];g=0;for(k=l.length;g<k;g++){d=l[g];b={};for(e in d)f=d[e],"y"!==e&&(b[e]={"in":[f]});f=s.lower(this._getValue(d,"x"),d.$n,d.$m);h=s.upper(this._getValue(d,"x"),d.$n,d.$m);m.push(this.geoms[c(d)]={marks:{0:{type:"rect",x:[f,h],y:[d.$lower,d.$upper],color:this._getValue(d,"color"),opacity:this._inLevels(d)?this._getValue(d,"opacity"):0}},evtData:b,tooltip:this._tooltip(d)})}return m};c.prototype._calcGeomsStack=function(){var b,
c,d,e,f,h,g,k,l;this._stack(null!=this.mapping.x?[this.mapping.x]:[]);c=this._getIdFunc();this.geoms={};k=this.statData;l=[];h=0;for(g=k.length;h<g;h++){d=k[h];b={};for(e in d)f=d[e],"y"!==e&&(b[e]={"in":[f]});l.push(this.geoms[c(d)]={marks:{0:{type:"rect",x:[s.lower(this._getValue(d,"x")),s.upper(this._getValue(d,"x"))],y:[d.$lower,d.$upper],color:this._getValue(d,"color"),opacity:this._inLevels(d)?this._getValue(d,"opacity"):0}},evtData:b,tooltip:this._tooltip(d)})}return l};return c}(c);g=function(b){function c(){return z=
c.__super__.constructor.apply(this,arguments)}C(c,b);c.prototype._calcGeoms=function(){var b,c,e,f,h,g,k,l,m,r,q,w,p,s,y,n;b=function(){var b,c,e,f;e=this.statData;f=[];b=0;for(c=e.length;b<c;b++)l=e[b],d.isDefined(this._getValue(l,"y"))&&d.isDefined(w=this._getValue(l,"x"))&&f.push(w);return f}.call(this);b=_.uniq(b);c={};f=0;for(h=b.length;f<h;f++)r=b[f],c[r]=0;g=function(){var b,c,d,e;d=_.without(_.keys(this.mapping),"x","y");e=[];b=0;for(c=d.length;b<c;b++)m=d[b],e.push(this.mapping[m]);return e}.call(this);
f=d.groupBy(this.statData,g);k=this._getIdFunc();this.geoms={};n=[];for(m in f){e=f[m];q=e[0];h={};p=0;for(s=g.length;p<s;p++)r=g[p],h[r]={"in":[q[r]]};r=function(){var d,e,f;f=[];d=0;for(e=b.length;d<e;d++)w=b[d],f.push(c[w]);return f}();s=0;for(y=e.length;s<y;s++)l=e[s],w=this._getValue(l,"x"),p=this._getValue(l,"y"),c[w]+=p;e=function(){var d,e,f;f=[];d=0;for(e=b.length;d<e;d++)w=b[d],f.push(c[w]);return f}();n.push(this.geoms[k(q)]={marks:{0:{type:"area",x:b,y:{bottom:r,top:e},color:this._getValue(q,
"color"),opacity:this._getValue(q,"opacity")}},evtData:h})}return n};return c}(c);r=function(b){function c(){return D=c.__super__.constructor.apply(this,arguments)}C(c,b);c.prototype._calcGeoms=function(){var b,c,d,e,f,h,g,k,l;c=this._getIdFunc();this.geoms={};k=this.statData;l=[];h=0;for(g=k.length;h<g;h++){d=k[h];b={};for(e in d)f=d[e],b[e]={"in":[f]};l.push(this.geoms[c(d)]={marks:{0:{type:"text",x:this._getValue(d,"x"),y:this._getValue(d,"y"),text:this._getValue(d,"text"),color:this._getValue(d,
"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity"),"text-anchor":"center"}},evtData:b})}return l};return c}(c);m=function(b){function c(){return B=c.__super__.constructor.apply(this,arguments)}C(c,b);c.prototype._calcGeoms=function(){var b,c,d,e,f,h,g,k,l;c=this._getIdFunc();this.geoms={};k=this.statData;l=[];h=0;for(g=k.length;h<g;h++){d=k[h];b={};this._getValue(d,"x");this._getValue(d,"y");for(e in d)f=d[e],"y"!==e&&"x"!==e&&(b[e]={"in":[f]});l.push(this.geoms[c(d)]={marks:{0:{type:"rect",
x:[s.lower(this._getValue(d,"x")),s.upper(this._getValue(d,"x"))],y:[s.lower(this._getValue(d,"y")),s.upper(this._getValue(d,"y"))],color:this._getValue(d,"color"),size:this._getValue(d,"size"),opacity:this._getValue(d,"opacity")}},evtData:b,tooltip:this._tooltip(d)})}return l};return c}(c);l=function(b){function c(){return F=c.__super__.constructor.apply(this,arguments)}C(c,b);c.prototype._calcGeoms=function(){var b,c,d,e,f,h,g,k,l,m,r,q,w,p,n,y;d=this._getIdFunc();this.geoms={};n=this.statData;
y=[];q=0;for(w=n.length;q<w;q++){f=n[q];c={};for(h in f)b=f[h],"y"!==h&&(c[h]={"in":[b]});l=this._getValue(f,"x");r=this._getValue(f,"y");b=this._getValue(f,"color");e=this._getValue(f,"size");g=this._inLevels(f)?this._getValue(f,"opacity"):0;k=s.lower(l);m=s.upper(l);l=s.middle(l);c={marks:{},evtData:c};r.q1&&(c.marks={iqr:{type:"rect",x:[k,m],y:[r.q2,r.q4],stroke:b,color:s.identity("white"),size:e,opacity:g,"stroke-width":"1px"},q1:{type:"pline",x:[k,m],y:[r.q1,r.q1],color:b,size:e,opacity:g},lower:{type:"pline",
x:[l,l],y:[r.q1,r.q2],color:b,size:e,opacity:g},q5:{type:"pline",x:[k,m],y:[r.q5,r.q5],color:b,size:e,opacity:g},upper:{type:"pline",x:[l,l],y:[r.q4,r.q5],color:b,size:e,opacity:g},middle:{type:"pline",x:[k,m],y:[r.q3,r.q3],color:b,size:e,opacity:g}});p=r.outliers;e=m=0;for(r=p.length;m<r;e=++m)k=p[e],c.marks[e]={type:"circle",x:l,y:k,color:b,size:s.identity(3),opacity:g};y.push(this.geoms[d(f)]=c)}return y};return c}(c);d.layer={};d.layer.Base=c;d.layer.classes={point:f,text:r,line:b,path:e,area:g,
bar:n,tile:m,box:l,spline:h};d.layer.make=function(b,c,e){var f;f=b.type;if(f in d.layer.classes)return new d.layer.classes[f](b,c,e);throw d.error.defn("No such layer "+b.type+".");}}).call(this);(function(){var g,n={}.hasOwnProperty,l=function(c,b){function d(){this.constructor=c}for(var f in b)n.call(b,f)&&(c[f]=b[f]);d.prototype=b.prototype;c.prototype=new d;c.__super__=b.prototype;return c};d.pane={};d.pane.make=function(c,b){return new g(c,b)};g=function(c){function b(b,c){this.titleObj=c;this.index=
b;this.title=this.layers=null}l(b,c);b.prototype.make=function(b,c,h){var g,l,q,n,s;this.layers=h;if(!this.geoms)for(this.geoms={},n=this.layers,h=q=0,n=n.length;q<n;h=++q)this.geoms[h]=new d.Geometry;this.metas={};s=this.layers;h=q=0;for(n=s.length;q<n;h=++q)g=s[h],l=g.calculate(c[h].statData,c[h].metaData),g=l.geoms,l=l.meta,this.geoms[h].set(g),this.metas[h]=l;null==this.title&&(this.title=this._makeTitle(b));this.title.make(this.titleObj);return this.domains=this._makeDomains(b,this.geoms,this.metas)};
b.prototype._makeTitle=function(){return d.guide.title("facet")};b.prototype._makeDomains=function(b,c,h){return d.domain.make(c,h,b.guides,b.strict)};b.prototype.render=function(b,c,d,g){var l;this.title.render(b({},!1,!1),g,c);c=b(c,d,!0);d=this.geoms;g=[];for(l in d)b=d[l],g.push(b.render(c));return g};b.prototype.dispose=function(b){var c,d,g;g=this.geoms;for(d in g)c=g[d],c.dispose(b);this.geoms={};return this.title.dispose(b)};return b}(d.Renderable)}).call(this);(function(){d.dim={};d.dim.make=
function(d,n,l){var c,b,e,f,h,r,m,q;d={width:null!=(b=d.width)?b:400,height:null!=(e=d.height)?e:400,paddingLeft:null!=(f=d.paddingLeft)?f:10,paddingRight:null!=(c=d.paddingRight)?c:10,paddingTop:null!=(h=d.paddingTop)?h:10,paddingBottom:null!=(r=d.paddingBottom)?r:10,horizontalSpacing:null!=(m=d.horizontalSpacing)?m:10,verticalSpacing:null!=(q=d.verticalSpacing)?q:20,guideTop:10,guideRight:0,guideLeft:5,guideBottom:5};c=n.axesOffset(d);b=c.left;e=c.right;f=c.top;c=c.bottom;d.guideLeft+=null!=b?b:
0;d.guideRight+=null!=e?e:0;d.guideBottom+=null!=c?c:0;d.guideTop+=null!=f?f:0;c=n.titleOffset(d);b=c.left;e=c.right;f=c.top;c=c.bottom;d.guideLeft+=null!=b?b:0;d.guideRight+=null!=e?e:0;d.guideBottom+=null!=c?c:0;d.guideTop+=null!=f?f:0;n=n.legendOffset(d);b=n.left;e=n.right;f=n.top;c=n.bottom;d.guideLeft+=null!=b?b:0;d.guideRight+=null!=e?e:0;d.guideBottom+=null!=c?c:0;d.guideTop+=null!=f?f:0;n=0.4*d.width;b=0.4*d.height;d.guideLeft>n&&(d.guideLeft=n);d.guideRight>n&&(d.guideRight=n);d.guideTop>
b&&(d.guideTop=b);d.guideBottom>b&&(d.guideBottom=b);d.chartHeight=d.height-d.paddingTop-d.paddingBottom-d.guideTop-d.guideBottom;d.chartWidth=d.width-d.paddingLeft-d.paddingRight-d.guideLeft-d.guideRight;null!=l.cols&&1<l.cols?(d.eachWidth=d.chartWidth-d.horizontalSpacing*l.cols,d.eachWidth/=l.cols):d.eachWidth=d.chartWidth;null!=l.rows&&1<l.rows?(d.eachHeight=d.chartHeight-d.verticalSpacing*(l.rows+1),d.eachHeight/=l.rows):d.eachHeight=d.chartHeight-d.verticalSpacing;return d};d.dim.guess=function(d,
n){var l,c,b,e,f,h,r,m,q;l={width:null!=(c=d.width)?c:400,height:null!=(b=d.height)?b:400,paddingLeft:null!=(e=d.paddingLeft)?e:10,paddingRight:null!=(f=d.paddingRight)?f:10,paddingTop:null!=(h=d.paddingTop)?h:10,paddingBottom:null!=(r=d.paddingBottom)?r:10,guideLeft:30,guideRight:40,guideTop:10,guideBottom:30,horizontalSpacing:null!=(m=d.horizontalSpacing)?m:10,verticalSpacing:null!=(q=d.verticalSpacing)?q:10};l.chartHeight=l.height-l.paddingTop-l.paddingBottom-l.guideTop-l.guideBottom;l.chartWidth=
l.width-l.paddingLeft-l.paddingRight-l.guideLeft-l.guideRight;l.eachWidth=null!=n.cols&&1<n.cols?l.chartWidth-l.horizontalSpacing*(n.cols-1):l.chartWidth;l.eachHeight=null!=n.rows&&1<n.rows?l.chartHeight-l.verticalSpacing*(n.rows-1):l.chartHeight;return l}}).call(this);(function(){var g,n,l,c,b,e,f,h,r,m,q,v,s,u,k,x,p,t,z,D,B={}.hasOwnProperty,F=function(b,c){function d(){this.constructor=b}for(var e in c)B.call(c,e)&&(b[e]=c[e]);d.prototype=c.prototype;b.prototype=new d;b.__super__=c.prototype;return b};
d.paper=function(b,c,e,f){b="undefined"!==typeof Raphael&&null!==Raphael?Raphael(b,c,e):d.canvas(b,c,e);c=b.rect(0,0,c,e).attr({fill:"white",opacity:0,"stroke-width":0});c.click(f.handleEvent("reset"));d.mouseEvents(f,c,!1);d.touchEvents(f.handleEvent,c,!0);return b};d.mouseEvents=function(b,c,e){var f,h,k,g,l,m;k=b.handleEvent("select");e&&(g=null);m=h=l=f=null;return c.drag(function(c,k,r,q){if(null!=m&&null!=l){if(f={x:l.x+c,y:l.y+k},h=b.facet.getFacetInfo(b.dims,f.x,f.y),null!=g&&null!=h&&h.col===
m.col&&h.row===m.row&&e)return r={x:Math.min(l.x,f.x),y:Math.min(l.y,f.y),width:Math.abs(l.x-f.x),height:Math.abs(l.y-f.y)},g=g.attr(r)}else if(c=d.offset(b.dom),l={x:r-c.left,y:q-c.top},m=b.facet.getFacetInfo(b.dims,l.x,l.y),null!=m&&e)return g=b.paper.rect(l.x,l.y,0,0,2),g=g.attr({fill:"black",opacity:0.2})},function(){return f=l=null},function(){if(null!=l&&null!=f)return null!=g&&e&&(g=g.hide(),g.remove()),k({start:l,end:f})})};d.touchEvents=function(b,c,d){null==d&&(d=!0);if(d)return c.touchstart(b("touchstart")),
c.touchend(b("touchend")),c.touchmove(b("touchmove")),c.touchcancel(b("touchcancel"))};d.render=function(b,c,e,f){return function(h,k,g){null==h&&(h={});null==k&&(k=!1);null==g&&(g=!0);if(null==f.type)throw d.error.unknown("Coordinate don't have at type?");if(null==m[f.type])throw d.error.input("Unknown coordinate type "+f.type);return{add:function(l,r,q,p){var n;if(null==m[f.type][l.type])throw d.error.input("Coord "+f.type+" has no mark "+l.type);n=m[f.type][l.type].render(c,e,f,h,l,g);n.data("m",
l);r&&0<_.keys(r).length&&n.data("e",r);q&&n.data("t",q);null!=k&&n.attr("clip-rect",k);"guide"===p?n.click(b("guide-click")):"guide-title"===p||"guide-titleH"===p||"guide-titleV"===p?n.click(b(p)):(n.click(b("click")),n.hover(b("mover"),b("mout")));d.touchEvents(b,n,!0);return n},remove:function(b){return b.remove()},animate:function(b,c,d,l){m[f.type][c.type].animate(b,e,f,h,c,g);null!=k&&b.attr("clip-rect",k);d&&0<_.keys(d).length&&b.data("e",d);l&&b.data("t",l);b.data("m",c);return b}}}};h=function(){function b(){}
b.prototype.render=function(b,c,d,e,f,h){var k;b=this._make(b);d=this.attr(c,d,e,f,h);for(k in d)c=d[k],b.attr(k,c);return b};b.prototype._make=function(){throw d.error.impl();};b.prototype.animate=function(b,c,d,e,f,h){return b.animate(this.attr(c,d,e,f,h),300)};b.prototype.attr=function(b,c,e,f,h){throw d.error.impl();};b.prototype._cantRender=function(b){throw d.error.missingdata();};b.prototype._makePath=function(b,c,d){null==d&&(d="L ");return("spline"===d?_.map(b,function(b,d){return(0===d?
"M "+b+" "+c[d]+" R ":"")+(""+b+" "+c[d])}):_.map(b,function(b,e){return(0===e?"M ":d)+b+" "+c[e]})).join(" ")};b.prototype._maybeApply=function(b,c,d){c=c[d];return _.isObject(c)&&"identity"===c.f?c.v:null!=b[d]?b[d].f(c):c};b.prototype._applyOffset=function(b,c,d){var e;if(!d)return{x:b,y:c};null==d.x&&(d.x=0);null==d.y&&(d.y=0);return{x:_.isArray(b)?function(){var c,f,h;h=[];c=0;for(f=b.length;c<f;c++)e=b[c],h.push(e+d.x);return h}():b+d.x,y:_.isArray(c)?function(){var b,f,h;h=[];b=0;for(f=c.length;b<
f;b++)e=c[b],h.push(e+d.y);return h}():c+d.y}};b.prototype._shared=function(b,c,d){var e,f=this;e=function(e){if(null!=c[e]&&null==d[e])return d[e]=f._maybeApply(b,c,e)};e("opacity");e("stroke-width");e("stroke-dasharray");e("stroke-dashoffset");e("transform");e("font-size");e("font-weight");e("font-family");return d};b.prototype._checkPointUndefined=function(b,c,e){null==e&&(e="Point");if(void 0===b||void 0===c)throw d.error.missing(""+e+" cannot be plotted due to undefined data.");};b.prototype._checkArrayUndefined=
function(b,c,e){var f;null==e&&(e="Line");if(_.all(function(){var d,e,h;h=[];f=d=0;for(e=b.length-1;0<=e?d<=e:d>=e;f=0<=e?++d:--d)h.push(void 0===b[f]||void 0===c[f]);return h}()))throw d.error.missing(""+e+" cannot be plotted due to too many missing points.");};b.prototype._checkArrayNaN=function(b,c){var d,e;e=_.map(_.zip(b,c),function(b,c){return isNaN(b[0])||isNaN(b[1])?void 0:b});return{x:function(){var b,c,f;f=[];b=0;for(c=e.length;b<c;b++)d=e[b],null!=d&&f.push(d[0]);return f}(),y:function(){var b,
c,f;f=[];b=0;for(c=e.length;b<c;b++)d=e[b],null!=d&&f.push(d[1]);return f}()}};return b}();g=function(b){function c(){return q=c.__super__.constructor.apply(this,arguments)}F(c,b);c.prototype.animate=function(b,c,d,e,f,h){var k,g;g=b.data("m");k=this.attr(c,d,e,f,h);if(_.isEqual(g.x,f.x))return b.animate(k,300);c=this.attr(c,d,e,g,h);return b.animate(c,300,function(){return b.attr(k)})};return c}(h);n=function(b){function c(){return v=c.__super__.constructor.apply(this,arguments)}F(c,b);c.prototype._make=
function(b){return b.circle()};c.prototype.attr=function(b,c,d,e,f){f=c.getXY(f,e);c=f.x;f=f.y;this._checkPointUndefined(c,f,"Circle");d=this._applyOffset(c,f,d);c=d.x;f=d.y;d=this._maybeApply(b,e,e.stroke?"stroke":"color");d={cx:c,cy:f,r:this._maybeApply(b,e,"size"),stroke:d};(c=this._maybeApply(b,e,"color"))&&"none"!==c&&(d.fill=c);return this._shared(b,e,d)};return c}(h);b=function(b){function c(){return s=c.__super__.constructor.apply(this,arguments)}F(c,b);c.prototype._make=function(b){return b.path()};
c.prototype.attr=function(b,c,d,e,f){var h;f=c.getXY(f,e);c=f.x;f=f.y;this._checkArrayUndefined(c,f,"Path");d=this._applyOffset(c,f,d);c=d.x;f=d.y;h=this._maybeApply(b,e,e.stroke?"stroke":"color");d=this._maybeApply(b,e,e.size?"size":"stroke-width");return this._shared(b,e,{path:this._makePath(c,f),stroke:h,"stroke-width":d})};return c}(h);c=function(b){function c(){return u=c.__super__.constructor.apply(this,arguments)}F(c,b);c.prototype._make=function(b){return b.path()};c.prototype.attr=function(b,
c,e,f,h){var k,g;k=d.sortArrays(b.x.compare,[f.x,f.y]);f.x=k[0];f.y=k[1];h=c.getXY(h,f);c=h.x;h=h.y;this._checkArrayUndefined(c,h,"Line");k=0;for(g=c.length;k<g;++k);e=this._applyOffset(c,h,e);c=e.x;h=e.y;e=this._checkArrayNaN(c,h);c=e.x;h=e.y;k=this._maybeApply(b,f,f.stroke?"stroke":"color");e=this._maybeApply(b,f,f.size?"size":"stroke-width");return this._shared(b,f,{path:this._makePath(c,h),stroke:k,"stroke-width":e})};return c}(g);r=function(b){function c(){return k=c.__super__.constructor.apply(this,
arguments)}F(c,b);c.prototype.attr=function(b,c,e,f,h){var k,g;k=d.sortArrays(b.x.compare,[f.x,f.y]);f.x=k[0];f.y=k[1];h=c.getXY(h,f);c=h.x;h=h.y;this._checkArrayUndefined(c,h,"Spline");k=0;for(g=c.length;k<g;++k);e=this._applyOffset(c,h,e);c=e.x;h=e.y;e=this._checkArrayNaN(c,h);c=e.x;h=e.y;k=this._maybeApply(b,f,f.stroke?"stroke":"color");e=this._maybeApply(b,f,f.size?"size":"stroke-width");return this._shared(b,f,{path:this._makePath(c,h,"spline"),stroke:k,"stroke-width":e})};return c}(c);e=function(b){function c(){return x=
c.__super__.constructor.apply(this,arguments)}F(c,b);c.prototype.attr=function(b,c,e,f,h){var k,g,l,m,r;m=c.getXY(h,f);h=m.x;r=m.y;c=m.r;m=m.t;this._checkArrayUndefined(h,r,"Line");r=this._applyOffset(h,r,e);h=r.x;r=r.y;var q,p;if(_.max(c)-_.min(c)<d["const"].epsilon)for(c=c[0],e="M "+h[0]+" "+r[0],g=q=1,p=h.length-1;1<=p?q<=p:q>=p;g=1<=p?++q:--q)l=Math.abs(m[g]-m[g-1])>Math.PI?1:0,k=0<m[g]-m[g-1]?1:0,e+="A "+c+" "+c+" 0 "+l+" "+k+" "+h[g]+" "+r[g];else e=this._makePath(h,r);c=this._maybeApply(b,
f,f.stroke?"stroke":"color");return this._shared(b,f,{path:e,stroke:c})};return c}(c);g=function(b){function c(){return p=c.__super__.constructor.apply(this,arguments)}F(c,b);c.prototype._make=function(b){return b.path()};c.prototype.attr=function(b,c,e,f,h){var k,g,l;k=d.sortArrays(b.x.compare,[f.x,f.y.top]);g=k[0];l=k[1];k=c.getXY(h,{x:g,y:l});k=this._applyOffset(k.x,k.y,e);l=d.sortArrays(function(c,d){return-b.x.compare(c,d)},[f.x,f.y.bottom]);g=l[0];l=l[1];c=c.getXY(h,{x:g,y:l});c=this._applyOffset(c.x,
c.y,e);g=k.x.concat(c.x);l=k.y.concat(c.y);return this._shared(b,f,{path:this._makePath(g,l),stroke:this._maybeApply(b,f,"color"),fill:this._maybeApply(b,f,"color"),"stroke-width":"0px"})};return c}(g);f=function(b){function c(){return t=c.__super__.constructor.apply(this,arguments)}F(c,b);c.prototype._make=function(b){return b.rect()};c.prototype.attr=function(b,c,d,e,f){f=c.getXY(f,e);c=f.x;f=f.y;this._checkPointUndefined(c[0],f[0],"Bar");this._checkPointUndefined(c[1],f[1],"Bar");d=this._applyOffset(c,
f,d);c=d.x;f=d.y;d=this._maybeApply(b,e,e.stroke?"stroke":"color");return this._shared(b,e,{x:_.min(c),y:_.min(f),width:Math.abs(c[1]-c[0]),height:Math.abs(f[1]-f[0]),fill:this._maybeApply(b,e,"color"),stroke:d,"stroke-width":this._maybeApply(b,e,"stroke-width")})};return c}(h);l=function(b){function c(){return z=c.__super__.constructor.apply(this,arguments)}F(c,b);c.prototype._make=function(b){return b.path()};c.prototype.attr=function(b,c,e,f,h){var k,g,l,m;k=f.x;g=k[0];k=k[1];m=f.y;l=m[0];m=m[1];
this._checkPointUndefined(g,l,"Bar");this._checkPointUndefined(k,m,"Bar");f.x=[g,g,k,k];f.y=[l,m,m,l];k=c.getXY(h,f);g=k.x;l=k.y;h=k.r;k=k.t;e=this._applyOffset(g,l,e);g=e.x;l=e.y;c.flip&&(g.push(g.splice(0,1)[0]),l.push(l.splice(0,1)[0]),h.push(h.splice(0,1)[0]),k.push(k.splice(0,1)[0]));2*Math.PI-Math.abs(k[1]-k[0])<d["const"].epsilon?(c="M "+g[0]+" "+l[0]+" A "+h[0]+" "+h[0]+" 0 1 1 "+g[0]+" "+(l[0]+2*h[0])+" A "+h[1]+" "+h[1]+" 0 1 1 "+g[1]+" "+l[1],c+="M "+g[2]+" "+l[2]+" A "+h[2]+" "+h[2]+" 0 1 0 "+
g[2]+" "+(l[2]+2*h[2])+" A "+h[3]+" "+h[3]+" 0 1 0 "+g[3]+" "+l[3]+" Z"):(e=Math.abs(k[1]-k[0])>Math.PI?1:0,c="M "+g[0]+" "+l[0]+" A "+h[0]+" "+h[1]+" 0 "+e+" 1 "+g[1]+" "+l[1],e=Math.abs(k[3]-k[2])>Math.PI?1:0,c+="L "+g[2]+" "+l[2]+" A "+h[2]+" "+h[3]+" 0 "+e+" 0 "+g[3]+" "+l[3]+" Z");e=this._maybeApply(b,f,f.stroke?"stroke":"color");return this._shared(b,f,{path:c,fill:this._maybeApply(b,f,"color"),stroke:e,"stroke-width":this._maybeApply(b,f,"stroke-width")})};return c}(h);h=function(b){function c(){return D=
c.__super__.constructor.apply(this,arguments)}F(c,b);c.prototype._make=function(b){return b.text()};c.prototype.attr=function(b,c,d,e,f){var h;f=c.getXY(f,e);c=f.x;f=f.y;this._checkPointUndefined(c,f,"Text");d=this._applyOffset(c,f,d);c=d.x;f=d.y;return this._shared(b,e,{x:c,y:f,r:10,text:this._maybeApply(b,e,"text"),"font-size":this._maybeApply(b,e,"size"),"text-anchor":null!=(h=e["text-anchor"])?h:"left",fill:this._maybeApply(b,e,"color")||"black"})};return c}(h);m={cartesian:{circle:new n,line:new c,
pline:new c,area:new g,path:new b,text:new h,rect:new f,spline:new r},polar:{circle:new n,path:new b,line:new c,pline:new e,area:new g,text:new h,rect:new l,spline:new r}}}).call(this);(function(){var g=[].indexOf||function(d){for(var g=0,c=this.length;g<c;g++)if(g in this&&this[g]===d)return g;return-1};d.handler={};d.handler.tooltip=function(){var g,l,c,b,e;c={};l=g=null;e=function(c){return function(e){e=d.getXY(g,e);if(null!=c.text)return b(c,e)}};b=function(b,c){return function(b,d){var e,f,
g,l,k,n;f=[d.x,d.y];l=f[0];f=f[1];if(null!=b.text)return g=b.text.getBBox().height,l={x:l,y:f-g/2-20},g=b.text.getBBox(),k=g.x,n=g.y,e=g.width,g=g.height,e={x:k-5,y:n-5,width:e+10,height:g+10},0>e.y&&(e.y=n+30+g,l.y=f+g/2+15),e.x+e.width>c&&(f=e.x+e.width-c,e.x-=f/2,l.x-=f/2),0>e.x&&(e.x+=e.x/2,l.x+=e.x/2),b.box.attr(e),b.text.attr(l)}};return function(f,h,r,m){var q,v,s;g=d.offset(m.dom);q=h.paper;l=b(m.dims.chartHeight,m.dims.chartWidth);if("mover"===f||"mout"===f)return null!=c.text&&(c.text.remove(),
c.box.remove()),c={},"mover"===f&&h.tooltip?(f=d.getXY(g,r),h.getBBox(),r=[f.x,f.y],v=r[0],r=r[1],c.text=q.text(v,r,h.tooltip(m.scaleSet.scales)).attr({"text-anchor":"middle",fill:"white"}),m=c.text.getBBox(),m=m.height,c.text.attr({y:r-m/2-20}),m=c.text.getBBox(),v=m.x,s=m.y,r=m.width,m=m.height,c.box=q.rect(v-5,s-5,r+10,m+10,10),c.box.attr({fill:"#213"}),c.text.toFront(),l(c,f),h.mousemove(e(c))):"function"===typeof h.unmousemove?h.unmousemove(null):void 0}};d.handler.drilldown=function(n,l,c){var b,
e;null==c&&(c={});if(!_.isArray(l))throw d.error.input("Parameter `levels` should be an array.");if(0>g.call(d["const"].aes,n))throw d.error.input("Unknown aesthetic "+n+".");b=0;e=[c];return function(c,d,g,m){var q,v;if("reset"===c&&0<b){d=m.spec;e.pop();c=e.unshift();b--;v=d.layers;g=0;for(q=v.length;g<q;g++)d=v[g],d.filter=c,d[n]=l[b],d.id=l[b];return m.make(m.spec)}if("click"===c&&b<l.length-1&&(c=d.evtData,d=m.spec,g=c[l[b]])){c={};c[l[b]]=g;b++;c=_.extend(_.clone(e[e.length-1]),c);v=d.layers;
g=0;for(q=v.length;g<q;g++)d=v[g],d.filter=c,d[n]=l[b],d.id=l[b];e.push(c);return m.make(m.spec)}}};d.handler.zoom=function(g,l){var c,b,e,f,h,r;null==l&&(l={x:!0,y:!0});if(null==g)throw d.error.input("Initial specification missing.");b={x:_.clone(null!=(f=g.guides)?f.x:void 0),y:_.clone(null!=(h=g.guides)?h.y:void 0)};e=void 0;c=["x","y"];r=function(b){return function(c,d,e,f){return"reset"===c?_.isFunction(b)?b("resetZoom",d,e,f):b.handle("resetZoom",d,e,f):_.isFunction(b)?b(c,d,e,f):b.handle(c,
d,e,f)}};return function(f,h,g,n){var u,k,x,p,t,z,D,B,F,G;null==e&&(e=_.clone(n.handlers));if("cartesian"===n.coord.type){if("resetZoom"===f){u=n.spec;k=0;for(x=c.length;k<x;k++)g=c[k],u.guides[g]=_.clone(b[g]);n.handlers=_.clone(e);n.make(n.spec)}if("select"===f){h=h.evtData;u=n.spec.guides;D=n.spec.layers;G=[];x=0;for(t=D.length;x<t;x++){k=D[x];p=0;for(z=c.length;p<z;p++)g=c[p],l[g]&&null!=k[g]&&(f=k[g]["var"],("num"===(B=n.axes.domains[g].type)||"date"===B)&&h[f].le-h[f].ge>d["const"].epsilon&&
(null==u[g]&&(u[g]={min:null,max:null}),F=[h[f].ge,h[f].le],u[g].min=F[0],u[g].max=F[1]),"cat"===n.axes.domains[g].type&&0!==h[f]["in"].length&&(null==u[g]&&(u[g]={levels:null}),u[g].levels=h[f]["in"]));n.handlers=_.map(n.handlers,r);G.push(n.make(n.spec))}return G}}}}}).call(this);(function(){var g,n=[].indexOf||function(d){for(var c=0,b=this.length;c<b;c++)if(c in this&&this[c]===d)return c;return-1};d.facet={};d.facet.make=function(){return new g};g=function(){function g(){this.type="none";this.mapping=
{};this.specgroups=[];this.groups=[];this.panes={};this.deletedPanes=[]}g.prototype.make=function(c){var b,d;this.spec=c;c=this._getMappings(this.spec.facet);this.type=c.type;this.mapping=d=c.mapping;this.groups=_.values(this.mapping);this.specgroups={};for(b in d)c=d[b],this.spec.facet[b]&&(this.specgroups[c]=this.spec.facet[b]);this.spec.facet.formatter&&(this.formatter=this.spec.facet.formatter);this.style={};this.spec.facet.size&&(this.style.size=this.spec.facet.size);if(this.spec.facet.color)return this.style.color=
this.spec.facet.color};g.prototype.calculate=function(c,b){var e,f,h,g,l;e=this._makeIndices(c,this.specgroups);this.values=e.values;this.indices=e.indices;"none"===this.type?this.rows=this.cols=1:(this.cols=this.spec.facet.cols,this.rows=this.spec.facet.rows,"wrap"===this.type?(e=this.values[this.mapping["var"]].length,this.cols||this.rows||(this.cols=Math.min(3,e)),this.cols?this.rows=Math.ceil(e/this.cols):this.rows&&(this.cols=Math.ceil(e/this.rows))):(this.rows=this.mapping.y?this.values[this.mapping.y].length:
1,this.cols=this.mapping.x?this.values[this.mapping.x].length:1));this.datas=this._groupData(c,this.indices);e=d.compare(_.keys(this.panes),_.keys(this.indices));f=e.deleted;e=e.added;g=0;for(l=f.length;g<l;g++)h=f[g],this.deletedPanes.push(this.panes[h]),delete this.panes[h];g=0;for(l=e.length;g<l;g++)h=e[g],f=this.formatter?this.formatter(this.indices[h]):h,this.panes[h]=d.pane.make(this.indices[h],_.extend({title:f},this.style));e=this.indices;f=[];for(h in e)f.push(this.panes[h].make(this.spec,
this.datas[h],b));return f};g.prototype.render=function(c,b,d){var f,h,g,l,q,n;if(0<this.deletedPanes.length){f=c({},!1,!1);n=this.deletedPanes;g=0;for(q=n.length;g<q;g++)l=n[g],l.dispose(f);this.deletedPanes=[]}q=this.panes;n=[];for(h in q)l=q[h],g=this.getOffset(b,h),f=d.clipping(g),n.push(l.render(c,g,f,b));return n};g.prototype.dispose=function(c){var b,d,f,h;f=this.panes;for(b in f)d=f[b],this.deletedPanes.push(d),delete this.panes[b];if(c){h=this.deletedPanes;b=0;for(f=h.length;b<f;b++)d=h[b],
d.dispose(c);return this.deletedPanes=[]}};g.prototype.getGrid=function(){return{cols:this.cols,rows:this.rows}};g.prototype.getOffset=function(c,b){var d;d=this._getRowCol(b);return{x:c.paddingLeft+c.guideLeft+(c.eachWidth+c.horizontalSpacing)*d.col,y:c.paddingTop+c.guideTop+(c.eachHeight+c.verticalSpacing)*d.row+c.verticalSpacing}};g.prototype.edge=function(c){var b,d,f,h,g,l,q,v,s=this;if("none"===this.type)return function(){return!0};"grid"===this.type?(v=function(b){return _.indexOf(s.values[s.mapping.y],
s.indices[b][s.mapping.y])},b=function(b){return _.indexOf(s.values[s.mapping.x],s.indices[b][s.mapping.x])}):(b=function(b){return _.indexOf(s.values[s.mapping["var"]],s.indices[b][s.mapping["var"]])%s.cols},v=function(b){return Math.floor(_.indexOf(s.values[s.mapping["var"]],s.indices[b][s.mapping["var"]])/s.cols)});if("none"===c)return function(){return!1};if("out"===c)return function(){return!0};f="top"===c||"bottom"===c?b:v;q="top"===c?v:"bottom"===c?function(b){return-v(b)}:"left"===c?b:"right"===
c?function(c){return-b(c)}:void 0;c={};for(h in this.indices)if(l=f(h),g=q(h),!c[l]||g<c[l].v)c[l]={v:g,k:h};d=_.pluck(c,"k");return function(b){return 0<=n.call(d,b)}};g.prototype.getEvtData=function(c,b){var d,f,h,g;h={};g=this.mapping;for(d in g)f=g[d],h[f]="x"===d||"y"===d?{"in":this.values[f][c]}:{"in":this.values[f][this.rows*b+c]};return h};g.prototype.getFacetInfo=function(c,b,e,f){var h,g,l;if(f){if(null==f.col||null==f.row)throw d.error.impl("Preset rows & columns are not present.");h=f.col;
l=f.row}else h=(b-c.paddingLeft-c.guideLeft)/(c.eachWidth+c.horizontalSpacing),h=Math.floor(h),l=(e-c.paddingTop-c.guideTop-c.verticalSpacing)/(c.eachHeight+c.verticalSpacing),l=Math.floor(l);if(0>h||h>=this.cols||0>l||l>=this.rows)return null;g={x:c.paddingLeft+c.guideLeft+(c.eachWidth+c.horizontalSpacing)*h,y:c.paddingTop+c.guideTop+(c.eachHeight+c.verticalSpacing)*l+c.verticalSpacing};b={x:b-g.x,y:e-g.y};if(!f&&(b.x>c.eachWidth||b.y>c.eachHeight))return null;b.x=Math.max(Math.min(b.x,c.eachWidth),
0);b.y=Math.max(Math.min(b.y,c.eachHeight),0);return{row:l,col:h,offset:g,adjusted:b,evtData:this.getEvtData(h,l)}};g.prototype._getMappings=function(c){var b;b={type:"none",mapping:{}};if(_.isObject(c))if("wrap"===c.type){b.type="wrap";if(!c["var"])throw d.error.defn("You didn't specify a variable to facet on.");c["var"]&&(b.mapping["var"]=c["var"]["var"])}else if("grid"===c.type){b.type="grid";if(!c.x&&c.y)throw d.error.defn("You didn't specify a variable to facet on.");c.x&&(b.mapping.x=c.x["var"]);
c.y&&(b.mapping.y=c.y["var"])}return b};g.prototype._makeIndices=function(c,b){var e,f,h,g,l,q,n,s;n={};for(e in b)if(g=b[e],g.levels)n[g["var"]]=g.levels;else{q=[];for(h in c){f=c[h];if(l=f.metaData[g["var"]])!l||"num"!==(s=l.type)&&"date"!==s||d.type.compare(l.type);q=_.uniq(_.union(q,_.pluck(f.statData,g["var"])))}n[g["var"]]=q}e=d.cross(n);f={};h=d.stringify(_.pluck(b,"var"));l=0;for(q=e.length;l<q;l++)g=e[l],f[h(g)]=g;return{values:n,indices:f}};g.prototype._groupData=function(c,b){var e,f,h,
g,l,n,v;f=d.groupProcessedData(c,this.groups);e={};v=this.indices;for(h in v){g=v[h];for(l=f;!0===l.grouped;)n=g[l.key],l=l.values[n];e[h]=l}return e};g.prototype._getRowCol=function(c){var b;b={row:0,col:0};"wrap"===this.type?(c=this.indices[c][this.mapping["var"]],c=_.indexOf(this.values[this.mapping["var"]],c),b.col=c%this.cols,b.row=Math.floor(c/this.cols)):"grid"===this.type&&(b.row=_.indexOf(this.values[this.mapping.y],this.indices[c][this.mapping.y]),b.col=_.indexOf(this.values[this.mapping.x],
this.indices[c][this.mapping.x]));return b};return g}();d.groupProcessedData=function(g,c){var b,e,f,h,n,m,q,v,s;if(0===c.length)return g;b=c.splice(0,1)[0];m=[];for(f in g)e=g[f],b in e.metaData&&(m=_.union(m,_.uniq(_.pluck(e.statData,b))));n={grouped:!0,key:b,values:{}};v=0;for(s=m.length;v<s;v++){q=m[v];h={};for(f in g)e=g[f],h[f]={metaData:e.metaData},h[f].statData=b in e.metaData?d.filter(e.statData,b,q):_.clone(e.statData);n.values[q]=d.groupProcessedData(h,_.clone(c))}return n}}).call(this);
(function(){var g,n={}.hasOwnProperty,l=function(c,b){function d(){this.constructor=c}for(var f in b)n.call(b,f)&&(c[f]=b[f]);d.prototype=b.prototype;c.prototype=new d;c.__super__=b.prototype;return c};g=function(c){function b(c,d){b.__super__.constructor.call(this);this.eventName="title-click";this.detail={type:d,data:c}}l(b,c);return b}(function(){function c(){this.eventName="polyjsEvent";this.cancelable=this.bubbles=!0;this.detail={type:null,data:null}}c.prototype.dispatch=function(b){var c;c=
new CustomEvent(this.eventName,{detail:this.detail});if(null!=b)return b.dispatchEvent(c)};return c}());d.event={};d.event.make=function(c,b){if("guide-title"===c||"guide-titleH"===c||"guide-titleV"===c)return new g(b,c);throw d.error.defn("No such event "+c+".");}}).call(this);(function(){var g,n=function(c,b){return function(){return c.apply(b,arguments)}},l=[].indexOf||function(c){for(var b=0,d=this.length;b<d;b++)if(b in this&&this[b]===c)return b;return-1};g=function(){function c(b,c,f){null==
c&&(c=null);null==f&&(f=null);this.handleEvent=n(this.handleEvent,this);this.render=n(this.render,this);this.mergeDomains=n(this.mergeDomains,this);this.merge=n(this.merge,this);this.maybeDispose=n(this.maybeDispose,this);if(null==b)throw d.error.defn("No graph specification is passed in!");this.handlers=[];this.coord=this.paper=this.dims=this.legends=this.axes=this.scaleSet=null;this.facet=d.facet.make();this.dataSubscribed=[];this.callback=c;this.prepare=f;this.make(b);this.addHandler(d.handler.tooltip())}
c.prototype.maybeDispose=function(b){var c;c=d.render(this.handleEvent,this.paper,this.scaleSet.scales,this.coord);c=c();if(this.coord&&!_.isEqual(this.coord.spec,b.coord))return this.scaleSet&&(this.scaleSet.disposeGuides(c),this.scaleSet=null),this.coord=null};c.prototype.make=function(b){var c,f,g,l,m,n,v,s,u,k=this;null!=b?(b=d.spec.toStrictMode(b),d.spec.check(b),this.spec=b):b=this.spec;this.scaleSet&&this.maybeDispose(b);null==this.coord&&(this.coord=d.coord.make(this.spec.coord));this.facet.make(b);
f=this.handleEvent("data");g=function(){var c,d,e,f;e=b.layers;f=[];l=c=0;for(d=e.length;c<d;l=++c)m=e[l],f.push(m.data);return f}();u=_.difference(g,this.dataSubscribed);v=0;for(s=u.length;v<s;v++)c=u[v],c.subscribe(f);this.dataSubscribed=g;n=_.after(b.layers.length,this.merge);this.dataprocess={};this.processedData={};return _.each(b.layers,function(c,e){var f;b=k.spec.layers[e];f=_.values(k.facet.specgroups);k.dataprocess[e]=new d.DataProcess(b,f,b.strict);return k.dataprocess[e].make(b,f,function(b,
c,f){if(null!=b)if(console.error(b),null!=k.callback)k.callback(b,null);else throw d.error.defn("Error processing data!");k.processedData[e]={statData:c,metaData:f};return n()})})};c.prototype.merge=function(){var b=this;this.layers=_.map(this.spec.layers,function(c){return d.layer.make(c,b.spec.strict,b.spec.guides)});this.facet.calculate(this.processedData,this.layers);this.mergeDomains();return this.render()};c.prototype.mergeDomains=function(){var b,c,f;b=_.map(this.facet.panes,function(b){return b.domains});
b=d.domain.merge(b);this.scaleSet||(c=d.dim.guess(this.spec,this.facet.getGrid()),this.coord.make(c),f=this.coord.ranges(),this.scaleSet=d.scaleset(f,this.coord));this.scaleSet.make(this.spec.guides,b,this.layers);this.dims=this._makeDimensions(this.spec,this.scaleSet,this.facet,c);this.coord.make(this.dims);this.ranges=this.coord.ranges();return this.scaleSet.setRanges(this.ranges)};c.prototype.render=function(){var b,c;if(null==this.spec.render||!1!==this.spec.render)if(b=this.scaleSet.scales,this.coord.setScales(b),
this.scaleSet.coord=this.coord,c=this.scaleSet.makeGuides(this.spec,this.dims),this.axes=c.axes,this.titles=c.titles,this.legends=c.legends,null!=this.prepare&&this.prepare(this),this.dom=this.spec.dom,null==this.paper&&(this.paper=this._makePaper(this.dom,this.dims.width,this.dims.height,this)),b=d.render(this.handleEvent,this.paper,b,this.coord),this.facet.render(b,this.dims,this.coord),this.scaleSet.renderGuides(this.dims,b,this.facet),null!=this.callback)return this.callback(null,this)};c.prototype.addHandler=
function(b){if(0>l.call(this.handlers,b))return this.handlers.push(b)};c.prototype.removeHandler=function(b){return this.handlers.splice(_.indexOf(this.handlers,b),1)};c.prototype.handleEvent=function(b){var c;c=this;return _.throttle(function(f){var g,l,m,n,v;if("touchstart"===b||"touchmove"===b||"touchend"===b||"touchcancel"===b)d.touch(b,this,f,c);else if("select"===b){l=f.start;g=f.end;l=c.facet.getFacetInfo(c.dims,l.x,l.y);if(!l)return;n=l.col;v=l.row;m=l.adjusted;l=_.clone(m);m=c.facet.getFacetInfo(c.dims,
g.x,g.y,{col:n,row:v}).adjusted;g=_.clone(m);this.evtData="cartesian"===c.coord.type?c.scaleSet.fromPixels(l,g):null}else if("data"===b)this.evtData={};else if("reset"===b||"click"===b||"mover"===b||"mout"===b||"guide-click"===b)this.tooltip=this.data("t"),this.evtData=this.data("e");else if("guide-title"===b||"guide-titleH"===b||"guide-titleV"===b)this.tooltip=this.data("t"),this.evtData=this.data("e"),f=d.event.make(b,this),f.dispatch(c.dom);v=c.handlers;m=[];l=0;for(n=v.length;l<n;l++)g=v[l],_.isFunction(g)?
m.push(g(b,this,f,c)):m.push(g.handle(b,this,f,c));return m},300)};c.prototype._makeScaleSet=function(b,c,f){b=this.coord.ranges();return d.scaleset(b,this.coord)};c.prototype._makeDimensions=function(b,c,f,g){c.makeGuides(b,g);return d.dim.make(b,c,f.getGrid())};c.prototype._makePaper=function(b,c,f,g){return d.paper(b,c,f,g)};return c}();d.chart=function(c,b,e){try{return new g(c,b,e)}catch(f){if(null!=b)return b(f,null);throw d.error.defn("Bad specification.");}}}).call(this)}return{data:d.data,
chart:d.chart,handler:d.handler,debug:d}}(window.polyjs);
